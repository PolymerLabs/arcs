!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),function(t){var e=n(2),r=n(240),i=n(235),s=n(224),o=n(4),a=n(31),c=n(182),u=n(44),l=n(246),h=n(174),d=n(252),f=n(253);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const p={version:"0.6",Arc:e.Arc,Manifest:a.Manifest,Planificator:r.Planificator,SlotComposer:i.SlotComposer,SlotDomConsumer:s.SlotDomConsumer,Type:o.Type,BrowserLoader:f.BrowserLoader,StorageProviderFactory:u.StorageProviderFactory,ParticleExecutionContext:c.ParticleExecutionContext,RecipeResolver:h.RecipeResolver,KeyManager:l.KeyManager,firebase:d.firebase};("undefined"==typeof window?t:window).__ArcsLib__=p}.call(this,n(1))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),n.d(e,"Arc",function(){return y});var r=n(3),i=n(4),s=n(14),o=n(43),a=n(34),c=n(31),u=n(180),l=n(37),h=n(181),d=n(44),f=n(169),p=n(197),g=n(234);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class y{constructor({id:t,context:e,pecFactory:n,slotComposer:r,loader:i,storageKey:o,storageProviderFactory:l,speculative:y,recipeIndex:v}){this.nextLocalID=0,this._activeRecipe=new a.Recipe,this._recipes=[],this.dataChangeCallbacks=new Map,this.storesById=new Map,this.storageKeys={},this.storeTags=new Map,this.storeDescriptions=new Map,this.instantiatePlanCallbacks=[],this.sessionId=f.Id.newSessionId(),this.particleHandleMaps=new Map,this._context=e||new c.Manifest({id:t}),this.pecFactory=n||Object(h.FakePecFactory)(i).bind(null),this.id=this.sessionId.fromString(t),this.speculative=!!y,this._loader=i,this.storageKey=o;const m=this.generateID(),_=this.pecFactory(m);this.pec=new s.ParticleExecutionHost(_,r,this),r&&(r.arc=this),this.storageProviderFactory=l||new d.StorageProviderFactory(this.id),this._description=new u.Description(this),this._recipeIndex=v||new g.RecipeIndex(this._context,i,r&&r.modality),this.debugHandler=new p.ArcDebugHandler(this)}get loader(){return this._loader}get description(){return this._description}get recipeIndex(){return this._recipeIndex}registerInstantiatePlanCallback(t){this.instantiatePlanCallbacks.push(t)}unregisterInstantiatePlanCallback(t){const e=this.instantiatePlanCallbacks.indexOf(t);return e>=0&&(this.instantiatePlanCallbacks.splice(e,1),!0)}dispose(){this.instantiatePlanCallbacks=[],this.pec.close(),this.pec.slotComposer&&this.pec.slotComposer.dispose()}async _waitForIdle(){let t;do{t=this.pec.messageCount,await this.pec.idle}while(this.pec.messageCount!==t+2)}get idle(){return this.waitForIdlePromise||(this.waitForIdlePromise=this._waitForIdle().then(()=>this.waitForIdlePromise=null)),this.waitForIdlePromise}get isSpeculative(){return this.speculative}async _serializeHandle(t,e,n){const r=t.type.getContainedType()||t.type;r instanceof i.InterfaceType&&(e.interfaces+=r.interfaceShape.toString()+"\n");const s=this.storageProviderFactory.parseStringAsKey(t.storageKey),o=[...this.storeTags.get(t)||[]].map(t=>`#${t}`).join(" "),a=this.activeRecipe.findHandle(t.id),c=a?a.originalId:null;let u=`'${t.id}'`;switch(c&&(u+=`!!'${c}'`),s.protocol){case"firebase":case"pouchdb":e.handles+=`store ${n} of ${t.type.toString()} ${u} @${null===t.version?0:t.version} ${o} at '${t.storageKey}'\n`;break;case"volatile":{let r=[];if(o.includes("nosync")||(r=(await t.toLiteral()).model.map(({id:t,value:e,index:n})=>{if(null==e)return null;let r;if(e.rawData){r={$id:t};for(const t of Object.keys(e.rawData))r[t]=e.rawData[t]}else r=e;return void 0!==n&&(r.$index=n),r})),t.referenceMode&&r.length>0){const i=r[0].storageKey;if(!e.dataResources.has(i)){const r=`${n}_Data`;e.dataResources.set(i,r),await t.ensureBackingStore(),await this._serializeHandle(t.backingStore,e,r)}const s=e.dataResources.get(i);r.forEach(t=>{t.storageKey=s})}e.resources+=`resource ${n}Resource\n`;const i="  ";e.resources+=i+"start\n";const s=JSON.stringify(r);e.resources+=s.split("\n").map(t=>i+t).join("\n"),e.resources+="\n",e.handles+=`store ${n} of ${t.type.toString()} ${u} @${t.version||0} ${o} in ${n}Resource\n`;break}default:throw new Error(`unknown storageKey protocol ${s.protocol}`)}}async _serializeHandles(){const t={handles:"",resources:"",interfaces:"",dataResources:new Map};let e=0;const n=new Set,r=new Set,i=new Set(this.context.stores.map(t=>t.id));for(const t of this._activeRecipe.handles)if("map"===t.fate)n.add(this.context.findManifestUrlForHandleId(t.id));else{if(t.immediateValue)continue;r.add(t.id)}for(const e of n.values())t.resources+=`import '${e}'\n`;for(const n of this._stores)r.has(n.id)&&!i.has(n.id)&&await this._serializeHandle(n,t,`Store${e++}`);return t.resources+t.interfaces+t.handles}_serializeParticles(){const t=[];t.push(...this._activeRecipe.particles.map(t=>t.spec)),t.push(...this._activeRecipe.handles.filter(t=>t.immediateValue).map(t=>t.immediateValue));const e=[];return t.forEach(t=>{for(const n of t.connections)n.type instanceof i.InterfaceType&&e.push(n.type.interfaceShape.toString());e.push(t.toString())}),e.join("\n")}_serializeStorageKey(){return this.storageKey?`storageKey: '${this.storageKey}'\n`:""}async serialize(){return await this.idle,`\nmeta\n  name: '${this.id}'\n  ${this._serializeStorageKey()}\n\n${await this._serializeHandles()}\n\n${this._serializeParticles()}\n\n@active\n${this.activeRecipe.toString()}`}static async deserialize({serialization:t,pecFactory:e,slotComposer:n,loader:i,fileName:s,context:o}){const a=await c.Manifest.parse(t,{loader:i,fileName:s,context:o}),u=new y({id:a.meta.name,storageKey:a.meta.storageKey,slotComposer:n,pecFactory:e,loader:i,storageProviderFactory:a.storageProviderFactory,context:o});await Promise.all(a.stores.map(async t=>{const e=a.storeTags.get(t);t instanceof c.StorageStub&&(t=await t.inflate()),u._registerStore(t,e)}));const l=a.activeRecipe.clone(),h={errors:new Map};return Object(r.assert)(l.normalize(h),`Couldn't normalize recipe ${l.toString()}:\n${[...h.errors.values()].join("\n")}`),await u.instantiate(l),u}get context(){return this._context}get activeRecipe(){return this._activeRecipe}get recipes(){return this._recipes}loadedParticles(){return[...this.particleHandleMaps.values()].map(({spec:t})=>t)}_instantiateParticle(t){t.id=this.generateID("particle");const e={spec:t.spec,handles:new Map};this.particleHandleMaps.set(t.id,e);for(const[e,n]of Object.entries(t.connections)){if(!n.handle){Object(r.assert)(n.isOptional);continue}const i=this.findStoreById(n.handle.id);Object(r.assert)(i,`can't find handle of id ${n.handle.id}`),this._connectParticleToHandle(t,e,i)}Object(r.assert)(e.handles.size>=e.spec.connections.filter(t=>!t.isOptional).length,"Not all mandatory connections are resolved for {$particle}"),this.pec.instantiate(t,e.spec,e.handles)}generateID(t=""){return this.id.createId(t).toString()}generateIDComponents(){return{base:this.id,component:()=>this.nextLocalID++}}get _stores(){return[...this.storesById.values()]}async cloneForSpeculativeExecution(){const t=new y({id:this.generateID().toString(),pecFactory:this.pecFactory,context:this.context,loader:this._loader,recipeIndex:this._recipeIndex,speculative:!0}),e=new Map;for(const n of this._stores){const r=await t.storageProviderFactory.construct(n.id,n.type,"volatile");await r.cloneFrom(n),e.set(n,r),this.storeDescriptions.has(n)&&t.storeDescriptions.set(r,this.storeDescriptions.get(n))}this.particleHandleMaps.forEach((n,r)=>{t.particleHandleMaps.set(r,{spec:n.spec,handles:new Map}),n.handles.forEach(n=>t.particleHandleMaps.get(r).handles.set(n.name,e.get(n)))});const{particles:n,handles:r,slots:i}=this._activeRecipe.mergeInto(t._activeRecipe);let s=0,o=0,c=0;this._recipes.forEach(e=>{const u={particles:[],handles:[],slots:[],innerArcs:new Map,patterns:e.patterns};e.particles.forEach(t=>{if(u.particles.push(n[s++]),e.innerArcs.has(t)){const n=e.innerArcs.get(t),r=u.particles[u.particles.length-1],i={activeRecipe:new a.Recipe,recipes:[]},s=n.activeRecipe.mergeInto(i.activeRecipe);n.recipes.forEach(t=>{const e={particles:[],handles:[],slots:[],innerArcs:new Map};let n=0;t.particles.forEach(t=>{e.particles.push(s.particles[n++])}),n=0,t.handles.forEach(t=>{e.handles.push(s.handles[n++])}),n=0,t.slots.forEach(t=>{e.slots.push(s.slots[n++])}),i.recipes.push(e)}),u.innerArcs.set(r,i)}}),e.handles.forEach(t=>{u.handles.push(r[o++])}),e.slots.forEach(t=>{u.slots.push(i[c++])}),t._recipes.push(u)});for(const n of e.values())t._registerStore(n,[]);return t}async instantiate(t,e){Object(r.assert)(t.isResolved(),`Cannot instantiate an unresolved recipe: ${t.toString({showUnresolved:!0})}`);let n={activeRecipe:this._activeRecipe,recipes:this._recipes};if(e){const t=this._recipes.find(t=>!!t.particles.find(t=>t===e.particle)).innerArcs;t.has(e.particle)||t.set(e.particle,{activeRecipe:new a.Recipe,recipes:[]}),n=t.get(e.particle)}const{handles:i,particles:s,slots:o}=t.mergeInto(n.activeRecipe);n.recipes.push({particles:s,handles:i,slots:o,innerArcs:new Map,patterns:t.patterns}),o.forEach(t=>t.id=t.id||`slotid-${this.generateID()}`);for(const t of i){if(["copy","create"].includes(t.fate)){let e=t.type;"create"===t.fate&&Object(r.assert)(e.maybeEnsureResolved(),`Can't assign resolved type to ${e}`),e=e.resolvedType(),Object(r.assert)(e.isResolved(),`Can't create handle for unresolved type ${e}`);const n=await this.createStore(e,null,this.generateID(),t.tags,t.immediateValue?"volatile":null);if(t.immediateValue){const e=t.immediateValue;Object(r.assert)(t.type.interfaceShape.particleMatches(e));const i=e.clone().toLiteral();i.id=n.id,await n.set(i)}else if("copy"===t.fate){const e=this.findStoreById(t.id);Object(r.assert)(e,`Cannot find store ${t.id}`),Object(r.assert)(null!==e.version,`Copied store ${t.id} doesn't have version.`),await n.cloneFrom(e),this._tagStore(n,this.findStoreTags(e));const i=this.getStoreDescription(e);i&&this.storeDescriptions.set(n,i)}t.id=n.id,t.fate="use",t.storageKey=n.storageKey;continue}if(this.storesById.has(t.id))continue;let e=t.storageKey;e||(e=this.keyForId(t.id)),Object(r.assert)(e,`couldn't find storage key for handle '${t}'`);const n=t.type.resolvedType();Object(r.assert)(n.isResolved());const i=await this.storageProviderFactory.connect(t.id,n,e);Object(r.assert)(i,`store '${t.id}' was not found`),this._registerStore(i,t.tags)}s.forEach(t=>this._instantiateParticle(t)),this.pec.slotComposer&&this.pec.slotComposer.initializeRecipe(s),this.isSpeculative||e||this.instantiatePlanCallbacks.forEach(e=>e(t)),this.debugHandler.recipeInstantiated({handles:i,particles:s,slots:o})}_connectParticleToHandle(t,e,n){Object(r.assert)(n,"no target handle provided");const i=this.particleHandleMaps.get(t.id);Object(r.assert)(void 0!==i.spec.connectionMap.get(e),"can't connect handle to a connection that doesn't exist"),i.handles.set(e,n)}async createStore(t,e,n,s,o){Object(r.assert)(t instanceof i.Type,`can't createStore with type ${t} that isn't a Type`),t instanceof i.RelationType&&(t=i.Type.newCollection(t)),void 0==n&&(n=this.generateID()),void 0==o&&this.storageKey&&(o=this.storageProviderFactory.parseStringAsKey(this.storageKey).childKeyForHandle(n).toString());(void 0==o||(t=>t&&(Array.isArray(t)&&t.includes("nosync")||"nosync"===t))(s))&&(o="volatile");const a=await this.storageProviderFactory.construct(n,t,o);return Object(r.assert)(a,`failed to create store with id [${n}]`),a.name=e,this._registerStore(a,s),a}_registerStore(t,e){Object(r.assert)(!this.storesById.has(t.id),`Store already registered '${t.id}'`),e=e||[],e=Array.isArray(e)?e:[e],this.storesById.set(t.id,t),this.storeTags.set(t,new Set(e)),this.storageKeys[t.id]=t.storageKey,t.on("change",()=>this._onDataChange(),this)}_tagStore(t,e){Object(r.assert)(this.storesById.has(t.id)&&this.storeTags.has(t),`Store not registered '${t.id}'`);const n=this.storeTags.get(t);(e||[]).forEach(t=>n.add(t))}_onDataChange(){for(const t of this.dataChangeCallbacks.values())t()}onDataChange(t,e){this.dataChangeCallbacks.set(e,t)}clearDataChange(t){this.dataChangeCallbacks.delete(t)}static _typeToKey(t){const e=t.getContainedType();if(e){const t=this._typeToKey(e);if(t)return`list:${t}`}else{if(t instanceof i.EntityType)return t.entitySchema.name;if(t.isShape)return t.shapeShape;if(t instanceof i.VariableType&&t.isResolved())return y._typeToKey(t.resolvedType())}}findStoresByType(t,e){const n=y._typeToKey(t);let r=[...this.storesById.values()].filter(e=>{if(n){const t=y._typeToKey(e.type);if(n===t)return!0}else{if(t instanceof i.VariableType&&!t.isResolved()&&e.type instanceof i.EntityType)return!0;const n=t.getContainedType();if(n&&n instanceof i.VariableType&&!n.isResolved()&&t.tag===e.type.tag)return!0}return!1});return e&&e.tags&&e.tags.length>0&&(r=r.filter(t=>0===e.tags.filter(e=>!this.storeTags.get(t).has(e)).length)),r.filter(e=>!!o.Handle.effectiveType(t,[{type:e.type,direction:e.type instanceof i.InterfaceType?"host":"inout"}]))}findStoreById(t){let e=this.storesById.get(t);return null==e&&(e=this._context.findStoreById(t)),e}findStoreTags(t){return this.storeTags.has(t)?this.storeTags.get(t):this._context.findStoreTags(t)}getStoreDescription(t){return Object(r.assert)(t,"Cannot fetch description for nonexistent store"),this.storeDescriptions.get(t)||t.description}getStoresState(t){const e=new Map;return this.storesById.forEach((t,n)=>e.set(n,t.version)),(t||{}).includeContext&&this._context.allStores.forEach(t=>e.set(t.id,t.version)),e}keyForId(t){return this.storageKeys[t]}stop(){this.pec.stop()}toContextString(t){const e=[];return[...this.storesById.values()].sort(l.compareComparables).forEach(t=>{e.push(t.toString([...this.storeTags.get(t)]))}),this._activeRecipe.isEmpty()||e.push(this._activeRecipe.toString()),e.join("\n")}}},function(t,e,n){"use strict";function r(t,e){if(!t)throw new Error(e)}n.r(e),n.d(e,"assert",function(){return r})},function(t,e,n){"use strict";n.r(e),n.d(e,"Type",function(){return a}),n.d(e,"EntityType",function(){return c}),n.d(e,"VariableType",function(){return u}),n.d(e,"CollectionType",function(){return l}),n.d(e,"BigCollectionType",function(){return h}),n.d(e,"RelationType",function(){return d}),n.d(e,"InterfaceType",function(){return f}),n.d(e,"SlotType",function(){return p}),n.d(e,"ReferenceType",function(){return g}),n.d(e,"ArcInfoType",function(){return y}),n.d(e,"HandleInfoType",function(){return v});var r=n(5),i=n(7),s=n(13),o=n(6);
// @license
class a{constructor(t,e){this.tag=t,this.data=e}static newEntity(t){return new c(t)}static newVariable(t){return new u(t)}static newCollection(t){return new l(t)}static newBigCollection(t){return new h(t)}static newRelation(t){return new d(t)}static newInterface(t){return new f(t)}static newSlot(t){return new p(t)}static newReference(t){return new g(t)}static newArcInfo(){return new y}static newHandleInfo(){return new v}static fromLiteral(t){switch(t.tag){case"Entity":return new c(r.Schema.fromLiteral(t.data));case"Variable":return new u(i.TypeVariable.fromLiteral(t.data));case"Collection":return new l(a.fromLiteral(t.data));case"BigCollection":return new h(a.fromLiteral(t.data));case"Relation":return new d(t.data);case"Interface":return new f(s.Shape.fromLiteral(t.data));case"Slot":return new p(t.data);case"Reference":return new g(a.fromLiteral(t.data));case"ArcInfo":return new y;case"HandleInfo":return new v;default:throw new Error(`fromLiteral: unknown type ${t}`)}}static unwrapPair(t,e){if(t.tag===e.tag){const n=t.getContainedType();if(null!==n)return a.unwrapPair(n,e.getContainedType())}return[t,e]}static canMergeConstraints(t,e){return a._canMergeCanReadSubset(t,e)&&a._canMergeCanWriteSuperset(t,e)}static _canMergeCanReadSubset(t,e){if(t.canReadSubset&&e.canReadSubset){if(t.canReadSubset.tag!==e.canReadSubset.tag)return!1;if(t.canReadSubset instanceof c)return null!==r.Schema.intersect(t.canReadSubset.entitySchema,e.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${t.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(t,e){if(t.canWriteSuperset&&e.canWriteSuperset){if(t.canWriteSuperset.tag!==e.canWriteSuperset.tag)return!1;if(t.canWriteSuperset instanceof c)return null!==r.Schema.union(t.canWriteSuperset.entitySchema,e.canWriteSuperset.entitySchema)}return!0}equals(t){return o.TypeChecker.compareTypes({type:this},{type:t})}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(t){return this}_applyExistenceTypeTest(t){return t(this)}get hasVariable(){return this._applyExistenceTypeTest(t=>t instanceof u)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(t=>t instanceof u&&!t.variable.isResolved())}primitiveType(){return null}getContainedType(){return null}isTypeContainer(){return!1}collectionOf(){return new l(this)}bigCollectionOf(){return new h(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(t){return this.tag===t.tag&&this._isMoreSpecificThan(t)}_isMoreSpecificThan(t){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(t){const e=this.resolvedType();if(e instanceof u){if(t.has(e.variable))return new u(t.get(e.variable));{const n=i.TypeVariable.fromLiteral(e.variable.toLiteral());return t.set(e.variable,n),new u(n)}}return e.data.clone?a.fromLiteral({tag:e.tag,data:e.data.clone(t)}):a.fromLiteral(e.toLiteral())}_cloneWithResolutions(t){return a.fromLiteral(this.toLiteral())}toLiteral(){return this}hasProperty(t){return t(this)||this._hasProperty(t)}_hasProperty(t){return!1}toString(t){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}}class c extends a{get entitySchema(){return this.data}constructor(t){super("Entity",t)}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(t){return this.entitySchema.isMoreSpecificThan(t.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(t){return this.entitySchema.toInlineSchemaString(t)}getEntitySchema(){return this.entitySchema}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}}class u extends a{get variable(){return this.data}constructor(t){super("Variable",t)}get isVariable(){return!0}mergeTypeVariablesByName(t){const e=this.variable.name;let n=t.get(e);if(n){if(n instanceof u&&(n.variable.hasConstraint||this.variable.hasConstraint)){if(!n.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else n=this,t.set(e,this);return n}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_cloneWithResolutions(t){if(t.has(this.variable))return new u(t.get(this.variable));{const e=i.TypeVariable.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(e.resolution=this.variable.resolution._cloneWithResolutions(t)),this.variable._canReadSubset&&(e.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(t)),this.variable._canWriteSuperset&&(e.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(t)),t.set(this.variable,e),new u(e)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(t){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class l extends a{get collectionType(){return this.data}constructor(t){super("Collection",t)}get isCollection(){return!0}mergeTypeVariablesByName(t){const e=this.collectionType,n=e.mergeTypeVariablesByName(t);return n===e?this:n.collectionOf()}_applyExistenceTypeTest(t){return this.collectionType._applyExistenceTypeTest(t)}primitiveType(){return this.collectionType}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const t=this.collectionType,e=t.resolvedType();return t!==e?e.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}_cloneWithResolutions(t){return new l(this.collectionType._cloneWithResolutions(t))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(t){return this.collectionType.hasProperty(t)}toString(t){return`[${this.collectionType.toString(t)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const t=this.getEntitySchema();return t&&t.description.plural?t.description.plural:`${this.collectionType.toPrettyString()} List`}}class h extends a{get bigCollectionType(){return this.data}constructor(t){super("BigCollection",t)}get isBigCollection(){return!0}mergeTypeVariablesByName(t){const e=this.bigCollectionType,n=e.mergeTypeVariablesByName(t);return n===e?this:n.bigCollectionOf()}_applyExistenceTypeTest(t){return this.bigCollectionType._applyExistenceTypeTest(t)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const t=this.bigCollectionType,e=t.resolvedType();return t!==e?e.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}_cloneWithResolutions(t){return new h(this.bigCollectionType._cloneWithResolutions(t))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(t){return this.bigCollectionType.hasProperty(t)}toString(t){return`BigCollection<${this.bigCollectionType.toString(t)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const t=this.getEntitySchema();return t&&t.description.plural?t.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class d extends a{get relationEntities(){return this.data}constructor(t){super("Relation",t)}get isRelation(){return!0}toPrettyString(){return JSON.stringify(this.relationEntities)}}class f extends a{get interfaceShape(){return this.data}constructor(t){super("Interface",t)}get isInterface(){return!0}mergeTypeVariablesByName(t){const e=this.interfaceShape.clone(new Map);return e.mergeTypeVariablesByName(t),new f(e)}_applyExistenceTypeTest(t){return this.interfaceShape._applyExistenceTypeTest(t)}resolvedType(){return new f(this.interfaceShape.resolvedType())}_canEnsureResolved(){return this.interfaceShape.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceShape.maybeEnsureResolved()}get canWriteSuperset(){return new f(this.interfaceShape.canWriteSuperset)}get canReadSubset(){return new f(this.interfaceShape.canReadSubset)}_isMoreSpecificThan(t){return this.interfaceShape.isMoreSpecificThan(t.interfaceShape)}_cloneWithResolutions(t){return new f(this.interfaceShape._cloneWithResolutions(t))}toLiteral(){return{tag:this.tag,data:this.interfaceShape.toLiteral()}}toString(t){return this.interfaceShape.name}toPrettyString(){return this.interfaceShape.toPrettyString()}}class p extends a{get slot(){return this.data}constructor(t){super("Slot",t)}get isSlot(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(t){return!0}toString(t){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let n="";return 0!==e.length&&(n=` {${e.join(", ")}}`),`Slot${n}`}toPrettyString(){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let e="";return 0!==t.length&&(e=` {${t.join(", ")}}`),`Slot${e}`}}class g extends a{get referredType(){return this.data}constructor(t){super("Reference",t)}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const t=this.referredType,e=t.resolvedType();return t!==e?new g(e):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canReadSubset(){return this.referredType.canReadSubset}_cloneWithResolutions(t){return new g(this.referredType._cloneWithResolutions(t))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(t){return"Reference<"+this.referredType.toString()+">"}}class y extends a{constructor(){super("ArcInfo",null)}get isArcInfo(){return!0}}class v extends a{constructor(){super("HandleInfo",null)}get isHandleInfo(){return!0}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Schema",function(){return c});var r=n(3),i=n(4),s=n(6),o=n(8),a=n(10);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(t){Object(r.assert)(t.fields),this._model=t,this.description={},t.description&&t.description.description.forEach(t=>this.description[t.name]=t.pattern||t.patterns[0])}toLiteral(){const t={},e=t=>{if("schema-reference"===t.kind){const e=t.schema;return{kind:"schema-reference",schema:{kind:e.kind,model:e.model.toLiteral()}}}return"schema-collection"===t.kind?{kind:"schema-collection",schema:e(t.schema)}:t};for(const n of Object.keys(this._model.fields))t[n]=e(this._model.fields[n]);return{names:this._model.names,fields:t,description:this.description}}static fromLiteral(t={fields:{},names:[],description:{}}){const e={},n=t=>{if("schema-reference"===t.kind){const e=t.schema;return{kind:"schema-reference",schema:{kind:e.kind,model:i.Type.fromLiteral(e.model)}}}return"schema-collection"===t.kind?{kind:"schema-collection",schema:n(t.schema)}:t};for(const r of Object.keys(t.fields))e[r]=n(t.fields[r]);const r=new c({names:t.names,fields:e});return r.description=t.description||{},r}get fields(){return this._model.fields}get names(){return this._model.names}get name(){return this.names[0]}static typesEqual(t,e){return c._typeString(t)===c._typeString(e)}static _typeString(t){if("object"!=typeof t)return Object(r.assert)("string"==typeof t),t;switch(t.kind){case"schema-union":return`(${t.types.join(" or ")})`;case"schema-tuple":return`(${t.types.join(", ")})`;case"schema-reference":return`Reference<${c._typeString(t.schema)}>`;case"type-name":case"schema-inline":return t.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${c._typeString(t.schema)}]`;default:throw new Error(`Unknown type kind ${t.kind} in schema ${this.name}`)}}static union(t,e){const n=[...new Set([...t.names,...e.names])],r={};for(const[n,i]of[...Object.entries(t.fields),...Object.entries(e.fields)])if(r[n]){if(!c.typesEqual(r[n],i))return null}else r[n]=i;return new c({names:n,fields:r})}static intersect(t,e){const n=[...t.names].filter(t=>e.names.includes(t)),r={};for(const[n,i]of Object.entries(t.fields)){const t=e.fields[n];t&&c.typesEqual(i,t)&&(r[n]=i)}return new c({names:n,fields:r})}equals(t){return this===t||this.name===t.name&&this.isMoreSpecificThan(t)&&t.isMoreSpecificThan(this)}isMoreSpecificThan(t){const e=new Set(this.names);for(const n of t.names)if(!e.has(n))return!1;const n={};for(const[t,e]of Object.entries(this.fields))n[t]=e;for(const[e,r]of Object.entries(t.fields)){if(void 0==n[e])return!1;if(!c.typesEqual(n[e],r))return!1}return!0}get type(){return i.Type.newEntity(this)}entityClass(t=null){const e=this,n=this.name,c=["toJSON","prototype","toString","inspect"],u=t=>{switch(t){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Object":return"object";default:throw new Error(`Unknown field type ${t} in schema ${n}`)}},l=this.fields,h=(t,e,n)=>d(t,e,l[e],n),d=(t,e,r,o)=>{if(void 0===r)throw new Error(`Can't ${t} field ${e}; not in schema ${n}`);if(void 0!==o&&null!==o)if("object"==typeof r)switch(r.kind){case"schema-union":for(const t of r.types)if(typeof o===u(t))return;throw new TypeError(`Type mismatch ${t}ting field ${e} (union [${r.types}]); `+`value '${o}' is type ${typeof o}`);case"schema-tuple":if(!Array.isArray(o))throw new TypeError(`Cannot ${t} tuple ${e} with non-array value '${o}'`);if(o.length!==r.types.length)throw new TypeError(`Length mismatch ${t}ting tuple ${e} `+`[${r.types}] with value '${o}'`);r.types.map((n,i)=>{if(void 0!==o[i]&&null!==o[i]&&typeof o[i]!==u(n))throw new TypeError(`Type mismatch ${t}ting field ${e} (tuple [${r.types}]); `+`value '${o}' has type ${typeof o[i]} at index ${i}`)});break;case"schema-reference":if(!(o instanceof a.Reference))throw new TypeError(`Cannot ${t} reference ${e} with non-reference '${o}'`);if(!s.TypeChecker.compareTypes({type:o.type},{type:i.Type.newReference(r.schema.model)}))throw new TypeError(`Cannot ${t} reference ${e} with value '${o}' of mismatched type`);break;case"schema-collection":if("Set"!==o.constructor.name)throw new TypeError(`Cannot ${t} collection ${e} with non-Set '${o}'`);for(const n of o)d(t,e,r.schema,n);break;default:throw new Error(`Unknown kind ${r.kind} in schema ${n}`)}else if(typeof o!==u(r))throw new TypeError(`Type mismatch ${t}ting field ${e} (type ${r}); `+`value '${o}' is type ${typeof o}`)},f=class extends o.Entity{constructor(t,e){super(e),this.rawData=new Proxy({},{get:(t,e)=>{if(c.includes(e)||e.constructor===Symbol)return;const n=t[e];return h("get",e,n),n},set:(t,e,n)=>(h("set",e,n),t[e]=n,!0)}),Object(r.assert)(t,"can't construct entity with null data");const n=this.sanitizeData(t);for(const[t,e]of Object.entries(n))this.rawData[t]=e}sanitizeData(t){const e={};for(const[n,r]of Object.entries(t))e[n]=this.sanitizeEntry(l[n],r,n);return e}sanitizeEntry(e,n,r){if(!e)return n;if("schema-reference"===e.kind&&n){if(n instanceof a.Reference)return n;if(n.id&&n.storageKey)return new a.Reference(n,i.Type.newReference(e.schema.model),t);throw new TypeError(`Cannot set reference ${r} with non-reference '${n}'`)}if("schema-collection"===e.kind&&n){if("Set"===n.constructor.name)return n;if(n.length&&n instanceof Object)return new Set(n.map(t=>this.sanitizeEntry(e.schema,t,r)));throw new TypeError(`Cannot set collection ${r} with non-collection '${n}'`)}return n}dataClone(){const t={};for(const n of Object.keys(e.fields))void 0!==this.rawData[n]&&(l[n]&&"schema-reference"===l[n].kind?t[n]=this.rawData[n].dataClone():l[n]&&"schema-collection"===l[n].kind?t[n]=[...this.rawData[n]].map(t=>t.dataClone()):t[n]=this.rawData[n]);return t}static get type(){return i.Type.newEntity(this.key.schema)}static get key(){return{tag:"entity",schema:e}}};Object.defineProperty(f,"type",{value:this.type}),Object.defineProperty(f,"name",{value:this.name});for(const t of Object.keys(this.fields))Object.defineProperty(f.prototype,t,{get(){return this.rawData[t]},set(e){this.rawData[t]=e}});return f}toInlineSchemaString(t){const e=this.names.join(" ")||"*",n=Object.entries(this.fields).map(([t,e])=>`${c._typeString(e)} ${t}`).join(", ");return`${e} {${n.length>0&&t&&t.hideFields?"...":n}}`}toManifestString(){const t=[];if(t.push(`schema ${this.names.join(" ")}`),t.push(...Object.entries(this.fields).map(([t,e])=>`  ${c._typeString(e)} ${t}`)),Object.keys(this.description).length>0){t.push(`  description \`${this.description.pattern}\``);for(const e of Object.keys(this.description))"pattern"!==e&&t.push(`    ${e} \`${this.description[e]}\``)}return t.join("\n")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"TypeChecker",function(){return s});var r=n(4),i=n(7);class s{static processTypeList(t,e){const n=new i.TypeVariable("",null,null);t&&(n.resolution=t),t=r.Type.newVariable(n);const o=[];for(const n of e)if(n.type.resolvedType().hasVariable){if(null==(t=s._tryMergeTypeVariable(t,n.type)))return null}else o.push(n);for(const e of o)if(!s._tryMergeConstraints(t,e))return null;const a=t=>t instanceof r.VariableType?null==t.canReadSubset||null==t.canWriteSuperset?t:t.canReadSubset.isMoreSpecificThan(t.canWriteSuperset)?(t.canWriteSuperset.isMoreSpecificThan(t.canReadSubset)&&(t.variable.resolution=t.canReadSubset),t):null:t,c=t.resolvedType();if(c instanceof r.CollectionType){const t=a(c.collectionType);return null!==t?t.collectionOf():null}if(c instanceof r.BigCollectionType){const t=a(c.bigCollectionType);return null!==t?t.bigCollectionOf():null}return a(c)}static _tryMergeTypeVariable(t,e){const[n,i]=r.Type.unwrapPair(t.resolvedType(),e.resolvedType());if(n instanceof r.VariableType){if(i instanceof r.VariableType){if(!1===n.variable.maybeMergeConstraints(i.variable))return null;i.variable.resolution=n}else n.variable.resolution=i;return t}if(i instanceof r.VariableType)return i.variable.resolution=n,e;if(n instanceof r.InterfaceType&&i instanceof r.InterfaceType){const t=n.interfaceShape.tryMergeTypeVariablesWith(i.interfaceShape);return null==t?null:r.Type.newInterface(t)}if(n.isTypeContainer()&&n.hasVariable||i.isTypeContainer()&&i.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(t,{type:e,direction:n}){let[o,a]=r.Type.unwrapPair(t.resolvedType(),e.resolvedType());if(o instanceof r.VariableType){for(;a.isTypeContainer();){if(null!=o.variable.resolution||null!=o.variable.canReadSubset||null!=o.variable.canWriteSuperset)return!1;const t=r.Type.newVariable(new i.TypeVariable("a",null,null));a instanceof r.CollectionType?o.variable.resolution=r.Type.newCollection(t):a instanceof r.BigCollectionType?o.variable.resolution=r.Type.newBigCollection(t):o.variable.resolution=r.Type.newReference(t);const e=r.Type.unwrapPair(o.resolvedType(),a);[o,a]=e}if(("out"===n||"inout"===n||"`provide"===n)&&!o.variable.maybeMergeCanReadSubset(a.canWriteSuperset))return!1;if(("in"===n||"inout"===n||"`consume"===n)&&!o.variable.maybeMergeCanWriteSuperset(a.canReadSubset))return!1}else{if(a.tag!==o.tag)return!1;if(("out"===n||"inout"===n)&&!s._writeConstraintsApply(o,a))return!1;if(("in"===n||"inout"===n)&&!s._readConstraintsApply(o,a))return!1}return!0}static _writeConstraintsApply(t,e){const n=e.canWriteSuperset;return null==n||null==t.canReadSubset||!!n.isMoreSpecificThan(t.canReadSubset)}static _readConstraintsApply(t,e){const n=e.canReadSubset;return null==n||null==t.canWriteSuperset||!!t.canWriteSuperset.isMoreSpecificThan(n)}static compareTypes(t,e){const n=t.type.resolvedType(),i=e.type.resolvedType(),[s,o]=r.Type.unwrapPair(n,i);if(s instanceof r.VariableType&&o.isTypeContainer())return!(s.variable.canReadSubset||s.variable.canWriteSuperset);if(o instanceof r.VariableType&&s.isTypeContainer())return!(o.variable.canReadSubset||o.variable.canWriteSuperset);if(s instanceof r.VariableType||o instanceof r.VariableType)return r.Type.canMergeConstraints(s,o);if(void 0===s!=(void 0===o))return!1;if(s===o)return!0;if(s.tag!==o.tag)return!1;if(s instanceof r.SlotType)return!0;if(s instanceof r.InterfaceType&&o instanceof r.InterfaceType&&s.interfaceShape.equals(o.interfaceShape))return!0;if(!(s instanceof r.EntityType&&o instanceof r.EntityType))return!1;const a=s.entitySchema.isMoreSpecificThan(o.entitySchema),c=o.entitySchema.isMoreSpecificThan(s.entitySchema);if(c&&a)return!0;if(!c&&!a)return!1;const[u,l]=c?[t,e]:[e,t],h=u.direction||(u.connection?u.connection.direction:"inout"),d=l.direction||(l.connection?l.connection.direction:"inout");return"in"===h||"out"===d}}},function(t,e,n){"use strict";n.r(e),n.d(e,"TypeVariable",function(){return o});var r=n(4),i=n(3),s=n(5);
// @license
class o{constructor(t,e,n){this.name=t,this._canWriteSuperset=e,this._canReadSubset=n,this._resolution=null}maybeMergeConstraints(t){return!!this.maybeMergeCanReadSubset(t.canReadSubset)&&this.maybeMergeCanWriteSuperset(t.canWriteSuperset)}maybeMergeCanReadSubset(t){if(null==t)return!0;if(null==this.canReadSubset)return this.canReadSubset=t,!0;if(this.canReadSubset instanceof r.SlotType&&t instanceof r.SlotType)return!0;const e=s.Schema.intersect(this.canReadSubset.entitySchema,t.entitySchema);return!!e&&(this.canReadSubset=r.Type.newEntity(e),!0)}maybeMergeCanWriteSuperset(t){if(null==t)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=t,!0;if(this.canWriteSuperset instanceof r.SlotType&&t instanceof r.SlotType)return!0;const e=s.Schema.union(this.canWriteSuperset.entitySchema,t.entitySchema);return!!e&&(this.canWriteSuperset=r.Type.newEntity(e),!0)}isSatisfiedBy(t){const e=this._canWriteSuperset;if(!e)return!0;if(!(e instanceof r.EntityType&&t instanceof r.EntityType))throw new Error(`constraint checking not implemented for ${this} and ${t}`);return t.getEntitySchema().isMoreSpecificThan(e.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}set resolution(t){Object(i.assert)(!this._resolution);const e=t.resolvedType().getContainedType();e instanceof r.VariableType&&Object(i.assert)(e.variable!==this,"variable cannot resolve to collection of itself");let n=t;for(;n&&n instanceof r.VariableType;){if(n.variable===this)return;n=n.variable.resolution}this._resolution=t,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(Object(i.assert)(!this._canWriteSuperset),this._resolution instanceof r.VariableType?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(t){Object(i.assert)(!this._resolution),this._canWriteSuperset=t}get canReadSubset(){return this._resolution?(Object(i.assert)(!this._canReadSubset),this._resolution instanceof r.VariableType?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(t){Object(i.assert)(!this._resolution),this._canReadSubset=t}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return Object(i.assert)(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(t){return new o(t.name,t.canWriteSuperset?r.Type.fromLiteral(t.canWriteSuperset):null,t.canReadSubset?r.Type.fromLiteral(t.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Entity",function(){return s});var r=n(3),i=n(9);
// @license
class s{constructor(t){Object(r.assert)(!t||-1===t.indexOf(":"),"user IDs must not contain the ':' character"),this[i.Symbols.identifier]=void 0,this.userIDComponent=t}get data(){}getUserID(){return this.userIDComponent}isIdentified(){return void 0!==this[i.Symbols.identifier]}get id(){return Object(r.assert)(!!this.isIdentified()),this[i.Symbols.identifier]}identify(t){Object(r.assert)(!this.isIdentified()),this[i.Symbols.identifier]=t;const e=t.split(":");"uid"===e[e.length-2]&&(this.userIDComponent=e[e.length-1])}createIdentity(t){let e;Object(r.assert)(!this.isIdentified()),e=this.userIDComponent?`${t.base}:uid:${this.userIDComponent}`:`${t.base}:${t.component()}`,this[i.Symbols.identifier]=e}toLiteral(){return this.rawData}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Symbols",function(){return r});
// @license
const r={identifier:Symbol("id")}},function(t,e,n){"use strict";n.r(e),n.d(e,"Reference",function(){return a});var r,i=n(3),s=n(4),o=n(11);!function(t){t[t.Unstored=0]="Unstored",t[t.Stored=1]="Stored"}(r||(r={}));class a{constructor(t,e,n){this.entity=null,this.storageProxy=null,this.handle=null,this.id=t.id,this.storageKey=t.storageKey,this.context=n,this.type=e}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Object(o.handleFor)(this.storageProxy),this.storageKey?Object(i.assert)(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return Object(i.assert)(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}static newClientReference(t){return class extends a{constructor(e){super({id:e.id,storageKey:null},new s.ReferenceType(e.constructor.type),t),this.mode=r.Unstored,this.entity=e,this.stored=new Promise(async(t,n)=>{await this.storeReference(e),t()})}async storeReference(t){await this.ensureStorageProxy(),await this.handle.store(t),this.mode=r.Stored}async dereference(){return this.mode===r.Unstored?null:super.dereference()}isIdentified(){return this.entity.isIdentified()}}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Handle",function(){return u}),n.d(e,"handleFor",function(){return p});var r=n(10),i=n(9),s=n(3),o=n(12),a=n(4);function c(t,e){Object(s.assert)(e,"Handles need entity classes for deserialization");const{id:n,rawData:r}=t,i=new e(
/** @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function(t){return t}(r));return t.id&&i.identify(t.id),i}class u{constructor(t,e,n,r,i){Object(s.assert)(!(t instanceof u)),this._proxy=t,this.name=e||this._proxy.name,this.canRead=r,this.canWrite=i,this._particleId=n,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}raiseSystemException(t,e){this._proxy.raiseSystemException(t,e,this._particleId)}configure(t){Object(s.assert)(this.canRead,"configure can only be called on readable Handles");try{const e=Object.keys(this.options),n=Object.keys(t).filter(t=>!e.includes(t));if(n.length>0)throw new Error(`Invalid option in Handle.configure(): ${n}`);Object.assign(this.options,t)}catch(t){throw this.raiseSystemException(t,"Handle::configure"),t}}_serialize(t){return Object(s.assert)(t,"can't serialize a null entity"),t.isIdentified()||t.createIdentity(this._proxy.generateIDComponents()),{id:t[i.Symbols.identifier],rawData:t.dataClone()}}get type(){return this._proxy.type}get _id(){return this._proxy.id}async store(t){throw new Error("unimplemented")}toManifestString(){return`'${this._id}'`}}class l extends u{_notify(t,e,n){switch(Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),t){case"sync":return void e.onHandleSync(this,this._restore(n));case"update":{const t={};return"add"in n&&(t.added=this._restore(n.add)),"remove"in n&&(t.removed=this._restore(n.remove)),t.originator=n.originatorId===this._particleId,void e.onHandleUpdate(this,t)}case"desync":return void e.onHandleDesync(this);default:throw new Error("unsupported")}}async get(t){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this._proxy.get(t,this._particleId)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this._proxy.toList())}_restore(t){return null!==t?t.map(t=>c(t,this.entityClass)):null}async store(t){if(!this.canWrite)throw new Error("Handle not writeable");const e=this._serialize(t),n=[this._proxy.generateID()+"key"];return this._proxy.store(e,n,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}async remove(t){if(!this.canWrite)throw new Error("Handle not writeable");const e=this._serialize(t);return this._proxy.remove(e.id,[],this._particleId)}}class h extends u{async _notify(t,e,n){switch(Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),t){case"sync":try{await e.onHandleSync(this,this._restore(n))}catch(t){this.raiseSystemException(t,`${e.name}::onHandleSync`)}return;case"update":try{await e.onHandleUpdate(this,{data:this._restore(n.data)})}catch(t){this.raiseSystemException(t,`${e.name}::onHandleUpdate`)}return;case"desync":try{await e.onHandleDesync(this)}catch(t){this.raiseSystemException(t,`${e.name}::onHandleDesync`)}return;default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const t=await this._proxy.get();return this._restore(t)}_restore(t){return null===t?null:this.type instanceof a.EntityType?c(t,this.entityClass):this.type instanceof a.InterfaceType?o.ParticleSpec.fromLiteral(t):this.type instanceof a.ReferenceType?new r.Reference(t,this.type,this._proxy.pec):void Object(s.assert)(!1,`Don't know how to deliver handle data of type ${this.type}`)}async set(t){try{if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.set(this._serialize(t),this._particleId)}catch(t){throw this.raiseSystemException(t,"Handle::set"),t}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}}class d{constructor(t,e){this._parent=t,this._cursorId=e}async next(){const t=await this._parent._proxy.cursorNext(this._cursorId);return t.done||(t.value=t.value.map(t=>c(t,this._parent.entityClass))),t}close(){this._parent._proxy.cursorClose(this._cursorId)}}class f extends u{configure(t){throw new Error("BigCollections do not support sync/update configuration")}async _notify(t,e,n){Object(s.assert)(this.canRead,"_notify should not be called for non-readable handles"),Object(s.assert)("sync"===t,"BigCollection._notify only supports sync events"),await e.onHandleSync(this,[])}async store(t){if(!this.canWrite)throw new Error("Handle not writeable");const e=this._serialize(t),n=[this._proxy.generateID()+"key"];return this._proxy.store(e,n,this._particleId)}async remove(t){if(!this.canWrite)throw new Error("Handle not writeable");const e=this._serialize(t);return this._proxy.remove(e.id,this._particleId)}async stream({pageSize:t,forward:e=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(t)||t<1)throw new Error("Streamed reads require a positive pageSize");const n=await this._proxy.stream(t,e);return new d(this,n)}}function p(t,e=null,n=0,r=!0,i=!0){let s;s=t.type instanceof a.CollectionType?new l(t,e,n,r,i):t.type instanceof a.BigCollectionType?new f(t,e,n,r,i):new h(t,e,n,r,i);const o=t.type.getContainedType()||t.type;return o instanceof a.EntityType&&(s.entityClass=o.entitySchema.entityClass(t.pec)),s}},function(t,e,n){"use strict";n.r(e),n.d(e,"ConnectionSpec",function(){return a}),n.d(e,"SlotSpec",function(){return c}),n.d(e,"ProvidedSlotSpec",function(){return u}),n.d(e,"ParticleSpec",function(){return l});var r=n(4),i=n(6),s=n(13),o=n(3);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a{constructor(t,e){this.parentConnection=null,this.rawData=t,this.direction=t.direction,this.name=t.name,this.type=t.type.mergeTypeVariablesByName(e),this.isOptional=t.isOptional,this.tags=t.tags||[],this.dependentConnections=[]}instantiateDependentConnections(t,e){for(const n of this.rawData.dependentConnections){const r=t.createConnection(n,e);r.parentConnection=this,this.dependentConnections.push(r)}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(t){return i.TypeChecker.compareTypes({type:t},{type:this.type,direction:this.direction})}}class c{constructor(t){this.name=t.name,this.isRequired=t.isRequired,this.isSet=t.isSet,this.tags=t.tags||[],this.formFactor=t.formFactor,this.providedSlots=[],t.providedSlots&&t.providedSlots.forEach(t=>{this.providedSlots.push(new u(t))})}getProvidedSlotSpec(t){return this.providedSlots.find(e=>e.name===t)}}class u{constructor(t){this.name=t.name,this.isRequired=t.isRequired||!1,this.isSet=t.isSet||!1,this.tags=t.tags||[],this.formFactor=t.formFactor,this.handles=t.handles||[]}}class l{constructor(t){this.model=t,this.name=t.name,this.verbs=t.verbs;const e=new Map;this.connections=[],t.args.forEach(t=>this.createConnection(t,e)),this.connectionMap=new Map,this.connections.forEach(t=>this.connectionMap.set(t.name,t)),this.inputs=this.connections.filter(t=>t.isInput),this.outputs=this.connections.filter(t=>t.isOutput),t.description=t.description||{},this.validateDescription(t.description),this.pattern=t.description.pattern,this.connections.forEach(e=>{e.pattern=t.description[e.name]}),this.implFile=t.implFile,this.modality=t.modality,this.slots=new Map,t.slots&&t.slots.forEach(t=>this.slots.set(t.name,new c(t))),this.slots.forEach(t=>{t.providedSlots.forEach(t=>{t.handles.forEach(t=>Object(o.assert)(this.connectionMap.has(t),"Cannot provide slot for nonexistent handle constraint ",t))})})}createConnection(t,e){const n=new a(t,e);return this.connections.push(n),n.instantiateDependentConnections(this,e),n}isInput(t){for(const e of this.inputs)if(e.name===t)return!0;return!1}isOutput(t){for(const e of this.outputs)if(e.name===t)return!0;return!1}getSlotSpec(t){return this.slots.get(t)}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}matchModality(t){return this.slots.size<=0||this.modality.includes(t)}toLiteral(){const{args:t,name:e,verbs:n,description:r,implFile:i,modality:s,slots:o}=this.model,a=({type:t,direction:e,name:n,isOptional:r,dependentConnections:i})=>({type:t.toLiteral(),direction:e,name:n,isOptional:r,dependentConnections:i.map(a)});return{args:t.map(t=>a(t)),name:e,verbs:n,description:r,implFile:i,modality:s,slots:o}}static fromLiteral(t){let{args:e,name:n,verbs:i,description:s,implFile:o,modality:a,slots:c}=t;const u=({type:t,direction:e,name:n,isOptional:i,dependentConnections:s})=>({type:r.Type.fromLiteral(t),direction:e,name:n,isOptional:i,dependentConnections:s?s.map(u):[]});return e=e.map(u),new l({args:e,name:n,verbs:i||[],description:s,implFile:o,modality:a,slots:c})}clone(){return l.fromLiteral(this.toLiteral())}equals(t){return JSON.stringify(this.toLiteral())===JSON.stringify(t.toLiteral())}validateDescription(t){Object.keys(t||[]).forEach(t=>{Object(o.assert)(["kind","location","pattern"].includes(t)||this.connectionMap.has(t),`Unexpected description for ${t}`)})}toInterface(){return r.Type.newInterface(this._toShape())}_toShape(){const t=this.model.args;Object(o.assert)(!this.slots.size,"please implement slots toShape");return new s.Shape(this.name,t,[])}toString(){const t=[];let e="";this.verbs.length>0&&(e=" "+this.verbs.map(t=>`&${t}`).join(" ")),t.push(`particle ${this.name}${e} in '${this.implFile}'`.trim());const n=(e,r)=>{const i=e.tags.map(t=>` #${t}`).join("");t.push(`${r}${e.direction}${e.isOptional?"?":""} ${e.type.toString()} ${e.name}${i}`);for(const t of e.dependentConnections)n(t,r+"  ")};for(const t of this.connections)t.parentConnection||n(t,"  ");return this.modality.filter(t=>"mock"!==t).forEach(e=>t.push(`  modality ${e}`)),this.slots.forEach(e=>{const n=[];e.isRequired&&n.push("must"),n.push("consume"),e.isSet&&n.push("set of"),n.push(e.name),e.tags.length>0&&n.push(e.tags.map(t=>`#${t}`).join(" ")),t.push(`  ${n.join(" ")}`),e.formFactor&&t.push(`    formFactor ${e.formFactor}`),e.providedSlots.forEach(e=>{const n=[];e.isRequired&&n.push("must"),n.push("provide"),e.isSet&&n.push("set of"),n.push(e.name),e.tags.length>0&&n.push(e.tags.map(t=>`#${t}`).join(" ")),t.push(`    ${n.join(" ")}`),e.formFactor&&t.push(`      formFactor ${e.formFactor}`),e.handles.forEach(e=>t.push(`      handle ${e}`))})}),this.pattern&&(t.push(`  description \`${this.pattern}\``),this.connections.forEach(e=>{e.pattern&&t.push(`    ${e.name} \`${e.pattern}\``)})),t.join("\n")}toManifestString(){return this.toString()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Shape",function(){return l});var r=n(3),i=n(4),s=n(6);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function o(t){return t&&"object"==typeof t?i.Type.fromLiteral(t):t}function a(t){return t&&t.toLiteral?t.toLiteral():t}const c=["type","name","direction"],u=["name","direction","isRequired","isSet"];class l{constructor(t,e,n){Object(r.assert)(t),Object(r.assert)(void 0!==e),Object(r.assert)(void 0!==n),this.name=t,this.handles=e,this.slots=n,this.typeVars=[];for(const t of e)for(const e of c)l.isTypeVar(t[e])&&this.typeVars.push({object:t,field:e});for(const t of n)for(const e of u)l.isTypeVar(t[e])&&this.typeVars.push({object:t,field:e})}toPrettyString(){return"SHAAAAPE"}mergeTypeVariablesByName(t){this.typeVars.map(({object:e,field:n})=>e[n]=e[n].mergeTypeVariablesByName(t))}get canReadSubset(){return this._cloneAndUpdate(t=>t.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(t=>t.canWriteSuperset)}isMoreSpecificThan(t){if(this.handles.length!==t.handles.length||this.slots.length!==t.slots.length)return!1;for(let e=0;e<this.typeVars.length;e++){const n=this.typeVars[e],r=t.typeVars[e];if(!n.object[n.field].isMoreSpecificThan(r.object[r.field]))return!1}return!0}_applyExistenceTypeTest(t){for(const e of this.typeVars)if(t(e.object[e.field]))return!0;return!1}_handlesToManifestString(){return this.handles.map(t=>{const e=t.type.resolvedType();return`  ${t.direction?t.direction+" ":""}${e.toString()} ${t.name?t.name:"*"}`}).join("\n")}_slotsToManifestString(){return this.slots.map(t=>`  ${t.direction} ${t.isSet?"set of ":""}${t.name?t.name+" ":""}`).join("\n")}toString(){return`shape ${this.name}\n${this._handlesToManifestString()}\n${this._slotsToManifestString()}\n`}static fromLiteral(t){const e=t.handles.map(t=>({type:o(t.type),name:o(t.name),direction:o(t.direction)})),n=t.slots.map(t=>({name:o(t.name),direction:o(t.direction),isRequired:o(t.isRequired),isSet:o(t.isSet)}));return new l(t.name,e,n)}toLiteral(){const t=this.handles.map(t=>({type:a(t.type),name:a(t.name),direction:a(t.direction)})),e=this.slots.map(t=>({name:a(t.name),direction:a(t.direction),isRequired:a(t.isRequired),isSet:a(t.isSet)}));return{name:this.name,handles:t,slots:e}}clone(t){const e=this.handles.map(({name:e,direction:n,type:r})=>({name:e,direction:n,type:r?r.clone(t):void 0})),n=this.slots.map(({name:t,direction:e,isRequired:n,isSet:r})=>({name:t,direction:e,isRequired:n,isSet:r}));return new l(this.name,e,n)}cloneWithResolutions(t){return this._cloneWithResolutions(t)}_cloneWithResolutions(t){const e=this.handles.map(({name:e,direction:n,type:r})=>({name:e,direction:n,type:r?r._cloneWithResolutions(t):void 0})),n=this.slots.map(({name:t,direction:e,isRequired:n,isSet:r})=>({name:t,direction:e,isRequired:n,isSet:r}));return new l(this.name,e,n)}canEnsureResolved(){for(const t of this.typeVars)if(!t.object[t.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const t of this.typeVars){let e=t.object[t.field];if(!(e=e.clone(new Map)).maybeEnsureResolved())return!1}for(const t of this.typeVars)t.object[t.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(t){if(!this._equalItems(t.slots,this.slots,this._equalSlot))return null;if(t.handles.length!==this.handles.length)return null;const e=new Set(this.handles),n=new Set(t.handles),r=new Map;let i=e.size;for(;e.size>0;){const t=[...e.values()].map(t=>({handle:t,match:[...n.values()].filter(e=>this._equalHandle(t,e))}));for(const i of t){if(0===i.match.length)return null;1===i.match.length&&(r.set(i.handle,i.match[0]),n.delete(i.match[0]),e.delete(i.handle))}if(e.size===i)return null;i=e.size}const o=[];for(const t of this.handles){const e=r.get(t);let n;if(t.type.hasVariable||e.type.hasVariable){if(!(n=s.TypeChecker._tryMergeTypeVariable(t.type,e.type)))return null}else n=t.type||e.type;o.push({name:t.name||e.name,direction:t.direction||e.direction,type:n})}const a=this.slots.map(({name:t,direction:e,isRequired:n,isSet:r})=>({name:t,direction:e,isRequired:n,isSet:r}));return new l(this.name,o,a)}resolvedType(){return this._cloneAndUpdate(t=>t.resolvedType())}equals(t){return this.handles.length===t.handles.length&&(!!this._equalItems(t.handles,this.handles,this._equalHandle)&&!!this._equalItems(t.slots,this.slots,this._equalSlot))}_equalHandle(t,e){return t.name===e.name&&t.direction===e.direction&&t.type.equals(e.type)}_equalSlot(t,e){return t.name===e.name&&t.direction===e.direction&&t.isRequired===e.isRequired&&t.isSet===e.isSet}_equalItems(t,e,n){for(const r of t){let t=!1;for(const i of e)if(n(i,r)){t=!0;break}if(!t)return!1}return!0}_cloneAndUpdate(t){const e=this.clone(new Map);return e.typeVars.forEach(e=>l._updateTypeVar(e,t)),e}static _updateTypeVar(t,e){t.object[t.field]=e(t.object[t.field])}static isTypeVar(t){return t instanceof i.Type&&t.hasProperty(t=>t instanceof i.VariableType)}static mustMatch(t){return!(void 0==t||l.isTypeVar(t))}static handlesMatch(t,e){if(l.mustMatch(t.name)&&t.name!==e.name)return!1;if(l.mustMatch(t.direction)&&t.direction!==e.direction)return!1;if(void 0==t.type)return!0;const[n,r]=i.Type.unwrapPair(t.type,e.type);return n instanceof i.VariableType?[{var:n,value:r,direction:t.direction}]:n.equals(r)}static slotsMatch(t,e){return(!l.mustMatch(t.name)||t.name===e.name)&&((!l.mustMatch(t.direction)||t.direction===e.direction)&&((!l.mustMatch(t.isRequired)||t.isRequired===e.isRequired)&&(!l.mustMatch(t.isSet)||t.isSet===e.isSet)))}particleMatches(t){return!1!==this.cloneWithResolutions(new Map).restrictType(t)}restrictType(t){return this._restrictThis(t)}_restrictThis(t){const e=this.handles.map(e=>t.connections.map(t=>({match:t,result:l.handlesMatch(e,t)})).filter(t=>!1!==t.result)),n=[];t.slots.forEach(t=>{n.push({name:t.name,direction:"consume",isRequired:t.isRequired,isSet:t.isSet}),t.providedSlots.forEach(t=>{n.push({name:t.name,direction:"provide",isRequired:!1,isSet:t.isSet})})});let r=this.slots.map(t=>n.filter(e=>l.slotsMatch(t,e)));r=r.map(t=>t.map(t=>({match:t,result:!0})));function o(t,e){if(0===t.length)return[];const n=t.pop();for(const r of n){if(e.includes(r.match))continue;const n=e.slice();n.push(r.match);const i=o(t,n);if(!1!==i)return r.result.length?i.concat(r.result):i}return!1}const a=o(e,[]),c=o(r,[]);if(!1===a||!1===c)return!1;for(const t of a)if(t.var.variable.resolution){if(t.var.variable.resolution instanceof i.VariableType){if(!s.TypeChecker.processTypeList(t.var,[{type:t.value,direction:t.direction}]))return!1}else if(!t.var.variable.resolution.equals(t.value))return!1}else t.var.variable.resolution=t.value;return this}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ParticleExecutionHost",function(){return c});var r=n(3),i=n(15),s=n(31),o=n(174),a=n(179);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(t,e,n){this.nextIdentifier=0,this.idleVersion=0,this._apiPort=new i.PECOuterPort(t,n),this.close=(()=>{t.close(),this._apiPort.close()}),this.arc=n,this.slotComposer=e,this._apiPort.onRender=(({particle:t,slotName:e,content:n})=>{this.slotComposer&&this.slotComposer.renderSlot(t,e,n)}),this._apiPort.onInitializeProxy=(async({handle:t,callback:e})=>{t.on("change",t=>this._apiPort.SimpleCallback({callback:e,data:t}),{})}),this._apiPort.onSynchronizeProxy=(async({handle:t,callback:e})=>{const n=await t.modelForSynchronization();this._apiPort.SimpleCallback({callback:e,data:n})}),this._apiPort.onHandleGet=(async({handle:t,callback:e})=>{this._apiPort.SimpleCallback({callback:e,data:await t.get()})}),this._apiPort.onHandleToList=(async({handle:t,callback:e})=>{this._apiPort.SimpleCallback({callback:e,data:await t.toList()})}),this._apiPort.onHandleSet=(({handle:t,data:e,particleId:n,barrier:r})=>t.set(e,n,r)),this._apiPort.onHandleClear=(({handle:t,particleId:e,barrier:n})=>t.clear(e,n)),this._apiPort.onHandleStore=(async({handle:t,callback:e,data:{value:n,keys:r},particleId:i})=>{await t.store(n,r,i),this._apiPort.SimpleCallback({callback:e})}),this._apiPort.onHandleRemove=(async({handle:t,callback:e,data:{id:n,keys:r},particleId:i})=>{await t.remove(n,r,i),this._apiPort.SimpleCallback({callback:e})}),this._apiPort.onHandleRemoveMultiple=(async({handle:t,callback:e,data:n,particleId:r})=>{await t.removeMultiple(n,r),this._apiPort.SimpleCallback({callback:e})}),this._apiPort.onHandleStream=(async({handle:t,callback:e,pageSize:n,forward:r})=>{this._apiPort.SimpleCallback({callback:e,data:await t.stream(n,r)})}),this._apiPort.onStreamCursorNext=(async({handle:t,callback:e,cursorId:n})=>{this._apiPort.SimpleCallback({callback:e,data:await t.cursorNext(n)})}),this._apiPort.onStreamCursorClose=(({handle:t,cursorId:e})=>t.cursorClose(e)),this._apiPort.onIdle=(({version:t,relevance:e})=>{t===this.idleVersion&&(this.idlePromise=void 0,this.idleResolve(e))}),this._apiPort.onGetBackingStore=(async({callback:t,type:e,storageKey:n})=>{n||(n=this.arc.storageProviderFactory.baseStorageKey(e,this.arc.storageKey||"volatile"));const r=await this.arc.storageProviderFactory.baseStorageFor(e,n);this._apiPort.GetBackingStoreCallback(r,{type:e.collectionOf(),name:e.toString(),callback:t,id:r.id,storageKey:n})}),this._apiPort.onConstructInnerArc=(({callback:t,particle:e})=>{const n={particle:e};this._apiPort.ConstructArcCallback({callback:t,arc:n})}),this._apiPort.onArcCreateHandle=(async({callback:t,arc:e,type:n,name:r})=>{const i=await this.arc.createStore(n,r,null,[],"volatile");this._apiPort.CreateHandleCallback(i,{type:n,name:r,callback:t,id:i.id})}),this._apiPort.onArcMapHandle=(async({callback:t,arc:e,handle:n})=>{Object(r.assert)(this.arc.findStoreById(n.id),`Cannot map nonexistent handle ${n.id}`),this._apiPort.MapHandleCallback({},{callback:t,id:n.id})}),this._apiPort.onArcCreateSlot=(({callback:t,arc:e,transformationParticle:n,transformationSlotName:r,hostedParticleName:i,hostedSlotName:s,handleId:o})=>{let a;this.slotComposer&&(a=this.slotComposer.createHostedSlot(n,r,i,s,o)),this._apiPort.CreateSlotCallback({},{callback:t,hostedSlotId:a})}),this._apiPort.onArcLoadRecipe=(async({arc:t,recipe:e,callback:n})=>{const r=await s.Manifest.parse(e,{loader:this.arc.loader,fileName:""});let i=void 0,a=r.recipes[0];if(a){const e=[];for(const t of a.handles){const n=this.arc.findStoreById(t.id)||r.findStoreById(t.id);n?t.mapToStorage(n):e.push(t)}if(e.length>0){const t=await new o.RecipeResolver(this.arc).resolve(a);t?a=t:i=`Recipe couldn't load due to missing handles [recipe=${a}, missingHandles=${e.join("\n")}].`}if(!i){const n={errors:new Map};e.length>0||a.normalize(n)?a.isResolved()?(r.stores.forEach(t=>this.arc._registerStore(t,[])),this.arc.instantiate(a,t)):i=`Recipe is not resolvable ${a.toString({showUnresolved:!0})}`:i=`Recipe ${a} could not be normalized:\n${[...n.errors.values()].join("\n")}`}}else i="No recipe defined";this._apiPort.SimpleCallback({callback:n,data:i})}),this._apiPort.onRaiseSystemException=(async({exception:t,methodName:e,particleId:n})=>{const r=this.arc.particleHandleMaps.get(n).spec.name;Object(a.reportSystemException)(t,e,r)})}stop(){this._apiPort.Stop()}get idle(){return void 0==this.idlePromise&&(this.idlePromise=new Promise((t,e)=>{this.idleResolve=t})),this.idleVersion=this.nextIdentifier,this._apiPort.AwaitIdle({version:this.nextIdentifier++}),this.idlePromise}get messageCount(){return this._apiPort.messageCount}sendEvent(t,e,n){this._apiPort.UIEvent({particle:t,slotName:e,event:n})}instantiate(t,e,n){return n.forEach(t=>{this._apiPort.DefineHandle(t,{type:t.type.resolvedType(),name:t.name})}),this._apiPort.InstantiateParticle(t,{id:t.id,spec:e,handles:n}),t}startRender({particle:t,slotName:e,providedSlots:n,contentTypes:r}){this._apiPort.StartRender({particle:t,slotName:e,providedSlots:n,contentTypes:r})}stopRender({particle:t,slotName:e}){this._apiPort.StopRender({particle:t,slotName:e})}innerArcRender(t,e,n,r){this._apiPort.InnerArcRender({transformationParticle:t,transformationSlotName:e,hostedSlotId:n,content:r})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"APIPort",function(){return u}),n.d(e,"PECOuterPort",function(){return l}),n.d(e,"PECInnerPort",function(){return h});var r=n(3),i=n(12),s=n(4),o=n(16),a=n(26);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(t){this._prefix=t,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(t,e){let n;return Object(r.assert)(!this._reverseIdMap.has(t)),n=e||(t.apiChannelMappingId?t.apiChannelMappingId:this._newIdentifier()),Object(r.assert)(!this._idMap.has(n),`${e?"requestedId":t.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${n} already in use`),this.establishThingMapping(n,t),n}maybeCreateMappingForThing(t){return this.hasMappingForThing(t)?this.identifierForThing(t):this.createMappingForThing(t)}async establishThingMapping(t,e){let n;Array.isArray(e)&&([e,n]=e),this._idMap.set(t,e),e instanceof Promise?(Object(r.assert)(null==n),await this.establishThingMapping(t,await e)):(this._reverseIdMap.set(e,t),n&&await n())}hasMappingForThing(t){return this._reverseIdMap.has(t)}identifierForThing(t){return Object(r.assert)(this._reverseIdMap.has(t),`Missing thing [${t}]`),this._reverseIdMap.get(t)}thingForIdentifier(t){return Object(r.assert)(this._idMap.has(t),`Missing id: ${t}`),this._idMap.get(t)}}class u{constructor(t,e){this._port=t,this._mapper=new c(e),this._messageMap=new Map,this._port.onmessage=(async t=>this._processMessage(t)),this._debugAttachment=null,this._attachStack=!1,this.messageCount=0,this.Direct={convert:t=>t,unconvert:t=>t},this.LocalMapped={convert:t=>this._mapper.maybeCreateMappingForThing(t),unconvert:t=>this._mapper.thingForIdentifier(t)},this.Mapped={convert:t=>this._mapper.identifierForThing(t),unconvert:t=>this._mapper.thingForIdentifier(t)},this.Map=function(t,e){return{convert:n=>{const r={};return n.forEach((n,i)=>r[t.convert(i)]=e.convert(n)),r},unconvert:n=>{const r=new Map;for(const i in n)r.set(t.unconvert(i),e.unconvert(n[i]));return r}}},this.List=function(t){return{convert:e=>e.map(e=>t.convert(e)),unconvert:e=>e.map(e=>t.unconvert(e))}},this.ByLiteral=function(t){return{convert:t=>t.toLiteral(),unconvert:e=>t.fromLiteral(e)}},this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(t){Object(r.assert)(this._messageMap.has(t.data.messageType));const e=this.messageCount++,n=this._messageMap.get(t.data.messageType);let i;try{i=this._unprocessArguments(n.args,t.data.messageBody)}catch(e){throw console.error(`Exception during unmarshaling for ${t.data.messageType}`),e}for(const e of Object.values(i))if(e instanceof Promise)return void e.then(()=>this._processMessage(t));const s="on"+t.data.messageType;Object(r.assert)(this[s],`no handler named ${s}`),this._debugAttachment&&this._debugAttachment.handlePecMessage(s,t.data.messageBody,e,t.data.stack);const o=this[s](i);n.isInitializer&&(Object(r.assert)(i.identifier),await this._mapper.establishThingMapping(i.identifier,o))}_processArguments(t,e){const n={};for(const r in t)n[r]=t[r].convert(e[r]);return n}_unprocessArguments(t,e){const n={};for(const r in t)n[r]=t[r].unconvert(e[r]);return n}registerCall(t,e){this[t]=(n=>{const r={messageType:t,messageBody:this._processArguments(e,n)};this._attachStack&&(r.stack=(new Error).stack);const i=this.messageCount++;this._port.postMessage(r),this._debugAttachment&&this._debugAttachment.handlePecMessage(t,r.messageBody,i,(new Error).stack)})}registerHandler(t,e){this._messageMap.set(t,{args:e})}registerInitializerHandler(t,e){e.identifier=this.Direct,this._messageMap.set(t,{isInitializer:!0,args:e})}registerRedundantInitializer(t,e,n){this.registerInitializer(t,e,n,!0)}registerInitializer(t,e,n=null,r=!1){this[t]=((i,s)=>{if(r&&this._mapper.hasMappingForThing(i))return;const o={messageType:t,messageBody:this._processArguments(e,s)};this._attachStack&&(o.stack=(new Error).stack);const a=n&&s[n];o.messageBody.identifier=this._mapper.createMappingForThing(i,a);const c=this.messageCount++;this._port.postMessage(o),this._debugAttachment&&this._debugAttachment.handlePecMessage(t,o.messageBody,c,(new Error).stack)})}}class l extends u{constructor(t,e){super(t,"o"),this.registerCall("Stop",{}),this.registerRedundantInitializer("DefineHandle",{type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializer("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(i.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)},"id"),this.registerCall("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerCall("SimpleCallback",{callback:this.Direct,data:this.Direct}),this.registerCall("AwaitIdle",{version:this.Direct}),this.registerCall("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerCall("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerHandler("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerHandler("InitializeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("SynchronizeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleGet",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleToList",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleStore",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemove",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemoveMultiple",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleStream",{handle:this.Mapped,callback:this.Direct,pageSize:this.Direct,forward:this.Direct}),this.registerHandler("StreamCursorNext",{handle:this.Mapped,callback:this.Direct,cursorId:this.Direct}),this.registerHandler("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerHandler("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerHandler("GetBackingStore",{callback:this.Direct,storageKey:this.Direct,type:this.ByLiteral(s.Type)}),this.registerInitializer("GetBackingStoreCallback",{callback:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerHandler("ConstructInnerArc",{callback:this.Direct,particle:this.Mapped}),this.registerCall("ConstructArcCallback",{callback:this.Direct,arc:this.LocalMapped}),this.registerHandler("ArcCreateHandle",{callback:this.Direct,arc:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializer("CreateHandleCallback",{callback:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct}),this.registerHandler("ArcMapHandle",{callback:this.Direct,arc:this.LocalMapped,handle:this.Mapped}),this.registerInitializer("MapHandleCallback",{callback:this.Direct,id:this.Direct}),this.registerHandler("ArcCreateSlot",{callback:this.Direct,arc:this.LocalMapped,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializer("CreateSlotCallback",{callback:this.Direct,hostedSlotId:this.Direct}),this.registerCall("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerHandler("ArcLoadRecipe",{arc:this.LocalMapped,recipe:this.Direct,callback:this.Direct}),this.registerHandler("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerCall("DevToolsConnected",{}),a.DevtoolsConnection.onceConnected.then(t=>{this.DevToolsConnected(),this._debugAttachment=new o.OuterPortAttachment(e,t)})}}class h extends u{constructor(t){super(t,"i"),this.registerHandler("Stop",{}),this.registerInitializerHandler("DefineHandle",{type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializerHandler("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(i.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)}),this.registerHandler("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerHandler("SimpleCallback",{callback:this.LocalMapped,data:this.Direct}),this.registerHandler("AwaitIdle",{version:this.Direct}),this.registerHandler("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerHandler("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerCall("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerCall("InitializeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("SynchronizeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleGet",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleToList",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleStore",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemove",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemoveMultiple",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleStream",{handle:this.Mapped,callback:this.LocalMapped,pageSize:this.Direct,forward:this.Direct}),this.registerCall("StreamCursorNext",{handle:this.Mapped,callback:this.LocalMapped,cursorId:this.Direct}),this.registerCall("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerCall("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerCall("GetBackingStore",{callback:this.LocalMapped,storageKey:this.Direct,type:this.ByLiteral(s.Type)}),this.registerInitializerHandler("GetBackingStoreCallback",{callback:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerCall("ConstructInnerArc",{callback:this.LocalMapped,particle:this.Mapped}),this.registerHandler("ConstructArcCallback",{callback:this.LocalMapped,arc:this.Direct}),this.registerCall("ArcCreateHandle",{callback:this.LocalMapped,arc:this.Direct,type:this.ByLiteral(s.Type),name:this.Direct}),this.registerInitializerHandler("CreateHandleCallback",{callback:this.LocalMapped,type:this.ByLiteral(s.Type),name:this.Direct,id:this.Direct}),this.registerCall("ArcMapHandle",{callback:this.LocalMapped,arc:this.Direct,handle:this.Mapped}),this.registerInitializerHandler("MapHandleCallback",{callback:this.LocalMapped,id:this.Direct}),this.registerCall("ArcCreateSlot",{callback:this.LocalMapped,arc:this.Direct,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializerHandler("CreateSlotCallback",{callback:this.LocalMapped,hostedSlotId:this.Direct}),this.registerHandler("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerCall("ArcLoadRecipe",{arc:this.Direct,recipe:this.Direct,callback:this.LocalMapped}),this.registerCall("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerHandler("DevToolsConnected",{}),this.onDevToolsConnected=(()=>this._attachStack=!0)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"OuterPortAttachment",function(){return i});var r=n(17);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(t,e){this._devtoolsChannel=e,this._arcIdString=t.id.toString(),this._speculative=t.isSpeculative}handlePecMessage(t,e,n,r){if(this._arcIdString.endsWith("-pipes")||this._speculative)return;const i=this._extractStackFrames(r);this._devtoolsChannel.send({messageType:"PecLog",messageBody:{name:t,pecMsgBody:e,pecMsgCount:n,timestamp:Date.now(),stack:i}})}_extractStackFrames(t){const e=[];if(!t)return e;if(t.includes("(file:///")){for(const n of t.split("\n    at ").slice(2)){let t=n.match(/^(.*) \((.*)\)$/);null===t&&(t={1:"<unknown>",2:n});let r=t[2].replace(/:[0-9]+$/,"");r.startsWith("file")&&(r=r.replace(/^.*\/arcs[^/]*\//,"")),e.push({method:t[1],location:r,target:null,targetClass:"noLink"})}return e}return Object(r.mapStackTrace)(t,t=>t.slice(1).map(t=>{let n=t.match(/^ {4}at (.*) \((.*)\)$/);null===n&&(n={1:"<unknown>",2:t.replace(/^ *at */,"")});const r={method:n[1]},i=n[2].replace(/:[0-9]+$/,"");i.startsWith("http")?(r.location=i.replace(/^.*\/arcs[^/]*\//,""),r.target=i,r.targetClass="link"):i.startsWith("webpack")?(r.location=i.slice(11),r.target=`webpack:///./${r.location}`,r.targetClass="link"):(r.location=i,r.target=null,r.targetClass="noLink"),e.push(r)}),{sync:!0,cacheGlobally:!0}),e}}},function(t,e,n){"use strict";n.r(e),n.d(e,"mapStackTrace",function(){return r});const r=n(18).mapStackTrace},function(t,e,n){var r,i;r=[n(19)],void 0===(i=function(t){var e={},n=function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1},r=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i=function(){return navigator.userAgent.toLowerCase().indexOf("safari")>-1},s=function(){return document.documentMode&&document.documentMode>=11},o=function(){this.count=0,this.pending=[]};o.prototype.incr=function(){this.count++},o.prototype.decr=function(){this.count--,this.flush()},o.prototype.whenReady=function(t){this.pending.push(t),this.flush()},o.prototype.flush=function(){0===this.count&&(this.pending.forEach(function(t){t()}),this.pending=[])};var a=function(t){this.sem=new o,this.sync=t&&t.sync,this.mapForUri=t&&t.cacheGlobally?e:{}};a.prototype.ajax=function(t,e){var n=function(){for(var t=!1,e=0;e<d.length;e++){try{t=d[e]()}catch(t){continue}break}return t}(),r=this;n.onreadystatechange=function(){4==n.readyState&&e.call(r,n,t)},n.open("GET",t,!this.sync),n.send()},a.prototype.fetchScript=function(t){t in this.mapForUri||(this.sem.incr(),this.mapForUri[t]=null,this.ajax(t,this.onScriptLoad))};var c=new RegExp("^(?:[a-z]+:)?//","i");a.prototype.onScriptLoad=function(e,n){if(200===e.status||"file://"===n.slice(0,7)&&0===e.status){var r=e.responseText.match("//# [s]ourceMappingURL=(.*)[\\s]*$","m");if(r&&2===r.length){var i=r[1],s=i.match("data:application/json;(charset=[^;]+;)?base64,(.*)");if(s&&s[2])this.mapForUri[n]=new t.SourceMapConsumer(atob(s[2])),this.sem.decr();else{if(!c.test(i)){var o,a=n.lastIndexOf("/");-1!==a&&(o=n.slice(0,a+1),i=o+i)}this.ajax(i,function(e){(200===e.status||"file://"===i.slice(0,7)&&0===e.status)&&(this.mapForUri[n]=new t.SourceMapConsumer(e.responseText)),this.sem.decr()})}}else this.sem.decr()}else this.sem.decr()};var u=function(t,e,n){for(var r,i=[],s=0;s<t.length;s++){var o=e[s];if(o){var a=o[1],c=parseInt(o[2],10),u=parseInt(o[3],10);if(r=n[a]){var d=r.originalPositionFor({line:c,column:u});i.push(h(d.source,d.line,d.column,d.name||l(t[s])))}else i.push(h(a,c,u,l(t[s])))}else i.push(t[s])}return i};function l(t){var e=String(t).match(n()||s()?/ +at +([^ ]*).*/:/([^@]*)@.*/);return e&&e[1]}var h=function(t,e,n,r){return"    at "+(r||"(unknown)")+" ("+t+":"+e+":"+n+")"},d=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return{mapStackTrace:function(t,e,o){var c,l,h,d,f,p,g,y={},v=new a(o);if(n()||s())p=/^ +at.+\((.*):([0-9]+):([0-9]+)/,f=4,g=1;else{if(!r()&&!i())throw new Error("unknown browser :(");p=/@(.*):([0-9]+):([0-9]+)/,f=4,g=0}c=t.split("\n").slice(g);for(var m=0;m<c.length;m++)l=c[m],o&&o.filter&&!o.filter(l)||(h=l.match(p))&&h.length===f&&(y[m]=h,(d=h[1]).match(/<anonymous>/)||v.fetchScript(d));v.sem.whenReady(function(){var t=u(c,y,v.mapForUri);e(t)})}}}.apply(e,r))||(t.exports=i)},function(t,e,n){var r=n(20),i=n(21),s=n(22).ArraySet,o=n(23),a=n(25).quickSort;function c(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,""))),null!=e.sections?new h(e):new u(e)}function u(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sources"),o=r.getArg(e,"names",[]),a=r.getArg(e,"sourceRoot",null),c=r.getArg(e,"sourcesContent",null),u=r.getArg(e,"mappings"),l=r.getArg(e,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);i=i.map(String).map(r.normalize).map(function(t){return a&&r.isAbsolute(a)&&r.isAbsolute(t)?r.relative(a,t):t}),this._names=s.fromArray(o.map(String),!0),this._sources=s.fromArray(i,!0),this.sourceRoot=a,this.sourcesContent=c,this._mappings=u,this.file=l}function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(t){var e=t;"string"==typeof t&&(e=JSON.parse(t.replace(/^\)\]\}'/,"")));var n=r.getArg(e,"version"),i=r.getArg(e,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new s,this._names=new s;var o={line:-1,column:0};this._sections=i.map(function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var e=r.getArg(t,"offset"),n=r.getArg(e,"line"),i=r.getArg(e,"column");if(n<o.line||n===o.line&&i<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=e,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new c(r.getArg(t,"map"))}})}c.fromSourceMap=function(t){return u.fromSourceMap(t)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(t,e){var n=t.charAt(e);return";"===n||","===n},c.prototype._parseMappings=function(t,e){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(t,e,n){var i,s=e||null;switch(n||c.GENERATED_ORDER){case c.GENERATED_ORDER:i=this._generatedMappings;break;case c.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var o=this.sourceRoot;i.map(function(t){var e=null===t.source?null:this._sources.at(t.source);return null!=e&&null!=o&&(e=r.join(o,e)),{source:e,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}},this).forEach(t,s)},c.prototype.allGeneratedPositionsFor=function(t){var e=r.getArg(t,"line"),n={source:r.getArg(t,"source"),originalLine:e,originalColumn:r.getArg(t,"column",0)};if(null!=this.sourceRoot&&(n.source=r.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var s=[],o=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(o>=0){var a=this._originalMappings[o];if(void 0===t.column)for(var c=a.originalLine;a&&a.originalLine===c;)s.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++o];else for(var u=a.originalColumn;a&&a.originalLine===e&&a.originalColumn==u;)s.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++o]}return s},e.SourceMapConsumer=c,u.prototype=Object.create(c.prototype),u.prototype.consumer=c,u.fromSourceMap=function(t){var e=Object.create(u.prototype),n=e._names=s.fromArray(t._names.toArray(),!0),i=e._sources=s.fromArray(t._sources.toArray(),!0);e.sourceRoot=t._sourceRoot,e.sourcesContent=t._generateSourcesContent(e._sources.toArray(),e.sourceRoot),e.file=t._file;for(var o=t._mappings.toArray().slice(),c=e.__generatedMappings=[],h=e.__originalMappings=[],d=0,f=o.length;d<f;d++){var p=o[d],g=new l;g.generatedLine=p.generatedLine,g.generatedColumn=p.generatedColumn,p.source&&(g.source=i.indexOf(p.source),g.originalLine=p.originalLine,g.originalColumn=p.originalColumn,p.name&&(g.name=n.indexOf(p.name)),h.push(g)),c.push(g)}return a(e.__originalMappings,r.compareByOriginalPositions),e},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._sources.toArray().map(function(t){return null!=this.sourceRoot?r.join(this.sourceRoot,t):t},this)}}),u.prototype._parseMappings=function(t,e){for(var n,i,s,c,u,h=1,d=0,f=0,p=0,g=0,y=0,v=t.length,m=0,_={},b={},w=[],S=[];m<v;)if(";"===t.charAt(m))h++,m++,d=0;else if(","===t.charAt(m))m++;else{for((n=new l).generatedLine=h,c=m;c<v&&!this._charIsMappingSeparator(t,c);c++);if(s=_[i=t.slice(m,c)])m+=i.length;else{for(s=[];m<c;)o.decode(t,m,b),u=b.value,m=b.rest,s.push(u);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");_[i]=s}n.generatedColumn=d+s[0],d=n.generatedColumn,s.length>1&&(n.source=g+s[1],g+=s[1],n.originalLine=f+s[2],f=n.originalLine,n.originalLine+=1,n.originalColumn=p+s[3],p=n.originalColumn,s.length>4&&(n.name=y+s[4],y+=s[4])),S.push(n),"number"==typeof n.originalLine&&w.push(n)}a(S,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,a(w,r.compareByOriginalPositions),this.__originalMappings=w},u.prototype._findMapping=function(t,e,n,r,s,o){if(t[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[n]);if(t[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[r]);return i.search(t,e,s,o)},u.prototype.computeColumnSpans=function(){for(var t=0;t<this._generatedMappings.length;++t){var e=this._generatedMappings[t];if(t+1<this._generatedMappings.length){var n=this._generatedMappings[t+1];if(e.generatedLine===n.generatedLine){e.lastGeneratedColumn=n.generatedColumn-1;continue}}e.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(t,"bias",c.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===e.generatedLine){var s=r.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),null!=this.sourceRoot&&(s=r.join(this.sourceRoot,s)));var o=r.getArg(i,"name",null);return null!==o&&(o=this._names.at(o)),{source:s,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:o}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return null==t}))},u.prototype.sourceContentFor=function(t,e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(t=r.relative(this.sourceRoot,t)),this._sources.has(t))return this.sourcesContent[this._sources.indexOf(t)];var n;if(null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var i=t.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(i))return this.sourcesContent[this._sources.indexOf(i)];if((!n.path||"/"==n.path)&&this._sources.has("/"+t))return this.sourcesContent[this._sources.indexOf("/"+t)]}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(t){var e=r.getArg(t,"source");if(null!=this.sourceRoot&&(e=r.relative(this.sourceRoot,e)),!this._sources.has(e))return{line:null,column:null,lastColumn:null};var n={source:e=this._sources.indexOf(e),originalLine:r.getArg(t,"line"),originalColumn:r.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(t,"bias",c.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===n.source)return{line:r.getArg(s,"generatedLine",null),column:r.getArg(s,"generatedColumn",null),lastColumn:r.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},e.BasicSourceMapConsumer=u,h.prototype=Object.create(c.prototype),h.prototype.constructor=c,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}}),h.prototype.originalPositionFor=function(t){var e={generatedLine:r.getArg(t,"line"),generatedColumn:r.getArg(t,"column")},n=i.search(e,this._sections,function(t,e){var n=t.generatedLine-e.generatedOffset.generatedLine;return n||t.generatedColumn-e.generatedOffset.generatedColumn}),s=this._sections[n];return s?s.consumer.originalPositionFor({line:e.generatedLine-(s.generatedOffset.generatedLine-1),column:e.generatedColumn-(s.generatedOffset.generatedLine===e.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})},h.prototype.sourceContentFor=function(t,e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(t,!0);if(r)return r}if(e)return null;throw new Error('"'+t+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(t){for(var e=0;e<this._sections.length;e++){var n=this._sections[e];if(-1!==n.consumer.sources.indexOf(r.getArg(t,"source"))){var i=n.consumer.generatedPositionFor(t);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(t,e){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],s=i.consumer._generatedMappings,o=0;o<s.length;o++){var c=s[o],u=i.consumer._sources.at(c.source);null!==i.consumer.sourceRoot&&(u=r.join(i.consumer.sourceRoot,u)),this._sources.add(u),u=this._sources.indexOf(u);var l=i.consumer._names.at(c.name);this._names.add(l),l=this._names.indexOf(l);var h={source:u,generatedLine:c.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(i.generatedOffset.generatedLine===c.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:l};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},e.IndexedSourceMapConsumer=h},function(t,e){e.getArg=function(t,e,n){if(e in t)return t[e];if(3===arguments.length)return n;throw new Error('"'+e+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,r=/^data:.+\,.+$/;function i(t){var e=t.match(n);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}function s(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}function o(t){var n=t,r=i(t);if(r){if(!r.path)return t;n=r.path}for(var o,a=e.isAbsolute(n),c=n.split(/\/+/),u=0,l=c.length-1;l>=0;l--)"."===(o=c[l])?c.splice(l,1):".."===o?u++:u>0&&(""===o?(c.splice(l+1,u),u=0):(c.splice(l,2),u--));return""===(n=c.join("/"))&&(n=a?"/":"."),r?(r.path=n,s(r)):n}e.urlParse=i,e.urlGenerate=s,e.normalize=o,e.join=function(t,e){""===t&&(t="."),""===e&&(e=".");var n=i(e),a=i(t);if(a&&(t=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),s(n);if(n||e.match(r))return e;if(a&&!a.host&&!a.path)return a.host=e,s(a);var c="/"===e.charAt(0)?e:o(t.replace(/\/+$/,"")+"/"+e);return a?(a.path=c,s(a)):c},e.isAbsolute=function(t){return"/"===t.charAt(0)||!!t.match(n)},e.relative=function(t,e){""===t&&(t="."),t=t.replace(/\/$/,"");for(var n=0;0!==e.indexOf(t+"/");){var r=t.lastIndexOf("/");if(r<0)return e;if((t=t.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)};var a=!("__proto__"in Object.create(null));function c(t){return t}function u(t){if(!t)return!1;var e=t.length;if(e<9)return!1;if(95!==t.charCodeAt(e-1)||95!==t.charCodeAt(e-2)||111!==t.charCodeAt(e-3)||116!==t.charCodeAt(e-4)||111!==t.charCodeAt(e-5)||114!==t.charCodeAt(e-6)||112!==t.charCodeAt(e-7)||95!==t.charCodeAt(e-8)||95!==t.charCodeAt(e-9))return!1;for(var n=e-10;n>=0;n--)if(36!==t.charCodeAt(n))return!1;return!0}function l(t,e){return t===e?0:t>e?1:-1}e.toSetString=a?c:function(t){return u(t)?"$"+t:t},e.fromSetString=a?c:function(t){return u(t)?t.slice(1):t},e.compareByOriginalPositions=function(t,e,n){var r=t.source-e.source;return 0!==r?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)||n?r:0!=(r=t.generatedColumn-e.generatedColumn)?r:0!=(r=t.generatedLine-e.generatedLine)?r:t.name-e.name},e.compareByGeneratedPositionsDeflated=function(t,e,n){var r=t.generatedLine-e.generatedLine;return 0!==r?r:0!=(r=t.generatedColumn-e.generatedColumn)||n?r:0!=(r=t.source-e.source)?r:0!=(r=t.originalLine-e.originalLine)?r:0!=(r=t.originalColumn-e.originalColumn)?r:t.name-e.name},e.compareByGeneratedPositionsInflated=function(t,e){var n=t.generatedLine-e.generatedLine;return 0!==n?n:0!=(n=t.generatedColumn-e.generatedColumn)?n:0!==(n=l(t.source,e.source))?n:0!=(n=t.originalLine-e.originalLine)?n:0!=(n=t.originalColumn-e.originalColumn)?n:l(t.name,e.name)}},function(t,e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(t,n,r,i){if(0===n.length)return-1;var s=function t(n,r,i,s,o,a){var c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return 0===u?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}(-1,n.length,t,n,r,i||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===r(n[s],n[s-1],!0);)--s;return s}},function(t,e,n){var r=n(20),i=Object.prototype.hasOwnProperty;function s(){this._array=[],this._set=Object.create(null)}s.fromArray=function(t,e){for(var n=new s,r=0,i=t.length;r<i;r++)n.add(t[r],e);return n},s.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(t,e){var n=r.toSetString(t),s=i.call(this._set,n),o=this._array.length;s&&!e||this._array.push(t),s||(this._set[n]=o)},s.prototype.has=function(t){var e=r.toSetString(t);return i.call(this._set,e)},s.prototype.indexOf=function(t){var e=r.toSetString(t);if(i.call(this._set,e))return this._set[e];throw new Error('"'+t+'" is not in the set.')},s.prototype.at=function(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)},s.prototype.toArray=function(){return this._array.slice()},e.ArraySet=s},function(t,e,n){var r=n(24);e.encode=function(t){var e,n="",i=function(t){return t<0?1+(-t<<1):0+(t<<1)}(t);do{e=31&i,(i>>>=5)>0&&(e|=32),n+=r.encode(e)}while(i>0);return n},e.decode=function(t,e,n){var i,s,o=t.length,a=0,c=0;do{if(e>=o)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(s=r.decode(t.charCodeAt(e++))))throw new Error("Invalid base64 digit: "+t.charAt(e-1));i=!!(32&s),a+=(s&=31)<<c,c+=5}while(i);n.value=function(t){var e=t>>1;return 1==(1&t)?-e:e}(a),n.rest=e}},function(t,e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");e.encode=function(t){if(0<=t&&t<n.length)return n[t];throw new TypeError("Must be between 0 and 63: "+t)},e.decode=function(t){return 65<=t&&t<=90?t-65:97<=t&&t<=122?t-97+26:48<=t&&t<=57?t-48+52:43==t?62:47==t?63:-1}},function(t,e){function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e,i,s){if(i<s){var o=i-1;n(t,function(t,e){return Math.round(t+Math.random()*(e-t))}(i,s),s);for(var a=t[s],c=i;c<s;c++)e(t[c],a)<=0&&n(t,o+=1,c);n(t,o+1,c);var u=o+1;r(t,e,i,u-1),r(t,e,u+1,s)}}e.quickSort=function(t,e){r(t,e,0,t.length-1)}},function(t,e,n){"use strict";n.r(e),n.d(e,"DevtoolsConnection",function(){return h}),n.d(e,"DevtoolsForTests",function(){return d});var r=n(3),i=n(27),s=n(29),o=n(30);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
let a=null,c=!1,u=null,l=new Promise(t=>u=t);o.DevtoolsBroker.onceConnected.then(()=>{h.ensure(),u(a),c=!0});class h{static get isConnected(){return c}static get onceConnected(){return l}static get(){return a}static ensure(){a||(a=new i.DevtoolsChannel)}}class d{static get channel(){return a}static ensureStub(){Object(r.assert)(!a),a=new s.DevtoolsChannelStub,u(a),c=!0}static reset(){Object(r.assert)(a),c=!1,u=null,l=new Promise(t=>u=t),a=null}}},function(t,e,n){"use strict";n.r(e),n.d(e,"DevtoolsChannel",function(){return i});var r=n(28);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends r.AbstractDevtoolsChannel{constructor(){super(),document.addEventListener("arcs-debug-in",t=>this._handleMessage(t.detail))}_flush(t){document.dispatchEvent(new CustomEvent("arcs-debug-out",{detail:t}))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"AbstractDevtoolsChannel",function(){return i});var r=n(3);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(){this.debouncedMessages=[],this.debouncing=!1,this.messageListeners=new Map}send(t){this.debouncedMessages.push(t),this.debouncing||(this.debouncing=!0,setTimeout(()=>{this._flush(this.debouncedMessages),this.debouncedMessages=[],this.debouncing=!1},100))}listen(t,e,n){Object(r.assert)(e),Object(r.assert)(t);const i=`${"string"==typeof t?t:t.id.toString()}/${e}`;let s=this.messageListeners.get(i);s||this.messageListeners.set(i,s=[]),s.push(n)}_handleMessage(t){const e=this.messageListeners.get(`${t.arcId}/${t.messageType}`);if(e)for(const n of e)n(t);else console.warn(`No one is listening to ${t.messageType} message`)}_flush(t){throw"Not implemented in an abstract class"}}},function(t,e,n){"use strict";n.r(e),n.d(e,"DevtoolsChannelStub",function(){return r});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{constructor(){this._messages=[]}get messages(){return this._messages}send(t){this._messages.push(JSON.parse(JSON.stringify(t)))}listen(t,e,n){}clear(){this._messages.length=0}}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"DevtoolsBroker",function(){return i});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const r="object"==typeof window?window:t;r._arcDebugPromise||(r._arcDebugPromise=new Promise(t=>{r._arcDebugPromiseResolve=t}));class i{static get onceConnected(){return r._arcDebugPromise}static markConnected(){return r._arcDebugPromiseResolve(),{preExistingArcs:!!r.arc}}}}.call(this,n(1))},function(t,e,n){"use strict";n.r(e),n.d(e,"StorageStub",function(){return S}),n.d(e,"Manifest",function(){return x});var r=n(3),i=n(32),s=n(33),o=n(34),a=n(43),c=n(12),u=n(5),l=n(41),h=n(13),d=n(4),f=n(37),p=n(44),g=n(168),y=n(36),v=n(169),m=n(7),_=n(172),b=n(173);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class w extends Error{constructor(t,e){super(e),this.location=t}}class S{constructor(t,e,n,r,i,s){this.type=t,this.id=e,this.originalId=s,this.name=n,this.storageKey=r,this.storageProviderFactory=i}async inflate(){const t=await this.storageProviderFactory.connect(this.id,this.type,this.storageKey);return t.originalId=this.originalId,t}}class C{traverse(t){if(["string","number","boolean"].includes(typeof t)||null===t)return;if(Array.isArray(t)){for(const e of t)this.traverse(e);return}Object(r.assert)(t.location,"expected manifest node to have `location`"),Object(r.assert)(t.kind,"expected manifest node to have `kind`");let e=!1;const n=()=>{if(!e){e=!0;for(const e of Object.keys(t))["location","kind","model"].includes(e)||this.traverse(t[e])}};this.visit(t,n),n()}visit(t,e){}}const E=new Set;class x{constructor({id:t}){if(this._recipes=[],this._imports=[],this._particles={},this._schemas={},this._stores=[],this._shapes=[],this.storeTags=new Map,this._fileName=null,this._storageProviderFactory=void 0,this._meta=new g.ManifestMeta,this._resources={},this.storeManifestUrls=new Map,this.warnings=[],Object(r.assert)(t instanceof v.Id||"string"==typeof t),t instanceof v.Id)this._id=t;else{const e=t.split(":");this._id=new v.Id(e[0],e.slice(1))}}get id(){return this._meta.name?v.Id.newSessionId().fromString(this._meta.name):this._id}get storageProviderFactory(){return void 0==this._storageProviderFactory&&(this._storageProviderFactory=new p.StorageProviderFactory(this.id)),this._storageProviderFactory}get recipes(){return this._recipes}get allRecipes(){return[...new Set(this._findAll(t=>t._recipes))]}get activeRecipe(){return this._recipes.find(t=>"active"===t.annotation)}get particles(){return[...new Set(this._findAll(t=>Object.values(t._particles)))]}get imports(){return this._imports}get schemas(){return this._schemas}get fileName(){return this._fileName}get stores(){return this._stores}get allStores(){return[...this._findAll(t=>t._stores)]}get shapes(){return this._shapes}get meta(){return this._meta}get resources(){return this._resources}applyMeta(t){void 0!==this._storageProviderFactory&&Object(r.assert)(t.name===this._meta.name||void 0==t.name,"can't change manifest ID after storage is constructed"),this._meta.apply(t)}async createStore(t,e,n,i,s){const o=await this.storageProviderFactory.construct(n,t,s||`volatile://${this.id}`);return Object(r.assert)(null!==o.version),o.name=e,this.storeManifestUrls.set(o.id,this.fileName),this._addStore(o,i)}_addStore(t,e){return this._stores.push(t),this.storeTags.set(t,e||[]),t}newStorageStub(t,e,n,r,i,s){return this._addStore(new S(t,n,e,r,this.storageProviderFactory,s),i)}_find(t){let e=t(this);if(!e)for(const n of this._imports)if(e=n._find(t))break;return e}*_findAll(t){yield*t(this);for(const e of this._imports)yield*e._findAll(t)}findSchemaByName(t){return this._find(e=>e._schemas[t])}findTypeByName(t){const e=this.findSchemaByName(t);if(e)return d.Type.newEntity(e);const n=this.findShapeByName(t);return n?d.Type.newInterface(n):null}findParticleByName(t){return this._find(e=>e._particles[t])}findParticlesByVerb(t){return[...this._findAll(e=>Object.values(e._particles).filter(e=>e.primaryVerb===t))]}findStoreByName(t){return this._find(e=>e._stores.find(e=>e.name===t))}findStoreById(t){return this._find(e=>e._stores.find(e=>e.id===t))}findStoreTags(t){return this._find(e=>e.storeTags.get(t))}findManifestUrlForHandleId(t){return this._find(e=>e.storeManifestUrls.get(t))}findStoreByType(t,e={tags:[],subtype:!1}){const n=e.tags||[],r=e.subtype||!1;return[...this._findAll(e=>e._stores.filter(i=>(function(e){const n=t.resolvedType();if(!n.isResolved())return t instanceof d.CollectionType==e.type instanceof d.CollectionType&&t instanceof d.BigCollectionType==e.type instanceof d.BigCollectionType;if(r){const[t,r]=d.Type.unwrapPair(e.type,n);return t instanceof d.EntityType&&r instanceof d.EntityType&&t.entitySchema.isMoreSpecificThan(r.entitySchema)}return e.type.equals(t)})(i)&&function(t,e){return 0===n.filter(n=>!t.storeTags.get(e).includes(n)).length}(e,i)))].filter(e=>!!a.Handle.effectiveType(t,[{type:e.type,direction:e.type instanceof d.InterfaceType?"host":"inout"}]))}findShapeByName(t){return this._find(e=>e._shapes.find(e=>e.name===t))}findRecipesByVerb(t){return[...this._findAll(e=>e._recipes.filter(e=>e.verbs.includes(t)))]}generateID(){return this.id.createId().toString()}static async load(t,e,n){n=n||{};let{registry:i,id:s}=n;return(i=i||{})&&i[t]?await i[t]:(i[t]=(async()=>{const n=await e.loadResource(t);return Object(r.assert)(void 0!==n,`${t} unable to be loaded by Manifest parser`),await x.parse(n,{id:s,fileName:t,loader:e,registry:i,position:{line:1,column:0}})})(),await i[t])}static async parse(t,e){e=e||{};let{id:n,fileName:r,position:i,loader:o,registry:a,context:c}=e;function u(t){for(const e of t.warnings){if(e.key){if(E.has(e.key))continue;E.add(e.key)}console.warn(l(e).message)}}function l(e,n){if(!(e instanceof w||e.location))return e;const i=t.split("\n")[e.location.start.line-1];let s=1;s=e.location.end.line===e.location.start.line?e.location.end.column-e.location.start.column:i.length-e.location.start.column,s=Math.max(1,s);let o,a="";for(let t=0;t<e.location.start.column-1;t++)a+=" ";for(let t=0;t<s;t++)a+="^";const c=`${o=n?"Parse error in":"Post-parse processing error caused by"} '${r}' line ${e.location.start.line}.\n${e.message}\n  ${i}\n  ${a}`,u=new Error(c);return n||(u.stack=e.stack),u}a=a||{},i=i||{line:1,column:0},n=`manifest:${r}:`;let h=[];try{h=s.parser.parse(t)}catch(t){throw l(t,!0)}const d=new x({id:n});d._fileName=r,c&&d._imports.push(c);try{await Promise.all(h.filter(t=>"import"===t.kind).map(async t=>{const e=o.path(d.fileName),n=o.join(e,t.path);try{d._imports.push(await x.load(n,o,{registry:a}))}catch(e){d.warnings.push(e),d.warnings.push(new w(t.location,`Error importing '${n}'`))}}));const t=async(t,e)=>{for(const n of h)n.kind===t&&(x._augmentAstWithTypes(d,n),await e(n))};await t("meta",t=>d.applyMeta(t.items)),await t("resource",t=>this._processResource(d,t)),await t("schema",t=>this._processSchema(d,t)),await t("shape",t=>this._processShape(d,t)),await t("particle",t=>this._processParticle(d,t,o)),await t("store",t=>this._processStore(d,t,o)),await t("recipe",t=>this._processRecipe(d,t,o))}catch(t){throw u(d),l(t,!1)}return u(d),d}static _augmentAstWithTypes(t,e){(new class extends C{constructor(){super()}visit(e,n){switch(n(),e.kind){case"schema-inline":{const n=[],r=[],i=[];for(const s of e.names){const e=t.resolveTypeName(s);e&&e.schema&&e.schema.isAlias?r.push(e.schema):i.push(s),e&&e.schema&&n.push(e.schema)}const s={};for(let{name:t,type:r}of e.fields){for(const i of n)if(r){const n=i.fields[t];if(n&&!u.Schema.typesEqual(n,r))throw new w(e.location,`Type of '${t}' does not match schema (${r} vs ${n})`)}else r=i.fields[t];if(!r)throw new w(e.location,`Could not infer type of '${t}' field`);s[t]=r}let o=new u.Schema({names:i,fields:s});for(const t of r)if(!(o=u.Schema.union(t,o)))throw new w(e.location,"Could not merge schema aliases");return void(e.model=d.Type.newEntity(o))}case"variable-type":{const t=e.constraint&&e.constraint.model;return void(e.model=d.Type.newVariable(new m.TypeVariable(e.name,t,null)))}case"slot-type":{const t={};for(const n of Object.keys(e.fields)){const r=e.fields[n];t[r.name]=r.value}const n={formFactor:t.formFactor,handle:t.handle};return void(e.model=d.Type.newSlot(new _.SlotInfo(n)))}case"type-name":{const n=t.resolveTypeName(e.name);if(!n)throw new w(e.location,`Could not resolve type reference to type name '${e.name}'`);if(n.schema)e.model=d.Type.newEntity(n.schema);else{if(!n.shape)throw new Error("Expected {shape} or {schema}");e.model=d.Type.newInterface(n.shape)}return}case"collection-type":return void(e.model=d.Type.newCollection(e.type.model));case"big-collection-type":return void(e.model=d.Type.newBigCollection(e.type.model));case"reference-type":return void(e.model=d.Type.newReference(e.type.model));default:return}}}).traverse(e)}static _processSchema(t,e){let n;const r={};let i=[...e.names];for(const t of e.items)switch(t.kind){case"schema-field":{const e=t;if(r[e.name])throw new w(e.location,`Duplicate definition of field '${e.name}'`);r[e.name]=e.type;break}case"description":if(n)throw new w(t.location,"Duplicate schema description");n=t;break;default:throw new w(t.location,`unknown parser artifact ${t.kind} while processing schema`)}for(const n of e.parents){const s=t.findSchemaByName(n);if(!s)throw new w(e.location,`Could not find parent schema '${n}'`);for(const[t,i]of Object.entries(s.fields))if(r[t]&&!u.Schema.typesEqual(r[t],i))throw new w(e.location,`'${n}' defines incompatible type for field '${t}'`);Object.assign(r,s.fields),i.push(...s.names)}i=[i[0],...i.filter(t=>t!==i[0])];const s=e.alias||i[0];if(!s)throw new w(e.location,"Schema defined without name or alias");const o={names:i,fields:r,description:n},a=new u.Schema(o);e.alias&&(a.isAlias=!0),t._schemas[s]=a}static _processResource(t,e){t._resources[e.name]=e.data}static _processParticle(t,e,n){if(Object(r.assert)(null==e.implFile||null!==e.args,"no valid body defined for this particle"),e.args||(e.args=[]),e.hasParticleArgument){const n=new w(e.location,"Particle uses deprecated argument body");n.key="hasParticleArgument",t._warnings.push(n)}e.implFile&&n&&(e.implFile=n.join(t.fileName,e.implFile));const i=t=>{for(const e of t)e.type=e.type.model,i(e.dependentConnections)};i(e.args);const s=new c.ParticleSpec(e);t._particles[e.name]=s}static _processShape(t,e){if(e.interface){const n=new w(e.location,"Shape uses deprecated argument body");n.key="hasShapeArgument",t._warnings.push(n)}const n=e.interface?e.interface.args:e.args,r=[];for(const t of n){const e={name:void 0,type:void 0,direction:t.direction};"*"!==t.name&&(e.name=t.name),t.type&&(e.type=t.type.model),r.push(e)}const i=[];for(const t of e.slots)i.push({direction:t.direction,name:t.name,isRequired:t.isRequired,isSet:t.isSet});const s=new h.Shape(e.name,r,i);t._shapes.push(s)}static async _processRecipe(t,e,n){const i=t._newRecipe(e.name);i.annotation=e.annotation,i.verbs=e.verbs;const s={handles:e.items.filter(t=>"handle"===t.kind),byHandle:new Map,particles:e.items.filter(t=>"particle"===t.kind),byParticle:new Map,slots:e.items.filter(t=>"slot"===t.kind),bySlot:new Map,byName:new Map,connections:e.items.filter(t=>"connection"===t.kind),search:e.items.find(t=>"search"===t.kind),description:e.items.find(t=>"description"===t.kind)};for(const e of s.handles){const n=i.newHandle(),o=e.ref||{tags:[]};if(o.id){n.id=o.id;const e=t.findStoreById(n.id);e&&n.mapToStorage(e)}else if(o.name){const e=t.findStoreByName(o.name);Object(r.assert)(e,`Could not find handle ${o.name}`),n.mapToStorage(e)}n.tags=o.tags,e.name&&(Object(r.assert)(!s.byName.has(e.name)),n.localName=e.name,s.byName.set(e.name,{item:e,handle:n})),n.fate=e.fate,s.byHandle.set(n,e)}const o=(e,n)=>{switch(n.targetType){case"particle":{const r=t.findParticleByName(n.particle);if(!r)throw new w(e.location,`could not find particle '${n.particle}'`);if(null!==n.param&&!r.connectionMap.has(n.param))throw new w(e.location,`param '${n.param}' is not defined by '${n.particle}'`);return new y.ParticleEndPoint(r,n.param)}case"localName":if(!s.byName.has(n.name))throw new w(e.location,`local name '${n.name}' does not exist in recipe`);if(null==n.param&&0===n.tags.length&&s.byName.get(n.name).handle)return new y.HandleEndPoint(s.byName.get(n.name).handle);throw new w(e.location,"references to particles by local name not yet supported");case"tag":return new y.TagEndPoint(n.tags);default:throw new Error(`endpoint ${n.targetType} not supported`)}};for(const t of s.connections){const e=o(t,t.from),n=o(t,t.to);i.newConnectionConstraint(e,n,t.direction)}s.search&&(i.search=new l.Search(s.search.phrase,s.search.tokens));for(const t of s.slots){const e=i.newSlot();t.ref=t.ref||{},t.ref.id&&(e.id=t.ref.id),t.ref.tags&&(e.tags=t.ref.tags),t.name&&(Object(r.assert)(!s.byName.has(t.name),`Duplicate slot local name ${t.name}`),e.localName=t.name,s.byName.set(t.name,e)),s.bySlot.set(e,t)}for(const e of s.particles){const n=i.newParticle(e.ref.name);if(n.tags=e.ref.tags,n.verbs=e.ref.verbs,e.ref.name){const r=t.findParticleByName(e.ref.name);if(!r)throw new w(e.location,`could not find particle ${e.ref.name}`);n.spec=r.clone()}e.name&&(Object(r.assert)(!s.byName.has(e.name)),n.localName=e.name,s.byName.set(e.name,{item:e,particle:n})),s.byParticle.set(n,e);for(const t of e.slotConnections){let e=n.consumedSlotConnections[t.param];e||(e=n.addSlotConnection(t.param)),e.tags=t.tags||[],t.providedSlots.forEach(t=>{let n=e.providedSlots[t.param];if(n){if(t.name)if(s.byName.has(t.name)){const e=s.byName.get(t.name);Object(r.assert)(e!==n),Object(r.assert)(!e.name&&n),Object(r.assert)(!e.sourceConnection&&n.sourceConnection),Object(r.assert)(0===e.handleConnections.length),e.name=n.name,e.sourceConnection=n.sourceConnection,e.sourceConnection.providedSlots[e.name]=e,e._handleConnections=n.handleConnections.slice(),e.recipe.removeSlot(n)}else s.byName.set(t.name,n);s.bySlot.set(n,t)}else n=s.byName.get(t.name);n||((n=i.newSlot(t.param)).localName=t.name,n.sourceConnection=e,t.name&&(Object(r.assert)(!s.byName.has(t.name)),s.byName.set(t.name,n)),s.bySlot.set(n,t)),e.providedSlots[t.param]||(e.providedSlots[t.param]=n)})}}for(const[e,n]of s.byParticle){for(const r of n.connections){let n;"*"===r.param?n=e.addUnnamedConnection():(n=e.connections[r.param])||(n=e.addConnectionName(r.param)),n.tags=r.target?r.target.tags:[];const o={"->":"out","<-":"in","=":"inout",consume:"`consume",provide:"`provide"}[r.dir];if(n.direction){if(!(n.direction===o||"inout"===o||"host"===n.direction&&"in"===o||"`consume"===n.direction&&"in"===o||"`provide"===n.direction&&"out"===o))throw new w(r.location,`'${r.dir}' not compatible with '${n.direction}' param of '${e.name}'`)}else{if("*"!==r.param&&void 0!==e.spec)throw new w(r.location,`param '${r.param}' is not defined by '${e.name}'`);n.direction=o}let a,c;if(r.target&&r.target.name){let t=s.byName.get(r.target.name);if(t){if(!t.item)throw new Error(`did not expect ${t} expected handle or particle`)}else{const e=i.newHandle();e.tags=[],e.localName=r.target.name,e.fate="create",e.item={kind:"handle"},t={item:e.item,handle:e},s.byName.set(e.localName,t),s.byHandle.set(e,e.item)}if("handle"===t.item.kind)a=t.handle;else{if("particle"!==t.item.kind)throw new Error(`did not expect ${t.item.kind}`);c=t.particle}}if(r.target&&r.target.particle){const e=t.findParticleByName(r.target.particle);if(!e)throw new w(r.target.location,`Could not find hosted particle '${r.target.particle}'`);if(!(a=b.RecipeUtil.constructImmediateValueHandle(n,e,t.generateID())))throw new w(r.target.location,`Hosted particle '${e.name}' does not match shape '${n.name}'`)}if(c){let t;r.target.param?(t=c.connections[r.target.param])||(t=c.addConnectionName(r.target.param)):t=c.addUnnamedConnection(),(a=t.handle)||(a=i.newHandle(),t.connectToHandle(a))}a&&n.connectToHandle(a)}for(const t of n.slotConnections){if(void 0!==e.spec){if(!e.spec.slots.has(t.param))throw new w(t.location,`Consumed slot '${t.param}' is not defined by '${e.name}'`);t.providedSlots.forEach(n=>{if(!e.spec.slots.get(t.param).getProvidedSlotSpec(n.param))throw new w(n.location,`Provided slot '${n.param}' is not defined by '${e.name}'`)})}let n=s.byName.get(t.name);n?(Object(r.assert)(s.bySlot.has(n)),n.name||(n.name=t.param),Object(r.assert)(n===s.byName.get(t.name),`Target slot ${n.name} doesn't match slot connection ${t.param}`)):t.name&&((n=i.newSlot(t.param)).localName=t.name,t.name&&s.byName.set(t.name,n),s.bySlot.set(n,t)),n&&e.consumedSlotConnections[t.param].connectToSlot(n)}}s.description&&s.description.description&&(i.description=s.description.description)}resolveTypeName(t){const e=this.findSchemaByName(t);if(e)return{schema:e};const n=this.findShapeByName(t);return n?{shape:n}:null}static async _processStore(t,e,n){const r=e.name;let s=e.id;const o=e.originalId,a=e.type.model;null==s&&(s=`${t._id}store${t._stores.length}`);let c,u,l,h,f=e.tags;if(null==f&&(f=[]),"storage"===e.origin)return void t.newStorageStub(a,r,s,e.source,f,o);if("file"===e.origin)u=n.join(t.fileName,e.source),c=await n.loadResource(u);else if("resource"===e.origin&&(u=e.source,void 0==(c=t.resources[u])))throw new Error(`Resource '${u}' referenced by store '${s}' is not defined in this manifest`);try{l=JSON.parse(c)}catch(t){throw new w(e.location,`Error parsing JSON from '${u}' (${t.message})'`)}if(a instanceof d.CollectionType)h=a.collectionType;else if(a instanceof d.BigCollectionType)h=a.bigCollectionType;else{if(0===l.length)return void await x._createStore(t,a,r,s,f,e,o);l=l.slice(l.length-1),h=a}if(h instanceof d.EntityType){let n=!1;if(l=l.map(e=>{if(null==e)return null;n=n||e.$id;const r=e.$id||t.generateID();return delete e.$id,{id:r,rawData:e}}),!e.id&&!n){s=`${s}:${await Object(i.digest)(JSON.stringify(l.map(t=>t.rawData)))}`}}const p=e.version||0,g=await x._createStore(t,a,r,s,f,e,o);if(l.length>0&&l[0].rawData&&l[0].rawData.storageKey){let e=l[0].rawData.storageKey;e=t.findStoreByName(e).storageKey,l=l.map(({id:t,rawData:n})=>({id:t,storageKey:e}))}else l.length>0&&(g.referenceMode=!1);let y;y=a instanceof d.CollectionType?l.map(t=>({id:t.id,value:t,keys:new Set([t.id])})):a instanceof d.BigCollectionType?l.map(t=>{const e=t.rawData.$index;return delete t.rawData.$index,{id:t.id,index:e,value:t,keys:new Set([t.id])}}):l.map(t=>({id:t.id,value:t})),g.fromLiteral({version:p,model:y})}static async _createStore(t,e,n,r,i,s,o){const a=await t.createStore(e,n,r,i);return a.source=s.source,a.description=s.description,a.originalId=o,a}_newRecipe(t){const e=new o.Recipe(t);return this._recipes.push(e),e}toString(t){t=t||{};const e=[];return this._imports.forEach(n=>{if(t.recursive){e.push(`// import '${n.fileName}'`);n.toString(t);e.push(`${n.toString(t)}`)}else e.push(`import '${n.fileName}'`)}),Object.values(this._schemas).forEach(t=>{e.push(t.toManifestString())}),Object.values(this._particles).forEach(t=>{e.push(t.toString())}),this._recipes.forEach(n=>{e.push(n.toString(t))}),[...this.stores].sort(f.compareComparables).forEach(t=>{e.push(t.toString(this.storeTags.get(t).map(t=>`#${t}`)))}),e.join("\n")}}},function(t,e,n){"use strict";async function r(t){const e=new TextEncoder("utf-8").encode(t),n=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(n)).map(t=>("00"+t.toString(16)).slice(-2)).join("")}n.r(e),n.d(e,"digest",function(){return r})},function(t,e,n){"use strict";n.r(e),n.d(e,"parser",function(){return r});const r=function(){function t(e,n,r,i){this.message=e,this.expected=n,this.found=r,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(t,Error),t.buildMessage=function(t,e){var n={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?s(t.parts[e][0])+"-"+s(t.parts[e][1]):s(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function o(t){return n[t.type](t)}return"Expected "+function(t){var e,n,r=new Array(t.length);for(e=0;e<t.length;e++)r[e]=o(t[e]);if(r.sort(),r.length>0){for(e=1,n=1;e<r.length;e++)r[e-1]!==r[e]&&(r[n]=r[e],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,n){n=void 0!==n?n:{};var r,i={},s={Manifest:Ri},o=Ri,a=function(t){let e=t.map(t=>{let e=t[2];return e.annotation=Is(t[0],t=>t[1],null),e});return function t(e){if(!["string","number","boolean"].includes(typeof e)&&null!==e){if(void 0===e)throw new Error("result was undefined");if(Array.isArray(e))for(let n of e)t(n);else{if(e.model)throw new Error(`unexpected 'model' in ${JSON.stringify(e)}`);if(!e.location)throw new Error(`no 'location' in ${JSON.stringify(e)}`);if(!e.kind)throw new Error(`no 'kind' in ${JSON.stringify(e)}`);for(let n of Object.keys(e))["location","kind"].includes(n)||t(e[n])}}}(e),e},c="@",u=xi("@",!1),l=function(t){return t},h="resource",d=xi("resource",!1),f=function(t,e){return{kind:"resource",name:t,data:e,location:Ci()}},p="start",g=xi("start",!1),y=function(){Os=ks},v=function(t){return t.map(t=>t[0].substring(Os.length)+t[1]).join("")},m=/^[^\n]/,_=Ti(["\n"],!0,!1),b=function(){return Si()},w="store",S=xi("store",!1),C="of",E=xi("of",!1),x="!!",T=xi("!!",!1),A=function(t,e,n,r,i,s,o,a){return a=Is(a,Rs,[]),{kind:"store",location:Ci(),name:t,type:e,id:Is(n,t=>t[1],null),originalId:Is(r,t=>t[1],null),version:Is(i,t=>t[1],null),tags:Is(s,t=>t[1],null),source:o.source,origin:o.origin,description:a.length>0?a[0][2]:null}},k="in",O=xi("in",!1),P=function(t){return{origin:"file",source:t}},R=function(t){return{origin:"resource",source:t}},I="at",F=xi("at",!1),D=function(t){return{origin:"storage",source:t}},N="description",j=xi("description",!1),M="import",B=xi("import",!1),L=function(t){return{kind:"import",location:Ci(),path:t}},H="shape",q=xi("shape",!1),U="<",V=xi("<",!1),K=">",$=xi(">",!1),W=function(t,e,n){var r=Is(n,Rs,[]).find(t=>"shape-interface"==t.kind);return r?{kind:"shape",location:Ci(),name:t,interface:r,slots:Is(n,Rs,[]).filter(t=>"shape-slot"==t.kind)}:{kind:"shape",location:Ci(),name:t,args:Is(n,Rs,[]).filter(t=>"shape-argument"==t.kind),slots:Is(n,Rs,[]).filter(t=>"shape-slot"==t.kind)}},z="(",G=xi("(",!1),Q=")",J=xi(")",!1),Y=function(t,e){return{kind:"shape-interface",location:Ci(),verb:t,args:e||[]}},X=function(t){return t},Z=",",tt=xi(",",!1),et=function(t,e){return[t].concat(e.map(t=>t[2]))},nt="*",rt=xi("*",!1),it=function(t,e,n){return t&&(t=t[0]),e&&(e=e[0]),"host"==t&&Ei("Shape cannot have arguments with a 'host' direction."),{kind:"shape-argument",location:Ci(),direction:t,type:e,name:n}},st="must",ot=xi("must",!1),at="consume",ct=xi("consume",!1),ut="provide",lt=xi("provide",!1),ht="set of",dt=xi("set of",!1),ft=function(t,e,n,r){return{kind:"shape-slot",location:Ci(),name:Is(r,t=>r[1],null),isRequired:Is(t,t=>"must"==t[0],!1),direction:e,isSet:!!n}},pt="meta",gt=xi("meta",!1),yt=function(t){return{kind:"meta",items:t=t?Rs(t):[],location:Ci()}},vt="name",mt=xi("name",!1),_t=":",bt=xi(":",!1),wt=function(t){return{key:"name",value:t,location:Ci(),kind:"name"}},St="storageKey",Ct=xi("storageKey",!1),Et=function(t){return{key:"storageKey",value:t,location:Ci(),kind:"storageKey"}},xt="particle",Tt=xi("particle",!1),At=function(t,e,n,r){let i=[],s=[],o=[],a=null,c=!1;return e=Is(e,t=>t[1],[]),(r=r?Rs(r):[]).forEach(n=>{"interface"==n.kind?(/[A-Z]/.test(n.verb[0])&&n.verb!=t&&Ei(`Verb ${n.verb} must start with a lower case character or be same as particle name.`),e.push(n.verb),i=n.args,c=!0):"particle-argument"==n.kind?i.push(n):"particle-slot"==n.kind?o.push(n):"description"==n.kind?(a={kind:"description?",location:"FIXME"},n.description.forEach(t=>a[t.name]=t.pattern||t.patterns[0])):n.modality?s.push(n.modality):Ei(`Particle ${t} contains an unknown element: ${n.name}`)}),0==s.length&&s.push("dom"),s.push("mock"),{kind:"particle",location:Ci(),name:t,implFile:Is(n,t=>t[3],null),verbs:e,args:i,modality:s,slots:o,description:a,hasParticleArgument:c}},kt=function(t,e){return{kind:"interface",location:Ci(),verb:t,args:e||[]}},Ot=function(t,e){return e=Is(e,Rs,[]),t.dependentConnections=e,t},Pt="?",Rt=xi("?",!1),It=function(t,e,n,r){return{kind:"particle-argument",location:Ci(),direction:t,type:n,isOptional:!!e,dependentConnections:[],name:r.name,tags:r.tags}},Ft="inout",Dt=xi("inout",!1),Nt="out",jt=xi("out",!1),Mt="host",Bt=xi("host",!1),Lt="`consume",Ht=xi("`consume",!1),qt="`provide",Ut=xi("`provide",!1),Vt=function(){return Si()},Kt="[",$t=xi("[",!1),Wt="]",zt=xi("]",!1),Gt=function(t){return{kind:"collection-type",location:Ci(),type:t}},Qt="BigCollection<",Jt=xi("BigCollection<",!1),Yt=function(t){return{kind:"big-collection-type",location:Ci(),type:t}},Xt="Reference<",Zt=xi("Reference<",!1),te=function(t){return{kind:"reference-type",location:Ci(),type:t}},ee="~",ne=xi("~",!1),re="with",ie=xi("with",!1),se=function(t,e){return{kind:"variable-type",location:Ci(),name:t,constraint:Is(e,t=>t[3],null)}},oe="Slot",ae=xi("Slot",!1),ce="{",ue=xi("{",!1),le="}",he=xi("}",!1),de=function(t){return t=Is(t,t=>{let e=t[2];return[e[0]].concat(e[1].map(t=>t[2]))},[]),{kind:"slot-type",location:Ci(),fields:t}},fe=function(t,e){return{kind:"slot-field",location:Ci(),name:t,value:e}},pe=function(t){return{kind:"type-name",location:Ci(),name:t}},ge=function(t,e){return[t,...e.map(t=>t[2])]},ye="affordance",ve=xi("affordance",!1),me="modality",_e=xi("modality",!1),be="dom-touch",we=xi("dom-touch",!1),Se="dom",Ce=xi("dom",!1),Ee="vr",xe=xi("vr",!1),Te="voice",Ae=xi("voice",!1),ke=function(t){return{kind:"particle-modality",location:Ci(),modality:t}},Oe=function(t,e,n,r,i){let s=null,o=[];return(i=Is(i,Rs,[])).forEach(t=>{"provided-slot"==t.kind?o.push(t):"form-factor"==t.kind?(s&&Ei("duplicate form factor for a slot"),s=t.formFactor):Ei("Unsupported particle slot item ",t)}),{kind:"particle-slot",location:Ci(),name:n,tags:Is(r,t=>t[1],[]),isRequired:Is(t,t=>"must"==t[0],!1),isSet:!!e,formFactor:s,providedSlots:o}},Pe="formFactor",Re=xi("formFactor",!1),Ie="fullscreen",Fe=xi("fullscreen",!1),De="big",Ne=xi("big",!1),je="medium",Me=xi("medium",!1),Be="small",Le=xi("small",!1),He=function(t){return{kind:"form-factor",location:Ci(),formFactor:t}},qe=function(t,e,n,r,i){let s=null,o=[];return(i=i?Rs(i):[]).forEach(t=>{"form-factor"==t.kind?(s&&Ei("duplicate form factor for a slot"),s=t.formFactor):o.push(t.handle)}),{kind:"provided-slot",location:Ci(),name:n,tags:Is(r,t=>t[1],[]),isRequired:Is(t,t=>"must"==t[0],!1),isSet:!!e,formFactor:s,handles:o}},Ue="handle",Ve=xi("handle",!1),Ke=function(t){return{kind:"particle-provided-slot-handle",location:Ci(),handle:t}},$e=function(t,e){e=Is(e,Rs,[]);let n=[];return t&&(n.push(t),e.filter(t=>"pattern"==t.name).forEach(t=>n.push(t)),e=e.filter(t=>"pattern"!=t.name)),{kind:"description",location:Ci(),description:[{kind:"default-description?",location:Ci(),name:"pattern",patterns:n},...e]}},We=function(t,e){return{kind:"handle-description",location:Ci(),name:t,pattern:e}},ze="recipe",Ge=xi("recipe",!1),Qe=function(t,e,n){return e=Is(e,t=>t[1],[]),{kind:"recipe",location:Ci(),name:Is(t,t=>t[1],null),verbs:e,items:Is(n,Rs,[])}},Je="as",Ye=xi("as",!1),Xe=function(t){return t},Ze=function(t,e,n){let r=[],i=[];if(n){n=Rs(n);for(let t of n)"handle-connection"==t.kind?r.push(t):i.push(t)}return{kind:"particle",location:Ci(),name:Is(e,t=>t[1],null),ref:t,connections:r,slotConnections:i}},tn=function(t,e,n){return{kind:"handle-connection",location:Ci(),param:t,dir:e,target:Is(n,t=>t[1],null)}},en=function(t,e){let n=null,r=null;return(t=Is(t,t=>t,null))&&(t[0].toUpperCase()==t[0]?r=t:n=t),{kind:"handle-connection-components",location:Ci(),name:n,particle:r,tags:Is(e,t=>t,[])}},nn=function(t,e,n){return{kind:"slot-connection",location:Ci(),param:t.param,tags:t.tags,name:Is(e,t=>t[1],null),providedSlots:Is(n,Rs,[])}},rn=function(t,e){return{kind:"slot-connection-ref",location:Ci(),param:t,tags:e}},sn=function(t,e){return{kind:"provided-slot",location:Ci(),param:t,name:Is(e,t=>t[1],null)}},on=function(t,e,n){return{kind:"connection",location:Ci(),direction:e,from:t,to:n}},an="search",cn=xi("search",!1),un="tokens",ln=xi("tokens",!1),hn=function(t,e){return{kind:"search",location:Ci(),phrase:t,tokens:Is(e,t=>t[1][2].map(t=>t[1]),null)}},dn="<-",fn=xi("<-",!1),pn="->",gn=xi("->",!1),yn="=",vn=xi("=",!1),mn=function(t,e){let{param:n,tags:r}=Is(e,t=>t,{param:null,tags:[]});return{kind:"connection-target",location:Ci(),targetType:"verb",verbs:t,param:n,tags:r}},_n=function(t){return{kind:"connection-target",location:Ci(),targetType:"tag",tags:t}},bn=function(t,e){let{param:n,tags:r}=Is(e,t=>t,{param:null,tags:[]});return{kind:"connection-target",targetType:"localName",location:Ci(),name:t,param:n,tags:r}},wn=function(t,e){let{param:n,tags:r}=Is(e,t=>t,{param:null,tags:[]});return{kind:"connection-target",targetType:"particle",location:Ci(),particle:t,param:n,tags:r}},Sn=".",Cn=xi(".",!1),En=function(t,e){return{param:Is(t,t=>t,null),tags:Is(e,t=>t[1],[])}},xn="use",Tn=xi("use",!1),An="map",kn=xi("map",!1),On="create",Pn=xi("create",!1),Rn="copy",In=xi("copy",!1),Fn="`slot",Dn=xi("`slot",!1),Nn=function(t,e,n){return{kind:"handle",location:Ci(),name:Is(n,t=>t[1],null),ref:Is(e,t=>t[1],null),fate:t}},jn="#",Mn=xi("#",!1),Bn=/^[a-zA-Z]/,Ln=Ti([["a","z"],["A","Z"]],!1,!1),Hn=/^[a-zA-Z0-9_]/,qn=Ti([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),Un=function(){return Si().substring(1)},Vn=function(t,e){return[t,...e&&e[1]||[]]},Kn="&",$n=xi("&",!1),Wn=function(t){return t},zn=function(t,e){return{name:t,tags:e=Is(e,t=>t[1],[])}},Gn=function(t){return{name:t,tags:[]}},Qn=function(t){return{name:t[0],tags:t}},Jn=function(t){return{kind:"particle-ref",location:Ci(),name:t,verbs:[]}},Yn=function(t){return{kind:"particle-ref",location:Ci(),verbs:[t]}},Xn=function(t,e){return{kind:"handle-ref",location:Ci(),id:t,tags:e||[]}},Zn=function(t,e){return{kind:"handle-ref",location:Ci(),name:t,tags:e||[]}},tr=function(t){return{kind:"handle-ref",location:Ci(),tags:t}},er="slot",nr=xi("slot",!1),rr=function(t,e){return{kind:"slot",location:Ci(),ref:Is(t,t=>t[1],null),name:Is(e,t=>t[1],"")}},ir=function(t,e){return{kind:"schema-inline",location:Ci(),names:Is(t,t=>t.map(t=>t[0]).filter(t=>"*"!=t),[]),fields:Is(e,t=>[t[0],...t[1].map(t=>t[2])],[])}},sr=function(t,e){return{kind:"schema-inline-field",location:Ci(),name:e,type:Is(t,t=>t[0],null)}},or="schema",ar=xi("schema",!1),cr=function(t,e){return{names:t.map(t=>t[1]).filter(t=>"*"!=t),parents:Is(e,t=>t,[])}},ur="alias",lr=xi("alias",!1),hr=function(t,e,n){return Object.assign(t,{kind:"schema",location:Ci(),items:Is(n,Rs,[]),alias:e})},dr=function(t,e){return Object.assign(t,{kind:"schema",location:Ci(),items:Is(e,Rs,[])})},fr="extends",pr=xi("extends",!1),gr=function(t,e){var n=[t];for(let t of e)n.push(t[3]);return n},yr=function(t,e){return{kind:"schema-field",location:Ci(),type:t,name:e}},vr=function(t){return{kind:"schema-collection",location:Ci(),schema:t}},mr=function(t){return{kind:"schema-reference",location:Ci(),schema:t}},_r="Text",br=xi("Text",!1),wr="URL",Sr=xi("URL",!1),Cr="Number",Er=xi("Number",!1),xr="Boolean",Tr=xi("Boolean",!1),Ar="Bytes",kr=xi("Bytes",!1),Or="Object",Pr=xi("Object",!1),Rr="or",Ir=xi("or",!1),Fr=function(t,e){let n=[t];for(let t of e)n.push(t[3]);return{kind:"schema-union",location:Ci(),types:n}},Dr=function(t,e){let n=[t];for(let t of e)n.push(t[3]);return{kind:"schema-tuple",location:Ci(),types:n}},Nr=/^[0-9]/,jr=Ti([["0","9"]],!1,!1),Mr=function(t){return Number(t.join(""))},Br=" ",Lr=xi(" ",!1),Hr=function(t){if((t=t.join("")).length>ks.length)return Ps.push(ks),ks=t,!0},qr=function(t){return(t=t.join("")).length==ks.length||(t.length<ks.length?(ks=Ps.pop(),!1):void 0)},Ur=function(t){return(t=t.join("")).length>=ks.length||(t.length<ks.length?(ks=Ps.pop(),!1):void 0)},Vr=function(){throw new Error(`Expected identifier but keyword, '${Si()}' found.`)},Kr="`",$r=xi("`",!1),Wr=/^[^`]/,zr=Ti(["`"],!0,!1),Gr=function(t){return t.join("")},Qr="'",Jr=xi("'",!1),Yr=/^[^']/,Xr=Ti(["'"],!0,!1),Zr=function(t){return t.join("")},ti=/^[A-Z]/,ei=Ti([["A","Z"]],!1,!1),ni=/^[a-z0-9_]/i,ri=Ti([["a","z"],["0","9"],"_"],!1,!0),ii=function(t){return Si()},si=/^[a-z]/,oi=Ti([["a","z"]],!1,!1),ai=/^[ ]/,ci=Ti([" "],!1,!1),ui={type:"any"},li="//",hi=xi("//",!1),di="\r",fi=xi("\r",!1),pi="\n",gi=xi("\n",!1),yi=0,vi=0,mi=[{line:1,column:1}],_i=0,bi=[],wi=0;if("startRule"in n){if(!(n.startRule in s))throw new Error("Can't start parsing from rule \""+n.startRule+'".');o=s[n.startRule]}function Si(){return e.substring(vi,yi)}function Ci(){return ki(vi,yi)}function Ei(e,n){throw function(e,n){return new t(e,null,null,n)}(e,n=void 0!==n?n:ki(vi,yi))}function xi(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ti(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function Ai(t){var n,r=mi[t];if(r)return r;for(n=t-1;!mi[n];)n--;for(r={line:(r=mi[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return mi[t]=r,r}function ki(t,e){var n=Ai(t),r=Ai(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:r.line,column:r.column}}}function Oi(t){yi<_i||(yi>_i&&(_i=yi,bi=[]),bi.push(t))}function Pi(e,n,r){return new t(t.buildMessage(e,n),e,n,r)}function Ri(){var t,e,n,r,s,o,c,u,l;if(t=yi,(e=Ts())===i&&(e=null),e!==i)if((n=ms())===i&&(n=null),n!==i){for(r=[],s=yi,o=yi,(c=_s())!==i&&(u=Fi())!==i&&(l=Ts())!==i?o=c=[c,u,l]:(yi=o,o=i),o===i&&(o=null),o!==i&&(c=_s())!==i&&(u=Ii())!==i?s=o=[o,c,u]:(yi=s,s=i);s!==i;)r.push(s),s=yi,o=yi,(c=_s())!==i&&(u=Fi())!==i&&(l=Ts())!==i?o=c=[c,u,l]:(yi=o,o=i),o===i&&(o=null),o!==i&&(c=_s())!==i&&(u=Ii())!==i?s=o=[o,c,u]:(yi=s,s=i);r!==i?(vi=t,t=e=a(r)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}function Ii(){var t;return(t=function(){var t,n,r,s,o,a,c,u,l,h,d;if(t=yi,e.substr(yi,6)===ze?(n=ze,yi+=6):(n=i,0===wi&&Oi(Ge)),n!==i)if(r=yi,(s=xs())!==i&&(o=Cs())!==i?r=s=[s,o]:(yi=r,r=i),r===i&&(r=null),r!==i)if(s=yi,(o=xs())!==i&&(a=us())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i)if((o=Ts())!==i){if(a=yi,(c=ms())!==i){for(u=[],l=yi,(h=_s())!==i&&(d=Zi())!==i?l=h=[h,d]:(yi=l,l=i);l!==i;)u.push(l),l=yi,(h=_s())!==i&&(d=Zi())!==i?l=h=[h,d]:(yi=l,l=i);u!==i?a=c=[c,u]:(yi=a,a=i)}else yi=a,a=i;a===i&&(a=null),a!==i?(vi=t,n=Qe(r,s,a),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d,f;if(t=yi,e.substr(yi,8)===xt?(n=xt,yi+=8):(n=i,0===wi&&Oi(Tt)),n!==i)if(xs()!==i)if((r=Cs())!==i)if(s=yi,(o=xs())!==i&&(a=us())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i)if(o=yi,(a=xs())!==i?(e.substr(yi,2)===k?(c=k,yi+=2):(c=i,0===wi&&Oi(O)),c!==i&&(u=xs())!==i&&(l=Ss())!==i?o=a=[a,c,u,l]:(yi=o,o=i)):(yi=o,o=i),o===i&&(o=null),o!==i)if((a=Ts())!==i){if(c=yi,(u=ms())!==i){for(l=[],h=yi,(d=_s())!==i&&(f=Li())!==i?h=d=[d,f]:(yi=h,h=i);h!==i;)l.push(h),h=yi,(d=_s())!==i&&(f=Li())!==i?h=d=[d,f]:(yi=h,h=i);l!==i?c=u=[u,l]:(yi=c,c=i)}else yi=c,c=i;c===i&&(c=null),c!==i?((u=Ts())===i&&(u=null),u!==i?(vi=t,n=At(r,s,o,c),t=n):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r;return t=yi,e.substr(yi,6)===M?(n=M,yi+=6):(n=i,0===wi&&Oi(B)),n!==i&&xs()!==i&&(r=Ss())!==i&&Ts()!==i?(vi=t,n=L(r),t=n):(yi=t,t=i),t}())===i&&(t=function(){var t,e,n,r,s,o,a,c;if(t=yi,(e=ps())!==i)if(Ts()!==i){if(n=yi,(r=ms())!==i){for(s=[],o=yi,(a=_s())!==i&&(c=gs())!==i?o=a=[a,c]:(yi=o,o=i);o!==i;)s.push(o),o=yi,(a=_s())!==i&&(c=gs())!==i?o=a=[a,c]:(yi=o,o=i);s!==i?n=r=[r,s]:(yi=n,n=i)}else yi=n,n=i;n===i&&(n=null),n!==i?(vi=t,e=dr(e,n),t=e):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h;if(t=yi,e.substr(yi,5)===ur?(n=ur,yi+=5):(n=i,0===wi&&Oi(lr)),n!==i)if(xs()!==i)if((r=ps())!==i)if(xs()!==i)if((s=function(){var t,n,r;return t=yi,e.substr(yi,2)===Je?(n=Je,yi+=2):(n=i,0===wi&&Oi(Ye)),n!==i&&xs()!==i&&(r=Cs())!==i?(vi=t,n=Xe(r),t=n):(yi=t,t=i),t}())!==i)if(Ts()!==i){if(o=yi,(a=ms())!==i){for(c=[],u=yi,(l=_s())!==i&&(h=gs())!==i?u=l=[l,h]:(yi=u,u=i);u!==i;)c.push(u),u=yi,(l=_s())!==i&&(h=gs())!==i?u=l=[l,h]:(yi=u,u=i);c!==i?o=a=[a,c]:(yi=o,o=i)}else yi=o,o=i;o===i&&(o=null),o!==i?(vi=t,n=hr(r,s,o),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,l,h,d,f,p,g,y,v,m,_,b;if(t=yi,e.substr(yi,5)===w?(n=w,yi+=5):(n=i,0===wi&&Oi(S)),n!==i)if(xs()!==i)if((r=Cs())!==i)if(xs()!==i)if(e.substr(yi,2)===C?(s=C,yi+=2):(s=i,0===wi&&Oi(E)),s!==i)if(xs()!==i)if((o=function(){var t;return(t=ds())===i&&(t=Vi())===i&&(t=Ki())===i&&(t=zi()),t}())!==i)if(a=yi,(l=xs())!==i&&(h=Ss())!==i?a=l=[l,h]:(yi=a,a=i),a===i&&(a=null),a!==i)if(l=yi,e.substr(yi,2)===x?(h=x,yi+=2):(h=i,0===wi&&Oi(T)),h!==i&&(d=Ss())!==i?l=h=[h,d]:(yi=l,l=i),l===i&&(l=null),l!==i)if(h=yi,(d=xs())!==i&&(f=function(){var t,n,r,s;if(t=yi,64===e.charCodeAt(yi)?(n=c,yi++):(n=i,0===wi&&Oi(u)),n!==i){if(r=[],Nr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(jr)),s!==i)for(;s!==i;)r.push(s),Nr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(jr));else r=i;r!==i?(vi=t,n=Mr(r),t=n):(yi=t,t=i)}else yi=t,t=i;return t}())!==i?h=d=[d,f]:(yi=h,h=i),h===i&&(h=null),h!==i)if(d=yi,(f=xs())!==i&&(p=as())!==i?d=f=[f,p]:(yi=d,d=i),d===i&&(d=null),d!==i)if((f=xs())!==i)if((p=function(){var t;return(t=function(){var t,n,r;return t=yi,e.substr(yi,2)===k?(n=k,yi+=2):(n=i,0===wi&&Oi(O)),n!==i&&xs()!==i&&(r=Ss())!==i?(vi=t,n=P(r),t=n):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r;return t=yi,e.substr(yi,2)===k?(n=k,yi+=2):(n=i,0===wi&&Oi(O)),n!==i&&xs()!==i&&(r=Cs())!==i?(vi=t,n=R(r),t=n):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r;return t=yi,e.substr(yi,2)===I?(n=I,yi+=2):(n=i,0===wi&&Oi(F)),n!==i&&xs()!==i&&(r=Ss())!==i?(vi=t,n=D(r),t=n):(yi=t,t=i),t}()),t}())!==i)if(Ts()!==i){if(g=yi,(y=ms())!==i){if(v=[],m=yi,(_=_s())!==i&&(b=Ni())!==i?m=_=[_,b]:(yi=m,m=i),m!==i)for(;m!==i;)v.push(m),m=yi,(_=_s())!==i&&(b=Ni())!==i?m=_=[_,b]:(yi=m,m=i);else v=i;v!==i?g=y=[y,v]:(yi=g,g=i)}else yi=g,g=i;g===i&&(g=null),g!==i?(vi=t,n=A(r,o,a,l,h,d,p,g),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d;if(t=yi,e.substr(yi,5)===H?(n=H,yi+=5):(n=i,0===wi&&Oi(q)),n!==i)if(xs()!==i)if((r=Cs())!==i)if(s=yi,(o=xs())===i&&(o=null),o!==i?(60===e.charCodeAt(yi)?(a=U,yi++):(a=i,0===wi&&Oi(V)),a!==i?((c=xs())===i&&(c=null),c!==i&&(u=function(){var t,n,r,s,o,a,c;if(t=yi,(n=$i())!==i){for(r=[],s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=$i())!==i?s=o=[o,a,c]:(yi=s,s=i);s!==i;)r.push(s),s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=$i())!==i?s=o=[o,a,c]:(yi=s,s=i);r!==i?(vi=t,n=ge(n,r),t=n):(yi=t,t=i)}else yi=t,t=i;return t}())!==i?((l=xs())===i&&(l=null),l!==i?(62===e.charCodeAt(yi)?(h=K,yi++):(h=i,0===wi&&Oi($)),h!==i?s=o=[o,a,c,u,l,h]:(yi=s,s=i)):(yi=s,s=i)):(yi=s,s=i)):(yi=s,s=i)):(yi=s,s=i),s===i&&(s=null),s!==i)if((o=Ts())!==i){if(a=yi,(c=ms())!==i){for(u=[],l=yi,(h=_s())!==i&&(d=ji())!==i?l=h=[h,d]:(yi=l,l=i);l!==i;)u.push(l),l=yi,(h=_s())!==i&&(d=ji())!==i?l=h=[h,d]:(yi=l,l=i);u!==i?a=c=[c,u]:(yi=a,a=i)}else yi=a,a=i;a===i&&(a=null),a!==i?((c=Ts())===i&&(c=null),c!==i?(vi=t,n=W(r,s,a),t=n):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,c,u;if(t=yi,e.substr(yi,4)===pt?(n=pt,yi+=4):(n=i,0===wi&&Oi(gt)),n!==i)if(Ts()!==i){if(r=yi,(s=ms())!==i){for(o=[],a=yi,(c=_s())!==i&&(u=Bi())!==i?a=c=[c,u]:(yi=a,a=i);a!==i;)o.push(a),a=yi,(c=_s())!==i&&(u=Bi())!==i?a=c=[c,u]:(yi=a,a=i);o!==i?r=s=[s,o]:(yi=r,r=i)}else yi=r,r=i;r===i&&(r=null),r!==i?((s=Ts())===i&&(s=null),s!==i?(vi=t,n=yt(r),t=n):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o;return t=yi,e.substr(yi,8)===h?(n=h,yi+=8):(n=i,0===wi&&Oi(d)),n!==i&&xs()!==i&&(r=Cs())!==i&&Ts()!==i&&ms()!==i&&_s()!==i&&function(){var t,n;return t=yi,e.substr(yi,5)===p?(n=p,yi+=5):(n=i,0===wi&&Oi(g)),n!==i&&Ts()!==i?(vi=t,n=y(),t=n):(yi=t,t=i),t}()!==i&&(s=function(){var t,e,n,r,s;if(t=yi,e=[],n=yi,(r=bs())!==i&&(s=Di())!==i?n=r=[r,s]:(yi=n,n=i),n!==i)for(;n!==i;)e.push(n),n=yi,(r=bs())!==i&&(s=Di())!==i?n=r=[r,s]:(yi=n,n=i);else e=i;return e!==i&&(vi=t,e=v(e)),t=e}())!==i?((o=Ts())===i&&(o=null),o!==i?(vi=t,n=f(r,s),t=n):(yi=t,t=i)):(yi=t,t=i),t}()),t}function Fi(){var t,n,r;return t=yi,64===e.charCodeAt(yi)?(n=c,yi++):(n=i,0===wi&&Oi(u)),n!==i&&(r=Es())!==i?(vi=t,t=n=l(r)):(yi=t,t=i),t}function Di(){var t,n,r;for(t=yi,n=[],m.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(_));r!==i;)n.push(r),m.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(_));return n!==i&&(r=As())!==i?(vi=t,t=n=b()):(yi=t,t=i),t}function Ni(){var t,n,r,s,o;return t=yi,e.substr(yi,11)===N?(n=N,yi+=11):(n=i,0===wi&&Oi(j)),n!==i&&(r=xs())!==i&&(s=ws())!==i&&(o=Ts())!==i?t=n=[n,r,s,o]:(yi=t,t=i),t}function ji(){var t;return(t=function(){var t,n,r,s,o,a,c;return t=yi,n=yi,e.substr(yi,4)===st?(r=st,yi+=4):(r=i,0===wi&&Oi(ot)),r!==i&&(s=xs())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i?(e.substr(yi,7)===at?(r=at,yi+=7):(r=i,0===wi&&Oi(ct)),r===i&&(e.substr(yi,7)===ut?(r=ut,yi+=7):(r=i,0===wi&&Oi(lt))),r!==i?(s=yi,(o=xs())!==i?(e.substr(yi,6)===ht?(a=ht,yi+=6):(a=i,0===wi&&Oi(dt)),a!==i?s=o=[o,a]:(yi=s,s=i)):(yi=s,s=i),s===i&&(s=null),s!==i?(o=yi,(a=xs())!==i&&(c=Es())!==i?o=a=[a,c]:(yi=o,o=i),o===i&&(o=null),o!==i&&(a=Ts())!==i?(vi=t,n=ft(n,r,s,o),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,e;return t=yi,(e=Mi())!==i&&Ts()!==i?(vi=t,e=X(e),t=e):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o;return t=yi,(n=Cs())===i&&(n=Es()),n!==i?(40===e.charCodeAt(yi)?(r=z,yi++):(r=i,0===wi&&Oi(G)),r!==i?((s=function(){var t,n,r,s,o,a,c;if(t=yi,(n=Mi())!==i){for(r=[],s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=Mi())!==i?s=o=[o,a,c]:(yi=s,s=i);s!==i;)r.push(s),s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=Mi())!==i?s=o=[o,a,c]:(yi=s,s=i);r!==i?(vi=t,n=et(n,r),t=n):(yi=t,t=i)}else yi=t,t=i;return t}())===i&&(s=null),s!==i?(41===e.charCodeAt(yi)?(o=Q,yi++):(o=i,0===wi&&Oi(J)),o!==i&&Ts()!==i?(vi=t,n=Y(n,s),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}()),t}function Mi(){var t,n,r,s,o;return t=yi,n=yi,(r=qi())!==i&&(s=xs())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i?(r=yi,(s=Ui())!==i&&(o=xs())!==i?r=s=[s,o]:(yi=r,r=i),r===i&&(r=null),r!==i?((s=Es())===i&&(42===e.charCodeAt(yi)?(s=nt,yi++):(s=i,0===wi&&Oi(rt))),s!==i?(vi=t,t=n=it(n,r,s)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}function Bi(){var t;return(t=function(){var t,n,r,s,o,a;return t=yi,e.substr(yi,10)===St?(n=St,yi+=10):(n=i,0===wi&&Oi(Ct)),n!==i?((r=xs())===i&&(r=null),r!==i?(58===e.charCodeAt(yi)?(s=_t,yi++):(s=i,0===wi&&Oi(bt)),s!==i?((o=xs())===i&&(o=null),o!==i&&(a=Ss())!==i&&Ts()!==i?(vi=t,n=Et(a),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o,a;return t=yi,e.substr(yi,4)===vt?(n=vt,yi+=4):(n=i,0===wi&&Oi(mt)),n!==i?((r=xs())===i&&(r=null),r!==i?(58===e.charCodeAt(yi)?(s=_t,yi++):(s=i,0===wi&&Oi(bt)),s!==i?((o=xs())===i&&(o=null),o!==i&&(a=Ss())!==i&&Ts()!==i?(vi=t,n=wt(a),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}()),t}function Li(){var t;return(t=function(){var t,n,r;return t=yi,e.substr(yi,10)===ye?(n=ye,yi+=10):(n=i,0===wi&&Oi(ve)),n===i&&(e.substr(yi,8)===me?(n=me,yi+=8):(n=i,0===wi&&Oi(_e))),n!==i&&xs()!==i?(e.substr(yi,9)===be?(r=be,yi+=9):(r=i,0===wi&&Oi(we)),r===i&&(e.substr(yi,3)===Se?(r=Se,yi+=3):(r=i,0===wi&&Oi(Ce)),r===i&&(e.substr(yi,2)===Ee?(r=Ee,yi+=2):(r=i,0===wi&&Oi(xe)),r===i&&(e.substr(yi,5)===Te?(r=Te,yi+=5):(r=i,0===wi&&Oi(Ae))))),r!==i&&Ts()!==i?(vi=t,n=ke(r),t=n):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d,f,p,g;if(t=yi,n=yi,e.substr(yi,4)===st?(r=st,yi+=4):(r=i,0===wi&&Oi(ot)),r!==i&&(s=xs())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i)if(e.substr(yi,7)===at?(r=at,yi+=7):(r=i,0===wi&&Oi(ct)),r!==i)if((s=xs())!==i)if(o=yi,e.substr(yi,6)===ht?(a=ht,yi+=6):(a=i,0===wi&&Oi(dt)),a!==i&&(c=xs())!==i?o=a=[a,c]:(yi=o,o=i),o===i&&(o=null),o!==i)if((a=Es())!==i)if(c=yi,(u=xs())!==i&&(l=as())!==i?c=u=[u,l]:(yi=c,c=i),c===i&&(c=null),c!==i)if((u=Ts())!==i){if(l=yi,(h=ms())!==i){for(d=[],f=yi,(p=_s())!==i&&(g=Gi())!==i?f=p=[p,g]:(yi=f,f=i);f!==i;)d.push(f),f=yi,(p=_s())!==i&&(g=Gi())!==i?f=p=[p,g]:(yi=f,f=i);d!==i?l=h=[h,d]:(yi=l,l=i)}else yi=l,l=i;l===i&&(l=null),l!==i?(vi=t,n=Oe(n,o,a,c,l),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=Yi())===i&&(t=function t(){var e,n,r,s,o,a,c,u;if(e=yi,(n=Hi())!==i)if(Ts()!==i){if(r=yi,(s=ms())!==i){for(o=[],a=yi,(c=_s())!==i&&(u=t())!==i?a=c=[c,u]:(yi=a,a=i);a!==i;)o.push(a),a=yi,(c=_s())!==i&&(u=t())!==i?a=c=[c,u]:(yi=a,a=i);o!==i?r=s=[s,o]:(yi=r,r=i)}else yi=r,r=i;r===i&&(r=null),r!==i?(vi=e,n=Ot(n,r),e=n):(yi=e,e=i)}else yi=e,e=i;else yi=e,e=i;return e}())===i&&(t=function(){var t,n,r,s,o;return t=yi,(n=Cs())===i&&(n=Es()),n!==i?(40===e.charCodeAt(yi)?(r=z,yi++):(r=i,0===wi&&Oi(G)),r!==i?((s=function(){var t,n,r,s,o,a,c;if(t=yi,(n=Hi())!==i){for(r=[],s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=Hi())!==i?s=o=[o,a,c]:(yi=s,s=i);s!==i;)r.push(s),s=yi,44===e.charCodeAt(yi)?(o=Z,yi++):(o=i,0===wi&&Oi(tt)),o!==i&&(a=xs())!==i&&(c=Hi())!==i?s=o=[o,a,c]:(yi=s,s=i);r!==i?(vi=t,n=et(n,r),t=n):(yi=t,t=i)}else yi=t,t=i;return t}())===i&&(s=null),s!==i?(41===e.charCodeAt(yi)?(o=Q,yi++):(o=i,0===wi&&Oi(J)),o!==i&&Ts()!==i?(vi=t,n=kt(n,s),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}()),t}function Hi(){var t,n,r,s,o;return t=yi,(n=qi())!==i?(63===e.charCodeAt(yi)?(r=Pt,yi++):(r=i,0===wi&&Oi(Rt)),r===i&&(r=null),r!==i&&xs()!==i&&(s=Ui())!==i&&xs()!==i&&(o=function(){var t,e,n,r,s;return t=yi,(e=Es())!==i?(n=yi,(r=xs())!==i&&(s=as())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i?(vi=t,e=zn(e,n),t=e):(yi=t,t=i)):(yi=t,t=i),t===i&&(t=yi,(e=xs())!==i&&(n=Es())!==i?(vi=t,e=Gn(n),t=e):(yi=t,t=i),t===i&&(t=yi,(e=xs())!==i&&(n=as())!==i?(vi=t,e=Qn(n),t=e):(yi=t,t=i))),t}())!==i?(vi=t,t=n=It(n,r,s,o)):(yi=t,t=i)):(yi=t,t=i),t}function qi(){var t,n;return e.substr(yi,5)===Ft?(t=Ft,yi+=5):(t=i,0===wi&&Oi(Dt)),t===i&&(e.substr(yi,2)===k?(t=k,yi+=2):(t=i,0===wi&&Oi(O)),t===i&&(e.substr(yi,3)===Nt?(t=Nt,yi+=3):(t=i,0===wi&&Oi(jt)),t===i&&(e.substr(yi,4)===Mt?(t=Mt,yi+=4):(t=i,0===wi&&Oi(Bt)),t===i&&(e.substr(yi,8)===Lt?(t=Lt,yi+=8):(t=i,0===wi&&Oi(Ht)),t===i&&(t=yi,e.substr(yi,8)===qt?(n=qt,yi+=8):(n=i,0===wi&&Oi(Ut)),n!==i&&(vi=t,n=Vt()),t=n))))),t}function Ui(){var t;return(t=$i())===i&&(t=Vi())===i&&(t=Ki())===i&&(t=function(){var t,n,r,s;return t=yi,e.substr(yi,10)===Xt?(n=Xt,yi+=10):(n=i,0===wi&&Oi(Zt)),n!==i&&(r=Ui())!==i?(62===e.charCodeAt(yi)?(s=K,yi++):(s=i,0===wi&&Oi($)),s!==i?(vi=t,n=te(r),t=n):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d,f;if(t=yi,e.substr(yi,4)===oe?(n=oe,yi+=4):(n=i,0===wi&&Oi(ae)),n!==i){if(r=yi,(s=xs())!==i)if(123===e.charCodeAt(yi)?(o=ce,yi++):(o=i,0===wi&&Oi(ue)),o!==i){if(a=yi,(c=Wi())!==i){for(u=[],l=yi,44===e.charCodeAt(yi)?(h=Z,yi++):(h=i,0===wi&&Oi(tt)),h!==i&&(d=xs())!==i&&(f=Wi())!==i?l=h=[h,d,f]:(yi=l,l=i);l!==i;)u.push(l),l=yi,44===e.charCodeAt(yi)?(h=Z,yi++):(h=i,0===wi&&Oi(tt)),h!==i&&(d=xs())!==i&&(f=Wi())!==i?l=h=[h,d,f]:(yi=l,l=i);u!==i?a=c=[c,u]:(yi=a,a=i)}else yi=a,a=i;a===i&&(a=null),a!==i?(125===e.charCodeAt(yi)?(c=le,yi++):(c=i,0===wi&&Oi(he)),c!==i?r=s=[s,o,a,c]:(yi=r,r=i)):(yi=r,r=i)}else yi=r,r=i;else yi=r,r=i;r===i&&(r=null),r!==i?(vi=t,n=de(r),t=n):(yi=t,t=i)}else yi=t,t=i;return t}())===i&&(t=ds())===i&&(t=zi()),t}function Vi(){var t,n,r,s;return t=yi,91===e.charCodeAt(yi)?(n=Kt,yi++):(n=i,0===wi&&Oi($t)),n!==i&&(r=Ui())!==i?(93===e.charCodeAt(yi)?(s=Wt,yi++):(s=i,0===wi&&Oi(zt)),s!==i?(vi=t,t=n=Gt(r)):(yi=t,t=i)):(yi=t,t=i),t}function Ki(){var t,n,r,s;return t=yi,e.substr(yi,14)===Qt?(n=Qt,yi+=14):(n=i,0===wi&&Oi(Jt)),n!==i&&(r=Ui())!==i?(62===e.charCodeAt(yi)?(s=K,yi++):(s=i,0===wi&&Oi($)),s!==i?(vi=t,t=n=Yt(r)):(yi=t,t=i)):(yi=t,t=i),t}function $i(){var t,n,r,s,o,a,c,u;return t=yi,126===e.charCodeAt(yi)?(n=ee,yi++):(n=i,0===wi&&Oi(ne)),n!==i&&(r=Es())!==i?(s=yi,(o=xs())!==i?(e.substr(yi,4)===re?(a=re,yi+=4):(a=i,0===wi&&Oi(ie)),a!==i&&(c=xs())!==i&&(u=Ui())!==i?s=o=[o,a,c,u]:(yi=s,s=i)):(yi=s,s=i),s===i&&(s=null),s!==i?(vi=t,t=n=se(r,s)):(yi=t,t=i)):(yi=t,t=i),t}function Wi(){var t,n,r,s,o,a;return t=yi,(n=Es())!==i?((r=xs())===i&&(r=null),r!==i?(58===e.charCodeAt(yi)?(s=_t,yi++):(s=i,0===wi&&Oi(bt)),s!==i?((o=xs())===i&&(o=null),o!==i&&(a=Es())!==i?(vi=t,t=n=fe(n,a)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}function zi(){var t,e;return t=yi,(e=Cs())!==i&&(vi=t,e=pe(e)),t=e}function Gi(){var t;return(t=Qi())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d,f,p,g;if(t=yi,n=yi,e.substr(yi,4)===st?(r=st,yi+=4):(r=i,0===wi&&Oi(ot)),r!==i&&(s=xs())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i)if(e.substr(yi,7)===ut?(r=ut,yi+=7):(r=i,0===wi&&Oi(lt)),r!==i)if((s=xs())!==i)if(o=yi,e.substr(yi,6)===ht?(a=ht,yi+=6):(a=i,0===wi&&Oi(dt)),a!==i&&(c=xs())!==i?o=a=[a,c]:(yi=o,o=i),o===i&&(o=null),o!==i)if((a=Es())!==i)if(c=yi,(u=xs())!==i&&(l=as())!==i?c=u=[u,l]:(yi=c,c=i),c===i&&(c=null),c!==i)if((u=Ts())!==i){if(l=yi,(h=ms())!==i){for(d=[],f=yi,(p=_s())!==i&&(g=Ji())!==i?f=p=[p,g]:(yi=f,f=i);f!==i;)d.push(f),f=yi,(p=_s())!==i&&(g=Ji())!==i?f=p=[p,g]:(yi=f,f=i);d!==i?l=h=[h,d]:(yi=l,l=i)}else yi=l,l=i;l===i&&(l=null),l!==i?(vi=t,n=qe(n,o,a,c,l),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}()),t}function Qi(){var t,n,r;return t=yi,e.substr(yi,10)===Pe?(n=Pe,yi+=10):(n=i,0===wi&&Oi(Re)),n!==i&&xs()!==i?(e.substr(yi,10)===Ie?(r=Ie,yi+=10):(r=i,0===wi&&Oi(Fe)),r===i&&(e.substr(yi,3)===De?(r=De,yi+=3):(r=i,0===wi&&Oi(Ne)),r===i&&(e.substr(yi,6)===je?(r=je,yi+=6):(r=i,0===wi&&Oi(Me)),r===i&&(e.substr(yi,5)===Be?(r=Be,yi+=5):(r=i,0===wi&&Oi(Le))))),r!==i&&Ts()!==i?(vi=t,t=n=He(r)):(yi=t,t=i)):(yi=t,t=i),t}function Ji(){var t;return(t=Qi())===i&&(t=function(){var t,n,r;return t=yi,e.substr(yi,6)===Ue?(n=Ue,yi+=6):(n=i,0===wi&&Oi(Ve)),n!==i&&xs()!==i&&(r=Es())!==i&&Ts()!==i?(vi=t,n=Ke(r),t=n):(yi=t,t=i),t}()),t}function Yi(){var t,n,r,s,o,a,c,u,l;if(t=yi,e.substr(yi,11)===N?(n=N,yi+=11):(n=i,0===wi&&Oi(j)),n!==i)if(xs()!==i)if((r=ws())!==i)if(Ts()!==i){if(s=yi,(o=ms())!==i){if(a=[],c=yi,(u=_s())!==i&&(l=Xi())!==i?c=u=[u,l]:(yi=c,c=i),c!==i)for(;c!==i;)a.push(c),c=yi,(u=_s())!==i&&(l=Xi())!==i?c=u=[u,l]:(yi=c,c=i);else a=i;a!==i?s=o=[o,a]:(yi=s,s=i)}else yi=s,s=i;s===i&&(s=null),s!==i?(vi=t,t=n=$e(r,s)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}function Xi(){var t,e,n;return t=yi,(e=Es())!==i&&xs()!==i&&(n=ws())!==i&&Ts()!==i?(vi=t,t=e=We(e,n)):(yi=t,t=i),t}function Zi(){var t;return(t=function(){var t,e,n,r,s,o,a,c,u,l;if(t=yi,(e=function(){var t,e;return t=yi,(e=Cs())!==i&&(vi=t,e=Jn(e)),(t=e)===i&&(t=yi,(e=cs())!==i&&(vi=t,e=Yn(e)),t=e),t}())!==i)if(n=yi,(r=xs())!==i&&(s=ts())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i)if((r=Ts())!==i){if(s=yi,(o=ms())!==i){for(a=[],c=yi,(u=_s())!==i&&(l=es())!==i?c=u=[u,l]:(yi=c,c=i);c!==i;)a.push(c),c=yi,(u=_s())!==i&&(l=es())!==i?c=u=[u,l]:(yi=c,c=i);a!==i?s=o=[o,a]:(yi=s,s=i)}else yi=s,s=i;s===i&&(s=null),s!==i?(vi=t,e=Ze(e,n,s),t=e):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,e,n,r,s,o;return t=yi,(e=os())!==i?(n=yi,(r=xs())!==i&&(s=hs())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i?(r=yi,(s=xs())!==i&&(o=ts())!==i?r=s=[s,o]:(yi=r,r=i),r===i&&(r=null),r!==i&&(s=Ts())!==i?(vi=t,e=Nn(e,n,r),t=e):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o,a;return t=yi,e.substr(yi,4)===er?(n=er,yi+=4):(n=i,0===wi&&Oi(nr)),n!==i?(r=yi,(s=xs())!==i&&(o=hs())!==i?r=s=[s,o]:(yi=r,r=i),r===i&&(r=null),r!==i?(s=yi,(o=xs())!==i&&(a=ts())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i&&(o=Ts())!==i?(vi=t,n=rr(r,s),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h,d,f;if(t=yi,e.substr(yi,6)===an?(n=an,yi+=6):(n=i,0===wi&&Oi(cn)),n!==i)if(xs()!==i)if((r=ws())!==i)if(Ts()!==i){if(s=yi,(o=ms())!==i){if(a=yi,(c=_s())!==i)if(e.substr(yi,6)===un?(u=un,yi+=6):(u=i,0===wi&&Oi(ln)),u!==i){if(l=[],h=yi,(d=xs())!==i&&(f=ws())!==i?h=d=[d,f]:(yi=h,h=i),h!==i)for(;h!==i;)l.push(h),h=yi,(d=xs())!==i&&(f=ws())!==i?h=d=[d,f]:(yi=h,h=i);else l=i;l!==i&&(h=Ts())!==i?a=c=[c,u,l,h]:(yi=a,a=i)}else yi=a,a=i;else yi=a,a=i;a!==i?s=o=[o,a]:(yi=s,s=i)}else yi=s,s=i;s===i&&(s=null),s!==i?(vi=t,n=hn(r,s),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,e,n,r;return t=yi,(e=is())!==i&&xs()!==i&&(n=rs())!==i&&xs()!==i&&(r=is())!==i&&Ts()!==i?(vi=t,e=on(e,n,r),t=e):(yi=t,t=i),t}())===i&&(t=Yi()),t}function ts(){var t,n,r;return t=yi,e.substr(yi,2)===Je?(n=Je,yi+=2):(n=i,0===wi&&Oi(Ye)),n!==i&&xs()!==i&&(r=Es())!==i?(vi=t,t=n=Xe(r)):(yi=t,t=i),t}function es(){var t;return(t=function(){var t,n,r,s,o,a,c,u,l,h,d;if(t=yi,e.substr(yi,7)===at?(n=at,yi+=7):(n=i,0===wi&&Oi(ct)),n!==i)if(xs()!==i)if((r=function(){var t,e,n;return t=yi,(e=Es())!==i?((n=ls())===i&&(n=null),n!==i?(vi=t,e=rn(e,n),t=e):(yi=t,t=i)):(yi=t,t=i),t}())!==i)if(s=yi,(o=xs())!==i&&(a=ts())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i)if((o=Ts())!==i){if(a=yi,(c=ms())!==i){for(u=[],l=yi,(h=_s())!==i&&(d=ns())!==i?l=h=[h,d]:(yi=l,l=i);l!==i;)u.push(l),l=yi,(h=_s())!==i&&(d=ns())!==i?l=h=[h,d]:(yi=l,l=i);u!==i?a=c=[c,u]:(yi=a,a=i)}else yi=a,a=i;a===i&&(a=null),a!==i?(vi=t,n=nn(r,s,a),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a;return t=yi,(n=Es())===i&&(42===e.charCodeAt(yi)?(n=nt,yi++):(n=i,0===wi&&Oi(rt))),n!==i&&xs()!==i&&(r=rs())!==i?(s=yi,(o=xs())!==i&&(a=function(){var t,e,n,r;return t=yi,(e=Cs())===i&&(e=Es()),e===i&&(e=null),e!==i?((n=xs())===i&&(n=null),n!==i?((r=as())===i&&(r=null),r!==i?(vi=t,e=en(e,r),t=e):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i&&(o=Ts())!==i?(vi=t,n=tn(n,r,s),t=n):(yi=t,t=i)):(yi=t,t=i),t}()),t}function ns(){var t,n,r,s,o,a;return t=yi,e.substr(yi,7)===ut?(n=ut,yi+=7):(n=i,0===wi&&Oi(lt)),n!==i&&xs()!==i&&(r=Es())!==i?(s=yi,(o=xs())!==i&&(a=ts())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i&&(o=Ts())!==i?(vi=t,t=n=sn(r,s)):(yi=t,t=i)):(yi=t,t=i),t}function rs(){var t;return e.substr(yi,2)===dn?(t=dn,yi+=2):(t=i,0===wi&&Oi(fn)),t===i&&(e.substr(yi,2)===pn?(t=pn,yi+=2):(t=i,0===wi&&Oi(gn)),t===i&&(61===e.charCodeAt(yi)?(t=yn,yi++):(t=i,0===wi&&Oi(vn)),t===i&&(e.substr(yi,7)===at?(t=at,yi+=7):(t=i,0===wi&&Oi(ct)),t===i&&(e.substr(yi,7)===ut?(t=ut,yi+=7):(t=i,0===wi&&Oi(lt)))))),t}function is(){var t;return(t=function(){var t,e,n;return t=yi,(e=us())!==i?((n=ss())===i&&(n=null),n!==i?(vi=t,e=mn(e,n),t=e):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,e;return t=yi,(e=as())!==i&&(vi=t,e=_n(e)),t=e}())===i&&(t=function(){var t,e,n;return t=yi,(e=Cs())!==i?((n=ss())===i&&(n=null),n!==i?(vi=t,e=wn(e,n),t=e):(yi=t,t=i)):(yi=t,t=i),t}())===i&&(t=function(){var t,e,n;return t=yi,(e=Es())!==i?((n=ss())===i&&(n=null),n!==i?(vi=t,e=bn(e,n),t=e):(yi=t,t=i)):(yi=t,t=i),t}()),t}function ss(){var t,n,r,s,o,a;return t=yi,46===e.charCodeAt(yi)?(n=Sn,yi++):(n=i,0===wi&&Oi(Cn)),n!==i?((r=Es())===i&&(r=null),r!==i?(s=yi,(o=xs())===i&&(o=null),o!==i&&(a=as())!==i?s=o=[o,a]:(yi=s,s=i),s===i&&(s=null),s!==i?(vi=t,t=n=En(r,s)):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}function os(){var t;return 63===e.charCodeAt(yi)?(t=Pt,yi++):(t=i,0===wi&&Oi(Rt)),t===i&&(e.substr(yi,3)===xn?(t=xn,yi+=3):(t=i,0===wi&&Oi(Tn)),t===i&&(e.substr(yi,3)===An?(t=An,yi+=3):(t=i,0===wi&&Oi(kn)),t===i&&(e.substr(yi,6)===On?(t=On,yi+=6):(t=i,0===wi&&Oi(Pn)),t===i&&(e.substr(yi,4)===Rn?(t=Rn,yi+=4):(t=i,0===wi&&Oi(In)),t===i&&(e.substr(yi,5)===Fn?(t=Fn,yi+=5):(t=i,0===wi&&Oi(Dn))))))),t}function as(){var t,n,r,s,o;return t=yi,(n=function(){var t,n,r,s,o;if(t=yi,35===e.charCodeAt(yi)?(n=jn,yi++):(n=i,0===wi&&Oi(Mn)),n!==i)if(Bn.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(Ln)),r!==i){for(s=[],Hn.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(qn));o!==i;)s.push(o),Hn.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(qn));s!==i?(vi=t,t=n=Un()):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}())!==i?(r=yi,(s=xs())!==i&&(o=as())!==i?r=s=[s,o]:(yi=r,r=i),r===i&&(r=null),r!==i?(vi=t,t=n=Vn(n,r)):(yi=t,t=i)):(yi=t,t=i),t}function cs(){var t,n,r,s,o;if(t=yi,38===e.charCodeAt(yi)?(n=Kn,yi++):(n=i,0===wi&&Oi($n)),n!==i)if(Bn.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(Ln)),r!==i){for(s=[],Hn.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(qn));o!==i;)s.push(o),Hn.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(qn));s!==i?(vi=t,t=n=Un()):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}function us(){var t,e,n,r,s;return t=yi,(e=cs())!==i?(n=yi,(r=xs())!==i&&(s=us())!==i?n=r=[r,s]:(yi=n,n=i),n===i&&(n=null),n!==i?(vi=t,t=e=Vn(e,n)):(yi=t,t=i)):(yi=t,t=i),t}function ls(){var t,e;return t=yi,xs()!==i&&(e=as())!==i?(vi=t,t=Wn(e)):(yi=t,t=i),t}function hs(){var t,e,n;return t=yi,(e=Ss())!==i?((n=ls())===i&&(n=null),n!==i?(vi=t,t=e=Xn(e,n)):(yi=t,t=i)):(yi=t,t=i),t===i&&(t=yi,(e=Cs())!==i?((n=ls())===i&&(n=null),n!==i?(vi=t,t=e=Zn(e,n)):(yi=t,t=i)):(yi=t,t=i),t===i&&(t=yi,(e=as())!==i&&(vi=t,e=tr(e)),t=e)),t}function ds(){var t,n,r,s,o,a,c,u,l,h;if(t=yi,n=[],r=yi,(s=Cs())===i&&(42===e.charCodeAt(yi)?(s=nt,yi++):(s=i,0===wi&&Oi(rt))),s!==i&&(o=xs())!==i?r=s=[s,o]:(yi=r,r=i),r!==i)for(;r!==i;)n.push(r),r=yi,(s=Cs())===i&&(42===e.charCodeAt(yi)?(s=nt,yi++):(s=i,0===wi&&Oi(rt))),s!==i&&(o=xs())!==i?r=s=[s,o]:(yi=r,r=i);else n=i;if(n!==i)if(123===e.charCodeAt(yi)?(r=ce,yi++):(r=i,0===wi&&Oi(ue)),r!==i){if(s=yi,(o=fs())!==i){for(a=[],c=yi,44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i&&(l=xs())!==i&&(h=fs())!==i?c=u=[u,l,h]:(yi=c,c=i);c!==i;)a.push(c),c=yi,44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i&&(l=xs())!==i&&(h=fs())!==i?c=u=[u,l,h]:(yi=c,c=i);a!==i?s=o=[o,a]:(yi=s,s=i)}else yi=s,s=i;s===i&&(s=null),s!==i?(125===e.charCodeAt(yi)?(o=le,yi++):(o=i,0===wi&&Oi(he)),o!==i?(vi=t,t=n=ir(n,s)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;return t}function fs(){var t,e,n,r;return t=yi,e=yi,(n=ys())!==i&&(r=xs())!==i?e=n=[n,r]:(yi=e,e=i),e===i&&(e=null),e!==i&&(n=Es())!==i?(vi=t,t=e=sr(e,n)):(yi=t,t=i),t}function ps(){var t,n,r,s,o,a;if(t=yi,e.substr(yi,6)===or?(n=or,yi+=6):(n=i,0===wi&&Oi(ar)),n!==i){if(r=[],s=yi,(o=xs())!==i?(42===e.charCodeAt(yi)?(a=nt,yi++):(a=i,0===wi&&Oi(rt)),a===i&&(a=Cs()),a!==i?s=o=[o,a]:(yi=s,s=i)):(yi=s,s=i),s!==i)for(;s!==i;)r.push(s),s=yi,(o=xs())!==i?(42===e.charCodeAt(yi)?(a=nt,yi++):(a=i,0===wi&&Oi(rt)),a===i&&(a=Cs()),a!==i?s=o=[o,a]:(yi=s,s=i)):(yi=s,s=i);else r=i;r!==i?((s=function(){var t,n,r,s,o,a,c,u,l,h;if(t=yi,(n=xs())!==i)if(e.substr(yi,7)===fr?(r=fr,yi+=7):(r=i,0===wi&&Oi(pr)),r!==i)if(xs()!==i)if((s=Cs())!==i){for(o=[],a=yi,(c=xs())===i&&(c=null),c!==i?(44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i&&(l=xs())!==i&&(h=Cs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i);a!==i;)o.push(a),a=yi,(c=xs())===i&&(c=null),c!==i?(44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i&&(l=xs())!==i&&(h=Cs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i);o!==i?(vi=t,n=gr(s,o),t=n):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(s=null),s!==i?(vi=t,t=n=cr(r,s)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;return t}function gs(){var t;return(t=function(){var t,e,n;return t=yi,(e=ys())!==i&&xs()!==i&&(n=Es())!==i&&Ts()!==i?(vi=t,e=yr(e,n),t=e):(yi=t,t=i),t}())===i&&(t=Yi()),t}function ys(){var t;return(t=function(){var t,n,r,s,o,a;if(t=yi,e.substr(yi,10)===Xt?(n=Xt,yi+=10):(n=i,0===wi&&Oi(Zt)),n!==i){for(r=[],s=xs();s!==i;)r.push(s),s=xs();if(r!==i)if((s=ds())===i&&(s=zi()),s!==i){for(o=[],a=xs();a!==i;)o.push(a),a=xs();o!==i?(62===e.charCodeAt(yi)?(a=K,yi++):(a=i,0===wi&&Oi($)),a!==i?(vi=t,n=mr(s),t=n):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i}else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a;if(t=yi,91===e.charCodeAt(yi)?(n=Kt,yi++):(n=i,0===wi&&Oi($t)),n!==i){for(r=[],s=xs();s!==i;)r.push(s),s=xs();if(r!==i)if((s=ys())!==i){for(o=[],a=xs();a!==i;)o.push(a),a=xs();o!==i?(93===e.charCodeAt(yi)?(a=Wt,yi++):(a=i,0===wi&&Oi(zt)),a!==i?(vi=t,n=vr(s),t=n):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i}else yi=t,t=i;return t}())===i&&(t=vs())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h;if(t=yi,40===e.charCodeAt(yi)?(n=z,yi++):(n=i,0===wi&&Oi(G)),n!==i)if((r=xs())===i&&(r=null),r!==i)if((s=vs())!==i){if(o=[],a=yi,(c=xs())!==i?(e.substr(yi,2)===Rr?(u=Rr,yi+=2):(u=i,0===wi&&Oi(Ir)),u!==i&&(l=xs())!==i&&(h=vs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i),a!==i)for(;a!==i;)o.push(a),a=yi,(c=xs())!==i?(e.substr(yi,2)===Rr?(u=Rr,yi+=2):(u=i,0===wi&&Oi(Ir)),u!==i&&(l=xs())!==i&&(h=vs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i);else o=i;o!==i?((a=xs())===i&&(a=null),a!==i?(41===e.charCodeAt(yi)?(c=Q,yi++):(c=i,0===wi&&Oi(J)),c!==i?(vi=t,n=Fr(s,o),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}())===i&&(t=function(){var t,n,r,s,o,a,c,u,l,h;if(t=yi,40===e.charCodeAt(yi)?(n=z,yi++):(n=i,0===wi&&Oi(G)),n!==i)if((r=xs())===i&&(r=null),r!==i)if((s=vs())!==i){for(o=[],a=yi,(c=xs())===i&&(c=null),c!==i?(44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i?((l=xs())===i&&(l=null),l!==i&&(h=vs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i)):(yi=a,a=i);a!==i;)o.push(a),a=yi,(c=xs())===i&&(c=null),c!==i?(44===e.charCodeAt(yi)?(u=Z,yi++):(u=i,0===wi&&Oi(tt)),u!==i?((l=xs())===i&&(l=null),l!==i&&(h=vs())!==i?a=c=[c,u,l,h]:(yi=a,a=i)):(yi=a,a=i)):(yi=a,a=i);o!==i?((a=xs())===i&&(a=null),a!==i?(41===e.charCodeAt(yi)?(c=Q,yi++):(c=i,0===wi&&Oi(J)),c!==i?(vi=t,n=Dr(s,o),t=n):(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;else yi=t,t=i;return t}()),t}function vs(){var t;return e.substr(yi,4)===_r?(t=_r,yi+=4):(t=i,0===wi&&Oi(br)),t===i&&(e.substr(yi,3)===wr?(t=wr,yi+=3):(t=i,0===wi&&Oi(Sr)),t===i&&(e.substr(yi,6)===Cr?(t=Cr,yi+=6):(t=i,0===wi&&Oi(Er)),t===i&&(e.substr(yi,7)===xr?(t=xr,yi+=7):(t=i,0===wi&&Oi(Tr)),t===i&&(e.substr(yi,5)===Ar?(t=Ar,yi+=5):(t=i,0===wi&&Oi(kr)),t===i&&(e.substr(yi,6)===Or?(t=Or,yi+=6):(t=i,0===wi&&Oi(Pr))))))),t}function ms(){var t,n,r,s;if(t=yi,wi++,n=yi,r=[],32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr)),s!==i)for(;s!==i;)r.push(s),32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr));else r=i;return r!==i?(vi=yi,(s=(s=Hr(r))?void 0:i)!==i?n=r=[r,s]:(yi=n,n=i)):(yi=n,n=i),wi--,n!==i?(yi=t,t=void 0):t=i,t}function _s(){var t,n,r,s,o;for(t=yi,n=yi,wi++,r=yi,s=[],32===e.charCodeAt(yi)?(o=Br,yi++):(o=i,0===wi&&Oi(Lr));o!==i;)s.push(o),32===e.charCodeAt(yi)?(o=Br,yi++):(o=i,0===wi&&Oi(Lr));if(s!==i?(vi=yi,(o=(o=qr(s))?void 0:i)!==i?r=s=[s,o]:(yi=r,r=i)):(yi=r,r=i),wi--,r!==i?(yi=n,n=void 0):n=i,n!==i){for(r=[],32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr));s!==i;)r.push(s),32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr));r!==i?t=n=[n,r]:(yi=t,t=i)}else yi=t,t=i;return t}function bs(){var t,n,r,s,o;for(t=yi,n=yi,wi++,r=yi,s=[],32===e.charCodeAt(yi)?(o=Br,yi++):(o=i,0===wi&&Oi(Lr));o!==i;)s.push(o),32===e.charCodeAt(yi)?(o=Br,yi++):(o=i,0===wi&&Oi(Lr));if(s!==i?(vi=yi,(o=(o=Ur(s))?void 0:i)!==i?r=s=[s,o]:(yi=r,r=i)):(yi=r,r=i),wi--,r!==i?(yi=n,n=void 0):n=i,n!==i){for(r=[],32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr));s!==i;)r.push(s),32===e.charCodeAt(yi)?(s=Br,yi++):(s=i,0===wi&&Oi(Lr));r!==i?(vi=t,t=n=b()):(yi=t,t=i)}else yi=t,t=i;return t}function ws(){var t,n,r,s;if(t=yi,96===e.charCodeAt(yi)?(n=Kr,yi++):(n=i,0===wi&&Oi($r)),n!==i){if(r=[],Wr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(zr)),s!==i)for(;s!==i;)r.push(s),Wr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(zr));else r=i;r!==i?(96===e.charCodeAt(yi)?(s=Kr,yi++):(s=i,0===wi&&Oi($r)),s!==i?(vi=t,t=n=Gr(r)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;return t}function Ss(){var t,n,r,s;if(t=yi,39===e.charCodeAt(yi)?(n=Qr,yi++):(n=i,0===wi&&Oi(Jr)),n!==i){if(r=[],Yr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(Xr)),s!==i)for(;s!==i;)r.push(s),Yr.test(e.charAt(yi))?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(Xr));else r=i;r!==i?(39===e.charCodeAt(yi)?(s=Qr,yi++):(s=i,0===wi&&Oi(Jr)),s!==i?(vi=t,t=n=Zr(r)):(yi=t,t=i)):(yi=t,t=i)}else yi=t,t=i;return t}function Cs(){var t,n,r,s,o;if(t=yi,n=yi,ti.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ei)),r!==i){for(s=[],ni.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(ri));o!==i;)s.push(o),ni.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(ri));s!==i?n=r=[r,s]:(yi=n,n=i)}else yi=n,n=i;return n!==i&&(vi=t,n=ii(n)),t=n}function Es(){var t,n,r,s,o,a,c;if(t=yi,n=yi,r=yi,wi++,s=function(){var t,n,r;return t=yi,(n=rs())===i&&(n=qi())===i&&(n=os())===i&&(e.substr(yi,8)===xt?(n=xt,yi+=8):(n=i,0===wi&&Oi(Tt)),n===i&&(e.substr(yi,6)===ze?(n=ze,yi+=6):(n=i,0===wi&&Oi(Ge)),n===i&&(e.substr(yi,6)===M?(n=M,yi+=6):(n=i,0===wi&&Oi(B)),n===i&&(e.substr(yi,5)===H?(n=H,yi+=5):(n=i,0===wi&&Oi(q)),n===i&&(e.substr(yi,6)===or?(n=or,yi+=6):(n=i,0===wi&&Oi(ar))))))),n!==i?((r=xs())===i&&(r=Ts()),r!==i?(vi=t,t=n=Vr()):(yi=t,t=i)):(yi=t,t=i),t}(),wi--,s===i?r=void 0:(yi=r,r=i),r!==i){if(s=yi,si.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(oi)),o!==i){for(a=[],ni.test(e.charAt(yi))?(c=e.charAt(yi),yi++):(c=i,0===wi&&Oi(ri));c!==i;)a.push(c),ni.test(e.charAt(yi))?(c=e.charAt(yi),yi++):(c=i,0===wi&&Oi(ri));a!==i?s=o=[o,a]:(yi=s,s=i)}else yi=s,s=i;s!==i?n=r=[r,s]:(yi=n,n=i)}else yi=n,n=i;return n!==i&&(vi=t,n=ii(n)),t=n}function xs(){var t,n;if(t=[],32===e.charCodeAt(yi)?(n=Br,yi++):(n=i,0===wi&&Oi(Lr)),n!==i)for(;n!==i;)t.push(n),32===e.charCodeAt(yi)?(n=Br,yi++):(n=i,0===wi&&Oi(Lr));else t=i;return t}function Ts(){var t,n,r,s,o;for(t=yi,n=[],ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));r!==i;)n.push(r),ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));if(n!==i?(r=yi,wi++,e.length>yi?(s=e.charAt(yi),yi++):(s=i,0===wi&&Oi(ui)),wi--,s===i?r=void 0:(yi=r,r=i),r!==i?t=n=[n,r]:(yi=t,t=i)):(yi=t,t=i),t===i){for(t=yi,n=[],ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));r!==i;)n.push(r),ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));if(n!==i)if(e.substr(yi,2)===li?(r=li,yi+=2):(r=i,0===wi&&Oi(hi)),r!==i){for(s=[],m.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(_));o!==i;)s.push(o),m.test(e.charAt(yi))?(o=e.charAt(yi),yi++):(o=i,0===wi&&Oi(_));s!==i&&(o=Ts())!==i?t=n=[n,r,s,o]:(yi=t,t=i)}else yi=t,t=i;else yi=t,t=i;if(t===i){for(t=yi,n=[],ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));r!==i;)n.push(r),ai.test(e.charAt(yi))?(r=e.charAt(yi),yi++):(r=i,0===wi&&Oi(ci));n!==i&&(r=As())!==i?((s=Ts())===i&&(s=null),s!==i?t=n=[n,r,s]:(yi=t,t=i)):(yi=t,t=i)}}return t}function As(){var t,n,r,s;return t=yi,13===e.charCodeAt(yi)?(n=di,yi++):(n=i,0===wi&&Oi(fi)),n===i&&(n=null),n!==i?(10===e.charCodeAt(yi)?(r=pi,yi++):(r=i,0===wi&&Oi(gi)),r!==i?(13===e.charCodeAt(yi)?(s=di,yi++):(s=i,0===wi&&Oi(fi)),s===i&&(s=null),s!==i?t=n=[n,r,s]:(yi=t,t=i)):(yi=t,t=i)):(yi=t,t=i),t}var ks="",Os="",Ps=[];function Rs(t){return t[1].map(t=>t[1])}function Is(t,e,n){if(null!=t){let n=e(t);if(null!=n)return n}return null==n?null:n}if((r=o())!==i&&yi===e.length)return r;throw r!==i&&yi<e.length&&Oi({type:"end"}),Pi(bi,_i<e.length?e.charAt(_i):null,_i<e.length?ki(_i,_i+1):ki(_i,_i))}}}()},function(t,e,n){"use strict";n.r(e),n.d(e,"Recipe",function(){return f});var r=n(3),i=n(32),s=n(35),o=n(36),a=n(38),c=n(41),u=n(42),l=n(43),h=n(37),d=n(4);class f{constructor(t){this._particles=[],this._handles=[],this._slots=[],this._localName=void 0,this.annotation=void 0,this._connectionConstraints=[],this._obligations=[],this._verbs=[],this._search=null,this._patterns=[],this._name=t}newConnectionConstraint(t,e,n){const r=new o.ConnectionConstraint(t,e,n,"constraint");return this._connectionConstraints.push(r),r}newObligation(t,e,n){const r=new o.ConnectionConstraint(t,e,n,"obligation");return this._obligations.push(r),r}removeObligation(t){const e=this._obligations.indexOf(t);Object(r.assert)(e>-1),this._obligations.splice(e,1)}removeConstraint(t){const e=this._connectionConstraints.indexOf(t);Object(r.assert)(e>=0),this._connectionConstraints.splice(e,1)}clearConnectionConstraints(){this._connectionConstraints=[]}newParticle(t){const e=new a.Particle(this,t);return this._particles.push(e),e}removeParticle(t){const e=this._particles.indexOf(t);Object(r.assert)(e>-1),this._particles.splice(e,1);for(const e of Object.values(t._consumedSlotConnections))e.remove()}newHandle(){const t=new l.Handle(this);return this._handles.push(t),t}removeHandle(t){Object(r.assert)(0===t.connections.length);const e=this._handles.indexOf(t);Object(r.assert)(e>-1),this._handles.splice(e,1)}newSlot(t){const e=new u.Slot(this,t);return this._slots.push(e),e}removeSlot(t){Object(r.assert)(0===t.consumeConnections.length);const e=this._slots.indexOf(t);Object(r.assert)(e>-1),this._slots.splice(e,1)}isResolved(){return Object(r.assert)(Object.isFrozen(this),"Recipe must be normalized to be resolved."),!(this._obligations.length>0)&&(0===this._connectionConstraints.length&&(null===this._search||this._search.isResolved())&&this._handles.every(t=>t.isResolved())&&this._particles.every(t=>t.isResolved())&&this._slots.every(t=>t.isResolved())&&this.handleConnections.every(t=>t.isResolved())&&this.slotConnections.every(t=>t.isResolved()))}_findDuplicate(t,e){const n=new Set,r=t.find(t=>{if(t.id){if(n.has(t.id))return t;n.add(t.id)}});return r&&e&&e.errors&&e.errors.set(r,`Has Duplicate ${r instanceof l.Handle?"Handle":"Slot"} '${r.id}'`),r}_isValid(t){return!this._findDuplicate(this._handles,t)&&!this._findDuplicate(this._slots,t)&&this._handles.every(e=>e._isValid(t))&&this._particles.every(e=>e._isValid(t))&&this._slots.every(e=>e._isValid(t))&&this.handleConnections.every(e=>e._isValid(t))&&this.slotConnections.every(e=>e._isValid(t))&&(!this.search||this.search.isValid())}get name(){return this._name}set name(t){this._name=t}get localName(){return this._localName}set localName(t){this._localName=t}get particles(){return this._particles}set particles(t){this._particles=t}get handles(){return this._handles}set handles(t){this._handles=t}get slots(){return this._slots}set slots(t){this._slots=t}get connectionConstraints(){return this._connectionConstraints}get obligations(){return this._obligations}get verbs(){return this._verbs}set verbs(t){this._verbs=t}get search(){return this._search}set search(t){this._search=t}setSearchPhrase(t){Object(r.assert)(!this._search,"Cannot override search phrase"),t&&(this._search=new c.Search(t))}get slotConnections(){const t=[];return this._particles.forEach(e=>{t.push(...Object.values(e.consumedSlotConnections))}),t}get handleConnections(){const t=[];return this._particles.forEach(e=>{t.push(...Object.values(e.connections)),t.push(...e._unnamedConnections)}),t}isEmpty(){return 0===this.particles.length&&0===this.handles.length&&0===this.slots.length&&0===this._connectionConstraints.length}findHandle(t){for(const e of this.handles)if(e.id===t)return e;return null}findSlot(t){for(const e of this.slots)if(e.id===t)return e;return null}get patterns(){return this._patterns}set patterns(t){this._patterns=t}set description(t){const e=t.find(t=>"pattern"===t.name);e&&e.patterns.forEach(t=>this._patterns.push(t)),t.forEach(t=>{if("pattern"!==t.name){const e=this.handles.find(e=>e.localName===t.name);Object(r.assert)(e,`Cannot set description pattern for nonexistent handle ${t.name}.`),e.pattern=t.pattern}})}async digest(){return Object(i.digest)(this.toString())}normalize(t){if(Object.isFrozen(this))return t&&t.errors&&t.errors.set(this,"already normalized"),!1;if(!this._isValid()){this._findDuplicate(this._handles,t),this._findDuplicate(this._slots,t);const e=e=>e.forEach(e=>!e._isValid(t));return e(this._handles),e(this._particles),e(this._slots),e(this.handleConnections),e(this.slotConnections),!1}for(const t of this._particles)t._startNormalize();for(const t of this._handles)t._startNormalize();for(const t of this._slots)t._startNormalize();const e=this.handleConnections;for(const t of e)t._normalize();e.sort(h.compareComparables);const n=this.slotConnections;for(const t of n)t._normalize();n.sort(h.compareComparables),this.search&&this.search._normalize();for(const t of this._particles)t._finishNormalize();for(const t of this._handles)t._finishNormalize();for(const t of this._slots)t._finishNormalize();const r=new Set,i=new Set,s=new Set,o=[],a=[],c=[];let u=e.filter(t=>!(t.type&&t.type instanceof d.InterfaceType));u=u.concat(e.filter(t=>!!t.type&&!!(t.type instanceof d.InterfaceType)));for(const t of u)i.has(t.particle)||(o.push(t.particle),i.add(t.particle)),t.handle&&!r.has(t.handle)&&(a.push(t.handle),r.add(t.handle));for(const t of n)t.targetSlot&&!s.has(t.targetSlot)&&(c.push(t.targetSlot),s.add(t.targetSlot)),Object.values(t.providedSlots).forEach(t=>{s.has(t)||(c.push(t),s.add(t))});const l=this._handles.filter(t=>!r.has(t));l.sort(h.compareComparables),a.push(...l);const f=this._particles.filter(t=>!i.has(t));f.sort(h.compareComparables),o.push(...f);const p=this._slots.filter(t=>!s.has(t));return p.sort(h.compareComparables),c.push(...p),this._particles=o,this._handles=a,this._slots=c,this._connectionConstraints.sort(h.compareComparables),this._verbs.sort(),this._patterns.sort(),Object.freeze(this._particles),Object.freeze(this._handles),Object.freeze(this._slots),Object.freeze(this._connectionConstraints),Object.freeze(this),!0}clone(t){const e=new f(this.name);return void 0==t&&(t=new Map),this._copyInto(e,t),e._cloneMap=t,e}mergeInto(t){const e=new Map,n=t._handles.length,r=t._particles.length,i=t._slots.length;return this._copyInto(t,e),{handles:t._handles.slice(n),particles:t._particles.slice(r),slots:t._slots.slice(i),cloneMap:e}}_copyInto(t,e){function n(n){const r=n._copyInto(t,e);e.set(n,r)}t._name=this.name,t._verbs=this._verbs.slice(),this._handles.forEach(n),this._particles.forEach(n),this._slots.forEach(n),this._connectionConstraints.forEach(n),this._obligations.forEach(n),t.verbs=t.verbs.slice(),this.search&&this.search._copyInto(t),t.patterns=t.patterns.concat(this.patterns)}updateToClone(t){const e={};return Object.keys(t).forEach(n=>e[n]=this._cloneMap.get(t[n])),e}static over(t,e,n){return s.Strategizer.over(t,e,n)}_makeLocalNameMap(){const t=new Set;for(const e of this.particles)t.add(e.localName);for(const e of this.handles)t.add(e.localName);for(const e of this.slots)t.add(e.localName);const e=new Map;let n=0;for(const r of this.particles){let i=r.localName;if(!i)do{i=`particle${n++}`}while(t.has(i));e.set(r,i)}n=0;for(const r of this.handles){let i=r.localName;if(!i)do{i=`handle${n++}`}while(t.has(i));e.set(r,i)}n=0;for(const r of this.slots){let i=r.localName;if(!i)do{i=`slot${n++}`}while(t.has(i));e.set(r,i)}return e}toString(t){const e=this._makeLocalNameMap(),n=[],r=this.verbs.length>0?` ${this.verbs.map(t=>`&${t}`).join(" ")}`:"";n.push(`recipe${this.name?` ${this.name}`:""}${r}`),t&&t.showUnresolved&&this.search&&n.push(this.search.toString(t).replace(/^|(\n)/g,"$1  "));for(const e of this._connectionConstraints){let r=e.toString().replace(/^|(\n)/g,"$1  ");t&&t.showUnresolved&&(r=r.concat(" // unresolved connection-constraint")),n.push(r)}n.push(...this.handles.map(n=>n.toString(e,t)).filter(t=>t).map(t=>t.replace(/^|(\n)/g,"$1  ")));for(const r of this.slots){const i=r.toString(e,t);i&&n.push(i.replace(/^|(\n)/g,"$1  "))}for(const r of this.particles)n.push(r.toString(e,t).replace(/^|(\n)/g,"$1  "));if(this.patterns.length>0||this.handles.find(t=>void 0!==t.pattern)){n.push(`  description \`${this.patterns[0]}\``);for(let t=1;t<this.patterns.length;++t)n.push(`    pattern \`${this.patterns[t]}\``);this.handles.forEach(t=>{t.pattern&&n.push(`    ${t.localName} \`${t.pattern}\``)})}if(this._obligations.length>0){n.push("  obligations");for(const r of this._obligations){const i=r.toString(e,t).replace(/^|(\n)/g,"$1    ");n.push(i)}}return n.join("\n")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Strategizer",function(){return i}),n.d(e,"StrategizerWalker",function(){return s}),n.d(e,"Strategy",function(){return o}),n.d(e,"RulesetBuilder",function(){return a}),n.d(e,"Ruleset",function(){return c});var r=n(3);class i{constructor(t,e,n){this._generation=0,this._internalPopulation=[],this._population=[],this._generated=[],this._terminal=[],this._strategies=t,this._evaluators=e,this._ruleset=n,this.populationHash=new Map}get generation(){return this._generation}get population(){return this._population}get generated(){return this._generated}get terminal(){return Object(r.assert)(this._terminal),this._terminal}async generate(){const t=this.generation+1,e=await Promise.all(this._strategies.map(t=>{const e=e=>this._ruleset.isAllowed(t,e);return t.generate({generation:this.generation,generated:this.generated.filter(e),terminal:this.terminal.filter(e),population:this.population.filter(e)})})),n={generation:t,sizeOfLastGeneration:this.generated.length,generatedDerivationsByStrategy:{}};for(let t=0;t<this._strategies.length;t++)n.generatedDerivationsByStrategy[this._strategies[t].constructor.name]=e[t].length;let s=[].concat(...e);s=await Promise.all(s.map(async t=>(t.hash&&(t.hash=await t.hash),t))),n.generatedDerivations=s.length,n.nullDerivations=0,n.invalidDerivations=0,n.duplicateDerivations=0,n.duplicateSameParentDerivations=0,n.nullDerivationsByStrategy={},n.invalidDerivationsByStrategy={},n.duplicateDerivationsByStrategy={},n.duplicateSameParentDerivationsByStrategy={},s=s.filter(t=>{const e=t.derivation[0].strategy.constructor.name;if(t.hash){const r=this.populationHash.get(t.hash);if(r)return t.derivation[0].parent===r?(n.nullDerivations+=1,void 0==n.nullDerivationsByStrategy[e]&&(n.nullDerivationsByStrategy[e]=0),n.nullDerivationsByStrategy[e]++):-1!==r.derivation.map(t=>t.parent).indexOf(t.derivation[0].parent)?(n.duplicateSameParentDerivations+=1,void 0==n.duplicateSameParentDerivationsByStrategy[e]&&(n.duplicateSameParentDerivationsByStrategy[e]=0),n.duplicateSameParentDerivationsByStrategy[e]++):(n.duplicateDerivations+=1,void 0==n.duplicateDerivationsByStrategy[e]&&(n.duplicateDerivationsByStrategy[e]=0),n.duplicateDerivationsByStrategy[e]++,this.populationHash.get(t.hash).derivation.push(t.derivation[0])),!1;this.populationHash.set(t.hash,t)}return!1!==t.valid||(n.invalidDerivations++,n.invalidDerivationsByStrategy[e]=(n.invalidDerivationsByStrategy[e]||0)+1,!1)});const o=new Map;for(const t of this.generated)o.set(t.result,t);for(const t of this.populationHash.values())for(const{parent:e}of t.derivation)e&&o.has(e.result)&&o.delete(e.result);const a=[...o.values()];n.survivingDerivations=s.length,s.sort((t,e)=>t.score>e.score?-1:t.score<e.score?1:0);const c=await Promise.all(this._evaluators.map(t=>t.evaluate(this,s))),u=i._mergeEvaluations(c,s);Object(r.assert)(u.length===s.length);for(let t=0;t<u.length;t++)this._internalPopulation.push({fitness:u[t],individual:s[t]});return this._internalPopulation.sort((t,e)=>e.fitness-t.fitness),this._terminal=a,this._generation=t,this._generated=s,this._population=this._internalPopulation.map(t=>t.individual),n}static _mergeEvaluations(t,e){const n=e.length,r=[];for(let e=0;e<n;e++){let n=NaN;for(const r of t){const t=r[e];isNaN(t)||(n=isNaN(n)?t:(n*e+t)/(e+1))}isNaN(n)&&(n=.5),r.push(n)}return r}static over(t,e,n){return e.onStrategy(n),t.forEach(t=>{e.onResult(t),e.onResultDone()}),e.onStrategyDone(),e.descendants}}class s{constructor(){this.descendants=[]}onStrategy(t){this.currentStrategy=t}onResult(t){this.currentResult=t}createDescendant(t,e,n,i){Object(r.assert)(this.currentResult,"no current result"),Object(r.assert)(this.currentStrategy,"no current strategy"),this.currentResult.score&&(e+=this.currentResult.score),this.descendants.push({result:t,score:e,derivation:[{parent:this.currentResult,strategy:this.currentStrategy}],hash:n,valid:i})}onResultDone(){this.currentResult=void 0}onStrategyDone(){this.currentStrategy=void 0}}class o{constructor(t,e){this._arc=t,this._args=e}get arc(){return this._arc}async activate(t){return{generate:0,evaluate:0}}getResults(t){return t.generated}async generate(t){return[]}async evaluate(t,e){return e.map(()=>NaN)}}class a{constructor(){this._orderingRules=new Map}order(...t){for(let e=0;e<t.length-1;e++){const n=t[e],r=t[e+1];for(const t of Array.isArray(n)?n:[n]){let e=this._orderingRules.get(t);e||this._orderingRules.set(t,e=new Set);for(const t of Array.isArray(r)?r:[r])e.add(t)}}return this}build(){const t=new Set,e=new Set;for(const n of this._orderingRules.keys())this._transitiveClosureFor(n,t,e);return new c(this._orderingRules)}_transitiveClosureFor(t,e,n){Object(r.assert)(!e.has(t),"Detected a loop in the ordering rules");const i=this._orderingRules.get(t);if(n.has(t))return i||[];if(i){e.add(t);for(const t of i)for(const r of this._transitiveClosureFor(t,e,n))i.add(r);e.delete(t)}return n.add(t),i||[]}}class c{constructor(t){this._orderingRules=t}isAllowed(t,e){const n=this._orderingRules.get(t.constructor);return!n||!e.derivation.some(t=>n.has(t.strategy.constructor))}}c.Builder=a},function(t,e,n){"use strict";n.r(e),n.d(e,"EndPoint",function(){return s}),n.d(e,"ParticleEndPoint",function(){return o}),n.d(e,"InstanceEndPoint",function(){return a}),n.d(e,"HandleEndPoint",function(){return c}),n.d(e,"TagEndPoint",function(){return u}),n.d(e,"ConnectionConstraint",function(){return l});var r=n(37),i=n(3);class s{}class o extends s{constructor(t,e){super(),this.particle=t,this.connection=e}_clone(t){return new o(this.particle,this.connection)}_compareTo(t){let e;return 0!==(e=Object(r.compareStrings)(this.particle.name,t.particle.name))?e:0!==(e=Object(r.compareStrings)(this.connection,t.connection))?e:0}toString(t){return this.connection?`${this.particle.name}.${this.connection}`:`${this.particle.name}`}}class a extends s{constructor(t,e){super(),Object(i.assert)(t),this.instance=t,this.connection=e}_clone(t){return new a(t.get(this.instance),this.connection)}_compareTo(t){let e;return 0!==(e=Object(r.compareComparables)(this.instance,t.instance))?e:0!==(e=Object(r.compareStrings)(this.connection,t.connection))?e:0}toString(t){return this.connection?`${t.get(this.instance)}.${this.connection}`:`${t.get(this.instance)}`}}class c extends s{constructor(t){super(),this.handle=t}_clone(t){return new c(this.handle)}_compareTo(t){let e;return 0!==(e=Object(r.compareStrings)(this.handle.localName,t.handle.localName))?e:0}toString(t){return`${this.handle.localName}`}}class u extends s{constructor(t){super(),this.tags=t}_clone(t){return new u(this.tags)}_compareTo(t){let e;return 0!==(e=Object(r.compareArrays)(this.tags,t.tags,r.compareStrings))?e:0}toString(t){return this.tags.map(t=>`#${t}`).join(" ")}}class l{constructor(t,e,n,r){Object(i.assert)(n),Object(i.assert)(r),this.from=t,this.to=e,this.direction=n,this.type=r,Object.freeze(this)}_copyInto(t,e){if("constraint"===this.type){if(!(this.from instanceof a||this.to instanceof a))return t.newConnectionConstraint(this.from._clone(),this.to._clone(),this.direction);Object(i.assert)(!1)}return t.newObligation(this.from._clone(e),this.to._clone(e),this.direction)}_compareTo(t){let e;return 0!==(e=this.from._compareTo(t.from))?e:0!==(e=this.to._compareTo(t.to))?e:0!==(e=Object(r.compareStrings)(this.direction,t.direction))?e:0}toString(t,e){let n="";return e&&!0===e.showUnresolved&&"obligation"===this.type&&(n=" // unresolved obligation"),`${this.from.toString(t)} ${this.direction} ${this.to.toString(t)}${n}`}}},function(t,e,n){"use strict";n.r(e),n.d(e,"compareNulls",function(){return i}),n.d(e,"compareStrings",function(){return s}),n.d(e,"compareNumbers",function(){return o}),n.d(e,"compareBools",function(){return a}),n.d(e,"compareArrays",function(){return c}),n.d(e,"compareObjects",function(){return u}),n.d(e,"compareComparables",function(){return l});var r=n(3);function i(t,e){return t===e?0:null===t?-1:1}function s(t,e){return null==t||null==e?i(t,e):t.localeCompare(e)}function o(t,e){return null==t||null==e?i(t,e):t-e}function a(t,e){return null==t||null==e?i(t,e):Number(t)-Number(e)}function c(t,e,n){if(Object(r.assert)(null!=t),Object(r.assert)(null!=e),t.length!==e.length)return o(t.length,e.length);for(let r=0;r<t.length;r++){let i;if(0!==(i=n(t[r],e[r])))return i}return 0}function u(t,e,n){const r=Object.keys(t);let i;if(0!==(i=o(r.length,Object.keys(e).length)))return i;for(const s of r)if(0!==(i=n(t[s],e[s])))return i;return 0}function l(t,e){return null==t||null==e?i(t,e):t._compareTo(e)}},function(t,e,n){"use strict";n.r(e),n.d(e,"Particle",function(){return a});var r=n(3),i=n(39),s=n(40),o=n(37);class a{constructor(t,e){this._id=void 0,this._localName=void 0,this._spec=void 0,this._verbs=[],this._connections={},this._unnamedConnections=[],this._consumedSlotConnections={},Object(r.assert)(t),this._recipe=t,this._name=e}_copyInto(t,e){const n=t.newParticle(this._name);return n._id=this._id,n._verbs=[...this._verbs],n._spec=this._spec,Object.keys(this._connections).forEach(t=>{n._connections[t]=this._connections[t]._clone(n,e)}),n._unnamedConnections=this._unnamedConnections.map(t=>t._clone(n,e)),n._cloneConnectionRawTypes(),Object.keys(this._consumedSlotConnections).forEach(t=>{n._consumedSlotConnections[t]=this._consumedSlotConnections[t]._clone(n,e)}),n}_cloneConnectionRawTypes(){const t=new Map;for(const e of Object.values(this._connections))e.rawType&&(e._rawType=e.rawType._cloneWithResolutions(t));for(const e of this._unnamedConnections)e.rawType&&(e._rawType=e.rawType._cloneWithResolutions(t))}_startNormalize(){this._localName=null,this._verbs.sort();const t={};for(const e of Object.keys(this._connections).sort())t[e]=this._connections[e];this._connections=t;const e={};for(const t of Object.keys(this._consumedSlotConnections).sort())e[t]=this._consumedSlotConnections[t];this._consumedSlotConnections=e}_finishNormalize(){this._unnamedConnections.sort(o.compareComparables),Object.freeze(this)}_compareTo(t){let e;return 0!==(e=Object(o.compareStrings)(this._id,t._id))?e:0!==(e=Object(o.compareStrings)(this._name,t._name))?e:0!==(e=Object(o.compareStrings)(this._localName,t._localName))?e:0!==(e=Object(o.compareArrays)(this._verbs,t._verbs,o.compareStrings))?e:0}_isValid(t){return!this.spec||(!(!this.name&&!this.primaryVerb)||(t&&t.errors&&t.errors.set(this,"Particle has no name and no verb"),!1))}isResolved(t){Object(r.assert)(Object.isFrozen(this));const e=Object.values(this.consumedSlotConnections);if(e.length>0){if(0===e.filter(t=>void 0!==t.targetSlot).length)return t&&t.showUnresolved&&(t.details="unfullfilled slot connections"),!1}return this.spec?this.spec.connectionMap.size!==Object.keys(this._connections).length?(t&&t.showUnresolved&&(t.details="unresolved connections"),!1):0===this.unnamedConnections.length||(t&&t.showUnresolved&&(t.details=`${this.unnamedConnections.length} unnamed connections`),!1):(t&&t.showUnresolved&&(t.details="missing spec"),!1)}get recipe(){return this._recipe}get localName(){return this._localName}set localName(t){this._localName=t}get id(){return this._id}set id(t){Object(r.assert)(!this._id,"Particle ID can only be set once."),this._id=t}get name(){return this._name}set name(t){this._name=t}get spec(){return this._spec}get connections(){return this._connections}get unnamedConnections(){return this._unnamedConnections}get consumedSlotConnections(){return this._consumedSlotConnections}get primaryVerb(){return this._verbs.length>0?this._verbs[0]:void 0}set verbs(t){this._verbs=t}set spec(t){this._spec=t;for(const e of t.connectionMap.keys()){const n=t.connectionMap.get(e);let r=this.connections[e];void 0==r&&(r=this.addConnectionName(e)),r.type=n.type,r.direction=n.direction}t.slots.forEach(t=>{void 0==this._consumedSlotConnections[t.name]&&this.addSlotConnection(t.name),this._consumedSlotConnections[t.name].slotSpec=t})}addUnnamedConnection(){const t=new s.HandleConnection(void 0,this);return this._unnamedConnections.push(t),t}addConnectionName(t){return Object(r.assert)(void 0==this._connections[t]),this._connections[t]=new s.HandleConnection(t,this),this._connections[t]}allConnections(){return Object.values(this._connections).concat(this._unnamedConnections)}ensureConnectionName(t){return this._connections[t]||this.addConnectionName(t)}getConnectionByName(t){return this._connections[t]}nameConnection(t,e){Object(r.assert)(!this._connections[e].handle,`Connection "${e}" already has a handle`);const n=this._unnamedConnections.indexOf(t);Object(r.assert)(n>=0,`Cannot name '${e}' nonexistent unnamed connection.`),t._name=e,t.type=this._connections[e].type,t.direction!==this._connections[e].direction&&(Object(r.assert)("inout"===t.direction,`Unnamed connection cannot adjust direction ${t.direction} to ${e}'s direction ${this._connections[e].direction}`),t.direction=this._connections[e].direction),this._connections[e]=t,this._unnamedConnections.splice(n,1)}addSlotConnection(t){const e=new i.SlotConnection(t,this);return this._consumedSlotConnections[t]=e,e}removeSlotConnection(t){this._consumedSlotConnections[t._name]=null,t.disconnectFromSlot()}remove(){this.recipe.removeParticle(this)}toString(t,e){let n=[];this.name?(n.push(this.name),n.push(`as ${t&&t.get(this)||this.localName}`),this.primaryVerb&&this.primaryVerb!==this.name&&n.push(`// verb=${this.primaryVerb}`)):n.push(`&${this.primaryVerb}`),e&&e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved particle: ${e.details}`)),n=[n.join(" ")];for(const r of this.unnamedConnections)n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of Object.values(this.connections))n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));for(const r of Object.values(this._consumedSlotConnections))n.push(r.toString(t,e).replace(/^|(\n)/g,"$1  "));return n.join("\n")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotConnection",function(){return s});var r=n(3),i=n(37);class s{constructor(t,e){this._slotSpec=void 0,this._targetSlot=void 0,this._providedSlots={},this._tags=[],Object(r.assert)(e),Object(r.assert)(e.recipe),Object(r.assert)(t),this._recipe=e.recipe,this._particle=e,this._name=t}remove(){this._particle.removeSlotConnection(this)}get recipe(){return this._recipe}get particle(){return this._particle}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get slotSpec(){return this._slotSpec}get targetSlot(){return this._targetSlot}get providedSlots(){return this._providedSlots}get tags(){return this._tags}set tags(t){this._tags=t}set slotSpec(t){Object(r.assert)(this.name===t.name),this._slotSpec=t,t.providedSlots.forEach(t=>{let e=this.providedSlots[t.name];void 0==e&&((e=this.recipe.newSlot(t.name))._sourceConnection=this,e._name=t.name,this.providedSlots[t.name]=e),Object(r.assert)(0===e.handleConnections.length,"Handle connections must be empty"),t.handles.forEach(t=>e.handleConnections.push(this.particle.connections[t])),Object(r.assert)(e._name===t.name),Object(r.assert)(!e.formFactor),e.formFactor=t.formFactor})}connectToSlot(t){Object(r.assert)(t),Object(r.assert)(!this.targetSlot),Object(r.assert)(this.recipe===t.recipe,"Cannot connect to slot from different recipe"),this._targetSlot=t,t.consumeConnections.push(this)}disconnectFromSlot(){this._targetSlot&&(this._targetSlot.removeConsumeConnection(this),this._targetSlot=void 0)}_clone(t,e){if(e.has(this))return e.get(this);const n=t.addSlotConnection(this.name);return n.tags=this.tags,this.slotSpec&&(n._slotSpec=t.spec.getSlotSpec(this.name)),e.set(this,n),n}_normalize(){const t={};for(const e of Object.keys(this._providedSlots).sort())t[e]=this._providedSlots[e];this._providedSlots=t,Object.freeze(this)}_compareTo(t){let e;return 0!==(e=Object(i.compareStrings)(this.name,t.name))?e:0!==(e=Object(i.compareComparables)(this._targetSlot,t._targetSlot))?e:0!==(e=Object(i.compareComparables)(this._particle,t._particle))?e:0}_isValid(t){return!this._targetSlot||!this._targetSlot.sourceConnection||this._targetSlot===this._targetSlot.sourceConnection.providedSlots[this._targetSlot.name]||(t&&t.errors&&t.errors.set(this,`Invalid target slot '${this._targetSlot.name}' for slot connection '${this.name}' of particle ${this.particle.name}`),!1)}isResolved(t){return Object(r.assert)(Object.isFrozen(this)),this.name?this.particle?!this.slotSpec.isRequired||this.targetSlot&&(this.targetSlot.id||this.targetSlot.sourceConnection.isConnected())?!this.targetSlot||this.slotSpec.providedSlots.every(e=>!e.isRequired||0!==this.providedSlots[e.name].consumeConnections.length||(t&&(t.details="missing consuming slot"),!1)):(t&&(t.details="missing target-slot"),!1):(t&&(t.details="missing particle"),!1):(t&&(t.details="missing name"),!1)}isConnectedToInternalSlot(){return this.targetSlot&&!!this.targetSlot.sourceConnection}isConnectedToRemoteSlot(){return this.targetSlot&&!!this.targetSlot.id}isConnected(){return this.isConnectedToInternalSlot()||this.isConnectedToRemoteSlot()}toString(t,e){const n=[];n.push("consume"),n.push(`${this.name}`),this.targetSlot&&n.push(`as ${t&&t.get(this.targetSlot)||this.targetSlot.localName}`),e&&e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved slot-connection: ${e.details}`));const i=[];return i.push(n.join(" ")),Object.keys(this.providedSlots).forEach(e=>{const n=this.providedSlots[e],s=[];if(s.push("  provide"),this.slotSpec){const t=this.slotSpec.getProvidedSlotSpec(e);Object(r.assert)(t,`Cannot find providedSlotSpec for ${e}`)}s.push(`${e} as ${t&&t.get(n)||n}`),i.push(s.join(" "))}),i.join("\n")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"HandleConnection",function(){return s});var r=n(3),i=n(37);class s{constructor(t,e){this._tags=[],this._type=void 0,this._rawType=void 0,this._direction=void 0,this._handle=void 0,Object(r.assert)(e),Object(r.assert)(e.recipe),this._recipe=e.recipe,this._name=t,this._particle=e}_clone(t,e){if(e.has(this))return e.get(this);const n=new s(this._name,t);return n._tags=[...this._tags],n._rawType=this._rawType,n._direction=this._direction,void 0!=this._handle&&(n._handle=e.get(this._handle),Object(r.assert)(void 0!==n._handle),n._handle.connections.push(n)),e.set(this,n),n}_normalize(){this._tags.sort(),Object.freeze(this)}_compareTo(t){let e;return 0!==(e=Object(i.compareComparables)(this._particle,t._particle))?e:0!==(e=Object(i.compareStrings)(this._name,t._name))?e:0!==(e=Object(i.compareArrays)(this._tags,t._tags,i.compareStrings))?e:0!==(e=Object(i.compareComparables)(this._handle,t._handle))?e:0!==(e=Object(i.compareStrings)(this._direction,t._direction))?e:0}get recipe(){return this._recipe}get name(){return this._name}getQualifiedName(){return`${this.particle.name}::${this.name}`}get tags(){return this._tags}get type(){return this._type?this._type:this._rawType}get rawType(){return this._rawType}get direction(){return this._direction}get isInput(){return"in"===this.direction||"inout"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}get handle(){return this._handle}get particle(){return this._particle}set tags(t){this._tags=t}set type(t){this._rawType=t,this._type=void 0,this._resetHandleType()}set direction(t){this._direction=t,this._resetHandleType()}get spec(){return null==this.particle.spec?null:this.particle.spec.connectionMap.get(this.name)}get isOptional(){return null!=this.spec&&this.spec.isOptional}_isValid(t){if(this.direction&&!["in","out","inout","host","`consume","`provide"].includes(this.direction))return t&&t.errors&&t.errors.set(this,`Invalid direction '${this.direction}' for handle connection '${this.getQualifiedName()}'`),!1;if(this.type&&this.spec){const e=this.spec;if(!e.isCompatibleType(this.rawType))return t&&t.errors&&t.errors.set(this,`Type '${this.rawType.toString()} for handle connection '${this.getQualifiedName()}' doesn't match particle spec's type '${e.type.toString()}'`),!1;if(this.direction!==e.direction)return t&&t.errors&&t.errors.set(this,`Direction '${this.direction}' for handle connection '${this.getQualifiedName()}' doesn't match particle spec's direction '${e.direction}'`),!1}return!0}isResolved(t){if(Object(r.assert)(Object.isFrozen(this)),this.isOptional)return!0;let e;return this.spec&&this.spec.parentConnection&&(e=this.particle.connections[this.spec.parentConnection.name]),this.type?this._direction?this.handle?!(e&&!e.handle)||(t&&(t.details="parent connection missing handle"),!1):!(!e||!e.isOptional||e.handle)||(t&&(t.details="missing handle"),!1):(t&&(t.details="missing direction"),!1):(t&&(t.details="missing type"),!1)}_resetHandleType(){this._handle&&(this._handle._type=void 0)}connectToHandle(t){Object(r.assert)(t.recipe===this.recipe),this._handle=t,this._resetHandleType(),this._handle.connections.push(this)}disconnectHandle(){const t=this._handle.connections.indexOf(this);Object(r.assert)(t>=0),this._handle.connections.splice(t,1),this._handle=void 0}toString(t,e){const n=[];return n.push(this.name||"*"),n.push({in:"<-",out:"->",inout:"=",host:"=","`consume":"<-","`provide":"->"}[this.direction]||this.direction||"="),this.handle&&(this.handle.immediateValue?n.push(this.handle.immediateValue.name):n.push(`${t&&t.get(this.handle)||this.handle.localName}`)),n.push(...this.tags.map(t=>`#${t}`)),e&&e.showUnresolved&&(this.isResolved(e)||n.push(`// unresolved handle-connection: ${e.details}`)),n.join(" ")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Search",function(){return i});var r=n(3);class i{constructor(t,e){Object(r.assert)(t),this._phrase=t;const n=this.phrase.toLowerCase().split(/[^a-z0-9]/g);this._unresolvedTokens=[],(e||n).forEach(t=>this._unresolvedTokens.push(t)),this._resolvedTokens=n.slice();for(const t of this.unresolvedTokens){const e=this._resolvedTokens.indexOf(t);e>=0&&this._resolvedTokens.splice(e,1)}Object(r.assert)(n.length===this.unresolvedTokens.length+this.resolvedTokens.length)}_append(t,e,n){this._phrase.length>0&&(this._phrase=this.phrase.concat(" ")),this._phrase=this._phrase.concat(t),n.forEach(t=>this._resolvedTokens.push(t)),e.forEach(t=>this._unresolvedTokens.push(t))}get phrase(){return this._phrase}get unresolvedTokens(){return this._unresolvedTokens}get resolvedTokens(){return this._resolvedTokens}resolveToken(t){const e=this.unresolvedTokens.indexOf(t.toLowerCase());Object(r.assert)(e>=0,`Cannot resolved nonexistent token ${t}`),this._unresolvedTokens.splice(e,1),this._resolvedTokens.push(t.toLowerCase())}isValid(){return this._unresolvedTokens.length>0||this._resolvedTokens.length>0}isResolved(){return Object(r.assert)(Object.isFrozen(this)),this._resolvedTokens.length>0}_normalize(){this._unresolvedTokens.sort(),this._resolvedTokens.sort(),Object.freeze(this)}_copyInto(t){return t.search?t.search._append(this.phrase,this.unresolvedTokens,this.resolvedTokens):(t.search=new i(this.phrase,this.unresolvedTokens),Object(r.assert)(t.search.resolvedTokens.length===this.resolvedTokens.length,`${t.search.resolvedTokens} is not same as ${this.resolvedTokens}`)),Object(r.assert)(this.resolvedTokens.every(e=>t.search.resolvedTokens.indexOf(e)>=0)&&this.unresolvedTokens.every(e=>t.search.unresolvedTokens.indexOf(e)>=0)),t.search}toString(t){const e=[];e.push(`search \`${this.phrase}\``);const n=[];return n.push("  tokens"),this.unresolvedTokens.length>0&&n.push(this.unresolvedTokens.map(t=>`\`${t}\``).join(" ")),this.resolvedTokens.length>0&&n.push(`// ${this.resolvedTokens.map(t=>`\`${t}\``).join(" ")}`),t&&t.showUnresolved&&this.unresolvedTokens.length>0&&n.push("// unresolved search tokens"),e.push(n.join(" ")),e.join("\n")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Slot",function(){return s});var r=n(3),i=n(37);class s{constructor(t,e){this._id=void 0,this._localName=void 0,this._tags=[],this._sourceConnection=void 0,this._formFactor=void 0,this._handleConnections=[],this._consumeConnections=[],Object(r.assert)(t),this._recipe=t,this._name=e}get recipe(){return this._recipe}get id(){return this._id}set id(t){this._id=t}get localName(){return this._localName}set localName(t){this._localName=t}get name(){return this._name}set name(t){this._name=t}get tags(){return this._tags}set tags(t){this._tags=t}get formFactor(){return this._formFactor}set formFactor(t){this._formFactor=t}get handleConnections(){return this._handleConnections}get sourceConnection(){return this._sourceConnection}set sourceConnection(t){this._sourceConnection=t}get consumeConnections(){return this._consumeConnections}get spec(){return this.sourceConnection&&this.sourceConnection.slotSpec?this.sourceConnection.slotSpec.getProvidedSlotSpec(this.name):{isSet:!1,tags:[]}}get handles(){return this.handleConnections.map(t=>t.handle).filter(t=>void 0!==t)}_copyInto(t,e){let n=void 0;return!this.sourceConnection&&this.id&&(n=t.findSlot(this.id)),void 0==n&&((n=t.newSlot(this.name))._id=this.id,n._formFactor=this.formFactor,n._localName=this._localName,n._tags=[...this._tags],n._sourceConnection=e.get(this._sourceConnection),n.sourceConnection&&(n.sourceConnection._providedSlots[n.name]=n),this._handleConnections.forEach(t=>n._handleConnections.push(e.get(t)))),this._consumeConnections.forEach(t=>e.get(t).connectToSlot(n)),n}_startNormalize(){this.localName=null,this._tags.sort()}_finishNormalize(){this._consumeConnections.forEach(t=>Object(r.assert)(Object.isFrozen(t))),this._consumeConnections.sort(i.compareComparables),Object.freeze(this)}_compareTo(t){let e;return 0!==(e=Object(i.compareStrings)(this.id,t.id))?e:0!==(e=Object(i.compareStrings)(this.localName,t.localName))?e:0!==(e=Object(i.compareStrings)(this.formFactor,t.formFactor))?e:0!==(e=Object(i.compareArrays)(this._tags,t._tags,i.compareStrings))?e:0}removeConsumeConnection(t){const e=this._consumeConnections.indexOf(t);Object(r.assert)(e>-1),this._consumeConnections.splice(e,1),0===this._consumeConnections.length&&this.remove()}remove(){this._recipe.removeSlot(this)}isResolved(t){return Object(r.assert)(Object.isFrozen(this)),t&&t.showUnresolved&&(t.details=[],this._sourceConnection||t.details.push("missing source-connection"),this.id||t.details.push("missing id"),t.details=t.details.join("; ")),Boolean(this._sourceConnection||this.id)}_isValid(t){return!0}toString(t,e){const n=[];n.push("slot"),this.id&&n.push(`'${this.id}'`),this.tags.length>0&&n.push(this.tags.map(t=>`#${t}`).join(" ")),n.push(`as ${t&&t.get(this)||this.localName}`);const r=e&&e.showUnresolved&&!this.isResolved(e);return r&&n.push(`// unresolved slot: ${e.details}`),this.id||r?n.join(" "):""}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Handle",function(){return a});var r=n(3),i=n(37),s=n(6),o=n(4);class a{constructor(t){this._id=null,this._localName=void 0,this._tags=[],this._type=void 0,this._fate=null,this._originalFate=null,this._originalId=null,this._connections=[],this._mappedType=void 0,this._storageKey=void 0,this._pattern=void 0,this._immediateValue=void 0,Object(r.assert)(t),this._recipe=t}_copyInto(t){let e=void 0;return null!==this._id&&["map","use","copy"].includes(this.fate)&&(e=t.findHandle(this._id)),void 0==e&&((e=t.newHandle())._id=this._id,e._tags=[...this._tags],e._type=this._type?o.Type.fromLiteral(this._type.toLiteral()):void 0,e._fate=this._fate,e._originalFate=this._originalFate,e._originalId=this._originalId,e._mappedType=this._mappedType,e._storageKey=this._storageKey,e._immediateValue=this._immediateValue,e._connections=[],e._pattern=this._pattern),e}mergeInto(t){for(Object(r.assert)(this.recipe===t.recipe,"Cannot merge handles from different recipes.");this.connections.length>0;){const[e]=this.connections;e.disconnectHandle(),e.connectToHandle(t)}t._immediateValue=this._immediateValue,t.tags=t.tags.concat(this.tags),t.recipe.removeHandle(this),t.fate=this._mergedFate([this.fate,t.fate])}_mergedFate(t){return Object(r.assert)(t.length>0,"Cannot merge empty fates list"),Object(r.assert)(!t.includes("map")&&!t.includes("copy"),"Merging map/copy not supported yet"),t.every(t=>"use"===t)?"use":"create"}_startNormalize(){this._localName=null,this._tags.sort()}_finishNormalize(){for(const t of this._connections)Object(r.assert)(Object.isFrozen(t),`Handle connection '${t.name}' is not frozen.`);this._connections.sort(i.compareComparables),Object.freeze(this)}_compareTo(t){let e;return 0!==(e=Object(i.compareStrings)(this._id,t._id))?e:0!==(e=Object(i.compareStrings)(this._localName,t._localName))?e:0!==(e=Object(i.compareArrays)(this._tags,t._tags,i.compareStrings))?e:0!==(e=Object(i.compareStrings)(this.fate,t.fate))?e:0!==(e=Object(i.compareStrings)(this._immediateValue&&this._immediateValue.toString()||"",t._immediateValue&&t._immediateValue.toString()||""))?e:0}get fate(){return this._fate||"?"}set fate(t){null==this._originalFate&&(this._originalFate=this._fate),this._fate=t}get originalFate(){return this._originalFate||"?"}get originalId(){return this._originalId}get recipe(){return this._recipe}get tags(){return this._tags}set tags(t){this._tags=t}get type(){return this._type}get id(){return this._id}set id(t){this._originalId||(this._originalId=this._id),this._id=t}mapToStorage(t){this._id=t.id,this._originalId=t.originalId,this._type=void 0,this._mappedType=t.type,this._storageKey=t.storageKey}get localName(){return this._localName}set localName(t){this._localName=t}get connections(){return this._connections}get storageKey(){return this._storageKey}set storageKey(t){this._storageKey=t}get pattern(){return this._pattern}set pattern(t){this._pattern=t}get mappedType(){return this._mappedType}set mappedType(t){this._mappedType=t}get immediateValue(){return this._immediateValue}set immediateValue(t){this._immediateValue=t}static effectiveType(t,e){const n=new Map,r=e.filter(t=>null!=t.type).map(t=>({type:t.type._cloneWithResolutions(n),direction:t.direction}));return s.TypeChecker.processTypeList(t?t._cloneWithResolutions(n):null,r)}static resolveEffectiveType(t,e){const n=e.filter(t=>null!=t.type).map(t=>({type:t.type,direction:t.direction}));return s.TypeChecker.processTypeList(t,n)}_isValid(t){const e=new Set;for(const n of this._connections){if("map"===this.fate&&["out","inout"].includes(n.direction))return t&&t.errors&&t.errors.set(this,`Invalid fate '${this.fate}' for handle '${this}'; it is used for '${n.direction}' ${n.getQualifiedName()} connection`),!1;n.tags.forEach(t=>e.add(t))}const n=a.resolveEffectiveType(this._mappedType,this._connections);return n?(this._type=n,this._tags.forEach(t=>e.add(t)),this._tags=[...e],!0):(t&&t.errors&&t.errors.set(this,`Type validations failed for handle '${this}'`),!1)}isResolved(t){Object(r.assert)(Object.isFrozen(this));let e=!0;if(this.type){let n=!0;"create"!==this.fate&&"`slot"!==this.fate||(n=!1),(n&&!this.type.isResolved()||!this.type.canEnsureResolved())&&(t&&t.details.push("unresolved type"),e=!1)}else t&&t.details.push("missing type"),e=!1;switch(this.fate){case"?":t&&t.details.push("missing fate"),e=!1;break;case"copy":case"map":case"use":t&&null===this.id&&t.details.push("missing id"),e=e&&null!==this.id;break;case"`slot":case"create":break;default:throw t&&t.details.push(`invalid fate ${this.fate}`),new Error(`Unexpected fate: ${this.fate}`)}return e}toString(t,e){if(this._immediateValue)return;e=e||{};const n=[];if(n.push(this.fate),this.id&&n.push(`'${this.id}'`),n.push(...this.tags.map(t=>`#${t}`)),n.push(`as ${t&&t.get(this)||this.localName}`),this.type)if(n.push("//"),this.type.isResolved())n.push(this.type.resolvedType().toString({hideFields:void 0==e.hideFields||e.hideFields}));else if(n.push(this.type.toString()),e.showUnresolved&&this.type.canEnsureResolved()){const t=o.Type.fromLiteral(this.type.toLiteral());t.maybeEnsureResolved(),n.push("//"),n.push(t.resolvedType().toString({hideFields:void 0==e.hideFields||e.hideFields}))}if(e.showUnresolved){const t={details:[]};this.isResolved(t)||n.push(` // unresolved handle: ${t.details.join(", ")}`)}return n.join(" ")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"StorageProviderFactory",function(){return a});var r=n(45),i=n(51),s=n(68),o=n(167);class a{constructor(t){this.arcId=t,this._storageInstances={volatile:{storage:new r.VolatileStorage(t),isPersistent:!1},firebase:{storage:new i.FirebaseStorage(t),isPersistent:!0},pouchdb:{storage:new s.PouchDbStorage(t),isPersistent:!0},synthetic:{storage:new o.SyntheticStorage(t,this),isPersistent:!1}}}getInstance(t){const e=this._storageInstances[t.split(":")[0]];if(!e)throw new Error(`unknown storage protocol: ${t}`);return e}_storageForKey(t){return this.getInstance(t).storage}isPersistent(t){return this.getInstance(t).isPersistent}async construct(t,e,n){return await this._storageForKey(n).construct(t,e,n)}async connect(t,e,n){return await this._storageForKey(n).connect(t,e,n)}async baseStorageFor(t,e){return await this._storageForKey(e).baseStorageFor(t,e)}baseStorageKey(t,e){return this._storageForKey(e).baseStorageKey(t,e)}parseStringAsKey(t){return this._storageForKey(t).parseStringAsKey(t)}newKey(t,e){}shutdown(){Object.values(this._storageInstances).map(t=>t.storage.shutdown())}}},function(t,e,n){"use strict";n.r(e),n.d(e,"resetVolatileStorageForTesting",function(){return u}),n.d(e,"VolatileStorage",function(){return d});var r=n(3),i=n(46),s=n(48),o=n(49),a=n(50),c=n(4);function u(){for(const t of Object.keys(h))h[t]._memoryMap={}}class l extends o.KeyBase{constructor(t){super();let e=t.split("://");this.protocol=e[0],Object(r.assert)("volatile"===this.protocol,`can't construct volatile key for protocol ${this.protocol} (input key ${t})`),e=e[1]?e.slice(1).join("://").split("^^"):[],this.arcId=e[0],this.location=e[1],Object(r.assert)(this.toString()===t)}childKeyForHandle(t){return new l("volatile")}toString(){return void 0!==this.location&&void 0!==this.arcId?`${this.protocol}://${this.arcId}^^${this.location}`:void 0!==this.arcId?`${this.protocol}://${this.arcId}`:`${this.protocol}`}}const h={};class d extends s.StorageBase{constructor(t){super(t),this._memoryMap={},this._typeMap={},this.localIDBase=0,this.typePromiseMap={},h[this.arcId.toString()]=this}async construct(t,e,n){const r=await this._construct(t,e,n);return e instanceof c.ReferenceType||e instanceof c.BigCollectionType?r:e.isTypeContainer()&&e.getContainedType()instanceof c.ReferenceType?r:(r.enableReferenceMode(),r)}async _construct(t,e,n){const r=new l(n);void 0==r.arcId&&(r.arcId=this.arcId.toString()),void 0==r.location&&(r.location="volatile-"+this.localIDBase++);const i=f.newProvider(e,this,void 0,t,r.toString());return void 0!==this._memoryMap[r.toString()]?null:(this._memoryMap[r.toString()]=i,i)}async connect(t,e,n){const r=new l(n);return r.arcId!==this.arcId.toString()?void 0==h[r.arcId]?null:h[r.arcId].connect(t,e,n):void 0==this._memoryMap[n]?null:this._memoryMap[n]}baseStorageKey(t){const e=new l("volatile");return e.arcId=this.arcId.toString(),e.location="volatile-"+t.toString(),e.toString()}async baseStorageFor(t,e){if(this._typeMap[e])return this._typeMap[e];if(this.typePromiseMap[e])return this.typePromiseMap[e];const n=this._construct(t.toString(),t.collectionOf(),e);this.typePromiseMap[e]=n;const i=await n;return Object(r.assert)(i,`could not construct baseStorage for key ${e}`),this._typeMap[e]=i,i}parseStringAsKey(t){return new l(t)}}class f extends s.StorageProviderBase{constructor(){super(...arguments),this.backingStore=null,this.pendingBackingStore=null}static newProvider(t,e,n,r,i){return t instanceof c.CollectionType?new p(t,e,n,r,i):t instanceof c.BigCollectionType?new v(t,e,n,r,i):new g(t,e,n,r,i)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const t=this.storageEngine.baseStorageKey(this.backingType());this.pendingBackingStore=this.storageEngine.baseStorageFor(this.backingType(),t),this.pendingBackingStore.then(t=>this.backingStore=t)}return this.pendingBackingStore}}class p extends f{constructor(t,e,n,i,s){super(t,n,i,s),this._model=new a.CrdtCollectionModel,this.storageEngine=e,Object(r.assert)(null!==this.version)}backingType(){return this.type.primitiveType()}clone(){const t=new p(this.type,this.storageEngine,this.name,this.id,null);return t.cloneFrom(this),t}async cloneFrom(t){this.referenceMode=t.referenceMode;const e=await t.toLiteral();if(this.referenceMode&&e.model.length>0){await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:e.id,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(e)}async modelForSynchronization(){const t=await this._toList();return{version:this.version,model:t}}toLiteral(){return{version:this.version,model:this._model.toLiteral()}}fromLiteral({version:t,model:e}){this.version=t,this._model=new a.CrdtCollectionModel(e)}async _toList(){if(this.referenceMode){const t=this.toLiteral().model;if(0===t.length)return[];const e=new Set;t.forEach(t=>e.add(t.value.storageKey)),Object(r.assert)(1===e.size,"multiple storageKeys in reference set of collection not yet supported.");e.values().next().value;await this.ensureBackingStore();const n=t.map(t=>t.value.id),i=await this.backingStore.getMultiple(n),s=[];for(let e=0;e<i.length;e++)s.push({id:n[e],value:i[e],keys:t[e].keys});return s}return this.toLiteral().model}async toList(){return(await this._toList()).map(t=>t.value)}async getMultiple(t){return Object(r.assert)(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),t.map(t=>this._model.getValue(t))}async storeMultiple(t,e,n=null){Object(r.assert)(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),t.map(t=>this._model.add(t.id,t,e)),this.version++}async get(t){if(this.referenceMode){const e=this._model.getValue(t);return null==e?null:(await this.ensureBackingStore(),await this.backingStore.get(e.id))}return this._model.getValue(t)}traceInfo(){return{items:this._model.size}}async store(t,e,n=null){Object(r.assert)(null!=e&&e.length>0,"keys required");const o=i.Tracing.start({cat:"handle",name:"VolatileCollection::store",args:{name:this.name}}),a={value:t,keys:e,effective:void 0};if(this.referenceMode){const n=this.type.primitiveType(),r=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(n);a.effective=this._model.add(t.id,{id:t.id,storageKey:r},e),await this.ensureBackingStore(),await this.backingStore.store(t,e)}else a.effective=this._model.add(t.id,t,e);this.version++,await o.wait(this._fire("change",new s.ChangeEvent({add:[a],version:this.version,originatorId:n}))),o.end({args:{value:t}})}async removeMultiple(t,e=null){0===t.length&&(t=this._model.toList().map(t=>({id:t.id,keys:[]}))),t.forEach(t=>{0===t.keys.length&&(t.keys=this._model.getKeys(t.id)),t.value=this._model.getValue(t.id),null!==t.value&&(t.effective=this._model.remove(t.id,t.keys))}),this.version++,this._fire("change",new s.ChangeEvent({remove:t,version:this.version,originatorId:e}))}async remove(t,e=[],n=null){const r=i.Tracing.start({cat:"handle",name:"VolatileCollection::remove",args:{name:this.name}});0===e.length&&(e=this._model.getKeys(t));const o=this._model.getValue(t);if(null!==o){const i=this._model.remove(t,e);this.version++,await r.wait(this._fire("change",new s.ChangeEvent({remove:[{value:o,keys:e,effective:i}],version:this.version,originatorId:n})))}r.end({args:{entity:o}})}clearItemsForTesting(){this._model=new a.CrdtCollectionModel}}class g extends f{constructor(t,e,n,r,i){super(t,n,r,i),this.localKeyId=0,this.storageEngine=e,this._stored=null,this.backingStore=null}backingType(){return this.type}clone(){const t=new g(this.type,this.storageEngine,this.name,this.id,null);return t.cloneFrom(this),t}async cloneFrom(t){this.referenceMode=t.referenceMode,t.referenceMode&&t.localModified&&await t._persistChanges();const e=await t.toLiteral();if(this.referenceMode&&e.model.length>0){await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:e.id,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}await this.fromLiteral(e)}async modelForSynchronization(){if(this.referenceMode&&null!==this._stored){const t=this._stored;await this.ensureBackingStore();const e=await this.backingStore.get(t.id);return{version:this.version,model:[{id:t.id,value:e}]}}return super.modelForSynchronization()}async toLiteral(){const t=this._stored,e=null!=t?[{id:t.id,value:t}]:[];return{version:this.version,model:e}}fromLiteral({version:t,model:e}){const n=0===e.length?null:e[0].value;this.referenceMode&&n&&n.rawData&&Object(r.assert)(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),Object(r.assert)(void 0!==n),this._stored=n,this.version=t}traceInfo(){return{stored:null!==this._stored}}async get(){if(this.referenceMode&&this._stored){const t=this._stored;return await this.ensureBackingStore(),await this.backingStore.get(t.id)}return this._stored}async set(t,e=null,n=null){if(Object(r.assert)(void 0!==t),this.referenceMode&&t){const e=this.type,n=this.backingStore?this.backingStore.storageKey:this.storageEngine.baseStorageKey(e);this._stored={id:t.id,storageKey:n},await this.ensureBackingStore(),await this.backingStore.store(t,[this.storageKey+this.localKeyId++])}else{if(JSON.stringify(this._stored)===JSON.stringify(t)&&null==n)return;this._stored=t}this.version++;const i=this.referenceMode?t:this._stored;await this._fire("change",new s.ChangeEvent({data:i,version:this.version,originatorId:e,barrier:n}))}async clear(t=null,e=null){await this.set(null,t,e)}}class y{constructor(t,e,n,r){this.version=t,this.pageSize=n;const i=[...e];i.sort((t,e)=>t.index-e.index),this.data=i.map(t=>t.value),r||this.data.reverse()}async next(){return 0===this.data.length?{done:!0}:{value:this.data.splice(0,this.pageSize),done:!1}}close(){this.data=[]}}class v extends f{constructor(t,e,n,r,i){super(t,n,r,i),this.items=new Map,this.cursors=new Map,this.cursorIndex=0}enableReferenceMode(){Object(r.assert)(!1,"referenceMode is not supported for BigCollection")}backingType(){return this.type.primitiveType()}async get(t){const e=this.items.get(t);return void 0!==e?e.value:null}async store(t,e,n){Object(r.assert)(null!=e&&e.length>0,"keys required"),this.version++,this.items.has(t.id)||this.items.set(t.id,{index:null,value:null,keys:{}});const i=this.items.get(t.id);i.index=this.version,i.value=t,e.forEach(t=>i.keys[t]=this.version)}async remove(t,e,n){this.version++,this.items.delete(t)}async stream(t,e=!0){Object(r.assert)(!isNaN(t)&&t>0),this.cursorIndex++;const n=new y(this.version,this.items.values(),t,e);return this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(t){const e=this.cursors.get(t);if(!e)return{done:!0};const n=await e.next();return n.done&&this.cursors.delete(t),n}cursorClose(t){const e=this.cursors.get(t);e&&(this.cursors.delete(t),e.close())}cursorVersion(t){const e=this.cursors.get(t);return e?e.version:null}async cloneFrom(t){t.items&&this.fromLiteral(t.toLiteral())}toLiteral(){const t=[];for(const[e,{index:n,value:r,keys:i}]of this.items.entries())t.push({id:e,index:n,value:r,keys:Object.keys(i)});return{version:this.version,model:t}}fromLiteral({version:t,model:e}){this.version=t,this.items.clear();for(const{id:t,index:n,value:r,keys:i}of e){const e={};for(const t of i)e[t]=n;this.items.set(t,{index:n,value:r,keys:e})}}clearItemsForTesting(){this.items.clear()}}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"Tracing",function(){return h});const r=[];let i,s;"object"==typeof document?(i=42,s=function(){return 1e3*performance.now()}):(i=t.pid,s=function(){const e=t.hrtime();return 1e6*e[0]+e[1]/1e3});let o=0;function a(t){return t?"function"==typeof t?a(t()):t.toTraceInfo?a(t.toTraceInfo()):t:{}}const c=[];function u(t){t.pid=i,t.tid=0,t.args||delete t.args,t.ov||delete t.ov,t.cat||(t.cat=""),0===c.length&&r.push(t),Promise.resolve().then(()=>{for(const{callback:e,predicate:n}of c)n&&!n(t)||e(t)})}const l={exports:{}},h=l.exports;function d(){const t={wait:async function(t){return t},start:function(){return this},end:function(){return this},step:function(){return this},addArgs:function(){},endWith:async function(t){return t}};function e(t){let e=(t=a(t)).args;const n=s();return{addArgs:function(t){e=Object.assign(e||{},t)},end:function(r={},i){(r=a(r)).args&&(e=Object.assign(e||{},r.args)),r=Object.assign({},t,r),this.endTs=s(),u({ph:"X",ts:n,dur:this.endTs-n,cat:r.cat,name:r.name,ov:r.overview,args:e,flowId:i&&i.id(),seq:r.sequence})},beginTs:n}}l.exports.wrap=function(t,e){return e},l.exports.start=function(e,n){return t},l.exports.flow=function(e,n){return t},l.exports.enabled&&(l.exports.wrap=function(t,e){return function(...n){const r=l.exports.start(t);try{return e(...n)}finally{r.end()}}},l.exports.start=function(t){let n,r=e(t);const i={cat:t.cat,name:t.name+" (async)",overview:t.overview,sequence:t.sequence};return{async wait(t,s){const o=!!n;o||(n=l.exports.flow(i)),r.end(s,n),o?n.step(Object.assign({ts:r.beginTs},i)):n.start({ts:r.endTs}),r=null;try{return await t}finally{r=e(i)}},addArgs(t){r.addArgs(t)},end(t){r.end(t,n),n&&n.end({ts:r.beginTs})},async endWith(t,e){if(Promise.resolve(t)!==t)return this.end(e),t;t=this.wait(t);try{return await t}finally{this.end(e)}}}},l.exports.flow=function(t){t=a(t);const e=o++;let n=!1;return{start:function(r){const i=r&&r.ts||s();return n=!0,u({ph:"s",ts:i,cat:t.cat,name:t.name,ov:t.overview,args:t.args,id:e,seq:t.sequence}),this},end:function(r){if(!n)return;const i=r&&r.ts||s();return r=a(r),u({ph:"f",bp:"e",ts:i,cat:t.cat,name:t.name,ov:t.overview,args:r&&r.args,id:e,seq:t.sequence}),this},step:function(r){if(!n)return;const i=r&&r.ts||s();return r=a(r),u({ph:"t",ts:i,cat:t.cat,name:t.name,ov:t.overview,args:r&&r.args,id:e,seq:t.sequence}),this},id:()=>e}},l.exports.save=function(){return{traceEvents:r}},l.exports.download=function(){const t=document.createElement("a");t.download="trace.json",t.href="data:text/plain;base64,"+btoa(JSON.stringify(l.exports.save())),t.click()},l.exports.now=s,l.exports.stream=function(t,e){r.length=0,c.push({callback:t,predicate:e})},l.exports.__clearForTests=function(){r.length=0,c.length=0})}l.exports.enabled=!1,l.exports.enable=function(){l.exports.enabled=!0,d()},d()}.call(this,n(47))},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var t=a(d);l=!0;for(var e=u.length;e;){for(c=u,u=[];++h<e;)c&&c[h].run();h=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e),n.d(e,"StorageBase",function(){return a}),n.d(e,"ChangeEvent",function(){return c}),n.d(e,"StorageProviderBase",function(){return u});var r,i=n(3),s=n(46),o=n(37);!function(t){t.change="Change"}(r||(r={}));class a{constructor(t){this.arcId=t,Object(i.assert)(void 0!==t,"Arcs with storage must have ids")}shutdown(){}}class c{constructor(t){Object.assign(this,t)}}class u{constructor(t,e,n,r){this.referenceMode=!1,Object(i.assert)(n,"id must be provided when constructing StorageProviders"),Object(i.assert)(!t.hasUnresolvedVariable,"Storage types must be concrete");const o=s.Tracing.start({cat:"handle",name:"StorageProviderBase::constructor",args:{type:t.toString(),name:e}});this._type=t,this.listeners=new Map,this.name=e,this.version=0,this.id=n,this.source=null,this._storageKey=r,this.nextLocalID=0,o.end()}enableReferenceMode(){this.referenceMode=!0}get storageKey(){return this._storageKey}generateID(){return`${this.id}:${this.nextLocalID++}`}generateIDComponents(){return{base:this.id,component:()=>this.nextLocalID++}}get type(){return this._type}on(t,e,n){Object(i.assert)(void 0!==n,"must provide a target to register a storage event handler");const s=r[t],o=this.listeners.get(s)||new Map;o.set(e,{target:n}),this.listeners.set(s,o)}off(t,e){const n=r[t],i=this.listeners.get(n);i&&i.delete(e)}async _fire(t,e){const n=r[t],i=this.listeners.get(n);if(!i||0===i.size)return;const o=s.Tracing.start({cat:"handle",name:"StorageProviderBase::_fire",args:{kind:n,type:this.type.tag,name:this.name,listeners:i.size}}),a=[];for(const[t]of i.entries())a.push(t);await o.wait(0);for(const t of a)t(e);o.end()}_compareTo(t){let e;return 0!==(e=Object(o.compareStrings)(this.name,t.name))?e:0!==(e=Object(o.compareNumbers)(this.version,t.version))?e:0!==(e=Object(o.compareStrings)(this.source,t.source))?e:0!==(e=Object(o.compareStrings)(this.id,t.id))?e:0}toString(t){const e=[],n=[];return n.push("store"),this.name&&n.push(`${this.name}`),n.push(`of ${this.type.toString()}`),this.id&&n.push(`'${this.id}'`),t&&t.length&&n.push(`${t.join(" ")}`),this.source&&n.push(`in '${this.source}'`),e.push(n.join(" ")),this.description&&e.push(`  description \`${this.description}\``),e.join("\n")}get apiChannelMappingId(){return this.id}dispose(){}modelForSynchronization(){return this.toLiteral()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"KeyBase",function(){return r});class r{}},function(t,e,n){"use strict";n.r(e),n.d(e,"CrdtCollectionModel",function(){return i});var r=n(3);
// @license
class i{constructor(t){if(this.items=new Map,t)for(let{id:e,value:n,keys:r}of t)r||(r=[]),this.items.set(e,{value:n,keys:new Set(r)})}add(t,e,n){Object(r.assert)(n.length>0&&"object"==typeof n,"add requires a list of keys");let i=this.items.get(t),s=!1;if(i){let t=!1;for(const e of n)i.keys.has(e)||(t=!0),i.keys.add(e);this._equals(i.value,e)||(Object(r.assert)(t,"cannot add without new keys. incoming="+n.join(",")+" existing="+[...i.keys].join(",")),i.value=e,s=!0)}else i={value:e,keys:new Set(n)},this.items.set(t,i),s=!0;return s}_equals(t,e){if(Boolean(t)!==Boolean(e))return!1;if(!t)return!0;const n=typeof t;if(n!==typeof e)return!1;if("object"===n){const n=Object.keys(t);return n.length===Object.keys(e).length&&n.every(n=>this._equals(t[n],e[n]))}return JSON.stringify(t)===JSON.stringify(e)}remove(t,e){const n=this.items.get(t);if(!n)return!1;for(const t of e)n.keys.delete(t);const r=0===n.keys.size;return r&&this.items.delete(t),r}toLiteral(){const t=[];for(const[e,{value:n,keys:r}]of this.items.entries())t.push({id:e,value:n,keys:[...r]});return t}toList(){return[...this.items.values()].map(t=>t.value)}has(t){return this.items.has(t)}getKeys(t){const e=this.items.get(t);return e?[...e.keys]:[]}getValue(t){const e=this.items.get(t);return e?e.value:null}get size(){return this.items.size}}},function(t,e,n){"use strict";n.r(e),n.d(e,"resetStorageForTesting",function(){return f}),n.d(e,"FirebaseStorage",function(){return v});var r=n(48),i=n(52),s=n.n(i),o=(n(60),n(63),n(3)),a=n(49),c=n(65),u=n(66),l=n(50),h=n(4),d=n(67);
// @license
async function f(t){t=new p(t);const e=s.a.initializeApp({apiKey:t.apiKey,projectId:t.projectId,databaseURL:t.databaseUrl}),n=s.a.database(e).ref(t.location);await new Promise(t=>{n.remove(t)}),e.delete()}class p extends a.KeyBase{constructor(t){super();let e=t.split("://");if(this.protocol=e[0],Object(o.assert)("firebase"===this.protocol,`can't construct firebase key for protocol ${this.protocol} (input key ${t})`),e[1]){if(e=e[1].split("/"),this.databaseUrl=e[0],!this.databaseUrl||!this.databaseUrl.endsWith(".firebaseio.com"))throw new Error("FirebaseKey must end with .firebaseio.com");this.projectId=this.databaseUrl.split(".")[0],this.apiKey=e[1],this.location=e.slice(2).join("/")}else this.databaseUrl=void 0,this.projectId=void 0,this.apiKey=void 0,this.location=""}childKeyForHandle(t){let e="";return void 0!=this.location&&this.location.length>0&&(e=this.location+"/"),e+=`handles/${t}`,new p(`${this.protocol}://${this.databaseUrl}/${this.apiKey}/${e}`)}toString(){return this.databaseUrl&&this.apiKey?`${this.protocol}://${this.databaseUrl}/${this.apiKey}/${this.location}`:`${this.protocol}://`}}function g(t){return new Promise(e=>{t.once("value",t=>e(t))})}let y=0;class v extends r.StorageBase{constructor(t){super(t),this.apps={},this.baseStores=new Map,this.baseStorePromises=new Map}async construct(t,e,n){let r=!(e instanceof h.ReferenceType);return e instanceof h.BigCollectionType?r=!1:e.isTypeContainer()&&e.getContainedType()instanceof h.ReferenceType&&(r=!1),this._join(t,e,n,!1,r)}async connect(t,e,n){return this._join(t,e,n,!0)}shutdown(){for(const t of Object.values(this.apps))t.owned&&(t.app.delete(),t.owned=!1)}baseStorageKey(t,e){const n=new p(e);return n.location=`backingStores/${t.toString()}`,n.toString()}async baseStorageFor(t,e){if(this.baseStores.has(t))return this.baseStores.get(t);if(this.baseStorePromises.has(t))return this.baseStorePromises.get(t);const n=this._join(t.toString(),t.collectionOf(),e,"unknown");this.baseStorePromises.set(t,n);const r=await n;return Object(o.assert)(r,"baseStorageFor should not fail"),this.baseStores.set(t,r),r}parseStringAsKey(t){return new p(t)}async _join(t,e,n,r,i=!1){Object(o.assert)(!(e instanceof h.VariableType)),Object(o.assert)(!(e.isTypeContainer()&&e.getContainedType()instanceof h.VariableType));const a=new p(n);if(void 0==a.databaseUrl||void 0==a.apiKey)throw new Error("Can't complete partial firebase keys");if(void 0==this.apps[a.projectId])for(const t of s.a.apps)if(t.options.databaseURL===a.databaseUrl){this.apps[a.projectId]={app:t,owned:!1};break}if(void 0==this.apps[a.projectId]){const t=s.a.initializeApp({apiKey:a.apiKey,projectId:a.projectId,databaseURL:a.databaseUrl},`app${y++}`);this.apps[a.projectId]={app:t,owned:!0}}const c=s.a.database(this.apps[a.projectId].app).ref(a.location),u=await g(c);if("unknown"!==r&&r!==u.exists())return null;let l=u.exists()&&u.val().referenceMode;if(!1===r||"unknown"===r&&!1===u.exists()){if(!(await c.transaction(t=>{if(null==t)return{version:0,referenceMode:i}},void 0,!1)).committed)return null;l=i}const d=m.newProvider(e,this,t,c,a,r);return l&&d.enableReferenceMode(),d}static encodeKey(t){return(t=Object(u.btoa)(t)).replace(/\//g,"*")}static decodeKey(t){return t=t.replace(/\*/g,"/"),Object(c.atob)(t)}}class m extends r.StorageProviderBase{constructor(t,e,n,r,i){super(t,void 0,n,i.toString()),this.storageEngine=e,this.firebaseKey=i,this.reference=r,this.backingStore=null,this.pendingBackingStore=null,this.persisting=null}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const t=this.storageEngine.baseStorageKey(this.backingType(),this.storageKey);this.pendingBackingStore=this.storageEngine.baseStorageFor(this.type,t),this.pendingBackingStore.then(t=>this.backingStore=t)}return this.pendingBackingStore}static newProvider(t,e,n,r,i,s){return t instanceof h.CollectionType?new b(t,e,n,r,i):t instanceof h.BigCollectionType?new C(t,e,n,r,i):new _(t,e,n,r,i,s)}async _transaction(t){const e=await this.reference.transaction(e=>{if(null==e)return 0;const n=t(e);return JSON.parse(JSON.stringify(n))},void 0,!1);return e.committed&&Object(o.assert)(0!==e.snapshot.val()),e}async _persistChanges(){for(;this._hasLocalChanges;)this.persisting?await this.persisting:(this.persisting=this._persistChangesImpl(),await this.persisting,this.persisting=null)}}class _ extends m{constructor(t,e,n,r,i,s){super(t,e,n,r,i),this.localKeyId=Date.now(),this.pendingWrites=[],this.wasConnect=s,this.value=null,this.version=null,this.localModified=!1,this.initialized=new Promise(t=>this.resolveInitialized=t),this.valueChangeCallback=this.reference.on("value",t=>this.remoteStateChanged(t))}dispose(){this.reference.off("value",this.valueChangeCallback)}backingType(){return this.type}remoteStateChanged(t){if(this.localModified)return;const e=t.val();if(Object(o.assert)(null==this.version||e.version>this.version),this.value=e.value||null,this.version=e.version,this.resolveInitialized(),this.referenceMode&&this.value){const t=this.version;this.ensureBackingStore().then(async e=>{const n=await e.get(this.value.id);this._fire("change",new r.ChangeEvent({data:n,version:t}))})}else this._fire("change",new r.ChangeEvent({data:e.value||null,version:this.version}))}get _hasLocalChanges(){return this.localModified}async _persistChangesImpl(){Object(o.assert)(this.localModified);const t=this.version,e=this.value;if(this.referenceMode&&this.pendingWrites.length>0){await this.ensureBackingStore();const t=this.pendingWrites.slice();this.pendingWrites=[],await Promise.all(t.map(t=>this.backingStore.store(t.value,[this.storageKey+this.localKeyId++])))}const n=await this._transaction(n=>(Object(o.assert)(this.version>=t),{version:Math.max(n.version+1,t),value:e,referenceMode:this.referenceMode}));Object(o.assert)(n.committed,"uncommited transaction (offline?) not supported yet");const r=n.snapshot.val();if(Object(o.assert)(0!==r),Object(o.assert)(r.version>=t),this.version!==t)return this._persistChangesImpl();this.localModified=!1,this.version=r.version,this.value=r.value||null}get versionForTesting(){return this.version}async get(){if(await this.initialized,this.referenceMode&&this.value){this.type;return await this.ensureBackingStore(),await this.backingStore.get(this.value.id)}return this.value}async set(t,e=null,n=null){if(Object(o.assert)(void 0!==t),null==this.version)Object(o.assert)(!this.localModified),this.version=0,this.resolveInitialized();else if(!this.referenceMode&&JSON.stringify(this.value)===JSON.stringify(t))return;this.version++;const i=this.version;let s;this.referenceMode&&t?(s=this.storageEngine.baseStorageKey(this.type,this.storageKey),this.value={id:t.id,storageKey:s},this.pendingWrites.push({value:t,storageKey:s})):this.value=t,this.localModified=!0,await this._persistChanges(),this._fire("change",new r.ChangeEvent({data:t,version:i,originatorId:e,barrier:n}))}async clear(t=null,e=null){return this.set(null,t,e)}async cloneFrom(t){this.referenceMode=t.referenceMode;const e=await t.toLiteral(),n=e.model[0].value;if(this.referenceMode&&e.model.length>0){await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:t,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(e),this.localModified=!0,this.resolveInitialized(),this._fire("change",new r.ChangeEvent({data:this.referenceMode?n:this.value,version:this.version})),await this._persistChanges()}async modelForSynchronization(){if(await this.initialized,this.value&&!this.referenceMode&&Object(o.assert)(void 0==this.value.storageKey,`values in non-referenceMode stores shouldn't have storageKeys. This store is ${this.storageKey}`),this.referenceMode&&null!==this.value){const t=this.value;await this.ensureBackingStore();const e=await this.backingStore.get(t.id);return{version:this.version,model:[{id:t.id,value:e}]}}return super.modelForSynchronization()}async toLiteral(){await this.initialized;const t=this.value,e=null==t?[]:[{id:t.id,value:t}];return{version:this.version,model:e}}fromLiteral({version:t,model:e}){const n=0===e.length?null:e[0].value;Object(o.assert)(void 0!==n),Object(o.assert)(this.referenceMode||!n.storageKey),this.value=n,this.version=t}}class b extends m{constructor(t,e,n,r,i){super(t,e,n,r,i),this.pendingWrites=[],this.localKeyId=Date.now(),this.localChanges=new Map,this.addSuppressions=new Map,this.model=new l.CrdtCollectionModel,this.version=null,this.remoteState={items:{}},this.initialized=new Promise(t=>this.resolveInitialized=t),this.valueChangeCallback=this.reference.on("value",t=>this.remoteStateChanged(t))}dispose(){this.reference.off("value",this.valueChangeCallback)}backingType(){return this.type.primitiveType()}remoteStateChanged(t){const e=t.val();e.items||(e.items={});const n=[],i=[],s=new Set([...Object.keys(e.items),...Object.keys(this.remoteState.items)]);for(const t of s){const r=v.decodeKey(t),s=this.addSuppressions.get(r);if(t in e.items){let{keys:o,value:a}=e.items[t];if(o=Object.keys(o),t in this.remoteState.items){const e=Object.keys(this.remoteState.items[t].keys),{add:c,remove:u}=Object(d.setDiff)(e,o);let l=c.map(v.decodeKey);const h=u.map(v.decodeKey);if(s&&(l=l.filter(t=>!s.keys.has(t))),l.length){this.localChanges.has(r)&&this.localChanges.get(r).add.length>0&&this.model.has(r)&&(a=this.model.getValue(r));const t=this.model.add(r,a,l);n.push({value:a,keys:l,effective:t})}if(h.length){const t=this.model.getValue(r),e=this.model.remove(r,h);i.push({value:t,keys:h,effective:e})}}else{let t=o.map(v.decodeKey);if(s&&(t=t.filter(t=>!s.keys.has(t))),t.length){this.localChanges.has(r)&&this.localChanges.get(r).add.length>0&&this.model.has(r)&&(a=this.model.getValue(r));const t=o.map(v.decodeKey),e=this.model.add(r,a,t);n.push({value:a,keys:t,effective:e})}}}else{const{keys:e,value:n}=this.remoteState.items[t],s=Object.keys(e).map(v.decodeKey),o=this.model.remove(r,s);i.push({value:n,keys:s,effective:o})}}for(const[t,{barrierVersion:n}]of this.addSuppressions.entries())e.version>=n&&this.addSuppressions.delete(t);if(this.version=Math.max(this.version+1,e.version),this.remoteState=e,this.resolveInitialized(),0!==n.length||0!==i.length)if(this.referenceMode){const t=n.map(({value:t})=>t.id).concat(i.map(({value:t})=>t.id));this.ensureBackingStore().then(async e=>{const s={};(await e.getMultiple(t)).forEach(t=>s[t.id]=t);const o=n.map(({value:t,keys:e,effective:n})=>({value:s[t.id],keys:e,effective:n})),a=i.map(({value:t,keys:e,effective:n})=>({value:s[t.id],keys:e,effective:n}));this._fire("change",new r.ChangeEvent({add:o,remove:a,version:this.version}))})}else this._fire("change",new r.ChangeEvent({add:n,remove:i,version:this.version}))}get versionForTesting(){return this.version}async get(t){if(await this.initialized,this.referenceMode){const e=this.model.getValue(t);return null==e?null:(await this.ensureBackingStore(),await this.backingStore.get(e.id))}return this.model.getValue(t)}async removeMultiple(t,e=null){await this.initialized,0===t.length&&(t=this.model.toList().map(t=>({id:t.id,keys:[]}))),t.forEach(t=>{t.value=this.model.getValue(t.id),null!==t.value&&(0===t.keys.length&&(t.keys=this.model.getKeys(t.id)),t.effective=this.model.remove(t.id,t.keys))}),this.version++,t=t.filter(t=>t.value),this._fire("change",new r.ChangeEvent({remove:t,version:this.version,originatorId:e})),t.forEach(t=>{this.localChanges.has(t.id)||this.localChanges.set(t.id,{add:[],remove:[]});const e=this.localChanges.get(t.id);for(const n of t.keys)e.remove.push(n)}),await this._persistChanges()}async remove(t,e=[],n=null){await this.initialized;const i=this.model.getValue(t);if(null===i)return;0===e.length&&(e=this.model.getKeys(t));const s=this.model.remove(t,e);this.version++,this._fire("change",new r.ChangeEvent({remove:[{value:i,keys:e,effective:s}],version:this.version,originatorId:n})),this.localChanges.has(t)||this.localChanges.set(t,{add:[],remove:[]});const o=this.localChanges.get(t);for(const t of e)o.remove.push(t);await this._persistChanges()}async store(t,e,n=null){Object(o.assert)(null!=e&&e.length>0,"keys required"),await this.initialized;const i=t.id;let s;if(this.referenceMode){const n=this.type.primitiveType(),r=this.storageEngine.baseStorageKey(n,this.storageKey);s=this.model.add(i,{id:i,storageKey:r},e),this.version++,this.pendingWrites.push({value:t,storageKey:r})}else s=this.model.add(i,t,e),this.version++;this._fire("change",new r.ChangeEvent({add:[{value:t,keys:e,effective:s}],version:this.version,originatorId:n})),this.localChanges.has(i)||this.localChanges.set(i,{add:[],remove:[]});const a=this.localChanges.get(i);for(const t of e)a.add.push(t);await this._persistChanges()}get _hasLocalChanges(){return this.localChanges.size>0||this.pendingWrites.length>0}async _persistChangesImpl(){if(this.pendingWrites.length>0){await this.ensureBackingStore(),Object(o.assert)(this.backingStore);const t=this.pendingWrites.slice();return this.pendingWrites=[],void await Promise.all(t.map(t=>this.backingStore.store(t.value,[this.storageKey+this.localKeyId++])))}if(this.localChanges.size>0){let t;const e=await this._transaction(e=>{e.items||(e.items={}),e.version=Math.max(e.version+1,this.version),t=new Map;for(let[n,{add:r,remove:i}]of this.localChanges.entries()){const s=v.encodeKey(n);t.set(n,{add:[...r],remove:[...i]}),r=r.filter(t=>!(i.indexOf(t)>=0));const a=e.items[s]||{value:null,keys:{}};for(const t of r){const n=v.encodeKey(t);a.keys[n]=e.version}for(const t of i){const e=v.encodeKey(t);delete a.keys[e]}r.length>0&&(Object(o.assert)(this.model.has(n)),a.value=this.model.getValue(n)),Object.keys(a.keys).length>0?e.items[s]=a:delete e.items[s]}return e.referenceMode=this.referenceMode,e});Object(o.assert)(e.committed);const n=e.snapshot.val();for(let[e,{add:r,remove:i}]of t.entries()){r=new Set(r),i=new Set(i);const t=this.localChanges.get(e);if(t.add=t.add.filter(t=>!r.has(t)),t.remove=t.remove.filter(t=>!i.has(t)),0===t.add.length&&0===t.remove.length&&this.localChanges.delete(e),this.addSuppressions.has(e)){const t=this.addSuppressions.get(e);for(const e of r)t.keys.add(e);t.barrierVersion=n.version}else this.addSuppressions.set(e,{keys:r,barrierVersion:n.version})}}}async _toList(){if(await this.initialized,this.referenceMode){const t=(await this.toLiteral()).model;if(0===t.length)return[];this.type.primitiveType();const e=new Set;t.forEach(t=>e.add(t.value.storageKey)),Object(o.assert)(1===e.size);e.values().next().value;await this.ensureBackingStore();const n=async t=>{const e=t.value;return{id:e.id,value:await this.backingStore.get(e.id),keys:t.keys}};return await Promise.all(t.map(n))}return(await this.toLiteral()).model}async modelForSynchronization(){const t=await this._toList();return{version:this.version,model:t}}async toList(){return(await this._toList()).map(t=>t.value)}async getMultiple(t){return Object(o.assert)(!this.referenceMode,"getMultiple not implemented for referenceMode stores"),await this.initialized,t.map(t=>this.model.getValue(t))}async storeMultiple(t,e,n=null){Object(o.assert)(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),t.map(t=>{this.model.add(t.id,t,e),this.localChanges.has(t.id)||this.localChanges.set(t.id,{add:[],remove:[]});const n=this.localChanges.get(t.id);for(const t of e)n.add.push(t)}),await this._persistChanges()}async cloneFrom(t){this.referenceMode=t.referenceMode;const e=await t.toLiteral();if(this.referenceMode&&e.model.length>0&&(await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),this.backingStore!==t.backingStore)){e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:e.id,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(e);for(const t of this.model.toLiteral())Object(o.assert)(void 0!==t.value.id),this.localChanges.set(t.value.id,{add:[...t.keys],remove:[]});await this._persistChanges()}async toLiteral(){return await this.initialized,await this.persisting,{version:this.version,model:this.model.toLiteral()}}fromLiteral({version:t,model:e}){this.version=t,this.model=new l.CrdtCollectionModel(e)}}var w;!function(t){t[t.new=0]="new",t[t.init=1]="init",t[t.stream=2]="stream",t[t.removed=3]="removed",t[t.done=4]="done"}(w||(w={}));class S{constructor(t,e,n){this.orderByIndex=t.child("items").orderByChild("index"),this.pageSize=e,this.forward=n,this.state=w.new,this.removed=[],this.baseQuery=null,this.nextBoundary=null,this.end=null,this.removedFn=null}async _init(){Object(o.assert)(this.state===w.new),(await g(this.orderByIndex.limitToLast(1))).forEach(t=>this.end=t.val().index),this.baseQuery=this.forward?this.orderByIndex.limitToFirst(this.pageSize+1):this.orderByIndex.limitToLast(this.pageSize+1),this.removedFn=this.orderByIndex.on("child_removed",t=>{const e=t.val().index;e>this.end||(null===this.nextBoundary||this.forward&&e>=this.nextBoundary||!this.forward&&e<=this.nextBoundary)&&this.removed.push(t.val().value)}),this.state=w.init}get version(){return this.end}async next(){if(Object(o.assert)(this.state!==w.new),this.state===w.done)return{done:!0};let t;this.state===w.init?(t=this.baseQuery.endAt(this.end),this.state=w.stream):this.state===w.stream&&(Object(o.assert)(null!==this.nextBoundary),t=this.forward?this.baseQuery.startAt(this.nextBoundary).endAt(this.end):this.baseQuery.endAt(this.nextBoundary));const e=[];if(this.state===w.stream){this.nextBoundary=null;const n=await g(t);if(this.forward)n.forEach(t=>{e.length<this.pageSize?e.push(t.val().value):this.nextBoundary=t.val().index});else{let t=null;n.forEach(n=>{e.push(n.val().value),null===t&&(t=n.val().index)}),e.length>this.pageSize&&(e.shift(),this.nextBoundary=t),e.reverse()}null===this.nextBoundary&&(this._detach(),this.state=w.removed)}if(this.state===w.removed){for(;this.removed.length&&e.length<this.pageSize;)e.push(this.removed.pop());0===this.removed.length&&(this.state=w.done)}return Object(o.assert)(e.length>0),{value:e,done:!1}}close(){this._detach(),this.state=w.done}_detach(){this.removedFn&&(this.orderByIndex.off("child_removed",this.removedFn),this.removedFn=null)}}class C extends m{constructor(t,e,n,r,i){super(t,e,n,r,i),this.cursors=new Map,this.cursorIndex=0}backingType(){return this.type.primitiveType()}enableReferenceMode(){Object(o.assert)(!1,"referenceMode is not supported for BigCollection")}async get(t){const e=v.encodeKey(t),n=await g(this.reference.child("items/"+e));return null!==n.val()?n.val().value:null}async store(t,e,n){let r;Object(o.assert)(null!=e&&e.length>0,"keys required"),await this.reference.child("version").transaction(t=>r=(t||0)+1,void 0,!1);const i=v.encodeKey(t.id);await this.reference.child("items/"+i).transaction(n=>{null===n?n={value:t,keys:{}}:n.value=t;for(const t of e){const e=v.encodeKey(t);n.keys[e]=r}return n.index=r,n},void 0,!1)}async remove(t,e,n){await this.reference.child("version").transaction(t=>(t||0)+1,void 0,!1);const r=v.encodeKey(t);await this.reference.child("items/"+r).remove()}async stream(t,e=!0){Object(o.assert)(!isNaN(t)&&t>0),this.cursorIndex++;const n=new S(this.reference,t,e);return await n._init(),this.cursors.set(this.cursorIndex,n),this.cursorIndex}async cursorNext(t){const e=this.cursors.get(t);if(!e)return{done:!0};const n=await e.next();return n.done&&this.cursors.delete(t),n}cursorClose(t){const e=this.cursors.get(t);e&&(this.cursors.delete(t),e.close())}cursorVersion(t){const e=this.cursors.get(t);return e?e.version:null}async _persistChangesImpl(){throw new Error("FireBaseBigCollection does not implement _persistChangesImpl")}get _hasLocalChanges(){return!1}async cloneFrom(t){throw new Error("FirebaseBigCollection does not yet implement cloneFrom")}toLiteral(){throw new Error("FirebaseBigCollection does not yet implement toLiteral")}fromLiteral({version:t,model:e}){throw new Error("FirebaseBigCollection does not yet implement fromLiteral")}}},function(t,e,n){"use strict";n(53);var r=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(n(57));t.exports=r},function(t,e,n){"use strict";n.r(e),function(t,e){n(56);var r=setTimeout;function i(){}function s(t){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,s._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void c(e.promise,t)}a(e.promise,r)}else(1===t._state?a:c)(e.promise,t._value)})):t._deferreds.push(e)}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof s)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void l(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,u(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&s._immediateFn(function(){t._handled||s._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var n=new this.constructor(i);return o(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,e,n)),n},s.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},s.all=function(t){return new s(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function s(t,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var a=o.then;if("function"==typeof a)return void a.call(o,function(e){s(t,e)},n)}r[t]=o,0==--i&&e(r)}catch(t){n(t)}}for(var o=0;o<r.length;o++)s(o,r[o])})},s.resolve=function(t){return t&&"object"==typeof t&&t.constructor===s?t:new s(function(e){e(t)})},s.reject=function(t){return new s(function(e,n){n(t)})},s.race=function(t){return new s(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},s._immediateFn="function"==typeof t&&function(e){t(e)}||function(t){r(t,0)},s._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("unable to locate global object")}();function d(t,e){return t(e={exports:{}},e.exports),e.exports}h.Promise||(h.Promise=s);var f=d(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),p=d(function(t){var e=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=e)}),g=(p.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),y=function(t){if(!g(t))throw TypeError(t+" is not an object!");return t},v=function(t){try{return!!t()}catch(t){return!0}},m=!v(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),_=f.document,b=g(_)&&g(_.createElement),w=function(t){return b?_.createElement(t):{}},S=!m&&!v(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),C=function(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,x={f:m?Object.defineProperty:function(t,e,n){if(y(t),e=C(e,!0),y(n),S)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},T=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},A=m?function(t,e,n){return x.f(t,e,T(1,n))}:function(t,e,n){return t[e]=n,t},k={}.hasOwnProperty,O=function(t,e){return k.call(t,e)},P=0,R=Math.random(),I=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++P+R).toString(36))},F=d(function(t){var e=I("src"),n=Function.toString,r=(""+n).split("toString");p.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,s){var o="function"==typeof i;o&&(O(i,"name")||A(i,"name",n)),t[n]!==i&&(o&&(O(i,e)||A(i,e,t[n]?""+t[n]:r.join(String(n)))),t===f?t[n]=i:s?t[n]?t[n]=i:A(t,n,i):(delete t[n],A(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||n.call(this)})}),D=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},N=function(t,e,n){var r,i,s,o,a=t&N.F,c=t&N.G,u=t&N.S,l=t&N.P,h=t&N.B,d=c?f:u?f[e]||(f[e]={}):(f[e]||{}).prototype,g=c?p:p[e]||(p[e]={}),y=g.prototype||(g.prototype={});for(r in c&&(n=e),n)s=((i=!a&&d&&void 0!==d[r])?d:n)[r],o=h&&i?D(s,f):l&&"function"==typeof s?D(Function.call,s):s,d&&F(d,r,s,t&N.U),g[r]!=s&&A(g,r,o),l&&y[r]!=s&&(y[r]=s)};f.core=p,N.F=1,N.G=2,N.S=4,N.P=8,N.B=16,N.W=32,N.U=64,N.R=128;var j=N,M={}.toString,B=function(t){return M.call(t).slice(8,-1)},L=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==B(t)?t.split(""):Object(t)},H=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},q=function(t){return Object(H(t))},U=Math.ceil,V=Math.floor,K=function(t){return isNaN(t=+t)?0:(t>0?V:U)(t)},$=Math.min,W=function(t){return t>0?$(K(t),9007199254740991):0},z=Array.isArray||function(t){return"Array"==B(t)},G=f["__core-js_shared__"]||(f["__core-js_shared__"]={}),Q=function(t){return G[t]||(G[t]={})},J=d(function(t){var e=Q("wks"),n=f.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:I)("Symbol."+t))}).store=e}),Y=J("species"),X=function(t,e){return new(function(t){var e;return z(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!z(e.prototype)||(e=void 0),g(e)&&null===(e=e[Y])&&(e=void 0)),void 0===e?Array:e}(t))(e)},Z=function(t,e){var n=1==t,r=2==t,i=3==t,s=4==t,o=6==t,a=5==t||o,c=e||X;return function(e,u,l){for(var h,d,f=q(e),p=L(f),g=D(u,l,3),y=W(p.length),v=0,m=n?c(e,y):r?c(e,0):void 0;y>v;v++)if((a||v in p)&&(d=g(h=p[v],v,f),t))if(n)m[v]=d;else if(d)switch(t){case 3:return!0;case 5:return h;case 6:return v;case 2:m.push(h)}else if(s)return!1;return o?-1:i||s?s:m}},tt=J("unscopables"),et=Array.prototype;void 0==et[tt]&&A(et,tt,{});var nt=function(t){et[tt][t]=!0},rt=Z(5),it=!0;"find"in[]&&Array(1).find(function(){it=!1}),j(j.P+j.F*it,"Array",{find:function(t){return rt(this,t,arguments.length>1?arguments[1]:void 0)}}),nt("find");p.Array.find;var st=Z(6),ot=!0;"findIndex"in[]&&Array(1).findIndex(function(){ot=!1}),j(j.P+j.F*ot,"Array",{findIndex:function(t){return st(this,t,arguments.length>1?arguments[1]:void 0)}}),nt("findIndex");p.Array.findIndex;var at=function(t){return L(H(t))},ct=Math.max,ut=Math.min,lt=Q("keys"),ht=function(t){return lt[t]||(lt[t]=I(t))},dt=function(t){return function(e,n,r){var i,s=at(e),o=W(s.length),a=function(t,e){return(t=K(t))<0?ct(t+e,0):ut(t,e)}(r,o);if(t&&n!=n){for(;o>a;)if((i=s[a++])!=i)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}}(!1),ft=ht("IE_PROTO"),pt=function(t,e){var n,r=at(t),i=0,s=[];for(n in r)n!=ft&&O(r,n)&&s.push(n);for(;e.length>i;)O(r,n=e[i++])&&(~dt(s,n)||s.push(n));return s},gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),yt=Object.keys||function(t){return pt(t,gt)},vt={f:Object.getOwnPropertySymbols},mt={f:{}.propertyIsEnumerable},_t=Object.assign,bt=!_t||v(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=_t({},t)[n]||Object.keys(_t({},e)).join("")!=r})?function(t,e){for(var n=q(t),r=arguments.length,i=1,s=vt.f,o=mt.f;r>i;)for(var a,c=L(arguments[i++]),u=s?yt(c).concat(s(c)):yt(c),l=u.length,h=0;l>h;)o.call(c,a=u[h++])&&(n[a]=c[a]);return n}:_t;j(j.S+j.F,"Object",{assign:bt});p.Object.assign;var wt=J("match"),St=function(t,e,n){if(function(t){var e;return g(t)&&(void 0!==(e=t[wt])?!!e:"RegExp"==B(t))}(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(H(t))},Ct=J("match"),Et="".startsWith;j(j.P+j.F*function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Ct]=!1,!"/./"[t](e)}catch(t){}}return!0}("startsWith"),"String",{startsWith:function(t){var e=St(this,t,"startsWith"),n=W(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return Et?Et.call(e,r,n):e.slice(n,n+r.length)===r}});p.String.startsWith;j(j.P,"String",{repeat:function(t){var e=String(H(this)),n="",r=K(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});p.String.repeat;var xt=d(function(t){var e=I("meta"),n=x.f,r=0,i=Object.isExtensible||function(){return!0},s=!v(function(){return i(Object.preventExtensions({}))}),o=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!O(t,e)){if(!i(t))return"F";if(!n)return"E";o(t)}return t[e].i},getWeak:function(t,n){if(!O(t,e)){if(!i(t))return!0;if(!n)return!1;o(t)}return t[e].w},onFreeze:function(t){return s&&a.NEED&&i(t)&&!O(t,e)&&o(t),t}}}),Tt=(xt.KEY,xt.NEED,xt.fastKey,xt.getWeak,xt.onFreeze,x.f),At=J("toStringTag"),kt=function(t,e,n){t&&!O(t=n?t:t.prototype,At)&&Tt(t,At,{configurable:!0,value:e})},Ot={f:J},Pt=x.f,Rt=function(t){var e=p.Symbol||(p.Symbol=f.Symbol||{});"_"==t.charAt(0)||t in e||Pt(e,t,{value:Ot.f(t)})},It=m?Object.defineProperties:function(t,e){y(t);for(var n,r=yt(e),i=r.length,s=0;i>s;)x.f(t,n=r[s++],e[n]);return t},Ft=f.document,Dt=Ft&&Ft.documentElement,Nt=ht("IE_PROTO"),jt=function(){},Mt=function(){var t,e=w("iframe"),n=gt.length;for(e.style.display="none",Dt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Mt=t.F;n--;)delete Mt.prototype[gt[n]];return Mt()},Bt=Object.create||function(t,e){var n;return null!==t?(jt.prototype=y(t),n=new jt,jt.prototype=null,n[Nt]=t):n=Mt(),void 0===e?n:It(n,e)},Lt=gt.concat("length","prototype"),Ht={f:Object.getOwnPropertyNames||function(t){return pt(t,Lt)}},qt=Ht.f,Ut={}.toString,Vt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Kt={f:function(t){return Vt&&"[object Window]"==Ut.call(t)?function(t){try{return qt(t)}catch(t){return Vt.slice()}}(t):qt(at(t))}},$t=Object.getOwnPropertyDescriptor,Wt={f:m?$t:function(t,e){if(t=at(t),e=C(e,!0),S)try{return $t(t,e)}catch(t){}if(O(t,e))return T(!mt.f.call(t,e),t[e])}},zt=xt.KEY,Gt=Wt.f,Qt=x.f,Jt=Kt.f,Yt=f.Symbol,Xt=f.JSON,Zt=Xt&&Xt.stringify,te=J("_hidden"),ee=J("toPrimitive"),ne={}.propertyIsEnumerable,re=Q("symbol-registry"),ie=Q("symbols"),se=Q("op-symbols"),oe=Object.prototype,ae="function"==typeof Yt,ce=f.QObject,ue=!ce||!ce.prototype||!ce.prototype.findChild,le=m&&v(function(){return 7!=Bt(Qt({},"a",{get:function(){return Qt(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Gt(oe,e);r&&delete oe[e],Qt(t,e,n),r&&t!==oe&&Qt(oe,e,r)}:Qt,he=function(t){var e=ie[t]=Bt(Yt.prototype);return e._k=t,e},de=ae&&"symbol"==typeof Yt.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof Yt},fe=function(t,e,n){return t===oe&&fe(se,e,n),y(t),e=C(e,!0),y(n),O(ie,e)?(n.enumerable?(O(t,te)&&t[te][e]&&(t[te][e]=!1),n=Bt(n,{enumerable:T(0,!1)})):(O(t,te)||Qt(t,te,T(1,{})),t[te][e]=!0),le(t,e,n)):Qt(t,e,n)},pe=function(t,e){y(t);for(var n,r=function(t){var e=yt(t),n=vt.f;if(n)for(var r,i=n(t),s=mt.f,o=0;i.length>o;)s.call(t,r=i[o++])&&e.push(r);return e}(e=at(e)),i=0,s=r.length;s>i;)fe(t,n=r[i++],e[n]);return t},ge=function(t){var e=ne.call(this,t=C(t,!0));return!(this===oe&&O(ie,t)&&!O(se,t))&&(!(e||!O(this,t)||!O(ie,t)||O(this,te)&&this[te][t])||e)},ye=function(t,e){if(t=at(t),e=C(e,!0),t!==oe||!O(ie,e)||O(se,e)){var n=Gt(t,e);return!n||!O(ie,e)||O(t,te)&&t[te][e]||(n.enumerable=!0),n}},ve=function(t){for(var e,n=Jt(at(t)),r=[],i=0;n.length>i;)O(ie,e=n[i++])||e==te||e==zt||r.push(e);return r},me=function(t){for(var e,n=t===oe,r=Jt(n?se:at(t)),i=[],s=0;r.length>s;)!O(ie,e=r[s++])||n&&!O(oe,e)||i.push(ie[e]);return i};ae||(F((Yt=function(){if(this instanceof Yt)throw TypeError("Symbol is not a constructor!");var t=I(arguments.length>0?arguments[0]:void 0),e=function(n){this===oe&&e.call(se,n),O(this,te)&&O(this[te],t)&&(this[te][t]=!1),le(this,t,T(1,n))};return m&&ue&&le(oe,t,{configurable:!0,set:e}),he(t)}).prototype,"toString",function(){return this._k}),Wt.f=ye,x.f=fe,Ht.f=Kt.f=ve,mt.f=ge,vt.f=me,m&&F(oe,"propertyIsEnumerable",ge,!0),Ot.f=function(t){return he(J(t))}),j(j.G+j.W+j.F*!ae,{Symbol:Yt});for(var _e="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),be=0;_e.length>be;)J(_e[be++]);for(var we=yt(J.store),Se=0;we.length>Se;)Rt(we[Se++]);j(j.S+j.F*!ae,"Symbol",{for:function(t){return O(re,t+="")?re[t]:re[t]=Yt(t)},keyFor:function(t){if(!de(t))throw TypeError(t+" is not a symbol!");for(var e in re)if(re[e]===t)return e},useSetter:function(){ue=!0},useSimple:function(){ue=!1}}),j(j.S+j.F*!ae,"Object",{create:function(t,e){return void 0===e?Bt(t):pe(Bt(t),e)},defineProperty:fe,defineProperties:pe,getOwnPropertyDescriptor:ye,getOwnPropertyNames:ve,getOwnPropertySymbols:me}),Xt&&j(j.S+j.F*(!ae||v(function(){var t=Yt();return"[null]"!=Zt([t])||"{}"!=Zt({a:t})||"{}"!=Zt(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(g(e)||void 0!==t)&&!de(t))return z(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!de(e))return e}),r[1]=e,Zt.apply(Xt,r)}}),Yt.prototype[ee]||A(Yt.prototype,ee,Yt.prototype.valueOf),kt(Yt,"Symbol"),kt(Math,"Math",!0),kt(f.JSON,"JSON",!0);var Ce=J("toStringTag"),Ee="Arguments"==B(function(){return arguments}()),xe={};xe[J("toStringTag")]="z",xe+""!="[object z]"&&F(Object.prototype,"toString",function(){return"[object "+function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ce))?n:Ee?B(e):"Object"==(r=B(e))&&"function"==typeof e.callee?"Arguments":r}(this)+"]"},!0),Rt("asyncIterator"),Rt("observable");p.Symbol;var Te={},Ae={};A(Ae,J("iterator"),function(){return this});var ke=function(t,e,n){t.prototype=Bt(Ae,{next:T(1,n)}),kt(t,e+" Iterator")},Oe=ht("IE_PROTO"),Pe=Object.prototype,Re=Object.getPrototypeOf||function(t){return t=q(t),O(t,Oe)?t[Oe]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Pe:null},Ie=J("iterator"),Fe=!([].keys&&"next"in[].keys()),De=function(){return this},Ne=function(t,e,n,r,i,s,o){ke(n,e,r);var a,c,u,l=function(t){if(!Fe&&t in p)return p[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},h=e+" Iterator",d="values"==i,f=!1,p=t.prototype,g=p[Ie]||p["@@iterator"]||i&&p[i],y=g||l(i),v=i?d?l("entries"):y:void 0,m="Array"==e&&p.entries||g;if(m&&(u=Re(m.call(new t)))!==Object.prototype&&u.next&&(kt(u,h,!0),"function"!=typeof u[Ie]&&A(u,Ie,De)),d&&g&&"values"!==g.name&&(f=!0,y=function(){return g.call(this)}),(Fe||f||!p[Ie])&&A(p,Ie,y),Te[e]=y,Te[h]=De,i)if(a={values:d?y:l("values"),keys:s?y:l("keys"),entries:v},o)for(c in a)c in p||F(p,c,a[c]);else j(j.P+j.F*(Fe||f),e,a);return a},je=function(t){return function(e,n){var r,i,s=String(H(e)),o=K(n),a=s.length;return o<0||o>=a?t?"":void 0:(r=s.charCodeAt(o))<55296||r>56319||o+1===a||(i=s.charCodeAt(o+1))<56320||i>57343?t?s.charAt(o):r:t?s.slice(o,o+2):i-56320+(r-55296<<10)+65536}}(!0);Ne(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=je(e,n),this._i+=t.length,{value:t,done:!1})});var Me=function(t,e){return{value:e,done:!!t}},Be=Ne(Array,"Array",function(t,e){this._t=at(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Me(1)):Me(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");Te.Arguments=Te.Array,nt("keys"),nt("values"),nt("entries");for(var Le=J("iterator"),He=J("toStringTag"),qe=Te.Array,Ue={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ve=yt(Ue),Ke=0;Ke<Ve.length;Ke++){var $e,We=Ve[Ke],ze=Ue[We],Ge=f[We],Qe=Ge&&Ge.prototype;if(Qe&&(Qe[Le]||A(Qe,Le,qe),Qe[He]||A(Qe,He,We),Te[We]=qe,ze))for($e in Be)Qe[$e]||F(Qe,$e,Be[$e],!0)}Ot.f("iterator")}.call(this,n(54).setImmediate,n(1))},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function s(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new s(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new s(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(55),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(1))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i=1,s={},o=!1,a=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){l(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&l(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},r=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;r=function(e){var n=a.createElement("script");n.onreadystatechange=function(){l(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():r=function(t){setTimeout(l,0,t)},c.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return s[i]=o,r(i),i++},c.clearImmediate=u}function u(t){delete s[t]}function l(t){if(o)setTimeout(l,0,t);else{var e=s[t];if(e){o=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{u(t),o=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(1),n(47))},function(t,e){!function(t){"use strict";if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};l.prototype.append=function(t,e){t=a(t),e=c(e);var n=this.map[t];this.map[t]=n?n+","+e:e},l.prototype.delete=function(t){delete this.map[a(t)]},l.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},l.prototype.set=function(t,e){this.map[a(t)]=c(e)},l.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},l.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),u(t)},l.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),u(t)},l.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),u(t)},e.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},g.call(y.prototype),g.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},m.error=function(){var t=new m(null,{status:0,statusText:""});return t.type="error",t};var o=[301,302,303,307,308];m.redirect=function(t,e){if(-1===o.indexOf(e))throw new RangeError("Invalid status code");return new m(null,{status:e,headers:{location:t}})},t.Headers=l,t.Request=y,t.Response=m,t.fetch=function(t,n){return new Promise(function(r,i){var s=new y(t,n),o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:function(t){var e=new l;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e}(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;r(new m(e,t))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(s.method,s.url,!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&e.blob&&(o.responseType="blob"),s.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function c(t){return"string"!=typeof t&&(t=String(t)),t}function u(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(t){this.map={},t instanceof l?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function f(t){var e=new FileReader,n=d(e);return e.readAsArrayBuffer(t),n}function p(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&r(t))this._bodyArrayBuffer=p(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=d(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(t,e){var n=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new l(e.headers)),this.method=function(t){var e=t.toUpperCase();return s.indexOf(e)>-1?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function v(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function m(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new l(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:this)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(58),i=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s="[DEFAULT]",o=[],a=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=r.deepCopy(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){o.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){o=o.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var e=[];return Object.keys(t.services_).forEach(function(n){Object.keys(t.services_[n]).forEach(function(r){e.push(t.services_[n][r])})}),Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=s),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==s?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;r.deepExtend(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(o.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),o=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&c("app-deleted",{name:this.name_})},t}();function c(t,e){throw u.create(t,e)}a.prototype.name&&a.prototype.options||a.prototype.delete||console.log("dc");var u=new r.ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),l=function t(){var e={},n={},o={},u={__esModule:!0,initializeApp:function(t,n){if(void 0===n&&(n={}),"object"!=typeof n||null===n){var r=n;n={name:r}}var o=n;void 0===o.name&&(o.name=s);var l=o.name;"string"==typeof l&&l||c("bad-app-name",{name:l+""}),i(e,l)&&c("duplicate-app",{name:l});var h=new a(t,o,u);return e[l]=h,d(h,"create"),h},app:l,apps:null,Promise:Promise,SDK_VERSION:"5.5.0",INTERNAL:{registerService:function(t,e,i,s,d){n[t]&&c("duplicate-service",{name:t}),n[t]=e,s&&(o[t]=s,h().forEach(function(t){s("create",t)}));var f=function(e){return void 0===e&&(e=l()),"function"!=typeof e[t]&&c("invalid-app-argument",{name:t}),e[t]()};return void 0!==i&&r.deepExtend(f,i),u[t]=f,a.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,d?e:[])},f},createFirebaseNamespace:t,extendNamespace:function(t){r.deepExtend(u,t)},createSubscribe:r.createSubscribe,ErrorFactory:r.ErrorFactory,removeApp:function(t){d(e[t],"delete"),delete e[t]},factories:n,useAsService:f,Promise:Promise,deepExtend:r.deepExtend}};function l(t){return i(e,t=t||s)||c("no-app",{name:t}),e[t]}function h(){return Object.keys(e).map(function(t){return e[t]})}function d(t,e){Object.keys(n).forEach(function(n){var r=f(t,n);null!==r&&o[r]&&o[r](e,t)})}function f(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return r.patchProperty(u,"default",u),Object.defineProperty(u,"apps",{get:h}),r.patchProperty(l,"App",a),u}();e.firebase=l,e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(59),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(t,e){if(!t)throw o(e)},o=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},a=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var s=t[i],o=i+1<t.length,a=o?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,l=s>>2,h=(3&s)<<4|a>>4,d=(15&a)<<2|u>>6,f=63&u;c||(f=64,o||(d=64)),r.push(n[l],n[h],n[d],n[f])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(s=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(o>>10)),e[r++]=String.fromCharCode(56320+(1023&o))}else{s=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var s=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,c=++i<t.length?n[t.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();var u=s<<2|o>>4;if(r.push(u),64!=a){var l=o<<4&240|a>>2;if(r.push(l),64!=c){var h=a<<6&192|c;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},u=function(t){try{return c.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function l(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=l(t[n],e[n]));return t}var h=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),d=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""},f="FirebaseError",p=Error.captureStackTrace;var g=function(){return function(t,e){if(this.code=t,this.message=e,p)p(this,y.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=f,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}}}();g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g.prototype.name=f;var y=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var s=new g(i,n);for(var o in e)e.hasOwnProperty(o)&&"_"!==o.slice(-1)&&(s[o]=e[o]);return s},t}();function v(t){return JSON.parse(t)}var m=function(t){var e={},n={},r={},i="";try{var s=t.split(".");e=v(u(s[0])||""),n=v(u(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},_=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},b=function(t,e){return _(e,function(e,n){t[e]=n}),t},w=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},S=function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}return r.__extends(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var s,o,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(s=l^c&(u^l),o=1518500249):(s=c^u^l,o=1859775393):r<60?(s=c&u|l&(c|u),o=2400959708):(s=c^u^l,o=3395469782);i=(a<<5|a>>>27)+s+h+o+n[r]&4294967295;h=l,l=u,u=4294967295&(c<<30|c>>>2),c=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<e;){if(0==s)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[s]=t.charCodeAt(r),++r,++s==this.blockSize){this.compress_(i),s=0;break}}else for(;r<e;)if(i[s]=t[r],++r,++s==this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},e}(function(){return function(){this.blockSize=-1}}());var C=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=E),void 0===r.error&&(r.error=E),void 0===r.complete&&(r.complete=E);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),s},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function E(){}function x(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}e.assert=s,e.assertionError=o,e.base64=c,e.base64Decode=u,e.base64Encode=function(t){var e=a(t);return c.encodeByteArray(e,!0)},e.CONSTANTS=i,e.deepCopy=function(t){return l(void 0,t)},e.deepExtend=l,e.patchProperty=function(t,e,n){t[e]=n},e.Deferred=h,e.getUA=d,e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())},e.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.ErrorFactory=y,e.FirebaseError=g,e.patchCapture=function(t){var e=p;return p=t,e},e.jsonEval=v,e.stringify=function(t){return JSON.stringify(t)},e.decode=m,e.isAdmin=function(t){var e=m(t).claims;return"object"==typeof e&&!0===e.admin},e.issuedAtTime=function(t){var e=m(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.isValidFormat=function(t){var e=m(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e,n,r=m(t).claims,i=Math.floor((new Date).getTime()/1e3);return"object"==typeof r&&(r.hasOwnProperty("nbf")?e=r.nbf:r.hasOwnProperty("iat")&&(e=r.iat),n=r.hasOwnProperty("exp")?r.exp:e+86400),i&&e&&n&&i>=e&&i<=n},e.clone=function(t){return b({},t)},e.contains=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.every=function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0},e.extend=b,e.findKey=w,e.findValue=function(t,e,n){var r=w(t,e,n);return r&&t[r]},e.forEach=_,e.getAnyKey=function(t){for(var e in t)return e},e.getCount=function(t){var e=0;for(var n in t)e++;return e},e.getValues=function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e},e.isEmpty=function(t){for(var e in t)return!1;return!0},e.isNonNullObject=function(t){return"object"==typeof t&&null!==t},e.map=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},e.safeGet=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},e.querystring=function(t){var e=[];return _(t,function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}),e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var n=t.split("=");e[n[0]]=n[1]}}),e},e.Sha1=S,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Promise.resolve(!0).then(function(){t.apply(void 0,n)}).catch(function(t){e&&e(t)})}},e.createSubscribe=function(t,e){var n=new C(t,e);return n.subscribe.bind(n)},e.errorPrefix=x,e.validateArgCount=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(x(t,e,r)+"must be a valid function.")},e.validateContextObject=function(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(x(t,e,r)+"must be a valid context object.")},e.validateNamespace=function(t,e,n,r){if((!r||n)&&"string"!=typeof n)throw new Error(x(t,e,r)+"must be a valid firebase namespace.")},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;s(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}},function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",function(){return i}),n.d(e,"__assign",function(){return s}),n.d(e,"__rest",function(){return o}),n.d(e,"__decorate",function(){return a}),n.d(e,"__param",function(){return c}),n.d(e,"__metadata",function(){return u}),n.d(e,"__awaiter",function(){return l}),n.d(e,"__generator",function(){return h}),n.d(e,"__exportStar",function(){return d}),n.d(e,"__values",function(){return f}),n.d(e,"__read",function(){return p}),n.d(e,"__spread",function(){return g}),n.d(e,"__await",function(){return y}),n.d(e,"__asyncGenerator",function(){return v}),n.d(e,"__asyncDelegator",function(){return m}),n.d(e,"__asyncValues",function(){return _}),n.d(e,"__makeTemplateObject",function(){return b}),n.d(e,"__importStar",function(){return w}),n.d(e,"__importDefault",function(){return S});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function o(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}function a(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function c(t,e){return function(n,r){e(n,r,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,a)}c((r=r.apply(t,e||[])).next())})}function h(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function f(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function v(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){s.push([t,e,n,r])>1||a(t,e)})})}function a(t,e){try{!function(t){t.value instanceof y?Promise.resolve(t.value.v).then(c,u):l(s[0][2],t)}(i[t](e))}catch(t){l(s[0][3],t)}}function c(t){a("next",t)}function u(t){a("throw",t)}function l(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}}function m(t){var e,n;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){t[r]&&(e[r]=function(e){return(n=!n)?{value:y(t[r](e)),done:"return"===r}:i?i(e):e})}}function _(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator];return e?e.call(t):f(t)}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function S(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){"use strict";n.r(e);n(61)},function(t,e,n){"use strict";(function(r){Object.defineProperty(e,"__esModule",{value:!0});var i=n(58),s=n(62),o=n(59),a=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(n(57)),c=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),i.stringify(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:i.jsonEval(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),u=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return i.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),l=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new c(e)}}catch(t){}return new u},h=l("localStorage"),d=l("sessionStorage"),f=new s.Logger("@firebase/database"),p=function(){var t=1;return function(){return t++}}(),g=function(t){var e=i.stringToByteArray(t),n=new i.Sha1;n.update(e);var r=n.digest();return i.base64.encodeByteArray(r)},y=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=y.apply(null,t[r]):"object"==typeof t[r]?n+=i.stringify(t[r]):n+=t[r],n+=" ";return n},v=null,m=!0,_=function(t,e){i.assert(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(f.logLevel=s.LogLevel.VERBOSE,v=f.log.bind(f),e&&d.set("logging_enabled",!0)):"function"==typeof t?v=t:(v=null,d.remove("logging_enabled"))},b=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===m&&(m=!1,null===v&&!0===d.get("logging_enabled")&&_(!0)),v){var n=y.apply(null,t);v(n)}},w=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];b.apply(void 0,[t].concat(e))}},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+y.apply(void 0,t);f.error(n)},C=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+y.apply(void 0,t);throw f.error(n),new Error(n)},E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+y.apply(void 0,t);f.warn(n)},x=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},T="[MIN_NAME]",A="[MAX_NAME]",k=function(t,e){if(t===e)return 0;if(t===T||e===A)return-1;if(e===T||t===A)return 1;var n=j(t),r=j(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},O=function(t,e){return t===e?0:t<e?-1:1},P=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+i.stringify(e))},R=function(t){if("object"!=typeof t||null===t)return i.stringify(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",s=0;s<e.length;s++)0!==s&&(r+=","),r+=i.stringify(e[s]),r+=":",r+=R(t[e[s]]);return r+="}"},I=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},F=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;++n)e(n,t[n]);else i.forEach(t,function(t,n){return e(n,t)})},D=function(t){i.assert(!x(t),"Invalid JSON number");var e,n,r,s,o,a,c;for(0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(s=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),c=a.join("");var u="";for(o=0;o<64;o+=8){var l=parseInt(c.substr(o,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},N=new RegExp("^-?\\d{1,10}$"),j=function(t){if(N.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},M=function(t){try{t()}catch(t){setTimeout(function(){var e=t.stack||"";throw E("Exception was thrown by user callback.",e),t},Math.floor(0))}},B=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},L=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},H=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var s=k(n[i],r[i]);if(0!==s)return s}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),q=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=i.stringLength(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=i.stringLength(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=i.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),U="long_polling",V=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(i.assert("string"==typeof t,"typeof type must == string"),i.assert("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==U)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return i.forEach(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var K,$,W=function(t){var e=z(t),n=e.subdomain;"firebase"===e.domain&&C(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||C("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&E("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new V(e.host,e.secure,n,r),path:new H(e.pathString)}},z=function(t){var e="",n="",r="",i="",s=!0,o="https",a=443;if("string"==typeof t){var c=t.indexOf("//");c>=0&&(o=t.substring(0,c-1),t=t.substring(c+2));var u=t.indexOf("/");-1===u&&(u=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(u,l)),u<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(u,l)));var h=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var s=i.split("=");2===s.length?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):E("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,l)));(c=e.indexOf(":"))>=0?(s="https"===o||"wss"===o,a=parseInt(e.substring(c+1),10)):c=t.length;var d=e.split(".");3===d.length?(n=d[1],r=d[0].toLowerCase()):2===d.length?n=d[0]:"localhost"===d[0].slice(0,c).toLowerCase()&&(n="localhost"),""===r&&"ns"in h&&(r=h.ns)}return{host:e,port:a,domain:n,subdomain:r,secure:s,scheme:o,pathString:i}},G=/[\[\].#$\/\u0000-\u001F\u007F]/,Q=/[\[\].#$\u0000-\u001F\u007F]/,J=function(t){return"string"==typeof t&&0!==t.length&&!G.test(t)},Y=function(t){return"string"==typeof t&&0!==t.length&&!Q.test(t)},X=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!x(t)||t&&"object"==typeof t&&i.contains(t,".sv")},Z=function(t,e,n,r,s){s&&void 0===n||tt(i.errorPrefix(t,e,s),n,r)},tt=function(t,e,n){var r=n instanceof H?new q(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(x(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>10485760/3&&i.stringLength(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var s=!1,o=!1;if(i.forEach(e,function(e,n){if(".value"===e)s=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!J(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),tt(t,n,r),r.pop()}),s&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},et=function(t,e,n,r,s){if(!s||void 0!==n){var o=i.errorPrefix(t,e,s);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];i.forEach(n,function(t,e){var n=new H(t);if(tt(o,e,r.child(n)),".priority"===n.getBack()&&!X(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),s=0;s<i.length;s++)if(".priority"===i[s]&&s===i.length-1);else if(!J(i[s]))throw new Error(t+"contains an invalid key ("+i[s]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(H.comparePaths);var o=null;for(n=0;n<e.length;n++){if(r=e[n],null!==o&&o.contains(r))throw new Error(t+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,a)}},nt=function(t,e,n,r){if(!r||void 0!==n){if(x(n))throw new Error(i.errorPrefix(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!X(n))throw new Error(i.errorPrefix(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},rt=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(i.errorPrefix(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},it=function(t,e,n,r){if(!(r&&void 0===n||J(n)))throw new Error(i.errorPrefix(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},st=function(t,e,n,r){if(!(r&&void 0===n||Y(n)))throw new Error(i.errorPrefix(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ot=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},at=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!J(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Y(t)}(r))throw new Error(i.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ct=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){i.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),i.validateCallback("OnDisconnect.cancel",1,t,!0);var e=new i.Deferred;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){i.validateArgCount("OnDisconnect.remove",0,1,arguments.length),ot("OnDisconnect.remove",this.path_),i.validateCallback("OnDisconnect.remove",1,t,!0);var e=new i.Deferred;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){i.validateArgCount("OnDisconnect.set",1,2,arguments.length),ot("OnDisconnect.set",this.path_),Z("OnDisconnect.set",1,t,this.path_,!1),i.validateCallback("OnDisconnect.set",2,e,!0);var n=new i.Deferred;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){i.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),ot("OnDisconnect.setWithPriority",this.path_),Z("OnDisconnect.setWithPriority",1,t,this.path_,!1),nt("OnDisconnect.setWithPriority",2,e,!1),i.validateCallback("OnDisconnect.setWithPriority",3,n,!0);var r=new i.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(i.validateArgCount("OnDisconnect.update",1,2,arguments.length),ot("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,E("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}et("OnDisconnect.update",1,t,this.path_,!1),i.validateCallback("OnDisconnect.update",2,e,!0);var s=new i.Deferred;return this.repo_.onDisconnectUpdate(this.path_,t,s.wrapCallback(e)),s.promise},t}(),ut=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return i.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),lt=function(){var t="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",e=0,n=[];return function(r){var s,o=r===e;e=r;var a=new Array(8);for(s=7;s>=0;s--)a[s]=t.charAt(r%64),r=Math.floor(r/64);i.assert(0===r,"Cannot push at time == 0");var c=a.join("");if(o){for(s=11;s>=0&&63===n[s];s--)n[s]=0;n[s]++}else for(s=0;s<12;s++)n[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)c+=t.charAt(n[s]);return i.assert(20===c.length,"nextPushId: Length should be 20."),c}}(),ht=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),dt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new ht(T,t),r=new ht(T,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return ht.MIN},t}(),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return K},set:function(t){K=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return k(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw i.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return ht.MIN},e.prototype.maxPost=function(){return new ht(A,K)},e.prototype.makePost=function(t,e){return i.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new ht(t,K)},e.prototype.toString=function(){return".key"},e}(dt),pt=new ft;var gt,yt,vt,mt=function(t){return"number"==typeof t?"number:"+D(t):"string:"+t},_t=function(t){if(t.isLeafNode()){var e=t.val();i.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&i.contains(e,".sv"),"Priority must be a string or number.")}else i.assert(t===$||t.isEmpty(),"priority of unexpected type.");i.assert(t===$||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},bt=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,i.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),_t(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return gt},set:function(t){gt=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(i.assert(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+mt(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?D(this.value_):this.value_,this.lazyHash_=g(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(i.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,s=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return i.assert(s>=0,"Unknown leaf type: "+n),i.assert(o>=0,"Unknown leaf type: "+r),s===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-s},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var wt,St,Ct=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?k(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return ht.MIN},e.prototype.maxPost=function(){return new ht(A,new bt("[PRIORITY-POST]",vt))},e.prototype.makePost=function(t,e){var n=yt(t);return new ht(e,new bt("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(dt)),Et=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var s=1;!t.isEmpty();)if(t=t,s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse_?t.left:t.right;else{if(0===s){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),xt=function(){function t(e,n,r,i,s){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:At.EMPTY_NODE,this.right=null!=s?s:At.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,s){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return At.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return At.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Tt=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new xt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),At=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,xt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,xt.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Et(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Et(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Et(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Et(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Tt,t}(),kt=Math.log(2),Ot=function(){function t(t){this.count=function(t){return parseInt(Math.log(t)/kt,10)}(t+1),this.current_=this.count-1;var e=function(t){return parseInt(Array(t+1).join("1"),2)}(this.count);this.bits_=t+1&e}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Pt=function(t,e,n,r){t.sort(e);var i=function(e,r){var s,o,a=r-e;if(0==a)return null;if(1==a)return s=t[e],o=n?n(s):s,new xt(o,s.node,xt.BLACK,null,null);var c=parseInt(a/2,10)+e,u=i(e,c),l=i(c+1,r);return s=t[c],o=n?n(s):s,new xt(o,s.node,xt.BLACK,u,l)},s=function(e){for(var r=null,s=null,o=t.length,a=function(e,r){var s=o-e,a=o;o-=e;var u=i(s+1,a),l=t[s],h=n?n(l):l;c(new xt(h,l.node,r,null,u))},c=function(t){r?(r.left=t,r=t):(s=t,r=t)},u=0;u<e.count;++u){var l=e.nextBitIsOne(),h=Math.pow(2,e.count-(u+1));l?a(h,xt.BLACK):(a(h,xt.BLACK),a(h,xt.RED))}return s}(new Ot(t.length));return new At(r||e,s)},Rt={},It=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return i.assert(Rt&&Ct,"ChildrenNode.ts has not been loaded"),wt=wt||new t({".priority":Rt},{".priority":Ct})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=i.safeGet(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===Rt?null:e},t.prototype.hasIndex=function(t){return i.contains(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){i.assert(e!==pt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,s=[],o=!1,a=n.getIterator(ht.Wrap),c=a.getNext();c;)o=o||e.isDefinedOn(c.node),s.push(c),c=a.getNext();r=o?Pt(s,e.getCompare()):Rt;var u=e.toString(),l=i.clone(this.indexSet_);l[u]=e;var h=i.clone(this.indexes_);return h[u]=r,new t(h,l)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(i.map(this.indexes_,function(t,s){var o=i.safeGet(r.indexSet_,s);if(i.assert(o,"Missing index implementation for "+s),t===Rt){if(o.isDefinedOn(e.node)){for(var a=[],c=n.getIterator(ht.Wrap),u=c.getNext();u;)u.name!=e.name&&a.push(u),u=c.getNext();return a.push(e),Pt(a,o.getCompare())}return Rt}var l=n.get(e.name),h=t;return l&&(h=h.remove(new ht(e.name,l))),h.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(i.map(this.indexes_,function(t){if(t===Rt)return t;var r=n.get(e.name);return r?t.remove(new ht(e.name,r)):t}),this.indexSet_)},t}();function Ft(t,e){return k(t.name,e.name)}function Dt(t,e){return k(t,e)}var Nt=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&_t(this.priorityNode_),this.children_.isEmpty()&&i.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return St||(St=new t(new At(Dt),null,It.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||St},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?St:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(i.assert(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new ht(e,n),s=void 0,o=void 0;return n.isEmpty()?(s=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_)),new t(s,s.isEmpty()?St:this.priorityNode_,o)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;i.assert(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,s=!0;if(this.forEachChild(Ct,function(o,a){n[o]=a.val(e),r++,s&&t.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){var o=[];for(var a in n)o[a]=n[a];return o}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+mt(this.getPriority().val())+":"),this.forEachChild(Ct,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":g(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ht(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ht(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ht(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,ht.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,ht.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===jt?-1:0},t.prototype.withIndex=function(e){if(e===pt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===pt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Ct),r=e.getIterator(Ct),i=n.getNext(),s=r.getNext();i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=n.getNext(),s=r.getNext()}return null===i&&null===s}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===pt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),jt=new(function(t){function e(){return t.call(this,new At(Dt),Nt.EMPTY_NODE,It.Default)||this}return o.__extends(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Nt.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Nt));Object.defineProperties(ht,{MIN:{value:new ht(T,Nt.EMPTY_NODE)},MAX:{value:new ht(A,jt)}}),ft.__EMPTY_NODE=Nt.EMPTY_NODE,bt.__childrenNodeConstructor=Nt,function(t){$=t}(jt),function(t){vt=t}(jt);var Mt=!0;function Bt(t,e){if(void 0===e&&(e=null),null===t)return Nt.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),i.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new bt(t,Bt(e));if(t instanceof Array||!Mt){var n=Nt.EMPTY_NODE,r=t;return i.forEach(r,function(t,e){if(i.contains(r,t)&&"."!==t.substring(0,1)){var s=Bt(e);!s.isLeafNode()&&s.isEmpty()||(n=n.updateImmediateChild(t,s))}}),n.updatePriority(Bt(e))}var s=[],o=!1,a=t;if(i.forEach(a,function(t,e){if("string"!=typeof t||"."!==t.substring(0,1)){var n=Bt(a[t]);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),s.push(new ht(t,n)))}}),0==s.length)return Nt.EMPTY_NODE;var c=Pt(s,Ft,function(t){return t.name},Dt);if(o){var u=Pt(s,Ct.getCompare());return new Nt(c,Bt(e),new It({".priority":u},{".priority":Ct}))}return new Nt(c,Bt(e),It.Default)}!function(t){yt=t}(Bt);var Lt,Ht,qt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?k(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return ht.MIN},e.prototype.maxPost=function(){return ht.MAX},e.prototype.makePost=function(t,e){var n=Bt(t);return new ht(e,n)},e.prototype.toString=function(){return".value"},e}(dt)),Ut=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,i.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return o.__extends(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?k(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Bt(t),r=Nt.EMPTY_NODE.updateChild(this.indexPath_,n);return new ht(e,r)},e.prototype.maxPost=function(){var t=Nt.EMPTY_NODE.updateChild(this.indexPath_,jt);return new ht(A,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(dt),Vt=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return i.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return i.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return i.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return i.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){i.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),st("DataSnapshot.child",1,e,!1);var n=new H(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Ct)},t.prototype.hasChild=function(t){i.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),st("DataSnapshot.hasChild",1,t,!1);var e=new H(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return i.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return i.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),i.validateCallback("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),Ct))})},t.prototype.hasChildren=function(){return i.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return i.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return i.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Kt=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+i.stringify(this.snapshot.exportVal())},t}(),$t=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Wt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Kt("value",this,new Vt(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){i.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new $t(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),zt=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,i.contains(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new $t(this,t,e):null},t.prototype.createEvent=function(t,e){i.assert(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Kt(t.type,this,new Vt(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){i.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=i.getCount(e.callbacks_);if(n===i.getCount(this.callbacks_)){if(1===n){var r=i.getAnyKey(e.callbacks_),s=i.getAnyKey(this.callbacks_);return!(s!==r||e.callbacks_[r]&&this.callbacks_[s]&&e.callbacks_[r]!==this.callbacks_[s])}return i.every(this.callbacks_,function(t,n){return e.callbacks_[t]===n})}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Gt=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return i.assert(Lt,"Reference.ts has not been loaded"),Lt},set:function(t){Lt=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===pt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=T)throw new Error(r);if("string"!=typeof e)throw new Error(s)}if(t.hasEnd()){if(t.getIndexEndName()!=A)throw new Error(r);if("string"!=typeof n)throw new Error(s)}}else if(t.getIndex()===Ct){if(null!=e&&!X(e)||null!=n&&!X(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(i.assert(t.getIndex()instanceof Ut||t.getIndex()===qt,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return i.validateArgCount("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,s){i.validateArgCount("Query.on",2,4,arguments.length),rt("Query.on",1,e,!1),i.validateCallback("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,s);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[e]=n,this.onChildEvent(a,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Wt(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new zt(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){i.validateArgCount("Query.off",0,3,arguments.length),rt("Query.off",1,t,!0),i.validateCallback("Query.off",2,e,!0),i.validateContextObject("Query.off",3,n,!0);var r=null,s=null;"value"===t?r=new Wt(e||null,null,n||null):t&&(e&&((s={})[t]=e),r=new zt(s,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,s){var o=this;i.validateArgCount("Query.once",1,4,arguments.length),rt("Query.once",1,e,!1),i.validateCallback("Query.once",2,n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,s),c=!0,u=new i.Deferred;u.promise.catch(function(){});var l=function(t){c&&(c=!1,o.off(e,l),n&&n.bind(a.context)(t),u.resolve(t))};return this.on(e,l,function(t){o.off(e,l),a.cancel&&a.cancel.bind(a.context)(t),u.reject(t)}),u.promise},t.prototype.limitToFirst=function(e){if(i.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(i.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(i.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');st("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new H(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Ut(n),s=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(s),new t(this.repo,this.path,s,!0)},t.prototype.orderByKey=function(){i.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(pt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){i.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Ct);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){i.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(qt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),i.validateArgCount("Query.startAt",0,2,arguments.length),Z("Query.startAt",1,e,this.path,!0),it("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),i.validateArgCount("Query.endAt",0,2,arguments.length),Z("Query.endAt",1,e,this.path,!0),it("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(i.validateArgCount("Query.equalTo",1,2,arguments.length),Z("Query.equalTo",1,t,this.path,!1),it("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return i.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return i.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=R(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(i.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof t)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===e.repo,r=this.path.equals(e.path),s=this.queryIdentifier()===e.queryIdentifier();return n&&r&&s},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,i.validateCallback(t,3,r.cancel,!0),r.context=n,i.validateContextObject(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(i.errorPrefix(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Qt=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return i.contains(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return i.isEmpty(this.set)},t.prototype.count=function(){return i.getCount(this.set)},t.prototype.each=function(t){i.forEach(this.set,function(e,n){return t(e,n)})},t.prototype.keys=function(){var t=[];return i.forEach(this.set,function(e){t.push(e)}),t},t}(),Jt=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,n);else{null==this.children_&&(this.children_=new Qt);var r=e.getFront();this.children_.contains(r)||this.children_.add(r,new t);var i=this.children_.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(Ct,function(t,e){n.remember(new H(t),e)}),this.forget(t)}if(null!==this.children_){var r=t.getFront();if(t=t.popFront(),this.children_.contains(r))this.children_.get(r).forget(t)&&this.children_.remove(r);return!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(n,r){var i=new H(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,n){t(e,n)})},t}(),Yt=function(t,e){return t&&"object"==typeof t?(i.assert(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},Xt=function(t,e){var n,r=t.getPriority().val(),i=Yt(r,e);if(t.isLeafNode()){var s=t,o=Yt(s.getValue(),e);return o!==s.getValue()||i!==s.getPriority().val()?new bt(o,Bt(i)):t}var a=t;return n=a,i!==a.getPriority().val()&&(n=n.updatePriority(new bt(i))),a.forEachChild(Ct,function(t,r){var i=Xt(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Ht||(Ht={}));var Zt,te,ee=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,i.assert(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ne=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ht.ACK_USER_WRITE,this.source=ee.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return i.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new H(e));return new t(H.Empty,n,this.revert)}return i.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),re=function(){return Zt||(Zt=new At(O)),Zt},ie=function(){function t(t,e){void 0===e&&(e=re()),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return i.forEach(e,function(t,e){n=n.set(new H(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:H.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new H(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),s=this.children.insert(r,i);return new t(this.value,s)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),s=void 0;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&s.isEmpty()?t.Empty:new t(this.value,s)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),s=void 0;return s=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,s)},t.prototype.fold=function(t){return this.fold_(H.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,H.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),s=this.children.get(i);return s?s.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,H.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),s=this.children.get(i);return s?s.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(H.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),se=function(){function t(t,e){this.source=t,this.path=e,this.type=Ht.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,H.Empty):new t(this.source,this.path.popFront())},t}(),oe=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ht.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,H.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ae=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ht.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new H(e));return n.isEmpty()?null:n.value?new oe(this.source,H.Empty,n.value):new t(this.source,H.Empty,n)}return i.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),ce=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),ue=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new ce(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new ce(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new ce(Nt.EMPTY_NODE,!1,!1),new ce(Nt.EMPTY_NODE,!1,!1)),t}(),le=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),he=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,s,o){i.assert(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(le.childRemovedChange(e,a)):i.assert(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(le.childAddedChange(e,n)):o.trackChildChange(le.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ct,function(t,r){e.hasChild(t)||n.trackChildChange(le.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(Ct,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(le.childChangedChange(e,r,i))}else n.trackChildChange(le.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Nt.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),de=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;i.assert(e==le.CHILD_ADDED||e==le.CHILD_CHANGED||e==le.CHILD_REMOVED,"Only child changes supported for tracking"),i.assert(".priority"!==n,"Only non-priority child changes can be tracked.");var r=i.safeGet(this.changeMap_,n);if(r){var s=r.type;if(e==le.CHILD_ADDED&&s==le.CHILD_REMOVED)this.changeMap_[n]=le.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==le.CHILD_REMOVED&&s==le.CHILD_ADDED)delete this.changeMap_[n];else if(e==le.CHILD_REMOVED&&s==le.CHILD_CHANGED)this.changeMap_[n]=le.childRemovedChange(n,r.oldSnap);else if(e==le.CHILD_CHANGED&&s==le.CHILD_ADDED)this.changeMap_[n]=le.childAddedChange(n,t.snapshotNode);else{if(e!=le.CHILD_CHANGED||s!=le.CHILD_CHANGED)throw i.assertionError("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=le.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return i.getValues(this.changeMap_)},t}(),fe=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),pe=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ce(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),ge=function(){return function(t,e){this.viewCache=t,this.changes=e}}(),ye=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){i.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),i.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,s){var o,a,c=new de;if(n.type===Ht.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(e,u.path,u.snap,r,s,c):(i.assert(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),o=this.applyServerOverwrite_(e,u.path,u.snap,r,s,a,c))}else if(n.type===Ht.MERGE){var l=n;l.source.fromUser?o=this.applyUserMerge_(e,l.path,l.children,r,s,c):(i.assert(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,l.path,l.children,r,s,a,c))}else if(n.type===Ht.ACK_USER_WRITE){var h=n;o=h.revert?this.revertUserWrite_(e,h.path,r,s,c):this.ackUserWrite_(e,h.path,h.affectedTree,r,s,c)}else{if(n.type!==Ht.LISTEN_COMPLETE)throw i.assertionError("Unknown operation type: "+n.type);o=this.listenComplete_(e,n.path,r,c)}var d=c.getChanges();return t.maybeAddValueEvent_(e,o,d),new ge(o,d)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(le.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,s){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,c=void 0;if(e.isEmpty())if(i.assert(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),l=u instanceof Nt?u:Nt.EMPTY_NODE,h=n.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,s)}else{var d=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),d,s)}else{var f=e.getFront();if(".priority"==f){i.assert(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();c=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,p,c);a=null!=g?this.filter_.updatePriority(p,g):o.getNode()}else{var y=e.popFront(),v=void 0;if(o.isCompleteForChild(f)){c=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),c);v=null!=m?o.getNode().getImmediateChild(f).updateChild(y,m):o.getNode().getImmediateChild(f)}else v=n.calcCompleteChild(f,t.getServerCache());a=null!=v?this.filter_.updateChild(o.getNode(),f,v,y,r,s):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,s,o){var a,c=t.getServerCache(),u=s?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=u.updateFullNode(c.getNode(),n,null);else if(u.filtersNodes()&&!c.isFiltered()){var l=c.getNode().updateChild(e,n);a=u.updateFullNode(c.getNode(),l,null)}else{var h=e.getFront();if(!c.isCompleteForPath(e)&&e.getLength()>1)return t;var d=e.popFront(),f=c.getNode().getImmediateChild(h).updateChild(d,n);a=".priority"==h?u.updatePriority(c.getNode(),f):u.updateChild(c.getNode(),h,f,d,fe,null)}var p=t.updateServerSnap(a,c.isFullyInitialized()||e.isEmpty(),u.filtersNodes()),g=new pe(r,p,i);return this.generateEventCacheAfterServerEvent_(p,e,r,g,o)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,s){var o,a,c=t.getEventCache(),u=new pe(r,t,i);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,s),o=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var l=e.getFront();if(".priority"===l)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),o=t.updateEventSnap(a,c.isFullyInitialized(),c.isFiltered());else{var h=e.popFront(),d=c.getNode().getImmediateChild(l),f=void 0;if(h.isEmpty())f=n;else{var p=u.getCompleteChild(l);f=null!=p?".priority"===h.getBack()&&p.getChild(h.parent()).isEmpty()?p:p.updateChild(h,n):Nt.EMPTY_NODE}if(d.equals(f))o=t;else{var g=this.filter_.updateChild(c.getNode(),l,f,h,u,s);o=t.updateEventSnap(g,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,s,o){var a=this,c=e;return r.foreach(function(r,u){var l=n.child(r);t.cacheHasChild_(e,l.getFront())&&(c=a.applyUserOverwrite_(c,l,u,i,s,o))}),r.foreach(function(r,u){var l=n.child(r);t.cacheHasChild_(e,l.getFront())||(c=a.applyUserOverwrite_(c,l,u,i,s,o))}),c},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,s,o){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var c,u=t;c=e.isEmpty()?n:ie.Empty.setTree(e,n);var l=t.getServerCache().getNode();return c.children.inorderTraversal(function(e,n){if(l.hasChild(e)){var c=t.getServerCache().getNode().getImmediateChild(e),h=a.applyMerge_(c,n);u=a.applyServerOverwrite_(u,new H(e),h,r,i,s,o)}}),c.children.inorderTraversal(function(e,n){var c=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!l.hasChild(e)&&!c){var h=t.getServerCache().getNode().getImmediateChild(e),d=a.applyMerge_(h,n);u=a.applyServerOverwrite_(u,new H(e),d,r,i,s,o)}}),u},t.prototype.ackUserWrite_=function(t,e,n,r,i,s){if(null!=r.shadowingWrite(e))return t;var o=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,o,s);if(e.isEmpty()){var c=ie.Empty;return a.getNode().forEachChild(pt,function(t,e){c=c.set(new H(t),e)}),this.applyServerMerge_(t,e,c,r,i,o,s)}return t}var u=ie.Empty;return n.foreach(function(t,n){var r=e.child(t);a.isCompleteForPath(r)&&(u=u.set(t,a.getNode().getChild(r)))}),this.applyServerMerge_(t,e,u,r,i,o,s)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),s=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(s,e,n,fe,r)},t.prototype.revertUserWrite_=function(t,e,n,r,s){var o;if(null!=n.shadowingWrite(e))return t;var a=new pe(n,t,r),c=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var l=void 0;if(t.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();i.assert(h instanceof Nt,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(h)}l=l,u=this.filter_.updateFullNode(c,l,s)}else{var d=e.getFront(),f=n.calcCompleteChild(d,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(d)&&(f=c.getImmediateChild(d)),(u=null!=f?this.filter_.updateChild(c,d,f,e.popFront(),a,s):t.getEventCache().getNode().hasChild(d)?this.filter_.updateChild(c,d,Nt.EMPTY_NODE,e.popFront(),a,s):c).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,s))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(H.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},t}(),ve=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],s=[];return t.forEach(function(t){t.type===le.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(le.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,le.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,le.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,le.CHILD_MOVED,s,n,e),this.generateEventsForType_(i,le.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,le.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var s=this,o=n.filter(function(t){return t.type===e});o.sort(this.compareChanges_.bind(this)),o.forEach(function(e){var n=s.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,s.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw i.assertionError("Should only compare child_ events.");var n=new ht(t.childName,t.snapshotNode),r=new ht(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),me=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new he(n.getIndex()),i=n.getNodeFilter();this.processor_=new ye(i);var s=e.getServerCache(),o=e.getEventCache(),a=r.updateFullNode(Nt.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Nt.EMPTY_NODE,o.getNode(),null),u=new ce(a,s.isFullyInitialized(),r.filtersNodes()),l=new ce(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=new ue(l,u),this.eventGenerator_=new ve(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){i.assert(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var s=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){s=s.concat(this.eventRegistrations_.slice(o+1));break}}else s.push(a)}this.eventRegistrations_=s}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Ht.MERGE&&null!==t.source.queryId&&(i.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),i.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,s=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(s.viewCache),i.assert(s.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=s.viewCache,this.generateEventsForChanges_(s.changes,s.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Ct,function(t,e){n.push(le.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(le.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),_e=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return i.assert(te,"Reference.ts has not been loaded"),te},set:function(t){i.assert(!te,"__referenceConstructor has already been defined"),te=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return i.isEmpty(this.views_)},t.prototype.applyOperation=function(t,e,n){var r=t.source.queryId;if(null!==r){var s=i.safeGet(this.views_,r);return i.assert(null!=s,"SyncTree gave us an op for an invalid query."),s.applyOperation(t,e,n)}var o=[];return i.forEach(this.views_,function(r,i){o=o.concat(i.applyOperation(t,e,n))}),o},t.prototype.addEventRegistration=function(t,e,n,r,s){var o=t.queryIdentifier(),a=i.safeGet(this.views_,o);if(!a){var c=n.calcCompleteEventCache(s?r:null),u=!1;c?u=!0:r instanceof Nt?(c=n.calcCompleteEventChildren(r),u=!1):(c=Nt.EMPTY_NODE,u=!1);var l=new ue(new ce(c,u,!1),new ce(r,s,!1));a=new me(t,l),this.views_[o]=a}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var s=e.queryIdentifier(),o=[],a=[],c=this.hasCompleteView();if("default"===s){var u=this;i.forEach(this.views_,function(t,e){a=a.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete u.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var l=i.safeGet(this.views_,s);l&&(a=a.concat(l.removeEventRegistration(n,r)),l.isEmpty()&&(delete this.views_[s],l.getQuery().getQueryParams().loadsAllData()||o.push(l.getQuery())))}return c&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:a}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return i.forEach(this.views_,function(n,r){e=e||r.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return i.safeGet(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){return i.findValue(this.views_,function(t){return t.getQuery().getQueryParams().loadsAllData()})||null},t}(),be=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new ie(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,s=r.value,o=H.relativePath(i,e);return s=s.updateChild(o,n),new t(this.writeTree_.set(i,s))}var a=new ie(n);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this;return i.forEach(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,ie.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(H.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ct,function(e,n){t.push(new ht(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new ht(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new ie(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(H.Empty,this.writeTree_,e)},t.Empty=new t(new ie(null)),t.applySubtreeWrite_=function(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var s=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(i.assert(null!==o.value,"Priority writes must always be leaf nodes"),s=o.value):r=t.applySubtreeWrite_(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===s||(r=r.updateChild(e.child(".priority"),s)),r},t}(),we=function(){function t(){this.visibleWrites_=be.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Se(t,this)},t.prototype.addOverwrite=function(t,e,n,r){i.assert(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){i.assert(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});i.assert(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var s=r.visible,o=!1,a=this.allWrites_.length-1;s&&a>=0;){var c=this.allWrites_[a];c.visible&&(a>=n&&this.recordContainsPath_(c,r.path)?s=!1:r.path.contains(c.path)&&(o=!0)),a--}if(s){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var u=r.children;i.forEach(u,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var s=this.visibleWrites_.childCompoundWrite(e);if(!i&&s.isEmpty())return n;if(i||null!=n||s.hasCompleteWrite(H.Empty)){var o=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);u=n||Nt.EMPTY_NODE;return o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var c=this.visibleWrites_.childCompoundWrite(e);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite(H.Empty)){var u=n||Nt.EMPTY_NODE;return c.apply(u)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Nt.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ct,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ct,function(t,e){var r=i.childCompoundWrite(new H(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){i.assert(n||r,"Either existingEventSnap or existingServerSnap must exist");var s=t.child(e);if(this.visibleWrites_.hasCompleteWrite(s))return null;var o=this.visibleWrites_.childCompoundWrite(s);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,s){var o,a=this.visibleWrites_.childCompoundWrite(t),c=a.getCompleteNode(H.Empty);if(null!=c)o=c;else{if(null==e)return[];o=a.apply(e)}if((o=o.withIndex(s)).isEmpty()||o.isLeafNode())return[];for(var u=[],l=s.getCompare(),h=i?o.getReverseIteratorFrom(n,s):o.getIteratorFrom(n,s),d=h.getNext();d&&u.length<r;)0!==l(d,n)&&u.push(d),d=h.getNext();return u},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!i.findKey(t.children,function(n,r){return t.path.child(r).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,H.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=be.Empty,s=0;s<t.length;++s){var o=t[s];if(e(o)){var a=o.path,c=void 0;if(o.snap)n.contains(a)?(c=H.relativePath(n,a),r=r.addWrite(c,o.snap)):a.contains(n)&&(c=H.relativePath(a,n),r=r.addWrite(H.Empty,o.snap.getChild(c)));else{if(!o.children)throw i.assertionError("WriteRecord should have .snap or .children");if(n.contains(a))c=H.relativePath(n,a),r=r.addWrites(c,o.children);else if(a.contains(n))if((c=H.relativePath(a,n)).isEmpty())r=r.addWrites(H.Empty,o.children);else{var u=i.safeGet(o.children,c.getFront());if(u){var l=u.getChild(c.popFront());r=r.addWrite(H.Empty,l)}}}}}return r},t}(),Se=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Ce=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=ie.Empty,this.pendingWriteTree_=new we,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new oe(ee.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=ie.fromObject(e);return this.applyOperationToSyncPoints_(new ae(ee.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=ie.Empty;return null!=n.snap?r=r.set(H.Empty,!0):i.forEach(n.children,function(t,e){r=r.set(new H(t),e)}),this.applyOperationToSyncPoints_(new ne(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new oe(ee.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=ie.fromObject(e);return this.applyOperationToSyncPoints_(new ae(ee.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new se(ee.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var s=t.parseQueryKey_(i),o=s.path,a=s.queryId,c=H.relativePath(o,e),u=new oe(ee.forServerTaggedQuery(a),c,n);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var s=t.parseQueryKey_(i),o=s.path,a=s.queryId,c=H.relativePath(o,e),u=ie.fromObject(n),l=new ae(ee.forServerTaggedQuery(a),c,u);return this.applyTaggedOperation_(o,l)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),s=i.path,o=i.queryId,a=H.relativePath(s,e),c=new se(ee.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(s,c)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,s=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=H.relativePath(t,r);s=s||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var a,c=this.syncPointTree_.get(r);(c?(o=o||c.hasCompleteView(),s=s||c.getCompleteServerCache(H.Empty)):(c=new _e,this.syncPointTree_=this.syncPointTree_.set(r,c)),null!=s)?a=!0:(a=!1,s=Nt.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(H.Empty);n&&(s=s.updateImmediateChild(t,n))}));var u=c.viewExistsForQuery(e);if(!u&&!e.getQueryParams().loadsAllData()){var l=t.makeQueryKey_(e);i.assert(!(l in this.queryToTagMap_),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap_[l]=h,this.tagToQueryMap_["_"+h]=l}var d=this.pendingWriteTree_.childWrites(r),f=c.addEventRegistration(e,n,d,s,a);if(!u&&!o){var p=c.viewForQuery(e);f=f.concat(this.setupListener_(e,p))}return f},t.prototype.removeEventRegistration=function(e,n,r){var i=this,s=e.path,o=this.syncPointTree_.get(s),a=[];if(o&&("default"===e.queryIdentifier()||o.viewExistsForQuery(e))){var c=o.removeEventRegistration(e,n,r);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(s));var u=c.removed;a=c.events;var l=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(s,function(t,e){return e.hasCompleteView()});if(l&&!h){var d=this.syncPointTree_.subtree(s);if(!d.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(d),p=0;p<f.length;++p){var g=f[p],y=g.getQuery(),v=this.createListenerForView_(g);this.listenProvider_.startListening(t.queryForListening_(y),this.tagForQuery_(y),v.hashFn,v.onComplete)}}if(!h&&u.length>0&&!r)if(l){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else u.forEach(function(e){var n=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),n)});this.removeTags_(u)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=H.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),i.forEach(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),s=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+s]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,s=this.tagForQuery_(e),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(t.queryForListening_(e),s,o.hashFn,o.onComplete),c=this.syncPointTree_.subtree(r);if(s)i.assert(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=c.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),i.forEach(n,function(t,e){r=r.concat(e)}),r}),l=0;l<u.length;++l){var h=u[l];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return a},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Nt.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return i.assert(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new H(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return i.safeGet(this.queryToTagMap_,n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);i.assert(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(H.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(H.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(H.Empty));var s=[],o=t.path.getFront(),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){var u=n?n.getImmediateChild(o):null,l=r.child(o);s=s.concat(this.applyOperationHelper_(a,c,u,l))}return i&&(s=s.concat(i.applyOperation(t,r,n))),s},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,s=e.get(H.Empty);null==n&&null!=s&&(n=s.getCompleteServerCache(H.Empty));var o=[];return e.children.inorderTraversal(function(e,s){var a=n?n.getImmediateChild(e):null,c=r.child(e),u=t.operationForChild(e);u&&(o=o.concat(i.applyOperationDescendantsHelper_(u,s,a,c)))}),s&&(o=o.concat(s.applyOperation(t,r,n))),o},t.nextQueryTag_=1,t}(),Ee=function(){function t(){this.rootNode_=Nt.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),xe=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(b("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',E(t)},t}(),Te=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),i.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return i.deepCopy(this.counters_)},t}(),Ae=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Te),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),ke=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=i.clone(t);return this.last_&&i.forEach(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),Oe=1e4,Pe=3e4,Re=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new ke(t);var n=Oe+(Pe-Oe)*Math.random();L(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;i.forEach(e,function(e,s){s>0&&i.contains(t.statsToReport_,e)&&(n[e]=s,r=!0)}),r&&this.server_.reportStats(n),L(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Ie=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Fe(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Fe=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();v&&b("event: "+e.toString()),M(n)}}},t.prototype.getPath=function(){return this.path_},t}(),De=function(){function t(t){this.allowedEvents_=t,this.listeners_={},i.assert(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){i.assert(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),Ne=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return o.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return i.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(De),je=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||i.isMobileCordova()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return o.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return i.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(De),Me=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&M(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},t}(),Be="pLPCommand",Le="pRTLPCB",He=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=w(t),this.stats_=Ae.getCollection(e),this.urlFn=function(t){return e.connectionURL(U,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Me(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(i.isNodeSdk()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new qe(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1],s=t[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=s;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),!i.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!i.isNodeSdk()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=i.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=i.base64Encode(e),r=I(n,1840),s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!i.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=i.stringify(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),qe=function(){function t(e,n,r,s){if(this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Qt,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,i.isNodeSdk())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=p(),window[Be+this.uniqueCallbackIdentifier]=e,window[Le+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(t){b("frame writing exception"),t.stack&&b(t.stack),b(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||b("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),i.isNodeSdk()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);t.nodeRestRequest(r)}var s=this.onDisconnect;s&&(this.onDisconnect=null,s())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;i.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){b("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},t}(),Ue=null;"undefined"!=typeof MozWebSocket?Ue=MozWebSocket:"undefined"!=typeof WebSocket&&(Ue=WebSocket);var Ve=function(){function t(e,n,r,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=w(this.connId),this.stats_=Ae.getCollection(n),this.connURL=t.connectionURL_(n,r,i)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!i.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(i.isNodeSdk()){var s=i.CONSTANTS.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+a.SDK_VERSION+"/"+r.platform+"/"+s}},c=r.env,u=0==this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;u&&(o.proxy={origin:u}),this.mySock=new Ue(this.connURL,[],o)}else this.mySock=new Ue(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var l=t.message||t.data;return l&&this.log_(l),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ue&&!t.forceDisallow_},t.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=i.jsonEval(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(i.assert(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=i.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=I(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Ke=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[He,Ve]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n=Ve&&Ve.isAvailable(),r=n&&!Ve.previouslyFailed();if(e.webSocketOnly&&(n||E("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Ve];else{var i=this.transports_=[];F(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),$e=function(){function t(t,e,n,r,i,s,o){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=s,this.lastSessionId=o,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=w("c:"+this.id+":"),this.transportManager_=new Ke(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=L(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=P("t",t),n=P("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=P("t",t),n=P("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=P("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?S("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&E("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),L(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):L(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),We=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),ze=1e3,Ge=3e5,Qe=function(t){function e(n,r,s,o,a,c){var u=t.call(this)||this;if(u.repoInfo_=n,u.onDataUpdate_=r,u.onConnectStatus_=s,u.onServerInfoUpdate_=o,u.authTokenProvider_=a,u.authOverride_=c,u.id=e.nextPersistentConnectionId_++,u.log_=w("p:"+u.id+":"),u.interruptReasons_={},u.listens_={},u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=ze,u.maxReconnectDelay_=Ge,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,c&&!i.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),Ne.getInstance().on("visible",u.onVisible_,u),-1===n.host.indexOf("fblocal")&&je.getInstance().on("online",u.onOnline_,u),u}return o.__extends(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,s={r:r,a:t,b:e};this.log_(i.stringify(s)),i.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var s=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+s),this.listens_[o]=this.listens_[o]||{},i.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),i.assert(!this.listens_[o][s],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[o][s]=a,this.connected_&&this.sendListen_(a)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),s=r.queryIdentifier();this.log_("Listen on "+i+" for "+s);var o={p:i};t.tag&&(o.q=r.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,function(o){var a=o.d,c=o.s;e.warnOnListenWarnings_(a,r),(n.listens_[i]&&n.listens_[i][s])===t&&(n.log_("listen response",o),"ok"!==c&&n.removeListen_(i,s),t.onComplete&&t.onComplete(c,a))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&i.contains(t,"w")){var n=i.safeGet(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',s=e.path.toString();E("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+s+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||i.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=i.isValidFormat(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),i.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var s={p:e,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:t,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+i.stringify(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):S("Unrecognized action received from server: "+i.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;i.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ze),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+e.nextConnectionId_++,o=this,a=this.lastSessionId,c=!1,u=null,l=function(){u?u.close():(c=!0,r())};this.realtime_={close:l,sendRequest:function(t){i.assert(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then(function(e){c?b("getToken() completed but was canceled"):(b("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,u=new $e(s,o.repoInfo_,t,n,r,function(t){E(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),c||(i.CONSTANTS.NODE_ADMIN&&E(t),l())})}},e.prototype.interrupt=function(t){b("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){b("Resuming connection for reason: "+t),delete this.interruptReasons_[t],i.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return R(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new H(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===i.getCount(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},e.prototype.onAuthRevoked_=function(t,e){b("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t=this;this.tryAuth(),i.forEach(this.listens_,function(e,n){i.forEach(n,function(e,n){t.sendListen_(n)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";i.CONSTANTS.NODE_ADMIN?e="admin_node":i.CONSTANTS.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+a.SDK_VERSION.replace(/\./g,"-")]=1,i.isMobileCordova()?t["framework.cordova"]=1:i.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=je.getInstance().currentlyOnline();return i.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(We),Je=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=w("p:rest:"),i.listens_={},i}return o.__extends(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(i.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,s){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var c=e.getListenId_(t,r),u={};this.listens_[c]=u;var l=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",l,function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(a,n,!1,r),i.safeGet(o.listens_,c)===u)&&s(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(s){var o=s&&s.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?"+i.querystring(e);r.log_("Sending REST request for "+a);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);var t=null;if(c.status>=200&&c.status<300){try{t=i.jsonEval(c.responseText)}catch(t){E("Failed to parse JSON response for "+a+": "+c.responseText)}n(null,t)}else 401!==c.status&&404!==c.status&&E("Got unsuccessful REST response for "+a+" Status: "+c.status),n(c.status);n=null}},c.open("GET",a,!0),c.send()})},e}(We),Ye=function(){function t(t,e,n){var r=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ie,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Jt,this.persistentConnection_=null;var s=new xe(n);if(this.stats_=Ae.getCollection(t),e||B())this.server_=new Je(this.repoInfo_,this.onDataUpdate_.bind(this),s),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(void 0!==o&&null!==o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{i.stringify(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Qe(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),s,o),this.server_=this.persistentConnection_}s.addTokenChangeListener(function(t){r.server_.refreshAuthToken(t)}),this.statsReporter_=Ae.getOrCreateReporter(t,function(){return new Re(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new Ee,this.infoSyncTree_=new Ce({startListening:function(t,e,n,i){var s=[],o=r.infoData_.getNode(t.path);return o.isEmpty()||(s=r.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){i("ok")},0)),s},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ce({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,function(e,n){var s=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,s)}),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new H(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var s=new H(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=i.map(e,function(t){return Bt(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(s,a,r)}else{var c=Bt(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(s,c,r)}else if(n){var u=i.map(e,function(t){return Bt(t)});o=this.serverSyncTree_.applyServerMerge(s,u)}else{var l=Bt(e);o=this.serverSyncTree_.applyServerOverwrite(s,l)}var h=s;o.length>0&&(h=this.rerunTransactions_(s)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;F(t,function(t,n){e.updateInfo_(n,t)})},t.prototype.updateInfo_=function(t,e){var n=new H("/.info/"+t),r=Bt(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var s=this.generateServerValues(),o=Bt(e,n),a=Xt(o,s),c=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserOverwrite(t,a,c,!0);this.eventQueue_.queueEvents(u),this.server_.put(t.toString(),o.val(!0),function(e,n){var s="ok"===e;s||E("set at "+t+" failed: "+e);var o=i.serverSyncTree_.ackUserWrite(c,!s);i.eventQueue_.raiseEventsForChangedPath(t,o),i.callOnCompleteCallback(r,e,n)});var l=this.abortTransactions_(t);this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(l,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var s=!0,o=this.generateServerValues(),a={};if(i.forEach(e,function(t,e){s=!1;var n=Bt(e);a[t]=Xt(n,o)}),s)b("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var c=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,c);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var s="ok"===e;s||E("update at "+t+" failed: "+e);var o=r.serverSyncTree_.ackUserWrite(c,!s),a=o.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(a,o),r.callOnCompleteCallback(n,e,i)}),i.forEach(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=[];(function(t,e){var n=new Jt;return t.forEachTree(new H(""),function(t,r){n.remember(t,Xt(r,e))}),n})(this.onDisconnect_,e).forEachTree(H.Empty,function(e,r){n=n.concat(t.serverSyncTree_.applyServerOverwrite(e,r));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new Jt,this.eventQueue_.raiseEventsForChangedPath(H.Empty,n)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Bt(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,s){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,s)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,s=Bt(e,n);this.server_.onDisconnectPut(t.toString(),s.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,s),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(i.isEmpty(e))return b("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(s,o){"ok"===s&&i.forEach(e,function(e,n){var i=Bt(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,s,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new ke(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);i.forEach(e,function(t,e){for(var r=t.length;r<n+2;r++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),b.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&M(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var s=new Error(i);s.code=r,t(s)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new cn(this))},enumerable:!0,configurable:!0}),t}(),Xe=function(){function t(e){this.indexedFilter_=new he(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,s){return this.matches(new ht(e,n))||(n=Nt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,s)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Nt.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Nt.EMPTY_NODE);var i=this;return e.forEachChild(Ct,function(t,e){i.matches(new ht(t,e))||(r=r.updateImmediateChild(t,Nt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),Ze=function(){function t(t){this.rangedFilter_=new Xe(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,s){return this.rangedFilter_.matches(new ht(e,n))||(n=Nt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,s):this.fullLimitUpdateChild_(t,e,n,i,s)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Nt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Nt.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var s=0;i.hasNext()&&s<this.limit_;){var o=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(o.name,o.node),s++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Nt.EMPTY_NODE);var a=void 0,c=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();u=function(t,e){return l(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();s=0;for(var h=!1;i.hasNext();){o=i.getNext();!h&&u(a,o)<=0&&(h=!0),h&&s<this.limit_&&u(o,c)<=0?s++:r=r.updateImmediateChild(o.name,Nt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,s){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var c=t;i.assert(c.numChildren()==this.limit_,"");var u=new ht(e,n),l=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(c.hasChild(e)){for(var d=c.getImmediateChild(e),f=r.getChildAfterChild(this.index_,l,this.reverse_);null!=f&&(f.name==e||c.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&p>=0)return null!=s&&s.trackChildChange(le.childChangedChange(e,n,d)),c.updateImmediateChild(e,n);null!=s&&s.trackChildChange(le.childRemovedChange(e,d));var g=c.updateImmediateChild(e,Nt.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=s&&s.trackChildChange(le.childAddedChange(f.name,f.node)),g.updateImmediateChild(f.name,f.node)):g}return n.isEmpty()?t:h&&o(l,u)>=0?(null!=s&&(s.trackChildChange(le.childRemovedChange(l.name,l.node)),s.trackChildChange(le.childAddedChange(e,n))),c.updateImmediateChild(e,n).updateImmediateChild(l.name,Nt.EMPTY_NODE)):t},t}(),tn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ct}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return i.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return i.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:T},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return i.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return i.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:A},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return i.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==Ct&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ct},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new he(this.getIndex()):this.hasLimit()?new Ze(this):new Xe(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===Ct?e=n.PRIORITY_INDEX:this.index_===qt?e=n.VALUE_INDEX:this.index_===pt?e=n.KEY_INDEX:(i.assert(this.index_ instanceof Ut,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=i.stringify(e),this.startSet_&&(r[n.START_AT]=i.stringify(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+i.stringify(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=i.stringify(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+i.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),en=function(t){function e(e,n){if(!(e instanceof Ye))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,tn.DEFAULT,!1)||this}return o.__extends(e,t),e.prototype.getKey=function(){return i.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return i.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof H||(null===this.path.getFront()?function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),st(t,e,n,r)}("Reference.child",1,t,!1):st("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){i.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){i.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){i.validateArgCount("Reference.set",1,2,arguments.length),ot("Reference.set",this.path),Z("Reference.set",1,t,this.path,!1),i.validateCallback("Reference.set",2,e,!0);var n=new i.Deferred;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(i.validateArgCount("Reference.update",1,2,arguments.length),ot("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,E("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}et("Reference.update",1,t,this.path,!1),i.validateCallback("Reference.update",2,e,!0);var s=new i.Deferred;return this.repo.update(this.path,t,s.wrapCallback(e)),s.promise},e.prototype.setWithPriority=function(t,e,n){if(i.validateArgCount("Reference.setWithPriority",2,3,arguments.length),ot("Reference.setWithPriority",this.path),Z("Reference.setWithPriority",1,t,this.path,!1),nt("Reference.setWithPriority",2,e,!1),i.validateCallback("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new i.Deferred;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return i.validateArgCount("Reference.remove",0,1,arguments.length),ot("Reference.remove",this.path),i.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(i.validateArgCount("Reference.transaction",1,3,arguments.length),ot("Reference.transaction",this.path),i.validateCallback("Reference.transaction",1,t,!1),i.validateCallback("Reference.transaction",2,e,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(i.errorPrefix(t,e,r)+"must be a boolean.")}("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new i.Deferred;"function"==typeof e&&r.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new ut(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){i.validateArgCount("Reference.setPriority",1,2,arguments.length),ot("Reference.setPriority",this.path),nt("Reference.setPriority",1,t,!1),i.validateCallback("Reference.setPriority",2,e,!0);var n=new i.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){i.validateArgCount("Reference.push",0,2,arguments.length),ot("Reference.push",this.path),Z("Reference.push",1,t,this.path,!0),i.validateCallback("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),s=lt(r),o=this.child(s),a=this.child(s);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},e.prototype.onDisconnect=function(){return ot("Reference.onDisconnect",this.path),new ct(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Gt);Gt.__referenceConstructor=en,_e.__referenceConstructor=en;var nn,rn=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),sn=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new rn),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n,r=e instanceof H?e:new H(e),s=this;null!==(n=r.getFront());){s=new t(n,s,i.safeGet(s.node_.children,n)||new rn),r=r.popFront()}return s},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){i.assert(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;i.forEach(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new H(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=i.contains(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(nn||(nn={})),Ye.MAX_TRANSACTION_RETRIES_=25,Ye.prototype.transactions_init_=function(){this.transactionQueueTree_=new sn},Ye.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var s=function(){},o=new en(this,t);o.on("value",s);var a={path:t,update:e,onComplete:n,status:null,order:p(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",s)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=this.getLatestState_(t);a.currentInputSnapshot=c;var u=a.update(c.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var l=new Vt(a.currentInputSnapshot,new en(this,a.path),Ct);a.onComplete(null,!1,l)}}else{tt("transaction failed: Data returned ",u,a.path),a.status=nn.RUN;var h=this.transactionQueueTree_.subTree(t),d=h.getValue()||[];d.push(a),h.setValue(d);var f=void 0;if("object"==typeof u&&null!==u&&i.contains(u,".priority"))f=i.safeGet(u,".priority"),i.assert(X(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||Nt.EMPTY_NODE).getPriority().val();f=f;var g=this.generateServerValues(),y=Bt(u,f),v=Xt(y,g);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,v,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Ye.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Nt.EMPTY_NODE},Ye.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);i.assert(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return t.status===nn.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Ye.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),s=this.getLatestState_(t,r),o=s,a=s.hash(),c=0;c<e.length;c++){var u=e[c];i.assert(u.status===nn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=nn.SENT,u.retryCount++;var l=H.relativePath(t,u.path);o=o.updateChild(l,u.currentOutputSnapshotRaw)}var h=o.val(!0),d=t;this.server_.put(d.toString(),h,function(r){n.log_("transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var s=[],o=0;o<e.length;o++){if(e[o].status=nn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[o].currentWriteId)),e[o].onComplete){var a=e[o].currentOutputSnapshotResolved,c=new en(n,e[o].path),u=new Vt(a,c,Ct);s.push(e[o].onComplete.bind(null,null,!0,u))}e[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(o=0;o<s.length;o++)M(s[o])}else{if("datastale"===r)for(o=0;o<e.length;o++)e[o].status===nn.SENT_NEEDS_ABORT?e[o].status=nn.NEEDS_ABORT:e[o].status=nn.RUN;else{E("transaction at "+d.toString()+" failed: "+r);for(o=0;o<e.length;o++)e[o].status=nn.NEEDS_ABORT,e[o].abortReason=r}n.rerunTransactions_(t)}},a)},Ye.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Ye.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n=[],r=[],s=t.filter(function(t){return t.status===nn.RUN}).map(function(t){return t.currentWriteId}),o=0;o<t.length;o++){var a=t[o],c=H.relativePath(e,a.path),u=!1,l=void 0;if(i.assert(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===nn.NEEDS_ABORT)u=!0,l=a.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===nn.RUN)if(a.retryCount>=Ye.MAX_TRANSACTION_RETRIES_)u=!0,l="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var h=this.getLatestState_(a.path,s);a.currentInputSnapshot=h;var d=t[o].update(h.val());if(void 0!==d){tt("transaction failed: Data returned ",d,a.path);var f=Bt(d);"object"==typeof d&&null!=d&&i.contains(d,".priority")||(f=f.updatePriority(h.getPriority()));var p=a.currentWriteId,g=this.generateServerValues(),y=Xt(f,g);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(p),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(a.path,y,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(p,!0))}else u=!0,l="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],u&&(t[o].status=nn.COMPLETED,function(t){setTimeout(t,Math.floor(0))}(t[o].unwatcher),t[o].onComplete))if("nodata"===l){var v=new en(this,t[o].path),m=t[o].currentInputSnapshot,_=new Vt(m,v,Ct);n.push(t[o].onComplete.bind(null,null,!1,_))}else n.push(t[o].onComplete.bind(null,new Error(l),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(o=0;o<n.length;o++)M(n[o]);this.sendReadyTransactions_()}},Ye.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Ye.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Ye.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Ye.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==nn.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Ye.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Ye.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],s=-1,o=0;o<e.length;o++)if(e[o].status===nn.SENT_NEEDS_ABORT);else if(e[o].status===nn.SENT)i.assert(s===o-1,"All SENT items should be at beginning of queue."),s=o,e[o].status=nn.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(i.assert(e[o].status===nn.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===s?t.setValue(null):e.length=s+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)M(n[o])}};var on,an=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return on||(on=new t),on},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options.databaseURL;void 0===n&&C("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r=W(n),i=r.repoInfo;return at("Invalid Firebase Database URL",1,r),r.path.isEmpty()||C("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=i.safeGet(this.repos_,t.app.name);e&&i.safeGet(e,t.repoInfo_.toURLString())===t||C("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=i.safeGet(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=i.safeGet(n,t.toURLString());return r&&C("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ye(t,this.useRestClient_,e),n[t.toURLString()]=r,r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),cn=function(){function t(t){this.repo_=t,t instanceof Ye||C("Don't call new Database() directly - please use firebase.database()."),this.root_=new en(t,H.Empty),this.INTERNAL=new un(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),i.validateArgCount("database.ref",0,1,arguments.length),t instanceof en?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),i.validateArgCount(e,1,1,arguments.length);var n=W(t);at(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&C(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&C("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){i.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){i.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),un=function(){function t(t){this.database=t}return t.prototype.delete=function(){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(t){return this.database.checkDeleted_("delete"),an.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),ln=Object.freeze({forceLongPolling:function(){Ve.forceDisallow(),He.forceAllow()},forceWebSockets:function(){He.forceDisallow()},isWebSocketsAvailable:function(){return Ve.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),hn=Qe;Qe.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Qe.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var dn=$e,fn=V,pn=Object.freeze({DataConnection:hn,RealTimeConnection:dn,hijackHash:function(t){var e=Qe.prototype.put;return Qe.prototype.put=function(n,r,i,s){void 0!==s&&(s=t()),e.call(this,n,r,i,s)},function(){Qe.prototype.put=e}},ConnectionTarget:fn,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){an.getInstance().forceRestClient(t)}}),gn=cn.ServerValue;function yn(e){var n=e.INTERNAL.registerService("database",function(t,e,n){return an.getInstance().databaseFromApp(t,n)},{Reference:en,Query:Gt,Database:cn,enableLogging:_,INTERNAL:ln,ServerValue:gn,TEST_ACCESS:pn},null,!0);i.isNodeSdk()&&(t.exports=n)}yn(a),e.registerDatabase=yn,e.Database=cn,e.Query=Gt,e.Reference=en,e.enableLogging=_,e.ServerValue=gn,e.DataSnapshot=Vt,e.OnDisconnect=ct}).call(this,n(47))},function(t,e,n){"use strict";n.r(e),n.d(e,"setLogLevel",function(){return c}),n.d(e,"Logger",function(){return a}),n.d(e,"LogLevel",function(){return r});var r,i=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(r||(r={}));var s=r.INFO,o=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var s=(new Date).toISOString();switch(e){case r.DEBUG:case r.VERBOSE:console.log.apply(console,["["+s+"]  "+t.name+":"].concat(n));break;case r.INFO:console.info.apply(console,["["+s+"]  "+t.name+":"].concat(n));break;case r.WARN:console.warn.apply(console,["["+s+"]  "+t.name+":"].concat(n));break;case r.ERROR:console.error.apply(console,["["+s+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},a=function(){function t(t){this.name=t,this._logLevel=s,this._logHandler=o,i.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.ERROR].concat(t))},t}();function c(t){i.forEach(function(e){e.logLevel=t})}},function(t,e,n){"use strict";n.r(e);n(64)},function(t,e,n){"use strict";n.r(e),n.d(e,"registerStorage",function(){return Wt});var r=n(57),i=n.n(r),s="https://firebasestorage.googleapis.com",o="https://firebasestorage.googleapis.com",a="/v0",c="/v0",u=12e4,l=6e4,h=-9007199254740991,d=function(){function t(t,e){this.code_=p(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return p(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),f={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function p(t){return"storage/"+t}function g(){return new d(f.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function y(){return new d(f.CANCELED,"User canceled the upload/download.")}function v(){return new d(f.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function m(t,e,n){return new d(f.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function _(){return new d(f.APP_DELETED,"The Firebase app was deleted.")}function b(t,e){return new d(f.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function w(t){throw new d(f.INTERNAL_ERROR,"Internal error: "+t)}var S={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function C(t){switch(t){case S.RAW:case S.BASE64:case S.BASE64URL:case S.DATA_URL:return;default:throw"Expected one of the event types: ["+S.RAW+", "+S.BASE64+", "+S.BASE64URL+", "+S.DATA_URL+"]."}}var E=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function x(t,e){switch(t){case S.RAW:return new E(T(e));case S.BASE64:case S.BASE64URL:return new E(A(t,e));case S.DATA_URL:return new E(function(t){var e=new k(t);return e.base64?A(S.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw b(S.DATA_URL,"Malformed data URL.")}return T(e)}(e.rest)}(e),function(t){return new k(t).contentType}(e))}throw g()}function T(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function A(t,e){switch(t){case S.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw b(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case S.BASE64URL:var i=-1!==e.indexOf("+"),s=-1!==e.indexOf("/");if(i||s)throw b(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var o;try{o=atob(e)}catch(e){throw b(t,"Invalid character found")}for(var a=new Uint8Array(o.length),c=0;c<o.length;c++)a[c]=o.charCodeAt(c);return a}var k=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw b(S.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)}}();var O,P={STATE_CHANGED:"state_changed"},R={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},I={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function F(t){switch(t){case R.RUNNING:case R.PAUSING:case R.CANCELING:return I.RUNNING;case R.PAUSED:return I.PAUSED;case R.SUCCESS:return I.SUCCESS;case R.CANCELED:return I.CANCELED;case R.ERROR:default:return I.ERROR}}function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function N(t,e){for(var n in t)D(t,n)&&e(n,t[n])}function j(t){if(null==t)return{};var e={};return N(t,function(t,n){e[t]=n}),e}function M(t){return new Promise(t)}function B(t){return Promise.resolve(t)}function L(t){return null!=t}function H(t){return void 0!==t}function q(t){return"function"==typeof t}function U(t){return"object"==typeof t}function V(t){return U(t)&&null!==t}function K(t){return"string"==typeof t||t instanceof String}function $(t){return W()&&t instanceof Blob}function W(){return"undefined"!=typeof Blob}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(O||(O={}));var z=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=O.NO_ERROR,this.sendPromise_=M(function(e,n){t.xhr_.addEventListener("abort",function(n){t.errorCode_=O.ABORT,e(t)}),t.xhr_.addEventListener("error",function(n){t.errorCode_=O.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(n){e(t)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw w("cannot .send() more than once");(this.sent_=!0,this.xhr_.open(e,t,!0),L(r))&&N(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())});return L(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw w("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw w("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw w("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){L(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){L(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),G=function(){function t(){}return t.prototype.createXhrIo=function(){return new z},t}();function Q(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return U(t)&&!Array.isArray(t)}(e)?e:null}var J=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw function(t){return new d(f.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},t.makeFromUrl=function(e){var n=null;for(var r=[{regex:new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i"),indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://firebasestorage\\.googleapis\\.com/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],i=0;i<r.length;i++){var s=r[i],o=s.regex.exec(e);if(o){var a=o[s.indices.bucket],c=o[s.indices.path];c||(c=""),n=new t(a,c),s.postModify(n);break}}if(null==n)throw function(t){return new d(f.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function Y(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function X(t){return s+a+t}function Z(t){return s+c+t}function tt(t){var e=encodeURIComponent,n="?";return N(t,function(t,r){var i=e(t)+"="+e(r);n=n+i+"&"}),n=n.slice(0,-1)}function et(t,e){return e}var nt=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||et}}(),rt=null;function it(){if(rt)return rt;var t=[];t.push(new nt("bucket")),t.push(new nt("generation")),t.push(new nt("metageneration")),t.push(new nt("name","fullPath",!0));var e=new nt("name");e.xform=function(t,e){return function(t){return!K(t)||t.length<2?t:Y(t=t)}(e)},t.push(e);var n=new nt("size");return n.xform=function(t,e){return L(e)?+e:e},t.push(n),t.push(new nt("timeCreated")),t.push(new nt("updated")),t.push(new nt("md5Hash",null,!0)),t.push(new nt("cacheControl",null,!0)),t.push(new nt("contentDisposition",null,!0)),t.push(new nt("contentEncoding",null,!0)),t.push(new nt("contentLanguage",null,!0)),t.push(new nt("contentType",null,!0)),t.push(new nt("metadata","customMetadata",!0)),rt=t}function st(t,e,n){for(var r={type:"file"},i=n.length,s=0;s<i;s++){var o=n[s];r[o.local]=o.xform(r,e[o.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new J(n,r);return e.makeStorageReference(i)}})}(r,t),r}function ot(t,e,n){var r=Q(e);return null===r?null:st(t,r,n)}function at(t,e){var n=Q(e);if(null===n)return null;if(!K(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return function(t){return o+a+t}("/b/"+i(n)+"/o/"+i(r))+tt({alt:"media",token:e})})[0]}function ct(t,e){for(var n={},r=e.length,i=0;i<r;i++){var s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}function ut(t){if(!(t&&U(t)))throw"Expected Metadata object.";for(var e in t){var n=t[e];if("customMetadata"===e){if(!U(n))throw"Expected object for 'customMetadata' mapping."}else if(V(n))throw"Mapping for '"+e+"' cannot be an object."}}function lt(t,e,n){for(var r=e.length,i=e.length,s=0;s<e.length;s++)if(e[s].optional){r=s;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,s;return t===e?(i=t,s=1===t?"argument":"arguments"):(i="between "+t+" and "+e,s="arguments"),new d(f.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+s+", received "+r+".")}(r,i,t,n.length);for(s=0;s<n.length;s++)try{e[s].validator(n[s])}catch(e){throw e instanceof Error?m(s,t,e.message):m(s,t,e)}}var ht=function(){return function(t,e){var n=this;this.validator=function(e){n.optional&&!H(e)||t(e)},this.optional=!!e}}();function dt(t,e){function n(t){if(!K(t))throw"Expected string."}var r;return r=t?function(t,e){return function(n){t(n),e(n)}}(n,t):n,new ht(r,e)}function ft(t){return new ht(ut,t)}function pt(){return new ht(function(t){if(!(function(t){return"number"==typeof t||t instanceof Number}(t)&&t>=0))throw"Expected a number 0 or greater."})}function gt(t,e){return new ht(function(e){if(!(null===e||L(e)&&e instanceof Object))throw"Expected an Object.";void 0!==t&&null!==t&&t(e)},e)}function yt(t){return new ht(function(t){if(null!==t&&!q(t))throw"Expected a Function."},t)}function vt(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}var mt=function(){function t(t,e){var n=0,r="";$(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if($(this.data_)){var r=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,e,n);return null===r?null:new t(r)}return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(W()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vt();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(W())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=e.map(function(t){return K(t)?x(S.RAW,t).data:t.data_}),s=0;i.forEach(function(t){s+=t.byteLength});var o=new Uint8Array(s),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new t(o,!0)},t.prototype.uploadData=function(){return this.data_},t}();function _t(t,e){return-1!==t.indexOf(e)}var bt=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function wt(t){if(!t)throw g()}function St(t,e){return function(n,r){var i=ot(t,r,e);return wt(null!==i),i}}function Ct(t){return function(e,n){var r;return(r=401===e.getStatus()?new d(f.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(t){return new d(f.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(t.bucket):403===e.getStatus()?function(t){return new d(f.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(t.path):n).setServerResponseProp(n.serverResponseProp()),r}}function Et(t){var e=Ct(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=function(t){return new d(f.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(t.path)),i.setServerResponseProp(r.serverResponseProp()),i}}function xt(t,e,n){var r=X(e.fullServerUrl()),i=t.maxOperationRetryTime(),s=new bt(r,"GET",St(t,n),i);return s.errorHandler=Et(e),s}function Tt(t,e,n){var r=X(e.fullServerUrl()),i=t.maxOperationRetryTime(),s=new bt(r,"GET",function(t,e){return function(n,r){var i=ot(t,r,e);return wt(null!==i),at(i,r)}}(t,n),i);return s.errorHandler=Et(e),s}function At(t,e,n){var r=j(n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var kt=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function Ot(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){wt(!1)}return wt(_t(e||["active"],n)),n}function Pt(t,e,n,r,i,s,o,a){var c=new kt(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new d(f.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var u=c.total-c.current,l=u;i>0&&(l=Math.min(l,i));var h=c.current,p=h+l,g={"X-Goog-Upload-Command":l===u?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},y=r.slice(h,p);if(null===y)throw v();var m=e.maxUploadRetryTime(),_=new bt(n,"POST",function(t,n){var i,o=Ot(t,["active","final"]),a=c.current+l,u=r.size();return i="final"===o?St(e,s)(t,n):null,new kt(a,u,"final"===o,i)},m);return _.headers=g,_.body=y.uploadData(),_.progressCallback=a||null,_.errorHandler=Ct(t),_}var Rt=function(){return function(t,e,n){if(q(t)||L(e)||L(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),It=function(){return function(t,e,n,r,i,s){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=s}}();function Ft(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];B(!0).then(function(){t.apply(null,e)})}}var Dt=function(){function t(t,e,n,r,i,s){void 0===s&&(s=null);var o=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=s,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=R.RUNNING,this.errorHandler_=function(t){o.request_=null,o.chunkMultiplier_=1,t.codeEquals(f.CANCELED)?(o.needToFetchStatus_=!0,o.completeTransitions_()):(o.error_=t,o.transition_(R.ERROR))},this.metadataErrorHandler_=function(t){o.request_=null,t.codeEquals(f.CANCELED)?o.completeTransitions_():(o.error_=t,o.transition_(R.ERROR))},this.promise_=M(function(t,e){o.resolve_=t,o.reject_=e,o.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n,r){t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===R.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case R.RUNNING:t(n);break;case R.CANCELING:e.transition_(R.CANCELED);break;case R.PAUSING:e.transition_(R.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var s=e.bucketOnlyServerUrl(),o=At(e,r,i),a={name:o.fullPath},c=Z(s),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},l=ct(o,n),h=t.maxUploadRetryTime(),d=new bt(c,"POST",function(t,e){var n;Ot(t);try{n=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){wt(!1)}return wt(K(n)),n},h);return d.urlParams=a,d.headers=u,d.body=l,d.errorHandler=Ct(e),d}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),s=new bt(n,"POST",function(t,e){var n,i=Ot(t,["active","final"]);try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){wt(!1)}var s=parseInt(n,10);return wt(!isNaN(s)),new kt(s,r.size(),"final"===i)},i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=Ct(e),s}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new kt(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var s;try{s=Pt(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(R.ERROR)}var o=t.authWrapper_.makeRequest(s,i);t.request_=o,o.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(R.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=xt(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(R.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=At(e,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ct(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=mt.getBlob(u,r,l);if(null===h)throw v();var d={name:c.fullPath},f=Z(s),p=t.maxUploadRetryTime(),g=new bt(f,"POST",St(t,n),p);return g.urlParams=d,g.headers=o,g.body=h.uploadData(),g.errorHandler=Ct(e),g}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(R.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case R.CANCELING:case R.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case R.RUNNING:var e=this.state_===R.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case R.PAUSED:this.state_=t,this.notifyObservers_();break;case R.CANCELED:this.error_=y(),this.state_=t,this.notifyObservers_();break;case R.ERROR:case R.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case R.PAUSING:this.transition_(R.PAUSED);break;case R.CANCELING:this.transition_(R.CANCELED);break;case R.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=F(this.state_);return new It(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){void 0===e&&(e=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",s=yt(!0).validator,o=gt(null,!0).validator;function a(t){try{return void s(t)}catch(t){}try{if(o(t),!(H(t.next)||H(t.error)||H(t.complete)))throw"";return}catch(t){throw i}}lt("on",[dt(function(e){if(t!==P.STATE_CHANGED)throw"Expected one of the event types: ["+P.STATE_CHANGED+"]."}),gt(a,!0),yt(!0),yt(!0)],arguments);var c=this;function u(t){return function(e,n,i){null!==t&&lt("on",t,arguments);var s=new Rt(e,n,r);return c.addObserver_(s),function(){c.removeObserver_(s)}}}var l=[gt(function(t){if(null===t)throw i;a(t)}),yt(!0),yt(!0)];return!(H(e)||H(n)||H(r))?u(l):u(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){!function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}(this.observers_,t)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),function(t){return Array.prototype.slice.call(t)}(this.observers_).forEach(function(e){t.notifyObserver_(e)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(F(this.state_)){case I.SUCCESS:Ft(this.resolve_.bind(null,this.snapshot))();break;case I.CANCELED:case I.ERROR:Ft(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(F(this.state_)){case I.RUNNING:case I.PAUSED:null!==t.next&&Ft(t.next.bind(t,this.snapshot))();break;case I.SUCCESS:null!==t.complete&&Ft(t.complete.bind(t))();break;case I.CANCELED:case I.ERROR:null!==t.error&&Ft(t.error.bind(t,this.error_))();break;default:null!==t.error&&Ft(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){lt("resume",[],arguments);var t=this.state_===R.PAUSED||this.state_===R.PAUSING;return t&&this.transition_(R.RUNNING),t},t.prototype.pause=function(){lt("pause",[],arguments);var t=this.state_===R.RUNNING;return t&&this.transition_(R.PAUSING),t},t.prototype.cancel=function(){lt("cancel",[],arguments);var t=this.state_===R.RUNNING||this.state_===R.PAUSING;return t&&this.transition_(R.CANCELING),t},t}(),Nt=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof J?e:J.makeFromUrl(e)}return t.prototype.toString=function(){return lt("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return it()},t.prototype.child=function(t){lt("child",[dt()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new J(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new J(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new J(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Y(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),lt("put",[new ht(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||W()&&t instanceof Blob))throw"Expected Blob or File."}),ft(!0)],arguments),this.throwIfRoot_("put"),new Dt(this,this.authWrapper,this.location,this.mappings(),new mt(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=S.RAW),lt("putString",[dt(),dt(C,!0),ft(!0)],arguments),this.throwIfRoot_("putString");var r=x(e,t),i=j(n);return!L(i.contentType)&&L(r.contentType)&&(i.contentType=r.contentType),new Dt(this,this.authWrapper,this.location,this.mappings(),new mt(r.data,!0),i)},t.prototype.delete=function(){lt("delete",[],arguments),this.throwIfRoot_("delete");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=X(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new bt(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=Et(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.getMetadata=function(){lt("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=xt(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){lt("updateMetadata",[ft()],arguments),this.throwIfRoot_("updateMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=X(e.fullServerUrl()),s=ct(n,r),o=t.maxOperationRetryTime(),a=new bt(i,"PATCH",St(t,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=Et(e),a}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){lt("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=Tt(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new d(f.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new d(f.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),jt=function(){function t(t){this.promise_=function(t){return Promise.reject(t)}(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),Mt=function(){function t(){this.map_={},this.id_=h}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){N(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),Bt=function(){function t(e,n,r,i,s){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var o=this.app_.options;L(o)&&(this.bucket_=t.extractBucket_(o))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=s,this.service_=i,this.maxOperationRetryTime_=u,this.maxUploadRetryTime_=l,this.requestMap_=new Mt}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:J.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&L(this.app_.INTERNAL)&&L(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(t){return null}):B(null)},t.prototype.bucket=function(){if(this.deleted_)throw _();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new jt(_());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}();var Lt=function(){function t(t,e,n,r,i,s,o,a,c,u,l){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=u,this.timeout_=c,this.pool_=l;var h=this;this.promise_=M(function(t,e){h.resolve_=t,h.reject_=e,h.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,s=t.reject_,o=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(o,o.getResponseText());H(a)?i(a):i()}catch(t){s(t)}else null!==o?((r=g()).setServerResponseProp(o.getResponseText()),t.errorCallback_?s(t.errorCallback_(o,r)):s(r)):n.canceled?s(r=t.appDelete_?_():y()):s(r=new d(f.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Ht(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,s=!1,o=0;function a(){return 2===o}var c=!1;function u(){c||(c=!0,e.apply(null,arguments))}function l(e){i=setTimeout(function(){i=null,t(h,a())},e)}function h(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];c||(t?u.apply(null,arguments):a()||s?u.apply(null,arguments):(r<64&&(r*=2),1===o?(o=2,e=0):e=1e3*(r+Math.random()),l(e)))}var d=!1;function f(t){d||(d=!0,c||(null!==i?(t||(o=2),clearTimeout(i),l(0)):t||(o=1)))}return l(0),setTimeout(function(){s=!0,f(!0)},n),f}(function(e,n){if(n)e(!1,new Ht(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===O.NO_ERROR,s=n.getStatus();if(r&&!t.isRetryStatusCode_(s)){var o=_t(t.successCodes_,s);e(!0,new Ht(o,n))}else{var a=n.getErrorCode()===O.ABORT;e(!1,new Ht(!1,null,a))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=_t([408,429],t),r=_t(this.additionalRetryCodes_,t);return e||n||r},t}(),Ht=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function qt(t,e,n){var r=tt(t.urlParams),s=t.url+r,o=j(t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==i.a?i.a.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new Lt(s,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var Ut=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Bt(t,function(t,e){return new Nt(t,e)},qt,this,e),this.app_=t,null!=n)this.bucket_=J.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new J(r,""))}this.internals_=new Vt(this)}return t.prototype.ref=function(t){if(lt("ref",[dt(function(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new Nt(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return lt("refFromURL",[dt(function(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{J.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Nt(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){lt("setMaxUploadRetryTime",[pt()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxOperationRetryTime=function(t){lt("setMaxOperationRetryTime",[pt()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Vt=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),B(void 0)},t}(),Kt="storage";function $t(t,e,n){return new Ut(t,new G,n)}function Wt(t){var e={TaskState:I,TaskEvent:P,StringFormat:S,Storage:Ut,Reference:Nt};t.INTERNAL.registerService(Kt,$t,e,void 0,!0)}Wt(i.a)},function(t,e,n){"use strict";n.r(e),n.d(e,"atob",function(){return r});const r=window.atob},function(t,e,n){"use strict";n.r(e),n.d(e,"btoa",function(){return r});const r=window.btoa},function(t,e,n){"use strict";n.r(e),n.d(e,"setDiff",function(){return i}),n.d(e,"setDiffCustom",function(){return s});var r=n(3);
// @license
function i(t,e){const n={add:[],remove:[]},i=new Set([...t,...e]),s=new Set(t),o=new Set(e);for(const t of i)if(s.has(t)){if(o.has(t))continue;n.remove.push(t)}else Object(r.assert)(o.has(t)),n.add.push(t);return n}function s(t,e,n){const i={add:[],remove:[]},s=new Map,o=new Map,a=new Map;for(const e of t){const t=n(e);s.set(t,e),o.set(t,e)}for(const t of e){const e=n(t);s.set(e,t),a.set(e,t)}for(const[t,e]of s)if(o.has(t)){if(a.has(t))continue;i.remove.push(e)}else Object(r.assert)(a.has(t)),i.add.push(e);return i}},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbStorage",function(){return d});var r=n(3),i=n(48),s=n(69),o=n(4),a=n(70),c=n(72),u=n(73),l=n(74),h=n(86);class d extends i.StorageBase{constructor(t){super(t),this.providerByLocationCache=new Map,this.baseStores=new Map,this.baseStorePromises=new Map,this.localIDBase=0}async construct(t,e,n){const r=await this._construct(t,e,n);return e instanceof o.ReferenceType?r:e.isTypeContainer()&&e.getContainedType()instanceof o.ReferenceType?r:(r.enableReferenceMode(),r)}async _construct(t,e,n){const r=new s.PouchDbKey(n),i=this.newProvider(e,void 0,t,r.toString());return this.providerByLocationCache.set(r.location,i),i}async connect(t,e,n){const r=new s.PouchDbKey(n),i=this.providerByLocationCache.get(r.location);if(i)return i;try{return await this.dbForKey(r).get(r.location),this.construct(t,e,n)}catch(t){if("not_found"===t)return null;throw t}}shutdown(){d.syncHandler&&d.syncHandler.cancel();for(const t of d.dbLocationToInstance.values())t.close();d.dbLocationToInstance.clear()}baseStorageKey(t,e){const n=new s.PouchDbKey(e);return n.location=`backingStores/${t.toString()}`,n.toString()}async baseStorageFor(t,e){if(this.baseStores.has(t))return this.baseStores.get(t);if(this.baseStorePromises.has(t))return this.baseStorePromises.get(t);const n=this._construct(t.toString(),t.collectionOf(),e);this.baseStorePromises.set(t,n);const i=await n;return Object(r.assert)(i,"baseStorageFor should not fail"),this.baseStores.set(t,i),i}parseStringAsKey(t){return new s.PouchDbKey(t)}newProvider(t,e,n,r){return t instanceof o.CollectionType?new a.PouchDbCollection(t,this,e,n,r):t instanceof o.BigCollectionType?new c.PouchDbBigCollection(t,this,e,n,r):new u.PouchDbVariable(t,this,e,n,r)}static async resetPouchDbStorageForTesting(){for(const t of d.dbLocationToInstance.values())await t.allDocs({include_docs:!0}).then(t=>t.rows.map(t=>({_id:t.id,_rev:t.doc._rev,_deleted:!0}))).then(e=>t.bulkDocs(e))}dbForKey(t){let e=d.dbLocationToInstance.get(t.dbCacheKey());if(e)return e;if("local"===t.dbLocation)e=new l.default(t.dbName);else if("memory"===t.dbLocation)l.default.plugin(h.default),e=new l.default(t.dbName,{adapter:"memory"});else{e=new l.default(t.dbName);const n=t.dbLocation.startsWith("localhost")?"http://":"https://",r=new l.default(n+t.dbLocation+"/"+t.dbName);if(!r||!e)throw new Error("unable to connect to remote database for "+t.toString());r.info().then(t=>{console.log("Connected to Remote Database",t)}).catch(t=>{console.warn("Error connecting to Remote Database",t)}),this.setupSync(e,r)}if(!e)throw new Error("unable to connect to database for "+t.toString());return d.dbLocationToInstance.set(t.dbCacheKey(),e),e}setupSync(t,e){console.log("Replicating DBs");const n=t.sync(e,{live:!0,retry:!0});n.on("change",t=>{if("pull"===t.direction)for(const e of t.change.docs){const t=this.providerByLocationCache.get(e._id);t&&t.onRemoteStateSynced(e)}}),n.on("paused",t=>{console.log("DB Replication paused",t)}).on("active",()=>{console.log("DB Replication active")}).on("denied",t=>{console.log("DB Replication denied",t)}).on("complete",t=>{console.log("DB Replication complete",t)}).on("error",t=>{console.log("DB Replication error",t)}),d.syncHandler=n}}d.dbLocationToInstance=new Map},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbKey",function(){return s});var r=n(3),i=n(49);
// @license
class s extends i.KeyBase{constructor(t){if(super(),!t.startsWith("pouchdb://"))throw new Error(`can't construct pouchdb key for input key ${t}`);const e=t.replace(/^pouchdb:\/\//,"").split("/");if(this.protocol="pouchdb",this.dbLocation=e[0]||"memory",this.dbName=e[1]||"user",this.location=e.slice(2).join("/")||"",this.toString()!==t)throw new Error("PouchDb keys must match "+this.toString()+" vs "+t)}childKeyForHandle(t){Object(r.assert)(t&&t.length>0,"invalid id");let e="";void 0!=this.location&&this.location.length>0&&(e=this.location+"/"),e+=`handles/${t}`;const n=new s(this.toString());return n.location=e,n}toString(){return"pouchdb://"+[this.dbLocation,this.dbName,this.location].join("/")}dbCacheKey(){return[this.dbLocation,this.dbName].join("/")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbCollection",function(){return a});var r=n(50),i=n(3),s=n(71),o=n(48);class a extends s.PouchDbStorageProvider{constructor(t,e,n,s,o){super(t,e,n,s,o),this._model=new r.CrdtCollectionModel,Object(i.assert)(null!==this.version)}backingType(){return this.type.primitiveType()}clone(){const t=new a(this.type,this.storageEngine,this.name,this.id,null);return t.cloneFrom(this),t}async cloneFrom(t){this.referenceMode=t.referenceMode;const e=await t.toLiteral();if(this.referenceMode&&e.model.length>0){await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:e.id,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}this.fromLiteral(e)}async modelForSynchronization(){return{version:this.version,model:await this._toList()}}async toLiteral(){return{version:this.version,model:(await this.getModel()).toLiteral()}}fromLiteral({version:t,model:e}){this.version=t,this._model=new r.CrdtCollectionModel(e)}async _toList(){if(this.referenceMode){const t=(await this.getModel()).toLiteral();if(0===t.length)return[];const e=new Set;t.forEach(t=>e.add(t.value.storageKey)),Object(i.assert)(1===e.size,"multiple storageKeys in reference set of collection not yet supported.");e.values().next().value;await this.ensureBackingStore();const n=async t=>{const e=t.value;return{id:e.id,value:await this.backingStore.get(e.id),keys:t.keys}};return await Promise.all(t.map(n))}return(await this.getModel()).toLiteral()}async toList(){return(await this._toList()).map(t=>t.value)}async getMultiple(t){Object(i.assert)(!this.referenceMode,"getMultiple not implemented for referenceMode stores");const e=await this.getModel();return t.map(t=>e.getValue(t))}async storeMultiple(t,e,n=null){Object(i.assert)(!this.referenceMode,"storeMultiple not implemented for referenceMode stores"),this.getModelAndUpdate(n=>(t.map(t=>n.add(t.id,t,e)),n))}async get(t){if(this.referenceMode){const e=(await this.getModel()).getValue(t);return null==e?null:(await this.ensureBackingStore(),await this.backingStore.get(e.id))}return(await this.getModel()).getValue(t)}async store(t,e,n=null){Object(i.assert)(null!=e&&e.length>0,"keys required");t.id;const r={value:t,keys:e,effective:void 0};if(this.referenceMode){const n=this.type.primitiveType(),i=this.storageEngine.baseStorageKey(n,this.storageKey);await this.getModelAndUpdate(n=>(r.effective=n.add(t.id,{id:t.id,storageKey:i},e),n)),await this.ensureBackingStore(),await this.backingStore.store(t,e)}else await this.getModelAndUpdate(n=>(r.effective=n.add(t.id,t,e),n));this.version++,this._fire("change",new o.ChangeEvent({add:[r],version:this.version,originatorId:n}))}async removeMultiple(t,e=null){await this.getModelAndUpdate(e=>(0===t.length&&(t=e.toList().map(t=>({id:t.id,keys:[]}))),t.forEach(t=>{0===t.keys.length&&(t.keys=e.getKeys(t.id)),t.value=e.getValue(t.id),null!==t.value&&(t.effective=e.remove(t.id,t.keys))}),e)).then(()=>{this._fire("change",new o.ChangeEvent({remove:t,version:this.version,originatorId:e}))})}async remove(t,e=[],n=null){await this.getModelAndUpdate(r=>{0===e.length&&(e=r.getKeys(t));const i=r.getValue(t);if(null!==i){const s=r.remove(t,e);this.version++,this._fire("change",new o.ChangeEvent({remove:[{value:i,keys:e,effective:s}],version:this.version,originatorId:n}))}return r})}onRemoteStateSynced(t){this._rev,this._model;if(this._rev===t._rev)return;const e=t.model;this._model=new r.CrdtCollectionModel(e),this._rev=t._rev,this.version++}async getModel(){try{const t=await this.db.get(this.pouchDbKey.location);this._rev!==t._rev&&(this._model=new r.CrdtCollectionModel(t.model),this._rev=t._rev,this.version++)}catch(t){throw"not_found"===t.name&&(this._model=new r.CrdtCollectionModel,this._rev=void 0),console.warn("PouchDbCollection.getModel err=",t),t}return this._model}async getModelAndUpdate(t){for(;;){let e,n=!1;try{e=await this.db.get(this.pouchDbKey.location),this._rev!==e._rev&&(this._model=new r.CrdtCollectionModel(e.model),this._rev=e._rev,this.version++)}catch(t){if("not_found"!==t.name)throw t;n=!0,e={_id:this.pouchDbKey.location,referenceMode:this.referenceMode,type:this.type.toLiteral()}}const i=t(new r.CrdtCollectionModel(this._model.toLiteral()));if(!n&&JSON.stringify(this._model.toLiteral())===JSON.stringify(i.toLiteral()))return this._model;e.model=i.toLiteral(),e.version=this.version;try{const t=await this.db.put(e);return this._rev=t.rev,this._model=i,this._model}catch(t){if("conflict"!==t.name)throw console.warn("PouchDbCollection.getModelAndUpdate (err,doc)=",t,e),t}}return null}async clearItemsForTesting(){try{const t=await this.db.get(this.pouchDbKey.location);await this.db.remove(t)}catch(t){"not_found"!==t.name&&console.warn("clearItemsForTesting: error removing",t)}this._model=new r.CrdtCollectionModel,this._rev=void 0}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbStorageProvider",function(){return s});var r=n(48),i=n(69);class s extends r.StorageProviderBase{constructor(t,e,n,r,s){super(t,n,r,s),this.backingStore=null,this.pendingBackingStore=null,this.storageEngine=e,this.pouchDbKey=new i.PouchDbKey(s)}async ensureBackingStore(){if(this.backingStore)return this.backingStore;if(!this.pendingBackingStore){const t=this.storageEngine.baseStorageKey(this.backingType(),this.storageKey);this.pendingBackingStore=this.storageEngine.baseStorageFor(this.type,t),this.pendingBackingStore.then(t=>this.backingStore=t)}return this.pendingBackingStore}get db(){return this.storageEngine.dbForKey(this.pouchDbKey)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbBigCollection",function(){return s});var r=n(71),i=n(3);class s extends r.PouchDbStorageProvider{constructor(t,e,n,r,i){super(t,e,n,r,i)}backingType(){return this.type.primitiveType()}async get(t){throw new Error("NotImplemented")}async store(t,e,n){throw Object(i.assert)(null!=e&&e.length>0,"keys required"),new Error("NotImplemented")}async remove(t,e,n){throw new Error("NotImplemented")}toLiteral(){throw new Error("NotImplemented")}cloneFrom(){throw new Error("NotImplemented")}onRemoteStateSynced(t){throw new Error("NotImplemented")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PouchDbVariable",function(){return o});var r=n(3),i=n(71),s=n(48);class o extends i.PouchDbStorageProvider{constructor(t,e,n,r,i){super(t,e,n,r,i),this._stored=null,this.localKeyId=0,this.backingStore=null}backingType(){return this.type}clone(){const t=new o(this.type,this.storageEngine,this.name,this.id,null);return t.cloneFrom(this),t}async cloneFrom(t){this.referenceMode=t.referenceMode;const e=await t.toLiteral();if(this.referenceMode&&e.model.length>0){await Promise.all([this.ensureBackingStore(),t.ensureBackingStore()]),e.model=e.model.map(({id:t,value:e})=>({id:t,value:{id:e.id,storageKey:this.backingStore.storageKey}}));const n=await t.backingStore.getMultiple(e.model.map(({id:t})=>t));await this.backingStore.storeMultiple(n,[this.storageKey])}if(await this.fromLiteral(e),e&&e.model&&1===e.model.length){const t=e.model[0].value;t&&await this.getStoredAndUpdate(e=>t)}}async modelForSynchronization(){const t=await this.getStored();if(this.referenceMode&&null!==t){await this.ensureBackingStore();const e=await this.backingStore.get(t.id);return{version:this.version,model:[{id:t.id,value:e}]}}return super.modelForSynchronization()}async toLiteral(){const t=await this.getStored();let e=[];return null!=t&&(e=[{id:t.id,value:t}]),{version:this.version,model:e}}async fromLiteral({version:t,model:e}){const n=0===e.length?null:e[0].value;this.referenceMode&&n&&n.rawData&&Object(r.assert)(!1,`shouldn't have rawData ${JSON.stringify(n.rawData)} here`),Object(r.assert)(void 0!==n),await this.getStoredAndUpdate(t=>n),this.version=t}async get(){const t=await this.getStored();if(this.referenceMode&&t)try{return await this.ensureBackingStore(),await this.backingStore.get(t.id)}catch(t){throw console.warn("PouchDbVariable.get err=",t),t}return t}async set(t,e=null,n=null){if(Object(r.assert)(void 0!==t),this.referenceMode&&t){const e=this.type,n=this.storageEngine.baseStorageKey(e,this.storageKey);await this.ensureBackingStore(),await this.backingStore.store(t,[this.storageKey+this.localKeyId++]),await this.getStoredAndUpdate(e=>({id:t.id,storageKey:n}))}else{if(JSON.stringify(this._stored)===JSON.stringify(t)&&null==n)return;if(null==t)try{const t=await this.db.get(this.pouchDbKey.location);await this.db.remove(t)}catch(t){if("not_found"!==t.name)throw console.warn("PouchDbVariable.remove err=",t),t}else await this.getStoredAndUpdate(e=>t)}this.version++;const i=this.referenceMode?t:this._stored;await this._fire("change",new s.ChangeEvent({data:i,version:this.version,originatorId:e,barrier:n}))}async clear(t=null,e=null){await this.set(null,t,e)}onRemoteStateSynced(t){if(t._rev===this._rev)return;const e=t.value;this._stored=e,this._rev=t._rev,this.version++,this.referenceMode&&e?this.ensureBackingStore().then(async t=>{const n=await t.get(e.id);n?this._fire("change",new s.ChangeEvent({data:n,version:this.version})):console.log("PouchDbVariable.onRemoteSynced: possible race condition for id="+e.id)}):null!=e&&this._fire("change",new s.ChangeEvent({data:e,version:this.version}))}async getStored(){try{const t=await this.db.get(this.pouchDbKey.location);this._rev!==t._rev&&(this._stored=t.value,this._rev=t._rev,this.version++)}catch(t){if("not_found"!==t.name)throw console.warn("PouchDbVariable.getStored err=",t),t;this._stored=null,this._rev=void 0,this.version++}return this._stored}async getStoredAndUpdate(t){for(;;){let e,n=!1;try{e=await this.db.get(this.pouchDbKey.location),this._rev!==e._rev&&(this._stored=e.value,this._rev=e._rev,this.version++)}catch(t){if("not_found"!==t.name)throw t;n=!0,e={_id:this.pouchDbKey.location}}const r=t(Object.assign({},this._stored));if(!n&&JSON.stringify(this._stored)===JSON.stringify(r))return this._stored;e.value=r,e.version=this.version;try{const t=await this.db.put(e);return this._rev=t.rev,this._stored=r,this._stored}catch(t){if("conflict"!==t.name)throw console.warn("PouchDbVariable.getStoredAndUpdate (err, doc)=",t,e),t}}return null}}},function(t,e,n){"use strict";n.r(e),function(t,r){var i=n(75),s=n.n(i),o=n(76),a=n.n(o),c=n(77),u=n(78),l=n.n(u),h=n(79),d=n.n(h),f=n(80),p=n.n(f),g=n(85),y=n.n(g);function v(t){if(t instanceof ArrayBuffer)return function(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}var m,_,b=Function.prototype.toString,w=b.call(Object);function S(t){var e,n,r;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=S(t[n]);return e}if(t instanceof Date)return t.toISOString();if(function(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}(t))return v(t);if(!function(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&b.call(n)==w}(t))return t;for(n in e={},t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=S(t[n]);void 0!==i&&(e[n]=i)}return e}function C(t){var e=!1;return s()(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function E(t){return s()(function(e){var n=this,r="function"==typeof(e=S(e))[e.length-1]&&e.pop(),i=new Promise(function(r,i){var s;try{var o=C(function(t,e){t?i(t):r(e)});e.push(o),(s=t.apply(n,e))&&"function"==typeof s.then&&r(s)}catch(t){i(t)}});return r&&i.then(function(t){r(null,t)},r),i})}function x(t,e){return E(s()(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",t.name,e];i=i.concat(n?["error",n]:["success",r]),t.constructor.emit("debug",i),s(n,r)}}}(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(e,i){r.taskqueue.addTask(function(s){s?i(s):e(r[t].apply(r,n))})})}))}function T(t){return"$"+t}function A(t){return t.substring(1)}function k(){this._store={}}function O(t){if(this._store=new k,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}function P(t,e){for(var n={},r=0,i=e.length;r<i;r++){var s=e[r];s in t&&(n[s]=t[s])}return n}k.prototype.get=function(t){var e=T(t);return this._store[e]},k.prototype.set=function(t,e){var n=T(t);return this._store[n]=e,!0},k.prototype.has=function(t){return T(t)in this._store},k.prototype.delete=function(t){var e=T(t),n=e in this._store;return delete this._store[e],n},k.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var i=e[n];t(this._store[i],i=A(i))}},Object.defineProperty(k.prototype,"size",{get:function(){return Object.keys(this._store).length}}),O.prototype.add=function(t){return this._store.set(t,!0)},O.prototype.has=function(t){return this._store.has(t)},O.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})},Object.defineProperty(O.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}()?(m=O,_=k):(m=Set,_=Map);var R,I=6;function F(t){return t}function D(t){return[{ok:t}]}function N(t,e,n){var r=e.docs,i=new _;r.forEach(function(t){i.has(t.id)?i.get(t.id).push(t):i.set(t.id,[t])});var s=i.size,o=0,a=new Array(s);function c(){++o===s&&function(){var t=[];a.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t})}()}var u=[];i.forEach(function(t,e){u.push(e)});var l=0;function h(){if(!(l>=u.length)){var n=Math.min(l+I,u.length),r=u.slice(l,n);!function(n,r){n.forEach(function(n,s){var o=r+s,u=i.get(n),l=P(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(t){return t.rev}),l.open_revs=l.open_revs.filter(F);var d=F;0===l.open_revs.length&&(delete l.open_revs,d=D),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in e&&(l[t]=e[t])}),t.get(n,l,function(t,e){var r;r=t?[{error:t}]:d(e),function(t,e,n){a[t]={id:e,docs:n},c()}(o,n,r),h()})})}(r,l),l+=r.length}}h()}try{localStorage.setItem("_pouch_check_localstorage",1),R=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){R=!1}function j(){return R}function M(){c.EventEmitter.call(this),this._listeners={},function(t){j()&&addEventListener("storage",function(e){t.emit(e.key)})}(this)}function B(t){if("undefined"!=typeof console&&"function"==typeof console[t]){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function L(t){var e=0;return t||(e=2e3),function(t,e){return t=parseInt(t,10)||0,(e=parseInt(e,10))!=e||e<=t?e=(t||1)<<1:e+=1,e>6e5&&(t=3e5,e=6e5),~~((e-t)*Math.random()+t)}(t,e)}function H(t,e){B("info","The above "+t+" is totally normal. "+e)}l()(M,c.EventEmitter),M.prototype.addListener=function(t,e,n,r){if(!this._listeners[e]){var i=this,s=!1;this._listeners[e]=o,this.on(t,o)}function o(){if(i._listeners[e])if(s)s="waiting";else{s=!0;var t=P(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(t).on("change",function(t){t.seq>r.since&&!r.cancelled&&(r.since=t.seq,r.onChange(t))}).on("complete",function(){"waiting"===s&&a()(o),s=!1}).on("error",function(){s=!1})}}},M.prototype.removeListener=function(t,e){e in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},M.prototype.notifyLocalWindows=function(t){j()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},M.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var q="function"==typeof Object.assign?Object.assign:function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};function U(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}l()(U,Error),U.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new U(401,"unauthorized","Name or password is incorrect.");var V=new U(400,"bad_request","Missing JSON list of 'docs'"),K=new U(404,"not_found","missing"),$=new U(409,"conflict","Document update conflict"),W=new U(400,"bad_request","_id field must contain a string"),z=new U(412,"missing_id","_id is required for puts"),G=new U(400,"bad_request","Only reserved document ids may start with underscore."),Q=(new U(412,"precondition_failed","Database not open"),new U(500,"unknown_error","Database encountered an unknown error")),J=new U(500,"badarg","Some query argument is invalid"),Y=(new U(400,"invalid_request","Request was invalid"),new U(400,"query_parse_error","Some query parameter is invalid")),X=new U(500,"doc_validation","Bad special document member"),Z=new U(400,"bad_request","Something wrong with the request"),tt=new U(400,"bad_request","Document must be a JSON object"),et=(new U(404,"not_found","Database not found"),new U(500,"indexed_db_went_bad","unknown")),nt=(new U(500,"web_sql_went_bad","unknown"),new U(500,"levelDB_went_went_bad","unknown"),new U(403,"forbidden","Forbidden by design doc validate_doc_update function"),new U(400,"bad_request","Invalid rev format")),rt=(new U(412,"file_exists","The database could not be created, the file already exists."),new U(412,"missing_stub","A pre-existing attachment stub wasn't found"));new U(413,"invalid_url","Provided URL is invalid");function it(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=U.prototype,new n(e)}function st(t){if("object"!=typeof t){var e=t;(t=Q).data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function ot(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(r){r.doc||(r.doc={});var i=n&&function(t,e,n){try{return!t(e,n)}catch(t){var r="Filter function threw: "+t.toString();return it(Z,r)}}(t.filter,r.doc,e);if("object"==typeof i)return i;if(i)return!1;if(t.include_docs){if(!t.attachments)for(var s in r.doc._attachments)r.doc._attachments.hasOwnProperty(s)&&(r.doc._attachments[s].stub=!0)}else delete r.doc;return!0}}function at(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function ct(t){var e;if(t?"string"!=typeof t?e=it(W):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=it(G)):e=it(z),e)throw e}function ut(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(B("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function lt(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function ht(t){var e=lt(t);return e?e.join("/"):null}var dt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ft="queryKey",pt=/(?:^|&)([^&=]*)=?([^&]*)/g,gt=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function yt(t){for(var e=gt.exec(t),n={},r=14;r--;){var i=dt[r],s=e[r]||"",o=-1!==["user","password"].indexOf(i);n[i]=o?decodeURIComponent(s):s}return n[ft]={},n[dt[12]].replace(pt,function(t,e,r){e&&(n[ft][e]=r)}),n}function vt(t,e){var n=[],r=[];for(var i in e)e.hasOwnProperty(i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function mt(t,e,n){return new Promise(function(r,i){t.get(e,function(s,o){if(s){if(404!==s.status)return i(s);o={}}var a=o._rev,c=n(o);if(!c)return r({updated:!1,rev:a});c._id=e,c._rev=a,r(function(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(r){if(409!==r.status)throw r;return mt(t,e._id,n)})}(t,c,n))})})}var _t=function(t){return atob(t)},bt=function(t){return btoa(t)};function wt(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}function St(t,e){return wt([function(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}(t)],{type:e})}function Ct(t,e){return St(_t(t),e)}function Et(t,e){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";if(r)return e(n);e(function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}(n))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function xt(t,e){Et(t,function(t){e(t)})}function Tt(t,e){xt(t,function(t){e(bt(t))})}var At=t.setImmediate||t.setTimeout,kt=32768;function Ot(t,e,n,r,i){(n>0||r<e.size)&&(e=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}(e,n,r)),function(t,e){var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}(e,function(e){t.append(e),i()})}function Pt(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function Rt(t,e){var n="string"==typeof t,r=n?t.length:t.size,i=Math.min(kt,r),s=Math.ceil(r/i),o=0,a=n?new d.a:new d.a.ArrayBuffer,c=n?Pt:Ot;function u(){At(h)}function l(){var t=function(t){return bt(t)}(a.end(!0));e(t),a.destroy()}function h(){var e=o*i,n=e+i;c(a,t,e,n,++o<s?u:l)}h()}function It(t){return d.a.hash(t)}function Ft(t,e){var n=S(t);return e?(delete n._rev_tree,It(JSON.stringify(n))):p.a.v4().replace(/-/g,"").toLowerCase()}var Dt=p.a.v4;function Nt(t){for(var e,n,r,i,s=t.rev_tree.slice();i=s.pop();){var o=i.ids,a=o[2],c=i.pos;if(a.length)for(var u=0,l=a.length;u<l;u++)s.push({pos:c+1,ids:a[u]});else{var h=!!o[1].deleted,d=o[0];e&&!(r!==h?r:n!==c?n<c:e<d)||(e=d,n=c,r=h)}}return n+"-"+e}function jt(t,e){for(var n,r=t.slice();n=r.pop();)for(var i=n.pos,s=n.ids,o=s[2],a=e(0===o.length,i,s[0],n.ctx,s[1]),c=0,u=o.length;c<u;c++)r.push({pos:i+1,ids:o[c],ctx:a})}function Mt(t,e){return t.pos-e.pos}function Bt(t){var e=[];jt(t,function(t,n,r,i,s){t&&e.push({rev:n+"-"+r,pos:n,opts:s})}),e.sort(Mt).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function Lt(t){for(var e=Nt(t),n=Bt(t.rev_tree),r=[],i=0,s=n.length;i<s;i++){var o=n[i];o.rev===e||o.opts.deleted||r.push(o.rev)}return r}function Ht(t){for(var e,n=[],r=t.slice();e=r.pop();){var i=e.pos,s=e.ids,o=s[0],a=s[1],c=s[2],u=0===c.length,l=e.history?e.history.slice():[];l.push({id:o,opts:a}),u&&n.push({pos:i+1-l.length,ids:l});for(var h=0,d=c.length;h<d;h++)r.push({pos:i+1,ids:c[h],history:l})}return n.reverse()}function qt(t,e){return t.pos-e.pos}function Ut(t,e,n){var r=function(t,e,n){for(var r,i=0,s=t.length;i<s;)n(t[r=i+s>>>1],e)<0?i=r+1:s=r;return i}(t,e,n);t.splice(r,0,e)}function Vt(t,e){for(var n,r,i=e,s=t.length;i<s;i++){var o=t[i],a=[o.id,o.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function Kt(t,e){return t[0]<e[0]?-1:1}function $t(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,o=i.tree2;(s[1].status||o[1].status)&&(s[1].status="available"===s[1].status||"available"===o[1].status?"available":"missing");for(var a=0;a<o[2].length;a++)if(s[2][0]){for(var c=!1,u=0;u<s[2].length;u++)s[2][u][0]===o[2][a][0]&&(n.push({tree1:s[2][u],tree2:o[2][a]}),c=!0);c||(r="new_branch",Ut(s[2],o[2][a],Kt))}else r="new_leaf",s[2][0]=o[2][a]}return{conflicts:r,tree:t}}function Wt(t,e,n){var r,i=[],s=!1,o=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var u=t[a];if(u.pos===e.pos&&u.ids[0]===e.ids[0])r=$t(u.ids,e.ids),i.push({pos:u.pos,ids:r.tree}),s=s||r.conflicts,o=!0;else if(!0!==n){var l=u.pos<e.pos?u:e,h=u.pos<e.pos?e:u,d=h.pos-l.pos,f=[],p=[];for(p.push({ids:l.ids,diff:d,parent:null,parentIdx:null});p.length>0;){var g=p.pop();if(0!==g.diff)for(var y=g.ids[2],v=0,m=y.length;v<m;v++)p.push({ids:y[v],diff:g.diff-1,parent:g.ids,parentIdx:v});else g.ids[0]===h.ids[0]&&f.push(g)}var _=f[0];_?(r=$t(_.ids,h.ids),_.parent[2][_.parentIdx]=r.tree,i.push({pos:l.pos,ids:l.ids}),s=s||r.conflicts,o=!0):i.push(u)}else i.push(u)}return o||i.push(e),i.sort(qt),{tree:i,conflicts:s||"internal_node"}}function zt(t,e,n){var r=Wt(t,e),i=function(t,e){for(var n,r,i=Ht(t),s=0,o=i.length;s<o;s++){var a,c=i[s],u=c.ids;if(u.length>e){n||(n={});var l=u.length-e;a={pos:c.pos+l,ids:Vt(u,l)};for(var h=0;h<l;h++){var d=c.pos+h+"-"+u[h].id;n[d]=!0}}else a={pos:c.pos,ids:Vt(u,0)};r=r?Wt(r,a,!0).tree:[a]}return n&&jt(r,function(t,e,r){delete n[e+"-"+r]}),{tree:r,revs:n?Object.keys(n):[]}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Gt(t){return t.ids}function Qt(t,e){e||(e=Nt(t));for(var n,r=e.substring(e.indexOf("-")+1),i=t.rev_tree.map(Gt);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function Jt(t){return/^_local/.test(t)}function Yt(t,e,n){c.EventEmitter.call(this);var r=this;this.db=t;var i=(e=e?S(e):{}).complete=C(function(e,n){e?function(t,e){return"listenerCount"in t?t.listenerCount(e):c.EventEmitter.listenerCount(t,e)}(r,"error")>0&&r.emit("error",e):r.emit("complete",n),r.removeAllListeners(),t.removeListener("destroyed",s)});function s(){r.cancel()}n&&(r.on("complete",function(t){n(null,t)}),r.on("error",n)),t.once("destroyed",s),e.onChange=function(t,e,n){r.isCancelled||function(t,e,n,r){try{t.emit("change",e,n,r)}catch(t){B("error",'Error in .on("change", function):',t)}}(r,t,e,n)};var o=new Promise(function(t,n){e.complete=function(e,r){e?n(e):t(r)}});r.once("cancel",function(){t.removeListener("destroyed",s),e.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(t){i(null,t)},i),t.taskqueue.isReady?r.validateChanges(e):t.taskqueue.addTask(function(t){t?e.complete(t):r.isCancelled?r.emit("cancel"):r.validateChanges(e)})}function Xt(t,e,n){var r=[{rev:t._rev}];"all_docs"===n.style&&(r=Bt(e.rev_tree).map(function(t){return{rev:t.rev}}));var i={id:e.id,changes:r,doc:t};return Qt(e,t._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Lt(e),i.doc._conflicts.length||delete i.doc._conflicts),i}function Zt(t,e){return t<e?-1:t>e?1:0}function te(t,e){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=e,t(n)):t(null,r.length?r[0]:r)}}function ee(t,e){var n=Zt(t._id,e._id);return 0!==n?n:Zt(t._revisions?t._revisions.start:0,e._revisions?e._revisions.start:0)}function ne(){for(var t in c.EventEmitter.call(this),ne.prototype)"function"==typeof this[t]&&(this[t]=this[t].bind(this))}function re(){this.isReady=!1,this.failed=!1,this.queue=[]}function ie(t,e){if(!(this instanceof ie))return new ie(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(t=(e=t).name,delete e.name),void 0===e.deterministic_revs&&(e.deterministic_revs=!0),this.__opts=e=S(e),n.auto_compaction=e.auto_compaction,n.prefix=ie.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var r=function(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=ie.adapters,i=ie.preferredAdapters,s=ie.prefix,o=e.adapter;if(!o)for(var a=0;a<i.length&&"idb"===(o=i[a])&&"websql"in r&&j()&&localStorage["_pouch__websqldb_"+s+t];++a)B("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var c=r[o];return{name:c&&"use_prefix"in c&&!c.use_prefix?t:s+t,adapter:o}}((e.prefix||"")+t,e);if(e.name=r.name,e.adapter=e.adapter||r.adapter,n.name=t,n._adapter=e.adapter,ie.emit("debug",["adapter","Picked adapter: ",e.adapter]),!ie.adapters[e.adapter]||!ie.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);ne.call(n),n.taskqueue=new re,n.adapter=e.adapter,ie.adapters[e.adapter].call(n,e,function(t){if(t)return n.taskqueue.fail(t);!function(t){function e(e){t.removeListener("closed",n),e||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}(n),n.emit("created",n),ie.emit("created",n.name),n.taskqueue.ready(n)})}l()(Yt,c.EventEmitter),Yt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Yt.prototype.validateChanges=function(t){var e=t.complete,n=this;ie._changesFilterPlugin?ie._changesFilterPlugin.validate(t,function(r){if(r)return e(r);n.doChanges(t)}):n.doChanges(t)},Yt.prototype.doChanges=function(t){var e=this,n=t.complete;if("live"in(t=S(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Xt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(ie._changesFilterPlugin){if(ie._changesFilterPlugin.normalize(t),ie._changesFilterPlugin.shouldFilter(this,t))return ie._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(e){e in t&&B("warn",'The "'+e+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&"function"==typeof r.cancel){var i=e.cancel;e.cancel=s()(function(t){r.cancel(),i.apply(this,t)})}}else this.db.info().then(function(r){e.isCancelled?n(null,{status:"cancelled"}):(t.since=r.update_seq,e.doChanges(t))},n)},l()(ne,c.EventEmitter),ne.prototype.post=x("post",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(it(tt));this.bulkDocs({docs:[t]},e,te(n,t._id))}),ne.prototype.put=x("put",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(it(tt));if(ct(t._id),Jt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,n):this._putLocal(t,n);var r=this;function i(n){"function"==typeof r._put&&!1!==e.new_edits?r._put(t,e,n):r.bulkDocs({docs:[t]},e,te(n,t._id))}e.force&&t._rev?(!function(){var n=t._rev.split("-"),r=n[1],i=parseInt(n[0],10)+1,s=Ft();t._revisions={start:i,ids:[s,r]},t._rev=i+"-"+s,e.new_edits=!1}(),i(function(e){var r=e?null:{ok:!0,id:t._id,rev:t._rev};n(e,r)})):i(n)}),ne.prototype.putAttachment=x("putAttachment",function(t,e,n,r,i){var s=this;function o(t){var n="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:i,data:r,revpos:++n},s.put(t)}return"function"==typeof i&&(i=r,r=n,n=null),void 0===i&&(i=r,r=n,n=null),i||B("warn","Attachment",e,"on document",t,"is missing content_type"),s.get(t).then(function(t){if(t._rev!==n)throw it($);return o(t)},function(e){if(e.reason===K.message)return o({_id:t});throw e})}),ne.prototype.removeAttachment=x("removeAttachment",function(t,e,n,r){var i=this;i.get(t,function(t,s){if(t)r(t);else if(s._rev===n){if(!s._attachments)return r();delete s._attachments[e],0===Object.keys(s._attachments).length&&delete s._attachments,i.put(s,r)}else r(it($))})}),ne.prototype.remove=x("remove",function(t,e,n,r){var i;"string"==typeof e?(i={_id:t,_rev:e},"function"==typeof n&&(r=n,n={})):(i=t,"function"==typeof e?(r=e,n={}):(r=n,n=e)),(n=n||{}).was_delete=!0;var s={_id:i._id,_rev:i._rev||n.rev,_deleted:!0};if(Jt(s._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,r);this.bulkDocs({docs:[s]},n,te(r,s._id))}),ne.prototype.revsDiff=x("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={});var r=Object.keys(t);if(!r.length)return n(null,{});var i=0,s=new _;function o(t,e){s.has(t)||s.set(t,{missing:[]}),s.get(t).missing.push(e)}r.map(function(e){this._getRevisionTree(e,function(a,c){if(a&&404===a.status&&"missing"===a.message)s.set(e,{missing:t[e]});else{if(a)return n(a);!function(e,n){var r=t[e].slice(0);jt(n,function(t,n,i,s,a){var c=n+"-"+i,u=r.indexOf(c);-1!==u&&(r.splice(u,1),"available"!==a.status&&o(e,c))}),r.forEach(function(t){o(e,t)})}(e,c)}if(++i===r.length){var u={};return s.forEach(function(t,e){u[e]=t}),n(null,u)}})},this)}),ne.prototype.bulkGet=x("bulkGet",function(t,e){N(this,t,e)}),ne.prototype.compactDocument=x("compactDocument",function(t,e,n){var r=this;this._getRevisionTree(t,function(i,s){if(i)return n(i);var o=function(t){var e={},n=[];return jt(t,function(t,r,i,s){var o=r+"-"+i;return t&&(e[o]=0),void 0!==s&&n.push({from:s,to:o}),o}),n.reverse(),n.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}(s),a=[],c=[];Object.keys(o).forEach(function(t){o[t]>e&&a.push(t)}),jt(s,function(t,e,n,r,i){var s=e+"-"+n;"available"===i.status&&-1!==a.indexOf(s)&&c.push(s)}),r._doCompaction(t,c,n)})}),ne.prototype.compact=x("compact",function(t,e){"function"==typeof t&&(e=t,t={});t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:e}),1===this._compactionQueue.length&&function t(e){var n=e._compactionQueue[0],r=n.opts,i=n.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(n){n&&n.last_seq&&(r.last_seq=n.last_seq),e._compact(r,function(n,r){n?i(n):i(null,r),a()(function(){e._compactionQueue.shift(),e._compactionQueue.length&&t(e)})})})}(this)}),ne.prototype._compact=function(t,e){var n=this,r={return_docs:!1,last_seq:t.last_seq||0},i=[];n.changes(r).on("change",function(t){i.push(n.compactDocument(t.id,0))}).on("complete",function(t){var r=t.last_seq;Promise.all(i).then(function(){return mt(n,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<r)&&(t.last_seq=r,t)})}).then(function(){e(null,{ok:!0})}).catch(e)}).on("error",e)},ne.prototype.get=x("get",function(t,e,n){if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(it(W));if(Jt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var r=[],i=this;function s(){var s=[],o=r.length;if(!o)return n(null,s);r.forEach(function(r){i.get(t,{rev:r,revs:e.revs,latest:e.latest,attachments:e.attachments,binary:e.binary},function(t,e){if(t)s.push({missing:r});else{for(var i,a=0,c=s.length;a<c;a++)if(s[a].ok&&s[a].ok._rev===e._rev){i=!0;break}i||s.push({ok:e})}--o||n(null,s)})})}if(!e.open_revs)return this._get(t,e,function(r,s){if(r)return r.docId=t,n(r);var o=s.doc,a=s.metadata,c=s.ctx;if(e.conflicts){var u=Lt(a);u.length&&(o._conflicts=u)}if(Qt(a,o._rev)&&(o._deleted=!0),e.revs||e.revs_info){for(var l=o._rev.split("-"),h=parseInt(l[0],10),d=l[1],f=Ht(a.rev_tree),p=null,g=0;g<f.length;g++){var y=f[g],v=y.ids.map(function(t){return t.id}).indexOf(d);(v===h-1||!p&&-1!==v)&&(p=y)}var m=p.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])+1,_=p.ids.length-m;if(p.ids.splice(m,_),p.ids.reverse(),e.revs&&(o._revisions={start:p.pos+p.ids.length-1,ids:p.ids.map(function(t){return t.id})}),e.revs_info){var b=p.pos+p.ids.length;o._revs_info=p.ids.map(function(t){return{rev:--b+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&o._attachments){var w=o._attachments,S=Object.keys(w).length;if(0===S)return n(null,o);Object.keys(w).forEach(function(t){this._getAttachment(o._id,t,w[t],{rev:o._rev,binary:e.binary,ctx:c},function(e,r){var i=o._attachments[t];i.data=r,delete i.stub,delete i.length,--S||n(null,o)})},i)}else{if(o._attachments)for(var C in o._attachments)o._attachments.hasOwnProperty(C)&&(o._attachments[C].stub=!0);n(null,o)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){if(t)return n(t);r=Bt(e).map(function(t){return t.rev}),s()});else{if(!Array.isArray(e.open_revs))return n(it(Q,"function_clause"));r=e.open_revs;for(var o=0;o<r.length;o++){var a=r[o];if("string"!=typeof a||!/^\d+-/.test(a))return n(it(nt))}s()}}),ne.prototype.getAttachment=x("getAttachment",function(t,e,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(t,n,function(s,o){return s?r(s):o.doc._attachments&&o.doc._attachments[e]?(n.ctx=o.ctx,n.binary=!0,void i._getAttachment(t,e,o.doc._attachments[e],n,r)):r(it(K))})}),ne.prototype.allDocs=x("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(it(Y,"Query parameter `"+n+"` is not compatible with multi-get"));if(!ut(this)&&(function(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}(t),0===t.keys.length))return this._allDocs({limit:0},e)}return this._allDocs(t,e)}),ne.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).return_docs="return_docs"in t?t.return_docs:!t.live,new Yt(this,t,e)},ne.prototype.close=x("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),ne.prototype.info=x("info",function(t){var e=this;this._info(function(n,r){if(n)return t(n);r.db_name=r.db_name||e.name,r.auto_compaction=!(!e.auto_compaction||ut(e)),r.adapter=e.adapter,t(null,r)})}),ne.prototype.id=x("id",function(t){return this._id(t)}),ne.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ne.prototype.bulkDocs=x("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(it(V));for(var r=0;r<t.docs.length;++r)if("object"!=typeof t.docs[r]||Array.isArray(t.docs[r]))return n(it(tt));var i;if(t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(e){i=i||function(t){return"_"===t.charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'"}(e),t._attachments[e].content_type||B("warn","Attachment",e,"on document",t._id,"is missing content_type")})}),i)return n(it(Z,i));"new_edits"in e||(e.new_edits=!("new_edits"in t)||t.new_edits);var s=this;e.new_edits||ut(s)||t.docs.sort(ee),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=P(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}(t.docs);var o=t.docs.map(function(t){return t._id});return this._bulkDocs(t,e,function(t,r){if(t)return n(t);if(e.new_edits||(r=r.filter(function(t){return t.error})),!ut(s))for(var i=0,a=r.length;i<a;i++)r[i].id=r[i].id||o[i];n(null,r)})}),ne.prototype.registerDependentDatabase=x("registerDependentDatabase",function(t,e){var n=new this.constructor(t,this.__opts);mt(this,"_local/_pouch_dependentDbs",function(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}).then(function(){e(null,{db:n})}).catch(e)}),ne.prototype.destroy=x("destroy",function(t,e){"function"==typeof t&&(e=t,t={});var n=this,r=!("use_prefix"in n)||n.use_prefix;function i(){n._destroy(t,function(t,r){if(t)return e(t);n._destroyed=!0,n.emit("destroyed"),e(null,r||{ok:!0})})}if(ut(n))return i();n.get("_local/_pouch_dependentDbs",function(t,s){if(t)return 404!==t.status?e(t):i();var o=s.dependentDbs,a=n.constructor,c=Object.keys(o).map(function(t){var e=r?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,n.__opts).destroy()});Promise.all(c).then(i,e)})}),re.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},re.prototype.fail=function(t){this.failed=t,this.execute()},re.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},re.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},l()(ie,ne);var se="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},oe=fetch,ae=Headers;ie.adapters={},ie.preferredAdapters=[],ie.prefix="_pouch_";var ce=new c.EventEmitter;!function(t){Object.keys(c.EventEmitter.prototype).forEach(function(e){"function"==typeof c.EventEmitter.prototype[e]&&(t[e]=ce[e].bind(ce))});var e=t._destructionListeners=new _;t.on("ref",function(t){e.has(t.name)||e.set(t.name,[]),e.get(t.name).push(t)}),t.on("unref",function(t){if(e.has(t.name)){var n=e.get(t.name),r=n.indexOf(t);r<0||(n.splice(r,1),n.length>1?e.set(t.name,n):e.delete(t.name))}}),t.on("destroyed",function(t){if(e.has(t)){var n=e.get(t);e.delete(t),n.forEach(function(t){t.emit("destroyed",!0)})}})}(ie),ie.adapter=function(t,e,n){e.valid()&&(ie.adapters[t]=e,n&&ie.preferredAdapters.push(t))},ie.plugin=function(t){if("function"==typeof t)t(ie);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){ie.prototype[e]=t[e]})}return this.__defaults&&(ie.__defaults=q({},this.__defaults)),ie},ie.defaults=function(t){function e(t,n){if(!(this instanceof e))return new e(t,n);n=n||{},t&&"object"==typeof t&&(t=(n=t).name,delete n.name),n=q({},e.__defaults,n),ie.call(this,t,n)}return l()(e,ie),e.preferredAdapters=ie.preferredAdapters.slice(),Object.keys(ie).forEach(function(t){t in e||(e[t]=ie[t])}),e.__defaults=q({},this.__defaults,t),e},ie.fetch=function(t,e){return oe(t,e)};function ue(t,e){for(var n=t,r=0,i=e.length;r<i;r++){if(!(n=n[e[r]]))break}return n}function le(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var s=t[r];"."===s?r>0&&"\\"===t[r-1]?n=n.substring(0,n.length-1)+".":(e.push(n),n=""):n+=s}return e.push(n),e}var he=["$or","$nor","$not"];function de(t){return he.indexOf(t)>-1}function fe(t){return Object.keys(t)[0]}function pe(t){var e={};return t.forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n];if("object"!=typeof r&&(r={$eq:r}),de(n))r instanceof Array?e[n]=r.map(function(t){return pe([t])}):e[n]=pe([r]);else{var i=e[n]=e[n]||{};Object.keys(r).forEach(function(t){var e=r[t];return"$gt"===t||"$gte"===t?function(t,e,n){if(void 0!==n.$eq)return;void 0!==n.$gte?"$gte"===t?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):void 0!==n.$gt?"$gte"===t?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e}(t,e,i):"$lt"===t||"$lte"===t?function(t,e,n){if(void 0!==n.$eq)return;void 0!==n.$lte?"$lte"===t?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):void 0!==n.$lt?"$lte"===t?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e}(t,e,i):"$ne"===t?function(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}(e,i):"$eq"===t?function(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}(e,i):void(i[t]=e)})}})}),e}var ge=-324,ye=3,ve="";function me(t,e){if(t===e)return 0;t=_e(t),e=_e(e);var n=Ee(t),r=Ee(e);if(n-r!=0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return function(t,e){return t===e?0:t>e?1:-1}(t,e)}return Array.isArray(t)?function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=me(t[r],e[r]);if(0!==i)return i}return t.length===e.length?0:t.length>e.length?1:-1}(t,e):function(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),s=0;s<i;s++){var o=me(n[s],r[s]);if(0!==o)return o;if(0!==(o=me(t[n[s]],e[r[s]])))return o}return n.length===r.length?0:n.length>r.length?1:-1}(t,e)}function _e(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=_e(e[r])}else{if(t instanceof Date)return t.toJSON();if(null!==t)for(var i in t={},e)if(e.hasOwnProperty(i)){var s=e[i];void 0!==s&&(t[i]=_e(s))}}}return t}function be(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return function(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",s=function(t,e,n){return function(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}(t,e,n)+t}(((r?-n:n)-ge).toString(),"0",ye);i+=ve+s;var o=Math.abs(parseFloat(e[0]));r&&(o=10-o);var a=o.toFixed(20);return a=a.replace(/\.?0+$/,""),i+=ve+a}(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,s="";if(e)for(;++r<i;)s+=we(n[r]);else for(;++r<i;){var o=n[r];s+=we(o)+we(t[o])}return s}return""}function we(t){return Ee(t=_e(t))+ve+be(t)+"\0"}function Se(t,e){var n,r=e;if("1"===t[e])n=0,e++;else{var i="0"===t[e];e++;var s="",o=t.substring(e,e+ye),a=parseInt(o,10)+ge;for(i&&(a=-a),e+=ye;;){var c=t[e];if("\0"===c)break;s+=c,e++}n=1===(s=s.split(".")).length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),i&&(n-=10),0!==a&&(n=parseFloat(n+"e"+a))}return{num:n,length:e-r}}function Ce(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(n);else if(s===t.length-2){i[t.pop()]=n}else t.push(n)}}function Ee(t){var e=["boolean","number","string","object"].indexOf(typeof t);return~e?null===t?1:Array.isArray(t)?5:e<3?e+2:e+3:Array.isArray(t)?5:void 0}function xe(t,e,n){if(t=t.filter(function(t){return Te(t.doc,e.selector,n)}),e.sort){var r=function(t){function e(e){return t.map(function(t){var n=le(fe(t));return ue(e,n)})}return function(t,n){var r=me(e(t.doc),e(n.doc));return 0!==r?r:function(t,e){return t<e?-1:t>e?1:0}(t.doc._id,n.doc._id)}}(e.sort);t=t.sort(r),"string"!=typeof e.sort[0]&&"desc"===function(t){return t[fe(t)]}(e.sort[0])&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,s=("limit"in e?e.limit:t.length)+i;t=t.slice(i,s)}return t}function Te(t,e,n){return n.every(function(n){var r=e[n],i=le(n),s=ue(t,i);return de(n)?function(t,e,n){if("$or"===t)return e.some(function(t){return Te(n,t,Object.keys(t))});if("$not"===t)return!Te(n,e,Object.keys(e));return!e.find(function(t){return Te(n,t,Object.keys(t))})}(n,r,t):Ae(r,t,i,s)})}function Ae(t,e,n,r){return!t||Object.keys(t).every(function(i){var s=t[i];return function(t,e,n,r,i){if(!Re[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Re[t](e,n,r,i)}(i,e,s,n,r)})}function ke(t){return void 0!==t&&null!==t}function Oe(t){return void 0!==t}function Pe(t,e){return e.some(function(e){return t instanceof Array?t.indexOf(e)>-1:t===e})}var Re={$elemMatch:function(t,e,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.some(function(t){return Te(t,e,Object.keys(e))}):r.some(function(r){return Ae(e,t,n,r)})))},$allMatch:function(t,e,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.every(function(t){return Te(t,e,Object.keys(e))}):r.every(function(r){return Ae(e,t,n,r)})))},$eq:function(t,e,n,r){return Oe(r)&&0===me(r,e)},$gte:function(t,e,n,r){return Oe(r)&&me(r,e)>=0},$gt:function(t,e,n,r){return Oe(r)&&me(r,e)>0},$lte:function(t,e,n,r){return Oe(r)&&me(r,e)<=0},$lt:function(t,e,n,r){return Oe(r)&&me(r,e)<0},$exists:function(t,e,n,r){return e?Oe(r):!Oe(r)},$mod:function(t,e,n,r){return ke(r)&&function(t,e){var n=e[0],r=e[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(t,10)===t&&t%n===r}(r,e)},$ne:function(t,e,n,r){return e.every(function(t){return 0!==me(r,t)})},$in:function(t,e,n,r){return ke(r)&&Pe(r,e)},$nin:function(t,e,n,r){return ke(r)&&!Pe(r,e)},$size:function(t,e,n,r){return ke(r)&&function(t,e){return t.length===e}(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&function(t,e){return e.every(function(e){return t.indexOf(e)>-1})}(r,e)},$regex:function(t,e,n,r){return ke(r)&&function(t,e){return new RegExp(e).test(t)}(r,e)},$type:function(t,e,n,r){return function(t,e){switch(e){case"null":return null===t;case"boolean":return"boolean"==typeof t;case"number":return"number"==typeof t;case"string":return"string"==typeof t;case"array":return t instanceof Array;case"object":return"[object Object]"==={}.toString.call(t)}throw new Error(e+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(r,e)}};function Ie(t,e){if("object"!=typeof e)throw new Error("Selector error: expected a JSON object");var n=xe([{doc:t}],{selector:e=function(t){var e=S(t),n=!1;"$and"in e&&(e=pe(e.$and),n=!0),["$or","$nor"].forEach(function(t){t in e&&e[t].forEach(function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var r=e[n],i=t[r];"object"==typeof i&&null!==i||(t[r]={$eq:i})}})}),"$not"in e&&(e.$not=pe([e.$not]));for(var r=Object.keys(e),i=0;i<r.length;i++){var s=r[i],o=e[s];"object"!=typeof o||null===o?o={$eq:o}:"$ne"in o&&!n&&(o.$ne=[o.$ne]),e[s]=o}return e}(e)},Object.keys(e));return n&&1===n.length}function Fe(t,e){if(t.selector&&t.filter&&"_selector"!==t.filter){var n="string"==typeof t.filter?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function De(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=ht(t.view):t.filter=ht(t.filter))}function Ne(t,e){return e.filter&&"string"==typeof e.filter&&!e.doc_ids&&!ut(t.db)}function je(t,e){var n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var r=it(Z,"`view` filter parameter not found or invalid.");return n(r)}var i=lt(e.view);t.db.get("_design/"+i[0],function(r,s){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(st(r));var o=s&&s.views&&s.views[i[1]]&&s.views[i[1]].map;if(!o)return n(it(K,s.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=function(t){return vt(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(o),t.doChanges(e)})}else if(e.selector)e.filter=function(t){return Ie(t,e.selector)},t.doChanges(e);else{var s=lt(e.filter);t.db.get("_design/"+s[0],function(r,i){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(st(r));var o=i&&i.filters&&i.filters[s[1]];if(!o)return n(it(K,i&&i.filters?"missing json key: "+s[1]:"missing json key: filters"));e.filter=function(t){return vt('"use strict";\nreturn '+t+";",{})}(o),t.doChanges(e)})}}function Me(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}ie.plugin(function(t){t._changesFilterPlugin={validate:Fe,normalize:De,shouldFilter:Ne,filter:je}}),ie.version="7.0.0";var Be=Me(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Le=Me(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function He(t){if(!/^\d+-./.test(t))return it(nt);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function qe(t,e,n){var r,i,s;n||(n={deterministic_revs:!0});var o={status:"available"};if(t._deleted&&(o.deleted=!0),e)if(t._id||(t._id=Dt()),i=Ft(t,n.deterministic_revs),t._rev){if((s=He(t._rev)).error)return s;t._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,o,[]]]]}],r=s.prefix+1}else t._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1;else if(t._revisions&&(t._rev_tree=function(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],s=1,o=r.length;s<o;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}(t._revisions,o),r=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if((s=He(t._rev)).error)return s;r=s.prefix,i=s.id,t._rev_tree=[{pos:r,ids:[i,o,[]]}]}ct(t._id),t._rev=r+"-"+i;var a={metadata:{},data:{}};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var u="_"===c[0];if(u&&!Be[c]){var l=it(X,c);throw l.message=X.message+": "+c,l}u&&!Le[c]?a.metadata[c.slice(1)]=t[c]:a.data[c]=t[c]}return a}function Ue(t,e,n){var r=function(t){try{return _t(t)}catch(t){return{error:it(J,"Attachment is not a valid base64 string")}}}(t.data);if(r.error)return n(r.error);t.length=r.length,t.data="blob"===e?St(r,t.content_type):"base64"===e?bt(r):r,Rt(r,function(e){t.digest="md5-"+e,n()})}function Ve(t,e,n){if(t.stub)return n();"string"==typeof t.data?Ue(t,e,n):function(t,e,n){Rt(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,"binary"===e?xt(t.data,function(e){t.data=e,n()}):"base64"===e?Tt(t.data,function(e){t.data=e,n()}):n()})}(t,e,n)}function Ke(t,e,n,r,i,s,o,a){if(function(t,e){for(var n,r=t.slice(),i=e.split("-"),s=parseInt(i[0],10),o=i[1];n=r.pop();){if(n.pos===s&&n.ids[0]===o)return!0;for(var a=n.ids[2],c=0,u=a.length;c<u;c++)r.push({pos:n.pos+1,ids:a[c]})}return!1}(e.rev_tree,n.metadata.rev)&&!a)return r[i]=n,s();var c=e.winningRev||Nt(e),u="deleted"in e?e.deleted:Qt(e,c),l="deleted"in n.metadata?n.metadata.deleted:Qt(n.metadata),h=/^1-/.test(n.metadata.rev);if(u&&!l&&a&&h){var d=n.data;d._rev=c,d._id=n.metadata.id,n=qe(d,a)}var f=zt(e.rev_tree,n.metadata.rev_tree[0],t);if(a&&(u&&l&&"new_leaf"!==f.conflicts||!u&&"new_leaf"!==f.conflicts||u&&!l&&"new_branch"===f.conflicts)){var p=it($);return r[i]=p,s()}var g=n.metadata.rev;n.metadata.rev_tree=f.tree,n.stemmedRevs=f.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var y=Nt(n.metadata),v=Qt(n.metadata,y),m=u===v?0:u<v?-1:1;o(n,y,v,g===y?v:Qt(n.metadata,g),!0,m,i,s)}function $e(t,e,n,r,i,s,o,a,c){t=t||1e3;var u=a.new_edits,l=new _,h=0,d=e.length;function f(){++h===d&&c&&c()}e.forEach(function(t,e){if(t._id&&Jt(t._id)){var r=t._deleted?"_removeLocal":"_putLocal";n[r](t,{ctx:i},function(t,n){s[e]=t||n,f()})}else{var o=t.metadata.id;l.has(o)?(d--,l.get(o).push([t,e])):l.set(o,[[t,e]])}}),l.forEach(function(e,n){var i=0;function c(){++i<e.length?l():f()}function l(){var l=e[i],h=l[0],d=l[1];if(r.has(n))Ke(t,r.get(n),h,s,d,c,o,u);else{var f=zt([],h.metadata.rev_tree[0],t);h.metadata.rev_tree=f.tree,h.stemmedRevs=f.stemmedRevs||[],function(t,e,n){var r=Nt(t.metadata),i=Qt(t.metadata,r);if("was_delete"in a&&i)return s[e]=it(K,"deleted"),n();if(u&&function(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}(t)){var c=it($);return s[e]=c,n()}o(t,r,i,i,!1,i?0:1,e,n)}(h,d,c)}}l()})}var We=5,ze="document-store",Ge="by-sequence",Qe="attach-store",Je="attach-seq-store",Ye="meta-store",Xe="local-store",Ze="detect-blob-support";function tn(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(it(et,n,e.type))}}function en(t,e,n){return{data:function(t){try{return JSON.stringify(t)}catch(e){return y.a.stringify(t)}}(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function nn(t){if(!t)return null;var e=function(t){try{return JSON.parse(t)}catch(e){return y.a.parse(t)}}(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function rn(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function sn(t,e,n,r){n?r(t?"string"!=typeof t?t:Ct(t,e):wt([""],{type:e})):t?"string"!=typeof t?Et(t,function(t){r(bt(t))}):r(t):r("")}function on(t,e,n,r){var i=Object.keys(t._attachments||{});if(!i.length)return r&&r();var s=0;function o(){++s===i.length&&r&&r()}i.forEach(function(r){e.attachments&&e.include_docs?function(t,e){var r=t._attachments[e],i=r.digest;n.objectStore(Qe).get(i).onsuccess=function(t){r.body=t.target.result.body,o()}}(t,r):(t._attachments[r].stub=!0,o())})}function an(t,e){return Promise.all(t.map(function(t){if(t.doc&&t.doc._attachments){var n=Object.keys(t.doc._attachments);return Promise.all(n.map(function(n){var r=t.doc._attachments[n];if("body"in r){var i=r.body,s=r.content_type;return new Promise(function(o){sn(i,s,e,function(e){t.doc._attachments[n]=q(P(r,["digest","content_type"]),{data:e}),o()})})}}))}}))}function cn(t,e,n){var r=[],i=n.objectStore(Ge),s=n.objectStore(Qe),o=n.objectStore(Je),a=t.length;function c(){--a||function(){if(!r.length)return;r.forEach(function(t){var e=o.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1));e.onsuccess=function(e){var n=e.target.result;n||s.delete(t)}})}()}t.forEach(function(t){var n=i.index("_doc_id_rev"),s=e+"::"+t;n.getKey(s).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return c();i.delete(e),o.index("seq").openCursor(IDBKeyRange.only(e)).onsuccess=function(t){var e=t.target.result;if(e){var n=e.value.digestSeq.split("::")[0];r.push(n),o.delete(e.primaryKey),e.continue()}else c()}}})}function un(t,e,n){try{return{txn:t.transaction(e,n)}}catch(t){return{error:t}}}var ln=new M;function hn(t,e,n,r,i,s){for(var o,a,c,u,l,h,d,f,p=e.docs,g=0,y=p.length;g<y;g++){var v=p[g];v._id&&Jt(v._id)||(v=p[g]=qe(v,n.new_edits,t)).error&&!d&&(d=v)}if(d)return s(d);var m=!1,b=0,w=new Array(p.length),S=new _,C=!1,E=r._meta.blobSupport?"blob":"base64";function x(){m=!0,T()}function T(){f&&m&&(f.docCount+=b,h.put(f))}function A(){C||(ln.notify(r._meta.name),s(null,w))}function k(t,e,n,r,i,s,o,a){t.metadata.winningRev=e,t.metadata.deleted=n;var c=t.data;if(c._id=t.metadata.id,c._rev=t.metadata.rev,r&&(c._deleted=!0),c._attachments&&Object.keys(c._attachments).length)return function(t,e,n,r,i,s){var o=t.data,a=0,c=Object.keys(o._attachments);function l(){a===c.length&&O(t,e,n,r,i,s)}function h(){a++,l()}c.forEach(function(n){var r=t.data._attachments[n];if(r.stub)a++,l();else{var i=r.data;delete r.data,r.revpos=parseInt(e,10);var s=r.digest;!function(t,e,n){u.count(t).onsuccess=function(r){var i=r.target.result;if(i)return n();var s={digest:t,body:e},o=u.put(s);o.onsuccess=n}}(s,i,h)}})}(t,e,n,i,o,a);b+=s,T(),O(t,e,n,i,o,a)}function O(t,e,n,i,s,u){var h=t.data,d=t.metadata;function f(s){var c=t.stemmedRevs||[];i&&r.auto_compaction&&(c=c.concat(function(t){var e=[];return jt(t.rev_tree,function(t,n,r,i,s){"available"!==s.status||t||(e.push(n+"-"+r),s.status="missing")}),e}(t.metadata))),c&&c.length&&cn(c,t.metadata.id,o),d.seq=s.target.result;var u=en(d,e,n);a.put(u).onsuccess=p}function p(){w[s]={ok:!0,id:d.id,rev:d.rev},S.set(t.metadata.id,t.metadata),function(t,e,n){var r=0,i=Object.keys(t.data._attachments||{});if(!i.length)return n();function s(){++r===i.length&&n()}function o(n){var r=t.data._attachments[n].digest,i=l.put({seq:e,digestSeq:r+"::"+e});i.onsuccess=s,i.onerror=function(t){t.preventDefault(),t.stopPropagation(),s()}}for(var a=0;a<i.length;a++)o(i[a])}(t,d.seq,u)}h._doc_id_rev=d.id+"::"+d.rev,delete h._id,delete h._rev;var g=c.put(h);g.onsuccess=f,g.onerror=function(t){t.preventDefault(),t.stopPropagation(),c.index("_doc_id_rev").getKey(h._doc_id_rev).onsuccess=function(t){c.put(h,t.target.result).onsuccess=f}}}!function(t,e,n){if(!t.length)return n();var r,i=0;function s(){i++,t.length===i&&(r?n(r):n())}t.forEach(function(t){var n=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],i=0;if(!n.length)return s();function o(t){r=t,++i===n.length&&s()}for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&Ve(t.data._attachments[a],e,o)})}(p,E,function(e){if(e)return s(e);!function(){var e=un(i,[ze,Ge,Qe,Xe,Je,Ye],"readwrite");if(e.error)return s(e.error);(o=e.txn).onabort=tn(s),o.ontimeout=tn(s),o.oncomplete=A,a=o.objectStore(ze),c=o.objectStore(Ge),u=o.objectStore(Qe),l=o.objectStore(Je),(h=o.objectStore(Ye)).get(Ye).onsuccess=function(t){f=t.target.result,T()},function(t){var e=[];if(p.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(n){var r=t.data._attachments[n];r.stub&&e.push(r.digest)})}),!e.length)return t();var n,r=0;e.forEach(function(i){!function(t,e){u.get(t).onsuccess=function(n){if(n.target.result)e();else{var r=it(rt,"unknown stub attachment with digest "+t);r.status=412,e(r)}}}(i,function(i){i&&!n&&(n=i),++r===e.length&&t(n)})})}(function(e){if(e)return C=!0,s(e);!function(){if(!p.length)return;var e=0;function i(){++e===p.length&&$e(t.revs_limit,p,r,S,o,w,k,n,x)}function s(t){var e=nn(t.target.result);e&&S.set(e.id,e),i()}for(var c=0,u=p.length;c<u;c++){var l=p[c];if(l._id&&Jt(l._id))i();else{var h=a.get(l.metadata.id);h.onsuccess=s}}}()})}()})}function dn(t,e,n,r,i){var s,o,a;function c(t){o=t.target.result,s&&i(s,o,a)}function u(t){s=t.target.result,o&&i(s,o,a)}function l(t){var e=t.target.result;if(!e)return i();i([e.key],[e.value],e)}-1===r&&(r=1e3),"function"==typeof t.getAll&&"function"==typeof t.getAllKeys&&r>1&&!n?(a={continue:function(){if(!s.length)return i();var n,a=s[s.length-1];if(e&&e.upper)try{n=IDBKeyRange.bound(a,e.upper,!0,e.upperOpen)}catch(t){if("DataError"===t.name&&0===t.code)return i()}else n=IDBKeyRange.lowerBound(a,!0);e=n,s=null,o=null,t.getAll(e,r).onsuccess=c,t.getAllKeys(e,r).onsuccess=u}},t.getAll(e,r).onsuccess=c,t.getAllKeys(e,r).onsuccess=u):n?t.openCursor(e,"prev").onsuccess=l:t.openCursor(e).onsuccess=l}function fn(t,e,n){var r,i,s="startkey"in t&&t.startkey,o="endkey"in t&&t.endkey,a="key"in t&&t.key,c="keys"in t&&t.keys,u=t.skip||0,l="number"==typeof t.limit?t.limit:-1,h=!1!==t.inclusive_end;if(!c&&(i=(r=function(t,e,n,r,i){try{if(t&&e)return i?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return i?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return i?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(t){return{error:t}}return null}(s,o,h,a,t.descending))&&r.error)&&("DataError"!==i.name||0!==i.code))return n(it(et,i.name,i.message));var d=[ze,Ge,Ye];t.attachments&&d.push(Qe);var f=un(e,d,"readonly");if(f.error)return n(f.error);var p=f.txn;p.oncomplete=function(){t.attachments?an(w,t.binary).then(x):x()},p.onabort=tn(n);var g,y,v=p.objectStore(ze),m=p.objectStore(Ge),_=p.objectStore(Ye),b=m.index("_doc_id_rev"),w=[];function S(e,n){var r={id:n.id,key:n.id,value:{rev:e}};n.deleted?c&&(w.push(r),r.value.deleted=!0,r.doc=null):u--<=0&&(w.push(r),t.include_docs&&function(e,n,r){var i=e.id+"::"+r;b.get(i).onsuccess=function(r){if(n.doc=rn(r.target.result)||{},t.conflicts){var i=Lt(e);i.length&&(n.doc._conflicts=i)}on(n.doc,t,p)}}(n,r,e))}function C(t){for(var e=0,n=t.length;e<n&&w.length!==l;e++){var r=t[e];if(r.error&&c)w.push(r);else{var i=nn(r);S(i.winningRev,i)}}}function E(t,e,n){n&&(C(e),w.length<l&&n.continue())}function x(){var e={total_rows:g,offset:t.skip,rows:w};t.update_seq&&void 0!==y&&(e.update_seq=y),n(null,e)}return _.get(Ye).onsuccess=function(t){g=t.target.result.docCount},t.update_seq&&function(t,e){t.openCursor(null,"prev").onsuccess=function(t){var n=t.target.result,r=void 0;n&&n.key&&(r=n.key);return e({target:{result:[r]}})}}(m,function(t){t.target.result&&t.target.result.length>0&&(y=t.target.result[0])}),i||0===l?void 0:c?function(t,e,n){var r=new Array(t.length),i=0;t.forEach(function(s,o){e.get(s).onsuccess=function(e){e.target.result?r[o]=e.target.result:r[o]={key:s,error:"not_found"},++i===t.length&&n(t,r,{})}})}(t.keys,v,E):-1===l?function(t,e,n){if("function"!=typeof t.getAll){var r=[];t.openCursor(e).onsuccess=function(t){var e=t.target.result;e?(r.push(e.value),e.continue()):n({target:{result:r}})}}else t.getAll(e).onsuccess=n}(v,r,function(e){var n=e.target.result;t.descending&&(n=n.reverse()),C(n)}):void dn(v,r,t.descending,l+u,E)}var pn=!1,gn=[];function yn(){!pn&&gn.length&&(pn=!0,gn.shift()())}function vn(t,e,n,r){if((t=S(t)).continuous){var i=n+":"+Dt();return ln.addListener(n,i,e,t),ln.notify(n),{cancel:function(){ln.removeListener(n,i)}}}var s=t.doc_ids&&new m(t.doc_ids);t.since=t.since||0;var o=t.since,a="limit"in t?t.limit:-1;0===a&&(a=1);var c,u,l,h,d=[],f=0,p=ot(t),g=new _;function y(t,e,n,r){if(n.seq!==e)return r();if(n.winningRev===t._rev)return r(n,t);var i=t._id+"::"+n.winningRev;h.get(i).onsuccess=function(t){r(n,rn(t.target.result))}}function v(){t.complete(null,{results:d,last_seq:o})}var b=[ze,Ge];t.attachments&&b.push(Qe);var w=un(r,b,"readonly");if(w.error)return t.complete(w.error);(c=w.txn).onabort=tn(t.complete),c.oncomplete=function(){!t.continuous&&t.attachments?an(d).then(v):v()},u=c.objectStore(Ge),l=c.objectStore(ze),h=u.index("_doc_id_rev"),dn(u,t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null,t.descending,a,function(e,n,r){if(r&&e.length){var i=new Array(e.length),u=new Array(e.length),h=0;n.forEach(function(n,o){!function(t,e,n){if(s&&!s.has(t._id))return n();var r=g.get(t._id);if(r)return y(t,e,r,n);l.get(t._id).onsuccess=function(i){r=nn(i.target.result),g.set(t._id,r),y(t,e,r,n)}}(rn(n),e[o],function(n,s){u[o]=n,i[o]=s,++h===e.length&&function(){for(var e=[],n=0,s=i.length;n<s&&f!==a;n++){var o=i[n];if(o){var c=u[n];e.push(v(c,o))}}Promise.all(e).then(function(e){for(var n=0,r=e.length;n<r;n++)e[n]&&t.onChange(e[n])}).catch(t.complete),f!==a&&r.continue()}()})})}function v(e,n){var r=t.processChange(n,e,t);o=r.seq=e.seq;var i=p(r);return"object"==typeof i?Promise.reject(i):i?(f++,t.return_docs&&d.push(r),t.attachments&&t.include_docs?new Promise(function(e){on(n,t,c,function(){an([r],t.binary).then(function(){e(r)})})}):Promise.resolve(r)):Promise.resolve()}})}var mn,_n=new _,bn=new _;function wn(t,e){var n=this;!function(t,e,n){gn.push(function(){t(function(t,r){!function(t,e,n,r){try{t(e,n)}catch(e){r.emit("error",e)}}(e,t,r,n),pn=!1,a()(function(){yn()})})}),yn()}(function(e){!function(t,e,n){var r=e.name,i=null;function s(t,e){var n=t.objectStore(ze);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(t){var r=t.target.result;if(r){var i=r.value,s=Qt(i);i.deletedOrLocal=s?"1":"0",n.put(i),r.continue()}else e()}}function o(t,e){var n=t.objectStore(Xe),r=t.objectStore(ze),i=t.objectStore(Ge),s=r.openCursor();s.onsuccess=function(t){var s=t.target.result;if(s){var o=s.value,a=o.id,c=Jt(a),u=Nt(o);if(c){var l=a+"::"+u,h=a+"::",d=a+"::~",f=i.index("_doc_id_rev"),p=IDBKeyRange.bound(h,d,!1,!1),g=f.openCursor(p);g.onsuccess=function(t){if(g=t.target.result){var e=g.value;e._doc_id_rev===l&&n.put(e),i.delete(g.primaryKey),g.continue()}else r.delete(s.primaryKey),s.continue()}}else s.continue()}else e&&e()}}function c(t,e){var n=t.objectStore(Ge),r=t.objectStore(Qe),i=t.objectStore(Je),s=r.count();s.onsuccess=function(t){var r=t.target.result;if(!r)return e();n.openCursor().onsuccess=function(t){var n=t.target.result;if(!n)return e();for(var r=n.value,s=n.primaryKey,o=Object.keys(r._attachments||{}),a={},c=0;c<o.length;c++){var u=r._attachments[o[c]];a[u.digest]=!0}var l=Object.keys(a);for(c=0;c<l.length;c++){var h=l[c];i.put({seq:s,digestSeq:h+"::"+s})}n.continue()}}}function u(t){var e=t.objectStore(Ge),n=t.objectStore(ze),r=n.openCursor();r.onsuccess=function(t){var r=t.target.result;if(r){var i=function(t){if(!t.data)return t.deleted="1"===t.deletedOrLocal,t;return nn(t)}(r.value);if(i.winningRev=i.winningRev||Nt(i),i.seq)return s();!function(){var t=i.id+"::",n=i.id+"::￿",r=0;e.index("_doc_id_rev").openCursor(IDBKeyRange.bound(t,n)).onsuccess=function(t){var e=t.target.result;if(!e)return i.seq=r,s();var n=e.primaryKey;n>r&&(r=n),e.continue()}}()}function s(){var t=en(i,i.winningRev,i.deleted),e=n.put(t);e.onsuccess=function(){r.continue()}}}}t._meta=null,t._remote=!1,t.type=function(){return"idb"},t._id=E(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(n,r,s){hn(e,n,r,t,i,s)},t._get=function(t,e,n){var r,s,o,a=e.ctx;if(!a){var c=un(i,[ze,Ge,Qe],"readonly");if(c.error)return n(c.error);a=c.txn}function u(){n(o,{doc:r,metadata:s,ctx:a})}a.objectStore(ze).get(t).onsuccess=function(t){if(!(s=nn(t.target.result)))return o=it(K,"missing"),u();var n;if(e.rev)n=e.latest?function(t,e){for(var n,r=e.rev_tree.slice();n=r.pop();){var i=n.pos,s=n.ids,o=s[0],a=s[1],c=s[2],u=0===c.length,l=n.history?n.history.slice():[];if(l.push({id:o,pos:i,opts:a}),u)for(var h=0,d=l.length;h<d;h++){var f=l[h];if(f.pos+"-"+f.id===t)return i+"-"+o}for(var p=0,g=c.length;p<g;p++)r.push({pos:i+1,ids:c[p],history:l})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}(e.rev,s):e.rev;else{n=s.winningRev;var i=Qt(s);if(i)return o=it(K,"deleted"),u()}var c=a.objectStore(Ge),l=s.id+"::"+n;c.index("_doc_id_rev").get(l).onsuccess=function(t){if((r=t.target.result)&&(r=rn(r)),!r)return o=it(K,"missing"),u();u()}}},t._getAttachment=function(t,e,n,r,s){var o;if(r.ctx)o=r.ctx;else{var a=un(i,[ze,Ge,Qe],"readonly");if(a.error)return s(a.error);o=a.txn}var c=n.digest,u=n.content_type;o.objectStore(Qe).get(c).onsuccess=function(t){var e=t.target.result.body;sn(e,u,r.binary,function(t){s(null,t)})}},t._info=function(e){var n,r,s=un(i,[Ye,Ge],"readonly");if(s.error)return e(s.error);var o=s.txn;o.objectStore(Ye).get(Ye).onsuccess=function(t){r=t.target.result.docCount},o.objectStore(Ge).openCursor(null,"prev").onsuccess=function(t){var e=t.target.result;n=e?e.key:0},o.oncomplete=function(){e(null,{doc_count:r,update_seq:n,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(t,e){fn(t,i,e)},t._changes=function(e){return vn(e,t,r,i)},t._close=function(t){i.close(),_n.delete(r),t()},t._getRevisionTree=function(t,e){var n=un(i,[ze],"readonly");if(n.error)return e(n.error);var r=n.txn,s=r.objectStore(ze).get(t);s.onsuccess=function(t){var n=nn(t.target.result);n?e(null,n.rev_tree):e(it(K))}},t._doCompaction=function(t,e,n){var r=[ze,Ge,Qe,Je],s=un(i,r,"readwrite");if(s.error)return n(s.error);var o=s.txn,a=o.objectStore(ze);a.get(t).onsuccess=function(n){var r=nn(n.target.result);jt(r.rev_tree,function(t,n,r,i,s){var o=n+"-"+r;-1!==e.indexOf(o)&&(s.status="missing")}),cn(e,t,o);var i=r.winningRev,s=r.deleted;o.objectStore(ze).put(en(r,i,s))},o.onabort=tn(n),o.oncomplete=function(){n()}},t._getLocal=function(t,e){var n=un(i,[Xe],"readonly");if(n.error)return e(n.error);var r=n.txn,s=r.objectStore(Xe).get(t);s.onerror=tn(e),s.onsuccess=function(t){var n=t.target.result;n?(delete n._doc_id_rev,e(null,n)):e(it(K))}},t._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var r=t._rev,s=t._id;t._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var o,a=e.ctx;if(!a){var c=un(i,[Xe],"readwrite");if(c.error)return n(c.error);(a=c.txn).onerror=tn(n),a.oncomplete=function(){o&&n(null,o)}}var u,l=a.objectStore(Xe);r?(u=l.get(s)).onsuccess=function(i){var s=i.target.result;if(s&&s._rev===r){var a=l.put(t);a.onsuccess=function(){o={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,o)}}else n(it($))}:((u=l.add(t)).onerror=function(t){n(it($)),t.preventDefault(),t.stopPropagation()},u.onsuccess=function(){o={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,o)})},t._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={});var r,s=e.ctx;if(!s){var o=un(i,[Xe],"readwrite");if(o.error)return n(o.error);(s=o.txn).oncomplete=function(){r&&n(null,r)}}var a=t._id,c=s.objectStore(Xe),u=c.get(a);u.onerror=tn(n),u.onsuccess=function(i){var s=i.target.result;s&&s._rev===t._rev?(c.delete(a),r={ok:!0,id:a,rev:"0-0"},e.ctx&&n(null,r)):n(it(K))}},t._destroy=function(t,e){ln.removeAllListeners(r);var n=bn.get(r);n&&n.result&&(n.result.close(),_n.delete(r));var i=indexedDB.deleteDatabase(r);i.onsuccess=function(){bn.delete(r),j()&&r in localStorage&&delete localStorage[r],e(null,{ok:!0})},i.onerror=tn(e)};var l=_n.get(r);if(l)return i=l.idb,t._meta=l.global,a()(function(){n(null,t)});var h=indexedDB.open(r,We);bn.set(r,h),h.onupgradeneeded=function(t){var e=t.target.result;if(t.oldVersion<1)return function(t){var e=t.createObjectStore(ze,{keyPath:"id"});t.createObjectStore(Ge,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(Qe,{keyPath:"digest"}),t.createObjectStore(Ye,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(Ze),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(Xe,{keyPath:"_id"});var n=t.createObjectStore(Je,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(e);var n=t.currentTarget.transaction;t.oldVersion<3&&function(t){t.createObjectStore(Xe,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(e),t.oldVersion<4&&function(t){var e=t.createObjectStore(Je,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}(e);var r=[s,o,c,u],i=t.oldVersion;!function t(){var e=r[i-1];i++;e&&e(n,t)}()},h.onsuccess=function(e){(i=e.target.result).onversionchange=function(){i.close(),_n.delete(r)},i.onabort=function(t){B("error","Database has a global failure",t.target.error),i.close(),_n.delete(r)};var s,o,a,c,u=i.transaction([Ye,Ze,ze],"readwrite"),l=!1;function h(){void 0!==a&&l&&(t._meta={name:r,instanceId:c,blobSupport:a},_n.set(r,{idb:i,global:t._meta}),n(null,t))}function d(){if(void 0!==o&&void 0!==s){var t=r+"_id";t in s?c=s[t]:s[t]=c=Dt(),s.docCount=o,u.objectStore(Ye).put(s)}}u.objectStore(Ye).get(Ye).onsuccess=function(t){s=t.target.result||{id:Ye},d()},function(t,e){t.objectStore(ze).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(t){e(t.target.result)}}(u,function(t){o=t,d()}),mn||(mn=function(t){return new Promise(function(e){var n=wt([""]),r=t.objectStore(Ze).put(n,"key");r.onsuccess=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)},r.onerror=t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)}}).catch(function(){return!1})}(u)),mn.then(function(t){a=t,h()}),u.oncomplete=function(){l=!0,h()},u.onabort=tn(n)},h.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";B("error",t),n(it(et,t))}}(n,t,e)},e,n.constructor)}wn.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}};var Sn=25,Cn=50,En=5e3,xn=1e4,Tn={};function An(t){var e=(t.doc||t.ok)._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];n.data=Ct(n.data,n.content_type)})}function kn(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function On(t){return t._attachments&&Object.keys(t._attachments)?Promise.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new Promise(function(t){Tt(n.data,t)}).then(function(t){n.data=t})})):Promise.resolve()}function Pn(t,e){if(function(t){if(!t.prefix)return!1;var e=yt(t.prefix).protocol;return"http"===e||"https"===e}(e)){var n=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var r=yt(t);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var i=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=i.pop(),-1===r.db.indexOf("%")&&(r.db=encodeURIComponent(r.db)),r.path=i.join("/"),r}function Rn(t,e){return In(t,t.db+"/"+e)}function In(t,e){var n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function Fn(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function Dn(t,e){var n=this,i=Pn(t.name,t),o=Rn(i,"");t=S(t);var c,u=function(e,n){if((n=n||{}).headers=n.headers||new ae,t.auth||i.auth){var r=t.auth||i.auth,s=r.username+":"+r.password,o=bt(unescape(encodeURIComponent(s)));n.headers.set("Authorization","Basic "+o)}var a=t.headers||{};return Object.keys(a).forEach(function(t){n.headers.append(t,a[t])}),function(t){var e="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==e.indexOf("msie"),r=-1!==e.indexOf("trident"),i=-1!==e.indexOf("edge"),s=!("method"in t)||"GET"===t.method;return(n||r||i)&&s}(n)&&(e+=(-1===e.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(t.fetch||oe)(e,n)};function l(t,e){return x(t,s()(function(t){d().then(function(){return e.apply(this,t)}).catch(function(e){t.pop()(e)})})).bind(n)}function h(t,e,n){var r={};return(e=e||{}).headers=e.headers||new ae,e.headers.get("Content-Type")||e.headers.set("Content-Type","application/json"),e.headers.get("Accept")||e.headers.set("Accept","application/json"),u(t,e).then(function(t){return r.ok=t.ok,r.status=t.status,t.json()}).then(function(t){if(r.data=t,!r.ok){r.data.status=r.status;var e=st(r.data);if(n)return n(e);throw e}if(Array.isArray(r.data)&&(r.data=r.data.map(function(t){return t.error||t.missing?st(t):t})),!n)return r;n(null,r.data)})}function d(){return t.skip_setup?Promise.resolve():c||((c=h(o).catch(function(t){return t&&t.status&&404===t.status?(H(404,"PouchDB is just detecting if the remote exists."),h(o,{method:"PUT"})):Promise.reject(t)}).catch(function(t){return!(!t||!t.status||412!==t.status)||Promise.reject(t)})).catch(function(){c=null}),c)}function f(t){return t.split("/").map(encodeURIComponent).join("/")}a()(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=l("id",function(t){u(In(i,"")).then(function(t){return t.json()}).then(function(e){var n=e&&e.uuid?e.uuid+i.db:Rn(i,"");t(null,n)}).catch(function(e){t(e)})}),n.compact=l("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=S(t),h(Rn(i,"_compact"),{method:"POST"}).then(function(){!function r(){n.info(function(n,i){i&&!i.compact_running?e(null,{ok:!0}):setTimeout(r,t.interval||200)})}()})}),n.bulkGet=x("bulkGet",function(t,e){var n=this;function r(e){var n={};t.revs&&(n.revs=!0),t.attachments&&(n.attachments=!0),t.latest&&(n.latest=!0),h(Rn(i,"_bulk_get"+Fn(n)),{method:"POST",body:JSON.stringify({docs:t.docs})}).then(function(n){t.attachments&&t.binary&&n.data.results.forEach(function(t){t.docs.forEach(An)}),e(null,n.data)}).catch(e)}function s(){var r=Cn,i=Math.ceil(t.docs.length/r),s=0,o=new Array(i);function a(t){return function(n,r){o[t]=r.results,++s===i&&e(null,{results:at(o)})}}for(var c=0;c<i;c++){var u=P(t,["revs","attachments","binary","latest"]);u.docs=t.docs.slice(c*r,Math.min(t.docs.length,(c+1)*r)),N(n,u,a(c))}}var o=In(i,""),a=Tn[o];"boolean"!=typeof a?r(function(t,n){t?(Tn[o]=!1,H(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),s()):(Tn[o]=!0,e(null,n))}):a?r(e):s()}),n._info=function(t){d().then(function(){return u(Rn(i,""))}).then(function(t){return t.json()}).then(function(e){e.host=Rn(i,""),t(null,e)}).catch(t)},n.fetch=function(t,e){return d().then(function(){return u(Rn(i,t),e)})},n.get=l("get",function(t,e,n){"function"==typeof e&&(n=e,e={});var s={};function o(t){var n=t._attachments,s=n&&Object.keys(n);if(n&&s.length)return function(t,e){return new Promise(function(n,r){var i,s=0,o=0,a=0,c=t.length;function u(){++a===c?i?r(i):n():d()}function l(){s--,u()}function h(t){s--,i=i||t,u()}function d(){for(;s<e&&o<c;)s++,t[o++]().then(l,h)}d()})}(s.map(function(s){return function(){return function(s){var o=n[s],a=kn(t._id)+"/"+f(s)+"?rev="+t._rev;return u(Rn(i,a)).then(function(t){return void 0===r||r.browser?t.blob():t.buffer()}).then(function(t){return e.binary?(void 0===r||r.browser||(t.type=o.content_type),t):new Promise(function(e){Tt(t,e)})}).then(function(t){delete o.stub,delete o.length,o.data=t})}(s)}}),5)}(e=S(e)).revs&&(s.revs=!0),e.revs_info&&(s.revs_info=!0),e.latest&&(s.latest=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),s.open_revs=e.open_revs),e.rev&&(s.rev=e.rev),e.conflicts&&(s.conflicts=e.conflicts),e.update_seq&&(s.update_seq=e.update_seq),t=kn(t),h(Rn(i,t+Fn(s))).then(function(t){return Promise.resolve().then(function(){if(e.attachments)return function(t){return Array.isArray(t)?Promise.all(t.map(function(t){if(t.ok)return o(t.ok)})):o(t)}(t.data)}).then(function(){n(null,t.data)})}).catch(function(e){e.docId=t,n(e)})}),n.remove=l("remove",function(t,e,n,r){var s;"string"==typeof e?(s={_id:t,_rev:e},"function"==typeof n&&(r=n,n={})):(s=t,"function"==typeof e?(r=e,n={}):(r=n,n=e));var o=s._rev||n.rev;h(Rn(i,kn(s._id))+"?rev="+o,{method:"DELETE"},r).catch(r)}),n.getAttachment=l("getAttachment",function(t,e,n,s){"function"==typeof n&&(s=n,n={});var o,a=n.rev?"?rev="+n.rev:"",c=Rn(i,kn(t))+"/"+f(e)+a;u(c,{method:"GET"}).then(function(t){if(o=t.headers.get("content-type"),t.ok)return void 0===r||r.browser?t.blob():t.buffer();throw t}).then(function(t){void 0===r||r.browser||(t.type=o),s(null,t)}).catch(function(t){s(t)})}),n.removeAttachment=l("removeAttachment",function(t,e,n,r){h(Rn(i,kn(t)+"/"+f(e))+"?rev="+n,{method:"DELETE"},r).catch(r)}),n.putAttachment=l("putAttachment",function(t,e,n,r,s,o){"function"==typeof s&&(o=s,s=r,r=n,n=null);var a=kn(t)+"/"+f(e),c=Rn(i,a);if(n&&(c+="?rev="+n),"string"==typeof r){var u;try{u=_t(r)}catch(t){return o(it(J,"Attachment is not a valid base64 string"))}r=u?St(u,s):""}h(c,{headers:new ae({"Content-Type":s}),method:"PUT",body:r},o).catch(o)}),n._bulkDocs=function(t,e,n){t.new_edits=e.new_edits,d().then(function(){return Promise.all(t.docs.map(On))}).then(function(){return h(Rn(i,"_bulk_docs"),{method:"POST",body:JSON.stringify(t)},n)}).catch(n)},n._put=function(t,e,n){d().then(function(){return On(t)}).then(function(){return h(Rn(i,kn(t._id)),{method:"PUT",body:JSON.stringify(t)})}).then(function(t){n(null,t.data)}).catch(function(e){e.docId=t&&t._id,n(e)})},n.allDocs=l("allDocs",function(t,e){"function"==typeof t&&(e=t,t={});var n,r={},s="GET";(t=S(t)).conflicts&&(r.conflicts=!0),t.update_seq&&(r.update_seq=!0),t.descending&&(r.descending=!0),t.include_docs&&(r.include_docs=!0),t.attachments&&(r.attachments=!0),t.key&&(r.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(r.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(r.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(r.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(r.limit=t.limit),void 0!==t.skip&&(r.skip=t.skip);var o=Fn(r);void 0!==t.keys&&(s="POST",n={keys:t.keys}),h(Rn(i,"_all_docs"+o),{method:s,body:JSON.stringify(n)}).then(function(n){t.include_docs&&t.attachments&&t.binary&&n.data.rows.forEach(An),e(null,n.data)}).catch(e)}),n._changes=function(t){var e="batch_size"in t?t.batch_size:Sn;!(t=S(t)).continuous||"heartbeat"in t||(t.heartbeat=xn);var n="timeout"in t?t.timeout:3e4;"timeout"in t&&t.timeout&&n-t.timeout<En&&(n=t.timeout+En),"heartbeat"in t&&t.heartbeat&&n-t.heartbeat<En&&(n=t.heartbeat+En);var r={};"timeout"in t&&t.timeout&&(r.timeout=t.timeout);var s=void 0!==t.limit&&t.limit,o=s;if(t.style&&(r.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(r.include_docs=!0),t.attachments&&(r.attachments=!0),t.continuous&&(r.feed="longpoll"),t.seq_interval&&(r.seq_interval=t.seq_interval),t.conflicts&&(r.conflicts=!0),t.descending&&(r.descending=!0),t.update_seq&&(r.update_seq=!0),"heartbeat"in t&&t.heartbeat&&(r.heartbeat=t.heartbeat),t.filter&&"string"==typeof t.filter&&(r.filter=t.filter),t.view&&"string"==typeof t.view&&(r.filter="_view",r.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var c in t.query_params)t.query_params.hasOwnProperty(c)&&(r[c]=t.query_params[c]);var u,l="GET";t.doc_ids?(r.filter="_doc_ids",l="POST",u={doc_ids:t.doc_ids}):t.selector&&(r.filter="_selector",l="POST",u={selector:t.selector});var f,p=new se,g=function(n,a){if(!t.aborted){r.since=n,"object"==typeof r.since&&(r.since=JSON.stringify(r.since)),t.descending?s&&(r.limit=o):r.limit=!s||o>e?e:o;var c=Rn(i,"_changes"+Fn(r)),g={signal:p.signal,method:l,body:JSON.stringify(u)};f=n,t.aborted||d().then(function(){return h(c,g,a)}).catch(a)}},y={results:[]},v=function(n,r){if(!t.aborted){var i=0;if(r&&r.results){i=r.results.length,y.last_seq=r.last_seq;var c=null,u=null;"number"==typeof r.pending&&(c=r.pending),"string"!=typeof y.last_seq&&"number"!=typeof y.last_seq||(u=y.last_seq);t.query_params,r.results=r.results.filter(function(e){o--;var n=ot(t)(e);return n&&(t.include_docs&&t.attachments&&t.binary&&An(e),t.return_docs&&y.results.push(e),t.onChange(e,c,u)),n})}else if(n)return t.aborted=!0,void t.complete(n);r&&r.last_seq&&(f=r.last_seq);var l=s&&o<=0||r&&i<e||t.descending;(!t.continuous||s&&o<=0)&&l?t.complete(null,y):a()(function(){g(f,v)})}};return g(t.since||0,v),{cancel:function(){t.aborted=!0,p.abort()}}},n.revsDiff=l("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={}),h(Rn(i,"_revs_diff"),{method:"POST",body:JSON.stringify(t)},n).catch(n)}),n._close=function(t){t()},n._destroy=function(t,e){h(Rn(i,""),{method:"DELETE"}).then(function(t){e(null,t)}).catch(function(t){404===t.status?e(null,{ok:!0}):e(t)})}}function Nn(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Nn)}catch(t){}}function jn(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,jn)}catch(t){}}function Mn(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Mn)}catch(t){}}function Bn(t,e){return e&&t.then(function(t){a()(function(){e(null,t)})},function(t){a()(function(){e(t)})}),t}function Ln(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function Hn(t){var e=new m(t),n=new Array(e.size),r=-1;return e.forEach(function(t){n[++r]=t}),n}function qn(t){var e=new Array(t.size),n=-1;return t.forEach(function(t,r){e[++n]=r}),e}function Un(t){return new Mn("builtin "+t+" function requires map values to be numbers or number arrays")}function Vn(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];if("number"!=typeof i){if(!Array.isArray(i))throw Un("_sum");e="number"==typeof e?[e]:e;for(var s=0,o=i.length;s<o;s++){var a=i[s];if("number"!=typeof a)throw Un("_sum");void 0===e[s]?e.push(a):e[s]+=a}}else"number"==typeof e?e+=i:e[0]+=i}return e}Dn.valid=function(){return!0},l()(Nn,Error),l()(jn,Error),l()(Mn,Error);var Kn=B.bind(null,"log"),$n=Array.isArray,Wn=JSON.parse;function zn(t,e){return vt("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Vn,log:Kn,isArray:$n,toJSON:Wn})}function Gn(){this.promise=new Promise(function(t){t()})}function Qn(t){if(!t)return"undefined";switch(typeof t){case"function":case"string":return t.toString();default:return JSON.stringify(t)}}function Jn(t,e,n,r,i,s){var o,a=function(t,e){return Qn(t)+Qn(e)+"undefined"}(n,r);if(!i&&(o=t._cachedViews=t._cachedViews||{})[a])return o[a];var c=t.info().then(function(c){var u=c.db_name+"-mrview-"+(i?"temp":It(a));return mt(t,"_local/"+s,function(t){t.views=t.views||{};var n=e;-1===n.indexOf("/")&&(n=e+"/"+e);var r=t.views[n]=t.views[n]||{};if(!r[u])return r[u]=!0,t}).then(function(){return t.registerDependentDatabase(u).then(function(e){var i=e.db;i.auto_compaction=!0;var s={name:u,db:i,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};return s.db.get("_local/lastSeq").catch(function(t){if(404!==t.status)throw t}).then(function(t){return s.seq=t?t.seq:0,o&&s.db.once("destroyed",function(){delete o[a]}),s})})})});return o&&(o[a]=c),c}Gn.prototype.add=function(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise},Gn.prototype.finish=function(){return this.promise};var Yn={},Xn=new Gn,Zn=50;function tr(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function er(t,e){try{t.emit("error",e)}catch(t){B("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),B("error",e)}}var nr={_sum:function(t,e){return Vn(e)},_count:function(t,e){return e.length},_stats:function(t,e){return{sum:Vn(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:function(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];e+=i*i}return e}(e)}}};var rr=function(t,e,n,r){function i(t,e,n){try{e(n)}catch(e){er(t,e)}}function o(t,e,n,r,i){try{return{output:e(n,r,i)}}catch(e){return er(t,e),{error:e}}}function c(t,e){var n=me(t.key,e.key);return 0!==n?n:me(t.value,e.value)}function u(t){var e=t.value;return e&&"object"==typeof e&&e._id||t.id}function l(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&function(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];e[t].data=Ct(n.data,n.content_type)})})}(e),e}}function h(t,e,n,r){var i=e[t];void 0!==i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),n.push(t+"="+i))}function d(t){if(void 0!==t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function f(t,e){var n=t.descending?"endkey":"startkey",r=t.descending?"startkey":"endkey";if(void 0!==t[n]&&void 0!==t[r]&&me(t[n],t[r])>0)throw new Nn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&!1!==t.reduce){if(t.include_docs)throw new Nn("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new Nn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var n=function(t){if(t){if("number"!=typeof t)return new Nn('Invalid value for integer: "'+t+'"');if(t<0)return new Nn('Invalid value for positive integer: "'+t+'"')}}(t[e]);if(n)throw n})}function p(t){return function(e){if(404===e.status)return t;throw e}}function g(t,e,n){var r="_local/doc_"+t,i={_id:r,keys:[]},s=n.get(t),o=s[0];return(function(t){return 1===t.length&&/^1-/.test(t[0].rev)}(s[1])?Promise.resolve(i):e.db.get(r).catch(p(i))).then(function(t){return function(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):Promise.resolve({rows:[]})}(t).then(function(e){return function(t,e){for(var n=[],r=new m,i=0,s=e.rows.length;i<s;i++){var a=e.rows[i].doc;if(a&&(n.push(a),r.add(a._id),a._deleted=!o.has(a._id),!a._deleted)){var c=o.get(a._id);"value"in c&&(a.value=c.value)}}var u=qn(o);return u.forEach(function(t){if(!r.has(t)){var e={_id:t},i=o.get(t);"value"in i&&(e.value=i.value),n.push(e)}}),t.keys=Hn(u.concat(t.keys)),n.push(t),n}(t,e)})})}function y(t){var e="string"==typeof t?t:t.name,n=Yn[e];return n||(n=Yn[e]=new Gn),n}function v(t){return Ln(y(t),function(){return function(t){var n,r,s=e(t.mapFun,function(t,e){var i={id:r._id,key:_e(t)};void 0!==e&&null!==e&&(i.value=_e(e)),n.push(i)}),o=t.seq||0;function a(e,n){return function(){return function(t,e,n){return t.db.get("_local/lastSeq").catch(p({_id:"_local/lastSeq",seq:0})).then(function(r){var i=qn(e);return Promise.all(i.map(function(n){return g(n,t,e)})).then(function(e){var i=at(e);return r.seq=n,i.push(r),t.db.bulkDocs({docs:i})})})}(t,e,n)}}var u=new Gn;function l(){return t.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:o,limit:Zn}).then(h)}function h(e){var h=e.results;if(h.length){var f=function(e){for(var a=new _,u=0,l=e.length;u<l;u++){var h=e[u];if("_"!==h.doc._id[0]){n=[],(r=h.doc)._deleted||i(t.sourceDB,s,r),n.sort(c);var f=d(n);a.set(h.doc._id,[f,h.changes])}o=h.seq}return a}(h);if(u.add(a(f,o)),!(h.length<Zn))return l()}}function d(t){for(var e,n=new _,r=0,i=t.length;r<i;r++){var s=t[r],o=[s.key,s.id];r>0&&0===me(s.key,e)&&o.push(r),n.set(we(o),s),e=s.key}return n}return l().then(function(){return u.finish()}).then(function(){t.seq=o})}(t)})()}function b(t,e){return Ln(y(t),function(){return function(t,e){var r,i=t.reduceFun&&!1!==e.reduce,s=e.skip||0;function a(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return r=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),n=["id","key","value"];if(!(e<n||e>n))return t.doc.value}var r=function(t){for(var e=[],n=[],r=0;;){var i=t[r++];if("\0"!==i)switch(i){case"1":e.push(null);break;case"2":e.push("1"===t[r]),r++;break;case"3":var s=Se(t,r);e.push(s.num),r+=s.length;break;case"4":for(var o="";;){var a=t[r];if("\0"===a)break;o+=a,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(o);break;case"5":var c={element:[],index:e.length};e.push(c.element),n.push(c);break;case"6":var u={element:{},index:e.length};e.push(u.element),n.push(u);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===e.length)return e.pop();Ce(e,n)}}}(t.doc._id);return{key:r[0],id:r[1],value:"value"in t.doc?t.doc.value:null}})})}function c(a){var c;if(c=i?function(t,e,r){0===r.group_level&&delete r.group_level;var i=r.group||r.group_level,s=n(t.reduceFun),a=[],c=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;e.forEach(function(t){var e=a[a.length-1],n=i?t.key:null;if(i&&Array.isArray(n)&&(n=n.slice(0,c)),e&&0===me(e.groupKey,n))return e.keys.push([t.key,t.id]),void e.values.push(t.value);a.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),e=[];for(var u=0,l=a.length;u<l;u++){var h=a[u],d=o(t.sourceDB,s,h.keys,h.values,!1);if(d.error&&d.error instanceof Mn)throw d.error;e.push({value:d.error?null:d.output,key:h.groupKey})}return{rows:function(t,e,n){return n=n||0,"number"==typeof e?t.slice(n,e+n):n>0?t.slice(n):t}(e,r.limit,r.skip)}}(t,a,e):{total_rows:r,offset:s,rows:a},e.update_seq&&(c.update_seq=t.seq),e.include_docs){var l=Hn(a.map(u));return t.sourceDB.allDocs({keys:l,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e=new _;return t.rows.forEach(function(t){e.set(t.id,t.doc)}),a.forEach(function(t){var n=u(t),r=e.get(n);r&&(t.doc=r)}),c})}return c}if(void 0===e.keys||e.keys.length||(e.limit=0,delete e.keys),void 0!==e.keys){var l=e.keys,h=l.map(function(t){var n={startkey:we([t]),endkey:we([t,{}])};return e.update_seq&&(n.update_seq=!0),a(n)});return Promise.all(h).then(at).then(c)}var d,f,p={descending:e.descending};if(e.update_seq&&(p.update_seq=!0),"start_key"in e&&(d=e.start_key),"startkey"in e&&(d=e.startkey),"end_key"in e&&(f=e.end_key),"endkey"in e&&(f=e.endkey),void 0!==d&&(p.startkey=e.descending?we([d,{}]):we([d])),void 0!==f){var g=!1!==e.inclusive_end;e.descending&&(g=!g),p.endkey=we(g?[f,{}]:[f])}if(void 0!==e.key){var y=we([e.key]),v=we([e.key,{}]);p.descending?(p.endkey=y,p.startkey=v):(p.startkey=y,p.endkey=v)}return i||("number"==typeof e.limit&&(p.limit=e.limit),p.skip=s),a(p).then(c)}(t,e)})()}function w(e,n,i){if("function"==typeof e._query)return function(t,e,n){return new Promise(function(r,i){t._query(e,n,function(t,e){if(t)return i(t);r(e)})})}(e,n,i);if(ut(e))return function(t,e,n){var r,i,s,o=[],a="GET";if(h("reduce",n,o),h("include_docs",n,o),h("attachments",n,o),h("limit",n,o),h("descending",n,o),h("group",n,o),h("group_level",n,o),h("skip",n,o),h("stale",n,o),h("conflicts",n,o),h("startkey",n,o,!0),h("start_key",n,o,!0),h("endkey",n,o,!0),h("end_key",n,o,!0),h("inclusive_end",n,o),h("key",n,o,!0),h("update_seq",n,o),o=""===(o=o.join("&"))?"":"?"+o,void 0!==n.keys){var c="keys="+encodeURIComponent(JSON.stringify(n.keys));c.length+o.length+1<=2e3?o+=("?"===o[0]?"&":"?")+c:(a="POST","string"==typeof e?r={keys:n.keys}:e.keys=n.keys)}if("string"==typeof e){var u=tr(e);return t.fetch("_design/"+u[0]+"/_view/"+u[1]+o,{headers:new ae({"Content-Type":"application/json"}),method:a,body:JSON.stringify(r)}).then(function(t){return i=t.ok,s=t.status,t.json()}).then(function(t){if(!i)throw t.status=s,st(t);return t.rows.forEach(function(t){if(t.value&&t.value.error&&"builtin_reduce_error"===t.value.error)throw new Error(t.reason)}),t}).then(l(n))}return r=r||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?r[t]=e[t]:r[t]=e[t].toString()}),t.fetch("_temp_view"+o,{headers:new ae({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)}).then(function(t){return i=t.ok,s=t.status,t.json()}).then(function(t){if(!i)throw t.status=s,st(t);return t}).then(l(n))}(e,n,i);if("string"!=typeof n)return f(i,n),Xn.add(function(){return Jn(e,"temp_view/temp_view",n.map,n.reduce,!0,t).then(function(t){return function(t,e){return t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})})}(v(t).then(function(){return b(t,i)}),function(){return t.db.destroy()})})}),Xn.finish();var s=n,o=tr(s),c=o[0],u=o[1];return e.get("_design/"+c).then(function(n){var o=n.views&&n.views[u];if(!o)throw new jn("ddoc "+n._id+" has no view named "+u);return r(n,u),f(i,o),Jn(e,s,o.map,o.reduce,!1,t).then(function(t){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&a()(function(){v(t)}),b(t,i)):v(t).then(function(){return b(t,i)})})})}return{query:function(t,e,n){var r=this;"function"==typeof e&&(n=e,e={}),e=e?function(t){return t.group_level=d(t.group_level),t.limit=d(t.limit),t.skip=d(t.skip),t}(e):{},"function"==typeof t&&(t={map:t});var i=Promise.resolve().then(function(){return w(r,t,e)});return Bn(i,n),i},viewCleanup:function(t){return s()(function(e){var n=e.pop(),r=t.apply(this,e);return"function"==typeof n&&Bn(r,n),r})}(function(){var e=this;return"function"==typeof e._viewCleanup?function(t){return new Promise(function(e,n){t._viewCleanup(function(t,r){if(t)return n(t);e(r)})})}(e):ut(e)?function(t){return t.fetch("_view_cleanup",{headers:new ae({"Content-Type":"application/json"}),method:"POST"}).then(function(t){return t.json()})}(e):function(e){return e.get("_local/"+t).then(function(t){var n=new _;Object.keys(t.views).forEach(function(t){var e=tr(t),r="_design/"+e[0],i=e[1],s=n.get(r);s||(s=new m,n.set(r,s)),s.add(i)});var r={keys:qn(n),include_docs:!0};return e.allDocs(r).then(function(r){var i={};r.rows.forEach(function(e){var r=e.key.substring(8);n.get(e.key).forEach(function(n){var s=r+"/"+n;t.views[s]||(s=n);var o=Object.keys(t.views[s]),a=e.doc&&e.doc.views&&e.doc.views[n];o.forEach(function(t){i[t]=i[t]||a})})});var s=Object.keys(i).filter(function(t){return!i[t]}).map(function(t){return Ln(y(t),function(){return new e.constructor(t,e.__opts).destroy()})()});return Promise.all(s).then(function(){return{ok:!0}})})},p({ok:!0}))}(e)})}}("mrviews",function(t,e){if("function"==typeof t&&2===t.length){var n=t;return function(t){return n(t,e)}}return zn(t.toString(),e)},function(t){var e=t.toString(),n=function(t){if(/^_sum/.test(t))return nr._sum;if(/^_count/.test(t))return nr._count;if(/^_stats/.test(t))return nr._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}(e);return n||zn(e)},function(t,e){var n=t.views&&t.views[e];if("string"!=typeof n.map)throw new jn("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)});var ir={query:function(t,e,n){return rr.query.call(this,t,e,n)},viewCleanup:function(t){return rr.viewCleanup.call(this,t)}};function sr(t){return/^1-/.test(t)}function or(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(n){return t.getAttachment(e._id,n,{rev:e._rev})}))}function ar(t,e,n,r){n=S(n);var i=[],s=!0;function o(e){return t.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(t){if(r.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){t.deleted||!t.doc||!sr(t.value.rev)||function(t){return t._attachments&&Object.keys(t._attachments).length>0}(t.doc)||function(t){return t._conflicts&&t._conflicts.length>0}(t.doc)||(t.doc._conflicts&&delete t.doc._conflicts,i.push(t.doc),delete n[t.id])})})}return Promise.resolve().then(function(){var t=Object.keys(n).filter(function(t){var e=n[t].missing;return 1===e.length&&sr(e[0])});if(t.length>0)return o(t)}).then(function(){var o=function(t){var e=[];return Object.keys(t).forEach(function(n){t[n].missing.forEach(function(t){e.push({id:n,rev:t})})}),{docs:e,revs:!0,latest:!0}}(n);if(o.docs.length)return t.bulkGet(o).then(function(n){if(r.cancelled)throw new Error("cancelled");return Promise.all(n.results.map(function(n){return Promise.all(n.docs.map(function(n){var r=n.ok;return n.error&&(s=!1),r&&r._attachments?function(t,e,n){var r=ut(e)&&!ut(t),i=Object.keys(n._attachments);return r?t.get(n._id).then(function(r){return Promise.all(i.map(function(i){return function(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}(r,n,i)?e.getAttachment(n._id,i):t.getAttachment(r._id,i)}))}).catch(function(t){if(404!==t.status)throw t;return or(e,n)}):or(e,n)}(e,t,r).then(function(t){var e=Object.keys(r._attachments);return t.forEach(function(t,n){var i=r._attachments[e[n]];delete i.stub,delete i.length,i.data=t}),r}):r}))})).then(function(t){i=i.concat(at(t).filter(Boolean))})})}).then(function(){return{ok:s,docs:i}})}var cr=1,ur="pouchdb",lr=5,hr=0;function dr(t,e,n,r,i){return t.get(e).catch(function(n){if(404===n.status)return"http"!==t.adapter&&"https"!==t.adapter||H(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:ur,version:cr};throw n}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(t){return t.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,lr),s.version=cr,s.replicator=ur,s.session_id=r,s.last_seq=n,t.put(s).catch(function(s){if(409===s.status)return dr(t,e,n,r,i);throw s})})}function fr(t,e,n,r,i){this.src=t,this.target=e,this.id=n,this.returnValue=r,this.opts=i||{}}fr.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},fr.prototype.updateTarget=function(t,e){return this.opts.writeTargetCheckpoint?dr(this.target,this.id,t,e,this.returnValue):Promise.resolve(!0)},fr.prototype.updateSource=function(t,e){if(this.opts.writeSourceCheckpoint){var n=this;return dr(this.src,this.id,t,e,this.returnValue).catch(function(t){if(yr(t))return n.opts.writeSourceCheckpoint=!1,!0;throw t})}return Promise.resolve(!0)};var pr={undefined:function(t,e){return 0===me(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return function(t,e){if(t.session_id===e.session_id)return{last_seq:t.last_seq,history:t.history};return function t(e,n){var r=e[0];var i=e.slice(1);var s=n[0];var o=n.slice(1);if(!r||0===n.length)return{last_seq:hr,history:[]};var a=r.session_id;if(gr(a,n))return{last_seq:r.last_seq,history:e};var c=s.session_id;if(gr(c,i))return{last_seq:s.last_seq,history:o};return t(i,o)}(t.history,e.history)}(e,t).last_seq}};function gr(t,e){var n=e[0],r=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||gr(t,r))}function yr(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}fr.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(t){return t.last_seq||hr}).catch(function(t){if(404!==t.status)throw t;return hr}):t.target.get(t.id).then(function(e){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?e.last_seq||hr:t.src.get(t.id).then(function(t){return e.version!==t.version?hr:(n=e.version?e.version.toString():"undefined")in pr?pr[n](e,t):hr;var n},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:hr}).then(function(){return hr},function(n){return yr(n)?(t.opts.writeSourceCheckpoint=!1,e.last_seq):hr});throw n})}).catch(function(t){if(404!==t.status)throw t;return hr})};var vr=0;function mr(t,e,n){var r=n.doc_ids?n.doc_ids.sort(me):"",i=n.filter?n.filter.toString():"",s="",o="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(function(t){return Object.keys(t).sort(me).reduce(function(e,n){return e[n]=t[n],e},{})}(n.query_params))),n.filter&&"_view"===n.filter&&(o=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+i+o+s+r+a;return new Promise(function(t){Rt(e,t)})}).then(function(t){return"_local/"+(t=t.replace(/\//g,".").replace(/\+/g,"_"))})}function _r(t,e,n,r,i){var s,o,c,u=[],l={seq:0,changes:[],docs:[]},h=!1,d=!1,f=!1,p=0,g=n.continuous||n.live||!1,y=n.batch_size||100,v=n.batches_limit||10,m=!1,_=n.doc_ids,b=n.selector,w=[],C=Dt();i=i||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var E={};function x(){return c?Promise.resolve():mr(t,e,n).then(function(i){o=i;var s={};s=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},c=new fr(t,e,o,r,s)})}function T(){if(w=[],0!==s.docs.length){var t=s.docs,o={timeout:n.timeout};return e.bulkDocs({docs:t,new_edits:!1},o).then(function(e){if(r.cancelled)throw I(),new Error("cancelled");var n=Object.create(null);e.forEach(function(t){t.error&&(n[t.id]=t)});var s=Object.keys(n).length;i.doc_write_failures+=s,i.docs_written+=t.length-s,t.forEach(function(t){var e=n[t._id];if(e){i.errors.push(e);var s=(e.name||"").toLowerCase();if("unauthorized"!==s&&"forbidden"!==s)throw e;r.emit("denied",S(e))}else w.push(t)})},function(e){throw i.doc_write_failures+=t.length,e})}}function A(){if(s.error)throw new Error("There was a problem getting docs.");i.last_seq=p=s.seq;var t=S(i);return w.length&&(t.docs=w,"number"==typeof s.pending&&(t.pending=s.pending,delete s.pending),r.emit("change",t)),h=!0,c.writeCheckpoint(s.seq,C).then(function(){if(h=!1,r.cancelled)throw I(),new Error("cancelled");s=void 0,j()}).catch(function(t){throw B(t),t})}function k(){return ar(t,e,s.diffs,r).then(function(t){s.error=!t.ok,t.docs.forEach(function(t){delete s.diffs[t._id],i.docs_read++,s.docs.push(t)})})}function O(){r.cancelled||s||(0!==u.length?(s=u.shift(),function(){var t={};return s.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(r.cancelled)throw I(),new Error("cancelled");s.diffs=t})}().then(k).then(T).then(A).then(O).catch(function(t){R("batch processing terminated with error",t)})):P(!0))}function P(t){0!==l.changes.length?(t||d||l.changes.length>=y)&&(u.push(l),l={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),O()):0!==u.length||s||((g&&E.live||d)&&(r.state="pending",r.emit("paused")),d&&I())}function R(t,e){f||(e.message||(e.message=t),i.ok=!1,i.status="aborting",u=[],l={seq:0,changes:[],docs:[]},I(e))}function I(s){if(!(f||r.cancelled&&(i.status="cancelled",h)))if(i.status=i.status||"complete",i.end_time=(new Date).toISOString(),i.last_seq=p,f=!0,s){(s=it(s)).result=i;var o=(s.name||"").toLowerCase();"unauthorized"===o||"forbidden"===o?(r.emit("error",s),r.removeAllListeners()):function(t,e,n,r){if(!1===t.retry)return e.emit("error",n),void e.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=L),e.emit("requestError",n),"active"===e.state||"pending"===e.state){e.emit("paused",n),e.state="stopped";var i=function(){t.current_back_off=vr};e.once("paused",function(){e.removeListener("active",i)}),e.once("active",i)}t.current_back_off=t.current_back_off||vr,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}(n,r,s,function(){_r(t,e,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function F(t,e,i){if(r.cancelled)return I();"number"==typeof e&&(l.pending=e),ot(n)(t)&&(l.seq=t.seq||i,l.changes.push(t),a()(function(){P(0===u.length&&E.live)}))}function D(t){if(m=!1,r.cancelled)return I();if(t.results.length>0)E.since=t.results[t.results.length-1].seq,j(),P(!0);else{var e=function(){g?(E.live=!0,j()):d=!0,P(!0)};s||0!==t.results.length?e():(h=!0,c.writeCheckpoint(t.last_seq,C).then(function(){h=!1,i.last_seq=p=t.last_seq,e()}).catch(B))}}function N(t){if(m=!1,r.cancelled)return I();R("changes rejected",t)}function j(){if(!m&&!d&&u.length<v){m=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",i);var e=t.changes(E).on("change",F);e.then(s,s),e.then(D).catch(N),n.retry&&(r._changes=e,r._abortChanges=i)}function i(){e.cancel()}function s(){r.removeListener("cancel",i)}}function M(){x().then(function(){if(!r.cancelled)return c.getCheckpoint().then(function(t){E={since:p=t,limit:y,batch_size:y,style:"all_docs",doc_ids:_,selector:b,return_docs:!0},n.filter&&("string"!=typeof n.filter?E.include_docs=!0:E.filter=n.filter),"heartbeat"in n&&(E.heartbeat=n.heartbeat),"timeout"in n&&(E.timeout=n.timeout),n.query_params&&(E.query_params=n.query_params),n.view&&(E.view=n.view),j()});I()}).catch(function(t){R("getCheckpoint rejected with ",t)})}function B(t){h=!1,R("writeCheckpoint completed with error",t)}r.ready(t,e),r.cancelled?I():(r._addedListeners||(r.once("cancel",I),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(t){n.complete(null,t)})),r._addedListeners=!0),void 0===n.since?M():x().then(function(){return h=!0,c.writeCheckpoint(n.since,C)}).then(function(){h=!1,r.cancelled?I():(p=n.since,M())}).catch(B))}function br(){c.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new Promise(function(e,n){t.once("complete",e),t.once("error",n)});t.then=function(t,n){return e.then(t,n)},t.catch=function(t){return e.catch(t)},t.catch(function(){})}function wr(t,e){var n=e.PouchConstructor;return"string"==typeof t?new n(t,e):t}function Sr(t,e,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw it(Z,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=S(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new br(n);return _r(wr(t,n),wr(e,n),n,i),i}function Cr(t,e,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=S(n)).PouchConstructor=n.PouchConstructor||this,new Er(t=wr(t,n),e=wr(e,n),n,r)}function Er(t,e,n,r){var i=this;this.canceled=!1;var s=n.push?q({},n,n.push):n,o=n.pull?q({},n,n.pull):n;function a(t){i.emit("change",{direction:"pull",change:t})}function c(t){i.emit("change",{direction:"push",change:t})}function u(t){i.emit("denied",{direction:"push",doc:t})}function l(t){i.emit("denied",{direction:"pull",doc:t})}function h(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function d(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function f(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function p(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}this.push=Sr(t,e,s),this.pull=Sr(e,t,o),this.pushPaused=!0,this.pullPaused=!0;var g={};function y(t){return function(e,n){("change"===e&&(n===a||n===c)||"denied"===e&&(n===l||n===u)||"paused"===e&&(n===d||n===h)||"active"===e&&(n===p||n===f))&&(e in g||(g[e]={}),g[e][t]=!0,2===Object.keys(g[e]).length&&i.removeAllListeners(e))}}function v(t,e,n){-1==t.listeners(e).indexOf(n)&&t.on(e,n)}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push))),this.on("newListener",function(t){"change"===t?(v(i.pull,"change",a),v(i.push,"change",c)):"denied"===t?(v(i.pull,"denied",l),v(i.push,"denied",u)):"active"===t?(v(i.pull,"active",p),v(i.push,"active",f)):"paused"===t&&(v(i.pull,"paused",d),v(i.push,"paused",h))}),this.on("removeListener",function(t){"change"===t?(i.pull.removeListener("change",a),i.push.removeListener("change",c)):"denied"===t?(i.pull.removeListener("denied",l),i.push.removeListener("denied",u)):"active"===t?(i.pull.removeListener("active",p),i.push.removeListener("active",f)):"paused"===t&&(i.pull.removeListener("paused",d),i.push.removeListener("paused",h))}),this.pull.on("removeListener",y("pull")),this.push.on("removeListener",y("push"));var m=Promise.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return i.emit("complete",e),r&&r(null,e),i.removeAllListeners(),e},function(t){if(i.cancel(),r?r(t):i.emit("error",t),i.removeAllListeners(),r)throw t});this.then=function(t,e){return m.then(t,e)},this.catch=function(t){return m.catch(t)}}l()(br,c.EventEmitter),br.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},br.prototype.ready=function(t,e){var n=this;function r(){n.cancel()}n._readyCalled||(n._readyCalled=!0,t.once("destroyed",r),e.once("destroyed",r),n.once("complete",function(){t.removeListener("destroyed",r),e.removeListener("destroyed",r)}))},l()(Er,c.EventEmitter),Er.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},ie.plugin(function(t){t.adapter("idb",wn,!0)}).plugin(function(t){t.adapter("http",Dn,!1),t.adapter("https",Dn,!1)}).plugin(ir).plugin(function(t){t.replicate=Sr,t.sync=Cr,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(e,n,r){return t.constructor.replicate(e,t,n,r)},to:function(e,n,r){return t.constructor.replicate(t,e,n,r)}}),this.replicateMethods}}),t.prototype.sync=function(t,e,n){return this.constructor.sync(this,t,e,n)}}),e.default=ie}.call(this,n(1),n(47))},function(t,e,n){"use strict";t.exports=function(t){return function(){var e=arguments.length;if(e){for(var n=[],r=-1;++r<e;)n[r]=arguments[r];return t.call(this,n)}return t.call(this,[])}}},function(t,e,n){"use strict";(function(e){var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(l),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,n=function(){c.port2.postMessage(0)}}var u=[];function l(){var t,e;r=!0;for(var n=u.length;n;){for(e=u,u=[],t=-1;++t<n;)e[t]();n=u.length}r=!1}t.exports=function(t){1!==u.push(t)||r||n()}}).call(this,n(1))},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,c,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(s(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),o=(u=n.slice()).length,c=0;c<o;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var n,s,o,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(n=this._events[t]).length,s=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=o;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){t.exports=function(t){"use strict";var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(t,e){var n=t[0],r=t[1],i=t[2],s=t[3];n+=(r&i|~r&s)+e[0]-680876936|0,s+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+e[1]-389564586|0,i+=((s=(s<<12|s>>>20)+n|0)&n|~s&r)+e[2]+606105819|0,r+=((i=(i<<17|i>>>15)+s|0)&s|~i&n)+e[3]-1044525330|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&s)+e[4]-176418897|0,s+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+e[5]+1200080426|0,i+=((s=(s<<12|s>>>20)+n|0)&n|~s&r)+e[6]-1473231341|0,r+=((i=(i<<17|i>>>15)+s|0)&s|~i&n)+e[7]-45705983|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&s)+e[8]+1770035416|0,s+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+e[9]-1958414417|0,i+=((s=(s<<12|s>>>20)+n|0)&n|~s&r)+e[10]-42063|0,r+=((i=(i<<17|i>>>15)+s|0)&s|~i&n)+e[11]-1990404162|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&s)+e[12]+1804603682|0,s+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+e[13]-40341101|0,i+=((s=(s<<12|s>>>20)+n|0)&n|~s&r)+e[14]-1502002290|0,r+=((i=(i<<17|i>>>15)+s|0)&s|~i&n)+e[15]+1236535329|0,n+=((r=(r<<22|r>>>10)+i|0)&s|i&~s)+e[1]-165796510|0,s+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+e[6]-1069501632|0,i+=((s=(s<<9|s>>>23)+n|0)&r|n&~r)+e[11]+643717713|0,r+=((i=(i<<14|i>>>18)+s|0)&n|s&~n)+e[0]-373897302|0,n+=((r=(r<<20|r>>>12)+i|0)&s|i&~s)+e[5]-701558691|0,s+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+e[10]+38016083|0,i+=((s=(s<<9|s>>>23)+n|0)&r|n&~r)+e[15]-660478335|0,r+=((i=(i<<14|i>>>18)+s|0)&n|s&~n)+e[4]-405537848|0,n+=((r=(r<<20|r>>>12)+i|0)&s|i&~s)+e[9]+568446438|0,s+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+e[14]-1019803690|0,i+=((s=(s<<9|s>>>23)+n|0)&r|n&~r)+e[3]-187363961|0,r+=((i=(i<<14|i>>>18)+s|0)&n|s&~n)+e[8]+1163531501|0,n+=((r=(r<<20|r>>>12)+i|0)&s|i&~s)+e[13]-1444681467|0,s+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+e[2]-51403784|0,i+=((s=(s<<9|s>>>23)+n|0)&r|n&~r)+e[7]+1735328473|0,r+=((i=(i<<14|i>>>18)+s|0)&n|s&~n)+e[12]-1926607734|0,n+=((r=(r<<20|r>>>12)+i|0)^i^s)+e[5]-378558|0,s+=((n=(n<<4|n>>>28)+r|0)^r^i)+e[8]-2022574463|0,i+=((s=(s<<11|s>>>21)+n|0)^n^r)+e[11]+1839030562|0,r+=((i=(i<<16|i>>>16)+s|0)^s^n)+e[14]-35309556|0,n+=((r=(r<<23|r>>>9)+i|0)^i^s)+e[1]-1530992060|0,s+=((n=(n<<4|n>>>28)+r|0)^r^i)+e[4]+1272893353|0,i+=((s=(s<<11|s>>>21)+n|0)^n^r)+e[7]-155497632|0,r+=((i=(i<<16|i>>>16)+s|0)^s^n)+e[10]-1094730640|0,n+=((r=(r<<23|r>>>9)+i|0)^i^s)+e[13]+681279174|0,s+=((n=(n<<4|n>>>28)+r|0)^r^i)+e[0]-358537222|0,i+=((s=(s<<11|s>>>21)+n|0)^n^r)+e[3]-722521979|0,r+=((i=(i<<16|i>>>16)+s|0)^s^n)+e[6]+76029189|0,n+=((r=(r<<23|r>>>9)+i|0)^i^s)+e[9]-640364487|0,s+=((n=(n<<4|n>>>28)+r|0)^r^i)+e[12]-421815835|0,i+=((s=(s<<11|s>>>21)+n|0)^n^r)+e[15]+530742520|0,r+=((i=(i<<16|i>>>16)+s|0)^s^n)+e[2]-995338651|0,n+=(i^((r=(r<<23|r>>>9)+i|0)|~s))+e[0]-198630844|0,s+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+e[7]+1126891415|0,i+=(n^((s=(s<<10|s>>>22)+n|0)|~r))+e[14]-1416354905|0,r+=(s^((i=(i<<15|i>>>17)+s|0)|~n))+e[5]-57434055|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~s))+e[12]+1700485571|0,s+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+e[3]-1894986606|0,i+=(n^((s=(s<<10|s>>>22)+n|0)|~r))+e[10]-1051523|0,r+=(s^((i=(i<<15|i>>>17)+s|0)|~n))+e[1]-2054922799|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~s))+e[8]+1873313359|0,s+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+e[15]-30611744|0,i+=(n^((s=(s<<10|s>>>22)+n|0)|~r))+e[6]-1560198380|0,r+=(s^((i=(i<<15|i>>>17)+s|0)|~n))+e[13]+1309151649|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~s))+e[4]-145523070|0,s+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+e[11]-1120210379|0,i+=(n^((s=(s<<10|s>>>22)+n|0)|~r))+e[2]+718787259|0,r=((r+=(s^((i=(i<<15|i>>>17)+s|0)|~n))+e[9]-343485551|0)<<21|r>>>11)+i|0,t[0]=n+t[0]|0,t[1]=r+t[1]|0,t[2]=i+t[2]|0,t[3]=s+t[3]|0}function r(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function i(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function s(t){var e,i,s,o,a,c,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)n(l,r(t.substring(e-64,e)));for(t=t.substring(e-64),i=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(n(l,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*u).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),c=parseInt(o[1],16)||0,s[14]=a,s[15]=c,n(l,s),l}function o(t){var n,r="";for(n=0;n<4;n+=1)r+=e[t>>8*n+4&15]+e[t>>8*n&15];return r}function a(t){var e;for(e=0;e<t.length;e+=1)t[e]=o(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function u(t){var e,n=[],r=t.length;for(e=0;e<r-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function l(){this.reset()}return a(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,r){var i,s,o,a,c=this.byteLength,u=e(n,c),l=c;return r!==t&&(l=e(r,c)),u>l?new ArrayBuffer(0):(i=l-u,s=new ArrayBuffer(i),o=new Uint8Array(s),a=new Uint8Array(this,u,i),o.set(a),s)}}(),l.prototype.append=function(t){return this.appendBinary(c(t)),this},l.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;e<=i;e+=64)n(this._hash,r(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},l.prototype.end=function(t){var e,n,r=this._buff,i=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(s,i),n=a(this._hash),t&&(n=u(n)),this.reset(),n},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},l.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(t,e){var r,i,s,o=e;if(t[o>>2]|=128<<(o%4<<3),o>55)for(n(this._hash,t),o=0;o<16;o+=1)t[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),s=parseInt(r[1],16)||0,t[14]=i,t[15]=s,n(this._hash,t)},l.hash=function(t,e){return l.hashBinary(c(t),e)},l.hashBinary=function(t,e){var n=a(s(t));return e?u(n):n},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(t){var e,r=function(t,e,n){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),n?r:r.buffer}(this._buff.buffer,t,!0),s=r.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)n(this._hash,i(r.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(r.buffer.slice(e-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(t){var e,n,r=this._buff,i=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)s[e>>2]|=r[e]<<(e%4<<3);return this._finish(s,i),n=a(this._hash),t&&(n=u(n)),this.reset(),n},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var t=l.prototype.getState.call(this);return t.buff=function(t){return String.fromCharCode.apply(null,new Uint8Array(t))}(t.buff),t},l.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){var n,r=t.length,i=new ArrayBuffer(r),s=new Uint8Array(i);for(n=0;n<r;n+=1)s[n]=t.charCodeAt(n);return e?s:i}(t.buff,!0),l.prototype.setState.call(this,t)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(t,e){var r=a(function(t){var e,r,s,o,a,c,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)n(l,i(t.subarray(e-64,e)));for(t=e-64<u?t.subarray(e-64):new Uint8Array(0),r=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<r;e+=1)s[e>>2]|=t[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(n(l,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*u).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),c=parseInt(o[1],16)||0,s[14]=a,s[15]=c,n(l,s),l}(new Uint8Array(t)));return e?u(r):r},l}()},function(t,e,n){var r=n(81),i=n(84),s=i;s.v1=r,s.v4=i,t.exports=s},function(t,e,n){var r,i,s=n(82),o=n(83),a=0,c=0;t.exports=function(t,e,n){var u=e&&n||0,l=e||[],h=(t=t||{}).node||r,d=void 0!==t.clockseq?t.clockseq:i;if(null==h||null==d){var f=s();null==h&&(h=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=i=16383&(f[6]<<8|f[7]))}var p=void 0!==t.msecs?t.msecs:(new Date).getTime(),g=void 0!==t.nsecs?t.nsecs:c+1,y=p-a+(g-c)/1e4;if(y<0&&void 0===t.clockseq&&(d=d+1&16383),(y<0||p>a)&&void 0===t.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,c=g,i=d;var v=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;l[u++]=v>>>24&255,l[u++]=v>>>16&255,l[u++]=v>>>8&255,l[u++]=255&v;var m=p/4294967296*1e4&268435455;l[u++]=m>>>8&255,l[u++]=255&m,l[u++]=m>>>24&15|16,l[u++]=m>>>16&255,l[u++]=d>>>8|128,l[u++]=255&d;for(var _=0;_<6;++_)l[u+_]=h[_];return e||o(l)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,i=n;return i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]}},function(t,e,n){var r=n(82),i=n(83);t.exports=function(t,e,n){var s=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var a=0;a<16;++a)e[s+a]=o[a];return e||i(o)}},function(t,e,n){"use strict";function r(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(t);else if(s===e.length-2){i[e.pop()]=t}else e.push(t)}e.stringify=function(t){var e=[];e.push({obj:t});for(var n,r,i,s,o,a,c,u,l,h,d="";n=e.pop();)if(r=n.obj,d+=n.prefix||"",i=n.val||"")d+=i;else if("object"!=typeof r)d+=void 0===r?null:JSON.stringify(r);else if(null===r)d+="null";else if(Array.isArray(r)){for(e.push({val:"]"}),s=r.length-1;s>=0;s--)o=0===s?"":",",e.push({obj:r[s],prefix:o});e.push({val:"["})}else{for(c in a=[],r)r.hasOwnProperty(c)&&a.push(c);for(e.push({val:"}"}),s=a.length-1;s>=0;s--)l=r[u=a[s]],h=s>0?",":"",h+=JSON.stringify(u)+":",e.push({obj:l,prefix:h});e.push({val:"{"})}return d},e.parse=function(t){for(var e,n,i,s,o,a,c,u,l,h=[],d=[],f=0;;)if("}"!==(e=t[f++])&&"]"!==e&&void 0!==e)switch(e){case" ":case"\t":case"\n":case":":case",":break;case"n":f+=3,r(null,h,d);break;case"t":f+=3,r(!0,h,d);break;case"f":f+=4,r(!1,h,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",f--;;){if(i=t[f++],!/[\d\.\-e\+]/.test(i)){f--;break}n+=i}r(parseFloat(n),h,d);break;case'"':for(s="",o=void 0,a=0;'"'!==(c=t[f++])||"\\"===o&&a%2==1;)s+=c,"\\"===(o=c)?a++:a=0;r(JSON.parse('"'+s+'"'),h,d);break;case"[":u={element:[],index:h.length},h.push(u.element),d.push(u);break;case"{":l={element:{},index:h.length},h.push(l.element),d.push(l);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===h.length)return h.pop();r(h.pop(),h,d)}}},function(t,e,n){"use strict";n.r(e);var r=n(87),i=n(92),s=n(152),o=n.n(s);function a(t,e){var n=Object(r.assign)({db:o.a},t);i.default.call(this,n,e)}a.valid=function(){return!0},a.use_prefix=!1,e.default=function(t){t.adapter("memory",a,!0)}},function(t,e,n){"use strict";n.r(e),n.d(e,"adapterFun",function(){return S}),n.d(e,"assign",function(){return D}),n.d(e,"bulkGetShim",function(){return k}),n.d(e,"changesHandler",function(){return P}),n.d(e,"clone",function(){return _}),n.d(e,"defaultBackOff",function(){return I}),n.d(e,"explainError",function(){return F}),n.d(e,"filterChange",function(){return N}),n.d(e,"flatten",function(){return j}),n.d(e,"functionName",function(){return M}),n.d(e,"guardedConsole",function(){return R}),n.d(e,"hasLocalStorage",function(){return O}),n.d(e,"invalidIdError",function(){return B}),n.d(e,"isRemote",function(){return L}),n.d(e,"listenerCount",function(){return H}),n.d(e,"normalizeDdocFunctionName",function(){return U}),n.d(e,"once",function(){return b}),n.d(e,"parseDdocFunctionName",function(){return q}),n.d(e,"parseUri",function(){return z}),n.d(e,"pick",function(){return C}),n.d(e,"rev",function(){return J}),n.d(e,"scopeEval",function(){return G}),n.d(e,"toPromise",function(){return w}),n.d(e,"upsert",function(){return Q}),n.d(e,"uuid",function(){return Y});var r=n(75),i=n.n(r),s=n(88),o=n(76),a=n.n(o);n.d(e,"nextTick",function(){return a.a});var c=n(77),u=n(78),l=n.n(u),h=n(89),d=n(80),f=n.n(d),p=n(90),g=n(87);function y(t){if(t instanceof ArrayBuffer)return function(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}var v=Function.prototype.toString,m=v.call(Object);function _(t){var e,n,r;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=_(t[n]);return e}if(t instanceof Date)return t.toISOString();if(function(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}(t))return y(t);if(!function(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&v.call(n)==m}(t))return t;for(n in e={},t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=_(t[n]);void 0!==i&&(e[n]=i)}return e}function b(t){var e=!1;return i()(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function w(t){return i()(function(e){var n=this,r="function"==typeof(e=_(e))[e.length-1]&&e.pop(),i=new Promise(function(r,i){var s;try{var o=b(function(t,e){t?i(t):r(e)});e.push(o),(s=t.apply(n,e))&&"function"==typeof s.then&&r(s)}catch(t){i(t)}});return r&&i.then(function(t){r(null,t)},r),i})}function S(t,e){return w(i()(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",t.name,e];i=i.concat(n?["error",n]:["success",r]),t.constructor.emit("debug",i),s(n,r)}}}(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(e,i){r.taskqueue.addTask(function(s){s?i(s):e(r[t].apply(r,n))})})}))}function C(t,e){for(var n={},r=0,i=e.length;r<i;r++){var s=e[r];s in t&&(n[s]=t[s])}return n}var E,x=6;function T(t){return t}function A(t){return[{ok:t}]}function k(t,e,n){var r=e.docs,i=new s.Map;r.forEach(function(t){i.has(t.id)?i.get(t.id).push(t):i.set(t.id,[t])});var o=i.size,a=0,c=new Array(o);function u(){++a===o&&function(){var t=[];c.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t})}()}var l=[];i.forEach(function(t,e){l.push(e)});var h=0;function d(){if(!(h>=l.length)){var n=Math.min(h+x,l.length),r=l.slice(h,n);!function(n,r){n.forEach(function(n,s){var o=r+s,a=i.get(n),l=C(a[0],["atts_since","attachments"]);l.open_revs=a.map(function(t){return t.rev}),l.open_revs=l.open_revs.filter(T);var h=T;0===l.open_revs.length&&(delete l.open_revs,h=A),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in e&&(l[t]=e[t])}),t.get(n,l,function(t,e){var r;r=t?[{error:t}]:h(e),function(t,e,n){c[t]={id:e,docs:n},u()}(o,n,r),d()})})}(r,h),h+=r.length}}d()}try{localStorage.setItem("_pouch_check_localstorage",1),E=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){E=!1}function O(){return E}function P(){c.EventEmitter.call(this),this._listeners={},function(t){O()&&addEventListener("storage",function(e){t.emit(e.key)})}(this)}function R(t){if("undefined"!=typeof console&&"function"==typeof console[t]){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function I(t){var e=0;return t||(e=2e3),function(t,e){return t=parseInt(t,10)||0,(e=parseInt(e,10))!=e||e<=t?e=(t||1)<<1:e+=1,e>6e5&&(t=3e5,e=6e5),~~((e-t)*Math.random()+t)}(t,e)}function F(t,e){R("info","The above "+t+" is totally normal. "+e)}l()(P,c.EventEmitter),P.prototype.addListener=function(t,e,n,r){if(!this._listeners[e]){var i=this,s=!1;this._listeners[e]=o,this.on(t,o)}function o(){if(i._listeners[e])if(s)s="waiting";else{s=!0;var t=C(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(t).on("change",function(t){t.seq>r.since&&!r.cancelled&&(r.since=t.seq,r.onChange(t))}).on("complete",function(){"waiting"===s&&a()(o),s=!1}).on("error",function(){s=!1})}}},P.prototype.removeListener=function(t,e){e in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},P.prototype.notifyLocalWindows=function(t){O()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},P.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var D="function"==typeof Object.assign?Object.assign:function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};function N(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(r){r.doc||(r.doc={});var i=n&&function(t,e,n){try{return!t(e,n)}catch(t){var r="Filter function threw: "+t.toString();return Object(h.createError)(h.BAD_REQUEST,r)}}(t.filter,r.doc,e);if("object"==typeof i)return i;if(i)return!1;if(t.include_docs){if(!t.attachments)for(var s in r.doc._attachments)r.doc._attachments.hasOwnProperty(s)&&(r.doc._attachments[s].stub=!0)}else delete r.doc;return!0}}function j(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}var M=function(){}.name?function(t){return t.name}:function(t){var e=t.toString().match(/^\s*function\s*(?:(\S+)\s*)?\(/);return e&&e[1]?e[1]:""};function B(t){var e;if(t?"string"!=typeof t?e=Object(h.createError)(h.INVALID_ID):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=Object(h.createError)(h.RESERVED_ID)):e=Object(h.createError)(h.MISSING_ID),e)throw e}function L(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(R("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function H(t,e){return"listenerCount"in t?t.listenerCount(e):c.EventEmitter.listenerCount(t,e)}function q(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function U(t){var e=q(t);return e?e.join("/"):null}var V=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],K="queryKey",$=/(?:^|&)([^&=]*)=?([^&]*)/g,W=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function z(t){for(var e=W.exec(t),n={},r=14;r--;){var i=V[r],s=e[r]||"",o=-1!==["user","password"].indexOf(i);n[i]=o?decodeURIComponent(s):s}return n[K]={},n[V[12]].replace($,function(t,e,r){e&&(n[K][e]=r)}),n}function G(t,e){var n=[],r=[];for(var i in e)e.hasOwnProperty(i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function Q(t,e,n){return new Promise(function(r,i){t.get(e,function(s,o){if(s){if(404!==s.status)return i(s);o={}}var a=o._rev,c=n(o);if(!c)return r({updated:!1,rev:a});c._id=e,c._rev=a,r(function(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(r){if(409!==r.status)throw r;return Q(t,e._id,n)})}(t,c,n))})})}function J(t,e){var n=Object(g.clone)(t);return e?(delete n._rev_tree,Object(p.stringMd5)(JSON.stringify(n))):f.a.v4().replace(/-/g,"").toLowerCase()}var Y=f.a.v4},function(t,e,n){"use strict";function r(t){return"$"+t}function i(t){return t.substring(1)}function s(){this._store={}}function o(t){if(this._store=new s,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}var a,c;n.r(e),n.d(e,"Set",function(){return a}),n.d(e,"Map",function(){return c}),s.prototype.get=function(t){var e=r(t);return this._store[e]},s.prototype.set=function(t,e){var n=r(t);return this._store[n]=e,!0},s.prototype.has=function(t){return r(t)in this._store},s.prototype.delete=function(t){var e=r(t),n=e in this._store;return delete this._store[e],n},s.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var s=e[n];t(this._store[s],s=i(s))}},Object.defineProperty(s.prototype,"size",{get:function(){return Object.keys(this._store).length}}),o.prototype.add=function(t){return this._store.set(t,!0)},o.prototype.has=function(t){return this._store.has(t)},o.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})},Object.defineProperty(o.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}()?(a=o,c=s):(a=Set,c=Map)},function(t,e,n){"use strict";n.r(e),n.d(e,"UNAUTHORIZED",function(){return s}),n.d(e,"MISSING_BULK_DOCS",function(){return o}),n.d(e,"MISSING_DOC",function(){return a}),n.d(e,"REV_CONFLICT",function(){return c}),n.d(e,"INVALID_ID",function(){return u}),n.d(e,"MISSING_ID",function(){return l}),n.d(e,"RESERVED_ID",function(){return h}),n.d(e,"NOT_OPEN",function(){return d}),n.d(e,"UNKNOWN_ERROR",function(){return f}),n.d(e,"BAD_ARG",function(){return p}),n.d(e,"INVALID_REQUEST",function(){return g}),n.d(e,"QUERY_PARSE_ERROR",function(){return y}),n.d(e,"DOC_VALIDATION",function(){return v}),n.d(e,"BAD_REQUEST",function(){return m}),n.d(e,"NOT_AN_OBJECT",function(){return _}),n.d(e,"DB_MISSING",function(){return b}),n.d(e,"WSQ_ERROR",function(){return S}),n.d(e,"LDB_ERROR",function(){return C}),n.d(e,"FORBIDDEN",function(){return E}),n.d(e,"INVALID_REV",function(){return x}),n.d(e,"FILE_EXISTS",function(){return T}),n.d(e,"MISSING_STUB",function(){return A}),n.d(e,"IDB_ERROR",function(){return w}),n.d(e,"INVALID_URL",function(){return k}),n.d(e,"createError",function(){return O}),n.d(e,"generateErrorFromResponse",function(){return P});var r=n(78);function i(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}n.n(r)()(i,Error),i.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var s=new i(401,"unauthorized","Name or password is incorrect."),o=new i(400,"bad_request","Missing JSON list of 'docs'"),a=new i(404,"not_found","missing"),c=new i(409,"conflict","Document update conflict"),u=new i(400,"bad_request","_id field must contain a string"),l=new i(412,"missing_id","_id is required for puts"),h=new i(400,"bad_request","Only reserved document ids may start with underscore."),d=new i(412,"precondition_failed","Database not open"),f=new i(500,"unknown_error","Database encountered an unknown error"),p=new i(500,"badarg","Some query argument is invalid"),g=new i(400,"invalid_request","Request was invalid"),y=new i(400,"query_parse_error","Some query parameter is invalid"),v=new i(500,"doc_validation","Bad special document member"),m=new i(400,"bad_request","Something wrong with the request"),_=new i(400,"bad_request","Document must be a JSON object"),b=new i(404,"not_found","Database not found"),w=new i(500,"indexed_db_went_bad","unknown"),S=new i(500,"web_sql_went_bad","unknown"),C=new i(500,"levelDB_went_went_bad","unknown"),E=new i(403,"forbidden","Forbidden by design doc validate_doc_update function"),x=new i(400,"bad_request","Invalid rev format"),T=new i(412,"file_exists","The database could not be created, the file already exists."),A=new i(412,"missing_stub","A pre-existing attachment stub wasn't found"),k=new i(413,"invalid_url","Provided URL is invalid");function O(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=i.prototype,new n(e)}function P(t){if("object"!=typeof t){var e=t;(t=f).data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"binaryMd5",function(){return l}),n.d(e,"stringMd5",function(){return h});var r=n(91),i=n(79),s=n.n(i),o=t.setImmediate||t.setTimeout,a=32768;function c(t,e,n,i,s){(n>0||i<e.size)&&(e=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}(e,n,i)),Object(r.readAsArrayBuffer)(e,function(e){t.append(e),s()})}function u(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function l(t,e){var n="string"==typeof t,i=n?t.length:t.size,l=Math.min(a,i),h=Math.ceil(i/l),d=0,f=n?new s.a:new s.a.ArrayBuffer,p=n?u:c;function g(){o(v)}function y(){var t=function(t){return Object(r.btoa)(t)}(f.end(!0));e(t),f.destroy()}function v(){var e=d*l,n=e+l;p(f,t,e,n,++d<h?g:y)}v()}function h(t){return s.a.hash(t)}}.call(this,n(1))},function(t,e,n){"use strict";n.r(e),n.d(e,"atob",function(){return r}),n.d(e,"btoa",function(){return i}),n.d(e,"base64StringToBlobOrBuffer",function(){return c}),n.d(e,"binaryStringToArrayBuffer",function(){return o}),n.d(e,"binaryStringToBlobOrBuffer",function(){return a}),n.d(e,"blob",function(){return s}),n.d(e,"blobOrBufferToBase64",function(){return h}),n.d(e,"blobOrBufferToBinaryString",function(){return l}),n.d(e,"readAsArrayBuffer",function(){return d}),n.d(e,"readAsBinaryString",function(){return u}),n.d(e,"typedBuffer",function(){return f});var r=function(t){return atob(t)},i=function(t){return btoa(t)};function s(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}function o(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function a(t,e){return s([o(t)],{type:e})}function c(t,e){return a(r(t),e)}function u(t,e){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";if(r)return e(n);e(function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}(n))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function l(t,e){u(t,function(t){e(t)})}function h(t,e){l(t,function(t){e(i(t))})}function d(t,e){var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}function f(){}},function(t,e,n){"use strict";n.r(e);var r=n(91),i=n(88),s=n(87),o=n(93),a=n.n(o),c=n(130),u=n(146),l=n(75),h=n.n(l),d=n(147),f=n.n(d),p=n(148),g=n.n(p),y=n(149),v=n(150),m=n(151),_=n(90),b=n(89);function w(t,e){var n=new Uint8Array(t);return Object(r.blob)([n],{type:e})}function S(t,e){Object(r.readAsBinaryString)(t,e)}function C(t,e){var n=e.prefix()[0],r=t._cache,s=r.get(n);return s||(s=new i.Map,r.set(n,s)),s}function E(){this._batch=[],this._cache=new i.Map}E.prototype.get=function(t,e,n){var r=C(this,t),i=r.get(e);return i?Object(s.nextTick)(function(){n(null,i)}):null===i?Object(s.nextTick)(function(){n({name:"NotFoundError"})}):void t.get(e,function(t,i){if(t)return"NotFoundError"===t.name&&r.set(e,null),n(t);r.set(e,i),n(null,i)})},E.prototype.batch=function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e],i=C(this,r.prefix);"put"===r.type?i.set(r.key,r.value):i.set(r.key,null)}this._batch=this._batch.concat(t)},E.prototype.execute=function(t,e){for(var n=new i.Set,r=[],s=this._batch.length-1;s>=0;s--){var o=this._batch[s],a=o.prefix.prefix()[0]+"ÿ"+o.key;n.has(a)||(n.add(a),r.push(o))}t.batch(r,e)};var x="document-store",T="by-sequence",A="attach-store",k="attach-binary-store",O="local-store",P="meta-store",R=new i.Map,I="_local_last_update_seq",F="_local_doc_count",D="_local_uuid",N="md5-",j={encode:m.safeJsonStringify,decode:m.safeJsonParse,buffer:!1,type:"cheap-json"},M=new s.changesHandler;function B(t){return"winningRev"in t?t.winningRev:Object(v.winningRev)(t)}function L(t,e){return"deleted"in t?t.deleted:Object(y.isDeleted)(t,e)}function H(t,e,n){var i=[];return t.forEach(function(t){t.doc&&t.doc._attachments&&Object.keys(t.doc._attachments).forEach(function(e){var n=t.doc._attachments[e];"data"in n||i.push(n)})}),Promise.all(i.map(function(t){return function(t,e,n){var i=t.content_type;return new Promise(function(s,o){e.binaryStore.get(t.digest,function(e,a){var c;if(e){if("NotFoundError"!==e.name)return o(e);c=n.binary?Object(r.binaryStringToBlobOrBuffer)("",i):""}else c=n.binary?w(a,i):a.toString("base64");delete t.stub,delete t.length,t.data=c,s()})})}(t,e,n)}))}e.default=function(t,e){var n,o,l=this,d={},p=(t=Object(s.clone)(t)).revs_limit,m=t.name;void 0===t.createIfMissing&&(t.createIfMissing=!0);var C,q=t.db,U=Object(s.functionName)(q);function V(){d.docStore=o.sublevel(x,{valueEncoding:j}),d.bySeqStore=o.sublevel(T,{valueEncoding:"json"}),d.attachmentStore=o.sublevel(A,{valueEncoding:"json"}),d.binaryStore=o.sublevel(k,{valueEncoding:"binary"}),d.localStore=o.sublevel(O,{valueEncoding:"json"}),d.metaStore=o.sublevel(P,{valueEncoding:"json"}),"object"==typeof t.migrate?t.migrate.doMigrationTwo(o,d,K):K()}function K(){d.metaStore.get(I,function(t,r){void 0===o._updateSeq&&(o._updateSeq=r||0),d.metaStore.get(F,function(t,r){o._docCount=t?0:r,d.metaStore.get(D,function(t,r){n=t?Object(s.uuid)():r,d.metaStore.put(D,n,function(){Object(s.nextTick)(function(){e(null,l)})})})})})}function $(t,e){try{t.apply(null,e)}catch(t){e[e.length-1](t)}}function W(){var t=o._queue.peekFront();"read"===t.type?function(t){for(var e=[t],n=1,r=o._queue.get(n);void 0!==r&&"read"===r.type;)e.push(r),n++,r=o._queue.get(n);var i=0;e.forEach(function(t){var n=t.args,r=n[n.length-1];n[n.length-1]=h()(function(t){r.apply(null,t),++i===e.length&&Object(s.nextTick)(function(){e.forEach(function(){o._queue.shift()}),o._queue.length&&W()})}),$(t.fun,n)})}(t):function(t){var e=t.args,n=e[e.length-1];e[e.length-1]=h()(function(t){n.apply(null,t),Object(s.nextTick)(function(){o._queue.shift(),o._queue.length&&W()})}),$(t.fun,e)}(t)}function z(t){return h()(function(e){o._queue.push({fun:t,args:e,type:"write"}),1===o._queue.length&&Object(s.nextTick)(W)})}function G(t){return h()(function(e){o._queue.push({fun:t,args:e,type:"read"}),1===o._queue.length&&Object(s.nextTick)(W)})}function Q(t){return("0000000000000000"+t).slice(-16)}function J(t,e){"destroy"in q&&q.destroy(t,e)}R.has(U)?C=R.get(U):(C=new i.Map,R.set(U,C)),C.has(m)?(o=C.get(m),V()):C.set(m,Object(c.default)(a()(q(m),t,function(n){if(n)return C.delete(m),e(n);(o=C.get(m))._docCount=-1,o._queue=new f.a,"object"==typeof t.migrate?t.migrate.doMigrationOne(m,o,V):V()}))),l._remote=!1,l.type=function(){return"leveldb"},l._id=function(t){t(null,n)},l._info=function(t){var e={doc_count:o._docCount,update_seq:o._updateSeq,backend_adapter:Object(s.functionName)(q)};return Object(s.nextTick)(function(){t(null,e)})},l._get=G(function(t,e,n){e=Object(s.clone)(e),d.docStore.get(t,function(t,r){if(t||!r)return n(Object(b.createError)(b.MISSING_DOC,"missing"));var i;if(e.rev)i=e.latest?Object(v.latest)(e.rev,r):e.rev;else if(i=B(r),L(r,i))return n(Object(b.createError)(b.MISSING_DOC,"deleted"));var s=r.rev_map[i];d.bySeqStore.get(Q(s),function(t,e){if(!e)return n(Object(b.createError)(b.MISSING_DOC));if("_id"in e&&e._id!==r.id)return n(new Error("wrong doc returned"));if(e._id=r.id,"_rev"in e){if(e._rev!==i)return n(new Error("wrong doc returned"))}else e._rev=i;return n(null,{doc:e,metadata:r})})})}),l._getAttachment=function(t,e,n,i,s){var o=n.digest,a=n.content_type;d.binaryStore.get(o,function(t,e){if(t)return"NotFoundError"!==t.name?s(t):s(null,i.binary?function(t){return Object(r.blob)([""],{type:t})}(a):"");i.binary?s(null,w(e,a)):s(null,e.toString("base64"))})},l._bulkDocs=z(function(t,e,n){var a=e.new_edits,c=new Array(t.docs.length),u=new i.Map,h=new i.Map,f=new E,w=0,C=o._updateSeq,x=t.docs,T=x.map(function(t){if(t._id&&Object(y.isLocalId)(t._id))return t;var e=Object(y.parseDoc)(t,a,l.__opts);return e.metadata&&!e.metadata.rev_map&&(e.metadata.rev_map={}),e}),A=T.filter(function(t){return t.error});if(A.length)return n(A[0]);function k(t,e){var n=Promise.resolve();t.forEach(function(t,e){n=n.then(function(){return new Promise(function(n,r){l._doCompactionNoLock(e,t,{ctx:f},function(t){if(t)return r(t);n()})})})}),n.then(function(){e()},e)}function O(){k(h,function(t){if(t&&j(t),l.auto_compaction)return function(t){var e=new i.Map;u.forEach(function(t,n){e.set(n,Object(v.compactTree)(t))}),k(e,t)}(j);j()})}function P(t,e,i,s,o,a,l,p){w+=a;var y=null,v=0;t.metadata.winningRev=e,t.metadata.deleted=i,t.data._id=t.metadata.id,t.data._rev=t.metadata.rev,s&&(t.data._deleted=!0),t.stemmedRevs.length&&h.set(t.metadata.id,t.stemmedRevs);var m=t.data._attachments?Object.keys(t.data._attachments):[];function E(t){v++,y||(t?p(y=t):v===m.length&&R())}function x(t,e,n,r){return function(i){!function(t,e,n,r,i){var s=t.data._attachments[n];delete s.data,s.digest=e,s.length=r.length;var o=t.metadata.id,a=t.metadata.rev;s.revpos=parseInt(a,10),D(o,a,e,function(t,n){return t?i(t):0===r.length?i(t):n?(f.batch([{type:"put",prefix:d.binaryStore,key:e,value:g()(r,"binary")}]),void i()):i(t)})}(t,N+i,e,n,r)}}function T(t,e,n){return function(r){Object(_.binaryMd5)(r,x(t,e,r,n))}}for(var A=0;A<m.length;A++){var k,O=m[A],P=t.data._attachments[O];if(P.stub)D(t.data._id,t.data._rev,P.digest,E);else if("string"==typeof P.data){try{k=Object(r.atob)(P.data)}catch(t){return void n(Object(b.createError)(b.BAD_ARG,"Attachment is not a valid base64 string"))}T(t,O,E)(k)}else S(P.data,T(t,O,E))}function R(){var e=t.metadata.rev_map[t.metadata.rev];if(e)return p();e=++C,t.metadata.rev_map[t.metadata.rev]=t.metadata.seq=e;var n=[{key:Q(e),value:t.data,prefix:d.bySeqStore,type:"put"},{key:t.metadata.id,value:t.metadata,prefix:d.docStore,type:"put"}];f.batch(n),c[l]={ok:!0,id:t.metadata.id,rev:t.metadata.rev},u.set(t.metadata.id,t.metadata),p()}m.length||R()}var R={};function D(t,e,n,r){function i(r){var i=[t,e].join("@"),s={};return r?r.refs&&(s.refs=r.refs,s.refs[i]=!0):(s.refs={},s.refs[i]=!0),new Promise(function(t){f.batch([{type:"put",prefix:d.attachmentStore,key:n,value:s}]),t(!r)})}var s=R[n]||Promise.resolve();R[n]=s.then(function(){return new Promise(function(t,e){f.get(d.attachmentStore,n,function(n,r){if(n&&"NotFoundError"!==n.name)return e(n);t(r)})}).then(i).then(function(t){r(null,t)},r)})}function j(t){if(t)return Object(s.nextTick)(function(){n(t)});f.batch([{prefix:d.metaStore,type:"put",key:I,value:C},{prefix:d.metaStore,type:"put",key:F,value:o._docCount+w}]),f.execute(o,function(t){if(t)return n(t);o._docCount+=w,o._updateSeq=C,M.notify(m),Object(s.nextTick)(function(){n(null,c)})})}if(!T.length)return n(null,[]);!function(t){var e=[];if(x.forEach(function(t){t&&t._attachments&&Object.keys(t._attachments).forEach(function(n){var r=t._attachments[n];r.stub&&e.push(r.digest)})}),!e.length)return t();var n,r=0;e.forEach(function(i){!function(t,e){f.get(d.attachmentStore,t,function(n){if(n){var r=Object(b.createError)(b.MISSING_STUB,"unknown stub attachment with digest "+t);e(r)}else e()})}(i,function(i){i&&!n&&(n=i),++r===e.length&&t(n)})})}(function(t){if(t)return n(t);!function(t){var e,n=0;function r(){if(++n===x.length)return t(e)}x.forEach(function(t){if(t._id&&Object(y.isLocalId)(t._id))return r();f.get(d.docStore,t._id,function(n,i){n?"NotFoundError"!==n.name&&(e=n):u.set(t._id,i),r()})})}(function(t){if(t)return n(t);Object(y.processDocs)(p,T,l,u,f,c,P,e,O)})})}),l._allDocs=function(t,e){return"keys"in t?Object(y.allDocsKeysQuery)(this,t):G(function(t,e){t=Object(s.clone)(t),function(t){o.isClosed()?t(new Error("database is closed")):t(null,o._docCount)}(function(n,r){if(n)return e(n);var i,s={},a=t.skip||0;if(t.startkey&&(s.gte=t.startkey),t.endkey&&(s.lte=t.endkey),t.key&&(s.gte=s.lte=t.key),t.descending){s.reverse=!0;var c=s.lte;s.lte=s.gte,s.gte=c}if("number"==typeof t.limit&&(i=t.limit),0===i||"gte"in s&&"lte"in s&&s.gte>s.lte){var l={total_rows:r,offset:t.skip,rows:[]};return t.update_seq&&(l.update_seq=o._updateSeq),e(null,l)}var h=[],f=d.docStore.readStream(s),p=Object(u.obj)(function(e,n,r){var s=e.value,o=B(s),c=L(s,o);if(c){if("ok"!==t.deleted)return void r()}else{if(a-- >0)return void r();if("number"==typeof i&&i--<=0)return f.unpipe(),f.destroy(),void r()}function u(e){var n={id:s.id,key:s.id,value:{rev:o}};if(t.include_docs){if(n.doc=e,n.doc._rev=n.value.rev,t.conflicts){var i=Object(v.collectConflicts)(s);i.length&&(n.doc._conflicts=i)}for(var a in n.doc._attachments)n.doc._attachments.hasOwnProperty(a)&&(n.doc._attachments[a].stub=!0)}if(!1===t.inclusive_end&&s.id===t.endkey)return r();if(c){if("ok"!==t.deleted)return r();n.value.deleted=!0,n.doc=null}h.push(n),r()}if(t.include_docs){var l=s.rev_map[o];d.bySeqStore.get(Q(l),function(t,e){u(e)})}else u()},function(n){Promise.resolve().then(function(){if(t.include_docs&&t.attachments)return H(h,d,t)}).then(function(){var n={total_rows:r,offset:t.skip,rows:h};t.update_seq&&(n.update_seq=o._updateSeq),e(null,n)},e),n()}).on("unpipe",function(){p.end()});f.on("error",e),f.pipe(p)})})(t,e)},l._changes=function(t){if((t=Object(s.clone)(t)).continuous){var e=m+":"+Object(s.uuid)();return M.addListener(m,e,l,t),M.notify(m),{cancel:function(){M.removeListener(m,e)}}}var n,r=t.descending,a=[],c=t.since||0,h=0,f={reverse:r};"limit"in t&&t.limit>0&&(n=t.limit),f.reverse||(f.start=Q(t.since||0));var p=t.doc_ids&&new i.Set(t.doc_ids),g=Object(s.filterChange)(t),v=new i.Map;function _(){t.done=!0,t.return_docs&&t.limit&&t.limit<a.length&&(a.length=t.limit),b.unpipe(w),b.destroy(),t.continuous||t.cancelled||(t.include_docs&&t.attachments&&t.return_docs?H(a,d,t).then(function(){t.complete(null,{results:a,last_seq:c})}):t.complete(null,{results:a,last_seq:c}))}var b=d.bySeqStore.readStream(f),w=Object(u.obj)(function(e,i,s){if(n&&h>=n)return _(),s();if(t.cancelled||t.done)return s();var u,l=function(t){return parseInt(t,10)}(e.key),f=e.value;if(l===t.since&&!r)return s();if(p&&!p.has(f._id))return s();function m(e){var n=B(e);function r(n){var r=t.processChange(n,e,t);r.seq=e.seq;var i=g(r);if("object"==typeof i)return t.complete(i);i&&(h++,t.attachments&&t.include_docs?H([r],d,t).then(function(){t.onChange(r)}):t.onChange(r),t.return_docs&&a.push(r)),s()}if(e.seq!==l)return s();if(c=l,n===f._rev)return r(f);var i=e.rev_map[n];d.bySeqStore.get(Q(i),function(t,e){r(e)})}if(u=v.get(f._id))return m(u);d.docStore.get(f._id,function(e,n){if(t.cancelled||t.done||o.isClosed()||Object(y.isLocalId)(n.id))return s();v.set(f._id,n),m(n)})},function(e){if(t.cancelled)return e();t.return_docs&&t.limit&&t.limit<a.length&&(a.length=t.limit),e()}).on("unpipe",function(){w.end(),_()});return b.pipe(w),{cancel:function(){t.cancelled=!0,_()}}},l._close=function(t){if(o.isClosed())return t(Object(b.createError)(b.NOT_OPEN));o.close(function(e){e?t(e):(C.delete(m),t())})},l._getRevisionTree=function(t,e){d.docStore.get(t,function(t,n){t?e(Object(b.createError)(b.MISSING_DOC)):e(null,n.rev_tree)})},l._doCompaction=z(function(t,e,n,r){l._doCompactionNoLock(t,e,n,r)}),l._doCompactionNoLock=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),!e.length)return r();var s=n.ctx||new E;s.get(d.docStore,t,function(a,c){if(a)return r(a);var u=e.map(function(t){var e=c.rev_map[t];return delete c.rev_map[t],e});Object(v.traverseRevTree)(c.rev_tree,function(t,n,r,i,s){var o=n+"-"+r;-1!==e.indexOf(o)&&(s.status="missing")});var l=[];l.push({key:c.id,value:c,type:"put",prefix:d.docStore});var h,f={},p=0;function g(n){if(n&&(h=n),++p===e.length){if(h)return r(h);!function(){var n=Object.keys(f);if(!n.length)return y();var r,o=0;function a(t){t&&(r=t),++o===n.length&&y(r)}var c=new i.Map;e.forEach(function(e){c.set(t+"@"+e,!0)}),n.forEach(function(t){s.get(d.attachmentStore,t,function(e,n){if(e)return"NotFoundError"===e.name?a():a(e);var r=Object.keys(n.refs||{}).filter(function(t){return!c.has(t)}),i={};r.forEach(function(t){i[t]=!0}),r.length?l.push({key:t,type:"put",value:{refs:i},prefix:d.attachmentStore}):l=l.concat([{key:t,type:"del",prefix:d.attachmentStore},{key:t,type:"del",prefix:d.binaryStore}]),a()})})}()}}function y(t){return t?r(t):(s.batch(l),n.ctx?r():void s.execute(o,r))}u.forEach(function(t){l.push({key:Q(t),type:"del",prefix:d.bySeqStore}),s.get(d.bySeqStore,Q(t),function(t,e){if(t)return"NotFoundError"===t.name?g():g(t);Object.keys(e._attachments||{}).forEach(function(t){var n=e._attachments[t].digest;f[n]=!0}),g()})})})},l._getLocal=function(t,e){d.localStore.get(t,function(t,n){t?e(Object(b.createError)(b.MISSING_DOC)):e(null,n)})},l._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),e.ctx?l._putLocalNoLock(t,e,n):l._putLocalWithLock(t,e,n)},l._putLocalWithLock=z(function(t,e,n){l._putLocalNoLock(t,e,n)}),l._putLocalNoLock=function(t,e,n){delete t._revisions;var r=t._rev,i=t._id,s=e.ctx||new E;s.get(d.localStore,i,function(a,c){if(a&&r)return n(Object(b.createError)(b.REV_CONFLICT));if(c&&c._rev!==r)return n(Object(b.createError)(b.REV_CONFLICT));t._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var u=[{type:"put",prefix:d.localStore,key:i,value:t}];s.batch(u);var l={ok:!0,id:t._id,rev:t._rev};if(e.ctx)return n(null,l);s.execute(o,function(t){if(t)return n(t);n(null,l)})})},l._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),e.ctx?l._removeLocalNoLock(t,e,n):l._removeLocalWithLock(t,e,n)},l._removeLocalWithLock=z(function(t,e,n){l._removeLocalNoLock(t,e,n)}),l._removeLocalNoLock=function(t,e,n){var r=e.ctx||new E;r.get(d.localStore,t._id,function(i,s){if(i)return"NotFoundError"!==i.name?n(i):n(Object(b.createError)(b.MISSING_DOC));if(s._rev!==t._rev)return n(Object(b.createError)(b.REV_CONFLICT));r.batch([{prefix:d.localStore,type:"del",key:t._id}]);var a={ok:!0,id:t._id,rev:"0-0"};if(e.ctx)return n(null,a);r.execute(o,function(t){if(t)return n(t);n(null,a)})})},l._destroy=function(t,e){var n,r=Object(s.functionName)(q);if(!R.has(r))return J(m,e);(n=R.get(r)).has(m)?(M.removeAllListeners(m),n.get(m).close(function(){n.delete(m),J(m,e)})):J(m,e)}}},function(t,e,n){(function(e){var r=n(77).EventEmitter,i=n(94).inherits,s=n(96),o=n(97),a=n(107),c=n(123),u=n(124),l=n(129),h=n(128),d=u.WriteError,f=u.ReadError,p=u.NotFoundError,g=u.OpenError,y=u.InitializationError;function v(t,n,i){if(!(this instanceof v))return new v(t,n,i);var s;if(r.call(this),this.setMaxListeners(1/0),"function"==typeof n&&(i=n,n={}),n=n||{},!t||"object"!=typeof t){if(s=new y("First argument must be an abstract-leveldown compliant store"),"function"==typeof i)return e.nextTick(i,s);throw s}l.equal(typeof t.status,"string",".status required, old abstract-leveldown"),this.options=_(n),this._db=t,this.db=new o(t),this.open(i)}function m(t,e){return"function"==typeof t?t:e}function _(t){return"object"==typeof t&&null!==t?t:{}}function b(t,n){if(!t._isOpening()&&!t.isOpen())return e.nextTick(n,new f("Database is not open")),!0}v.prototype.emit=r.prototype.emit,v.prototype.once=r.prototype.once,i(v,r),v.prototype.open=function(t){var n,r=this;return t||(n=(t=h()).promise),this.isOpen()?(e.nextTick(t,null,r),n):this._isOpening()?(this.once("open",function(){t(null,r)}),n):(this.emit("opening"),this.db.open(this.options,function(e){if(e)return t(new g(e));r.db=r._db,t(null,r),r.emit("open"),r.emit("ready")}),n)},v.prototype.close=function(t){var n,r=this;return t||(n=(t=h()).promise),this.isOpen()?(this.db.close(function(){r.emit("closed"),t.apply(null,arguments)}),this.emit("closing"),this.db=new o(this._db)):this.isClosed()?e.nextTick(t):"closing"===this.db.status?this.once("closed",t):this._isOpening()&&this.once("open",function(){r.close(t)}),n},v.prototype.isOpen=function(){return"open"===this.db.status},v.prototype._isOpening=function(){return"opening"===this.db.status},v.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)},v.prototype.get=function(t,e,n){if(null===t||void 0===t)throw new f("get() requires a key argument");var r;return(n=m(e,n))||(r=(n=h()).promise),b(this,n)?r:(e=_(e),this.db.get(t,e,function(e,r){if(e)return e=/notfound/i.test(e)||e.notFound?new p("Key not found in database ["+t+"]",e):new f(e),n(e);n(null,r)}),r)},v.prototype.put=function(t,e,n,r){if(null===t||void 0===t)throw new d("put() requires a key argument");var i,s=this;return(r=m(n,r))||(i=(r=h()).promise),b(this,r)?i:(n=_(n),this.db.put(t,e,n,function(n){if(n)return r(new d(n));s.emit("put",t,e),r()}),i)},v.prototype.del=function(t,e,n){if(null===t||void 0===t)throw new d("del() requires a key argument");var r,i=this;return(n=m(e,n))||(r=(n=h()).promise),b(this,n)?r:(e=_(e),this.db.del(t,e,function(e){if(e)return n(new d(e));i.emit("del",t),n()}),r)},v.prototype.batch=function(t,e,n){if(!arguments.length)return new c(this);if(!Array.isArray(t))throw new d("batch() requires an array argument");var r,i=this;return(n=m(e,n))||(r=(n=h()).promise),b(this,n)?r:(e=_(e),this.db.batch(t,e,function(e){if(e)return n(new d(e));i.emit("batch",t),n()}),r)},v.prototype.readStream=v.prototype.createReadStream=function(t){return"number"!=typeof(t=s({keys:!0,values:!0},t)).limit&&(t.limit=-1),new a(this.db.iterator(t),t)},v.prototype.keyStream=v.prototype.createKeyStream=function(t){return this.createReadStream(s(t,{keys:!0,values:!1}))},v.prototype.valueStream=v.prototype.createValueStream=function(t){return this.createReadStream(s(t,{keys:!1,values:!0}))},v.prototype.toString=function(){return"LevelUP"},v.errors=u,t.exports=v.default=v}).call(this,n(47))},function(t,e,n){(function(t,r){var i=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(a(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,s=r.length,o=String(t).replace(i,function(t){if("%%"===t)return"%";if(n>=s)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),c=r[n];n<s;c=r[++n])g(c)||!b(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(n,i){if(m(t.process))return function(){return e.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var s=!1;return function(){if(!s){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),s=!0}return n.apply(this,arguments)}};var s,o={};function a(t,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&e._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,t,r.depth)}function c(t,e){var n=a.styles[e];return n?"["+a.colors[n][0]+"m"+t+"["+a.colors[n][1]+"m":t}function u(t,e){return t}function l(t,n,r){if(t.customInspect&&n&&C(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return v(i)||(i=l(t,i,r)),i}var s=function(t,e){if(m(e))return t.stylize("undefined","undefined");if(v(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(y(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,n);if(s)return s;var o=Object.keys(n),a=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(n)),S(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(C(n)){var c=n.name?": "+n.name:"";return t.stylize("[Function"+c+"]","special")}if(_(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return t.stylize(Date.prototype.toString.call(n),"date");if(S(n))return h(n)}var u,b="",E=!1,x=["{","}"];(f(n)&&(E=!0,x=["[","]"]),C(n))&&(b=" [Function"+(n.name?": "+n.name:"")+"]");return _(n)&&(b=" "+RegExp.prototype.toString.call(n)),w(n)&&(b=" "+Date.prototype.toUTCString.call(n)),S(n)&&(b=" "+h(n)),0!==o.length||E&&0!=n.length?r<0?_(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=E?function(t,e,n,r,i){for(var s=[],o=0,a=e.length;o<a;++o)A(e,String(o))?s.push(d(t,e,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(d(t,e,n,r,i,!0))}),s}(t,n,r,a,o):o.map(function(e){return d(t,n,r,a,e,E)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(u,b,x)):x[0]+b+x[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,r,i,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),A(r,i)||(o="["+i+"]"),a||(t.seen.indexOf(c.value)<0?(a=g(n)?l(t,c.value,null):l(t,c.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),m(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function f(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function g(t){return null===t}function y(t){return"number"==typeof t}function v(t){return"string"==typeof t}function m(t){return void 0===t}function _(t){return b(t)&&"[object RegExp]"===E(t)}function b(t){return"object"==typeof t&&null!==t}function w(t){return b(t)&&"[object Date]"===E(t)}function S(t){return b(t)&&("[object Error]"===E(t)||t instanceof Error)}function C(t){return"function"==typeof t}function E(t){return Object.prototype.toString.call(t)}function x(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(m(s)&&(s=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var n=r.pid;o[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else o[t]=function(){};return o[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=p,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=y,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=m,e.isRegExp=_,e.isObject=b,e.isDate=w,e.isError=S,e.isFunction=C,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(95);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function(){var t=new Date,e=[x(t.getHours()),x(t.getMinutes()),x(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=n(78),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,n(1),n(47))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){t.exports=function(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var i in r)n.call(r,i)&&(t[i]=r[i])}return t};var n=Object.prototype.hasOwnProperty},function(t,e,n){var r=n(98).AbstractLevelDOWN,i=n(78),s=n(106),o="put get del batch".split(" ");function a(t){r.call(this,""),this._db=t,this._operations=[],this._iterators=[],c(this)}function c(t){o.forEach(function(e){t["_"+e]=function(){this._operations.push({method:e,args:arguments})}}),"function"==typeof t._db.approximateSize&&(t.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),t._iterator=function(t){var e=new s(t);return this._iterators.push(e),e}}i(a,r),a.prototype._open=function(t,e){var n=this;this._db.open(t,function(t){if(t)return e(t);n._operations.forEach(function(t){n._db[t.method].apply(n._db,t.args)}),n._operations=[],n._iterators.forEach(function(t){t.setDb(n._db)}),n._iterators=[],function(t){o.concat("iterator").forEach(function(e){t["_"+e]=function(){return this._db[e].apply(this._db,arguments)}}),t._db.approximateSize&&(t.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)})}(n),e()})},a.prototype._close=function(t){var e=this;this._db.close(function(n){if(n)return t(n);c(e),t()})},a.prototype._serializeKey=function(t){return t},a.prototype._serializeValue=function(t){return t},t.exports=a,t.exports.DeferredIterator=s},function(t,e,n){e.AbstractLevelDOWN=n(99),e.AbstractIterator=n(104),e.AbstractChainedBatch=n(105)},function(t,e,n){(function(e,r){var i=n(96),s=n(104),o=n(105),a=Object.prototype.hasOwnProperty,c="start end gt gte lt lte".split(" ");function u(t){if(!arguments.length||void 0===t)throw new Error("constructor requires at least a location argument");if("string"!=typeof t)throw new Error("constructor requires a location string argument");this.location=t,this.status="new"}function l(t){return-1!==c.indexOf(t)}function h(t){return""===t||null==t||function(t){return r.isBuffer(t)&&0===t.length}(t)}u.prototype.open=function(t,e){var n=this,r=this.status;if("function"==typeof t&&(e=t),"function"!=typeof e)throw new Error("open() requires a callback argument");"object"!=typeof t&&(t={}),t.createIfMissing=!1!==t.createIfMissing,t.errorIfExists=!!t.errorIfExists,this.status="opening",this._open(t,function(t){if(t)return n.status=r,e(t);n.status="open",e()})},u.prototype._open=function(t,n){e.nextTick(n)},u.prototype.close=function(t){var e=this,n=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");this.status="closing",this._close(function(r){if(r)return e.status=n,t(r);e.status="closed",t()})},u.prototype._close=function(t){e.nextTick(t)},u.prototype.get=function(t,n,r){if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("get() requires a callback argument");var i=this._checkKey(t,"key");if(i)return e.nextTick(r,i);t=this._serializeKey(t),"object"!=typeof n&&(n={}),n.asBuffer=!1!==n.asBuffer,this._get(t,n,r)},u.prototype._get=function(t,n,r){e.nextTick(function(){r(new Error("NotFound"))})},u.prototype.put=function(t,n,r,i){if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");var s=this._checkKey(t,"key");if(s)return e.nextTick(i,s);t=this._serializeKey(t),n=this._serializeValue(n),"object"!=typeof r&&(r={}),this._put(t,n,r,i)},u.prototype._put=function(t,n,r,i){e.nextTick(i)},u.prototype.del=function(t,n,r){if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("del() requires a callback argument");var i=this._checkKey(t,"key");if(i)return e.nextTick(r,i);t=this._serializeKey(t),"object"!=typeof n&&(n={}),this._del(t,n,r)},u.prototype._del=function(t,n,r){e.nextTick(r)},u.prototype.batch=function(t,n,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof n&&(r=n),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(t))return e.nextTick(r,new Error("batch(array) requires an array argument"));n&&"object"==typeof n||(n={});for(var s=new Array(t.length),o=0;o<t.length;o++){if("object"!=typeof t[o]||null===t[o])return e.nextTick(r,new Error("batch(array) element must be an object and not `null`"));var a=i(t[o]);if("put"!==a.type&&"del"!==a.type)return e.nextTick(r,new Error("`type` must be 'put' or 'del'"));var c=this._checkKey(a.key,"key");if(c)return e.nextTick(r,c);a.key=this._serializeKey(a.key),"put"===a.type&&(a.value=this._serializeValue(a.value)),s[o]=a}this._batch(s,n,r)},u.prototype._batch=function(t,n,r){e.nextTick(r)},u.prototype._setupIteratorOptions=function(t){return(t=function(t){var e={};for(var n in t)a.call(t,n)&&(l(n)&&h(t[n])||(e[n]=t[n]));return e}(t)).reverse=!!t.reverse,t.keys=!1!==t.keys,t.values=!1!==t.values,t.limit="limit"in t?t.limit:-1,t.keyAsBuffer=!1!==t.keyAsBuffer,t.valueAsBuffer=!1!==t.valueAsBuffer,t},u.prototype.iterator=function(t){return"object"!=typeof t&&(t={}),t=this._setupIteratorOptions(t),this._iterator(t)},u.prototype._iterator=function(t){return new s(this)},u.prototype._chainedBatch=function(){return new o(this)},u.prototype._serializeKey=function(t){return r.isBuffer(t)?t:String(t)},u.prototype._serializeValue=function(t){return null==t?"":r.isBuffer(t)||e.browser?t:String(t)},u.prototype._checkKey=function(t,e){return null===t||void 0===t?new Error(e+" cannot be `null` or `undefined`"):r.isBuffer(t)&&0===t.length?new Error(e+" cannot be an empty Buffer"):""===String(t)?new Error(e+" cannot be an empty String"):void 0},t.exports=u}).call(this,n(47),n(100).Buffer)},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(101),i=n(102),s=n(103);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=d(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),i=(t=a(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(c.isBuffer(e)){var n=0|f(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):d(t,e);if("Buffer"===e.type&&s(e.data))return d(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(l(e),t=a(t,e<0?0:0|f(e)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function d(t,e){var n=e.length<0?0:0|f(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function f(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function p(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(t).length;default:if(r)return H(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:v(t,e,n,r,i);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):v(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(t,e,n,r,i){var s,o=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var l=-1;for(s=n;s<a;s++)if(u(t,s)===u(e,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*o}else-1!==l&&(s-=s-l),l=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var h=!0,d=0;d<c;d++)if(u(t,s+d)!==u(e,d)){h=!1;break}if(h)return s}return-1}function m(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[n+o]=a}return o}function _(t,e,n,r){return U(H(e,t.length-n),t,n,r)}function b(t,e,n,r){return U(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function w(t,e,n,r){return b(t,e,n,r)}function S(t,e,n,r){return U(q(e),t,n,r)}function C(t,e,n,r){return U(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function E(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function x(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,a,c,u=t[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(s=t[i+1]))&&(c=(31&u)<<6|63&s)>127&&(l=c);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=T));return n}(r)}e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,n){return u(null,t,e,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,n){return function(t,e,n,r){return l(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},c.allocUnsafe=function(t){return h(null,t)},c.allocUnsafeSlow=function(t){return h(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=c.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return O(this,e,n);case"utf8":case"utf-8":return x(this,e,n);case"ascii":return A(this,e,n);case"latin1":case"binary":return k(this,e,n);case"base64":return E(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,n,r,i){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var s=i-r,o=n-e,a=Math.min(s,o),u=this.slice(r,i),l=t.slice(e,n),h=0;h<a;++h)if(u[h]!==l[h]){s=u[h],o=l[h];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return m(this,t,e,n);case"utf8":case"utf-8":return _(this,t,e,n);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return w(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function A(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function k(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function O(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=L(t[s]);return i}function P(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function R(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,n,r,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function F(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-n,2);i<s;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-n,4);i<s;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function N(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(t,e,n,r,s){return s||N(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function M(t,e,n,r,s){return s||N(t,0,n,8),i.write(t,e,n,r,52,8),n+8}c.prototype.slice=function(t,e){var n,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=c.prototype;else{var i=e-t;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+t]}return n},c.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},c.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},c.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},c.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},c.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,n){return j(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return j(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return M(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return M(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,s=r-n;if(this===t&&n<e&&e<r)for(i=s-1;i>=0;--i)t[i+e]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),e);return s},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var s;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=e;s<n;++s)this[s]=t;else{var o=c.isBuffer(t)?t:H(new c(t,r).toString()),a=o.length;for(s=0;s<n-e;++s)this[s+e]=o[s%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function L(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function q(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(B,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function U(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(1))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){for(var e,n=u(t),r=n[0],o=n[1],a=new s(function(t,e,n){return 3*(e+n)/4-n}(0,r,o)),c=0,l=o>0?r-4:r,h=0;h<l;h+=4)e=i[t.charCodeAt(h)]<<18|i[t.charCodeAt(h+1)]<<12|i[t.charCodeAt(h+2)]<<6|i[t.charCodeAt(h+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=255&e;2===o&&(e=i[t.charCodeAt(h)]<<2|i[t.charCodeAt(h+1)]>>4,a[c++]=255&e);1===o&&(e=i[t.charCodeAt(h)]<<10|i[t.charCodeAt(h+1)]<<4|i[t.charCodeAt(h+2)]>>2,a[c++]=e>>8&255,a[c++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(h(t,o,o+16383>a?a:o+16383));1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function h(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(l(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,d=n?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=256*s+t[e+h],h+=d,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=256*o+t[e+h],h+=d,l-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=u}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,u=8*s-i-1,l=(1<<u)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[n+f]=255&o,f+=p,o/=256,u-=8);t[n+f-p]|=128*g}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){(function(e){function n(t){this.db=t,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?(e.nextTick(t,new Error("cannot call next() after end()")),n):n._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),n):(n._nexting=!0,n._next(function(){n._nexting=!1,t.apply(null,arguments)}),n)},n.prototype._next=function(t){e.nextTick(t)},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},n.prototype._end=function(t){e.nextTick(t)},t.exports=n}).call(this,n(47))},function(t,e,n){(function(e){function n(t){this._db=t,this._operations=[],this._written=!1}n.prototype._serializeKey=function(t){return this._db._serializeKey(t)},n.prototype._serializeValue=function(t){return this._db._serializeValue(t)},n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(t,e){this._checkWritten();var n=this._db._checkKey(t,"key");if(n)throw n;return t=this._serializeKey(t),e=this._serializeValue(e),this._put(t,e),this},n.prototype._put=function(t,e){this._operations.push({type:"put",key:t,value:e})},n.prototype.del=function(t){this._checkWritten();var e=this._db._checkKey(t,"key");if(e)throw e;return t=this._serializeKey(t),this._del(t),this},n.prototype._del=function(t){this._operations.push({type:"del",key:t})},n.prototype.clear=function(){return this._checkWritten(),this._operations=[],this._clear(),this},n.prototype._clear=function(){},n.prototype.write=function(t,n){if(this._checkWritten(),"function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(n):"function"==typeof this._db._batch?this._db._batch(this._operations,t,n):void e.nextTick(n)},t.exports=n}).call(this,n(47))},function(t,e,n){var r=n(98).AbstractIterator;function i(t){r.call(this,t),this._options=t,this._iterator=null,this._operations=[]}n(78)(i,r),i.prototype.setDb=function(t){var e=this._iterator=t.iterator(this._options);this._operations.forEach(function(t){e[t.method].apply(e,t.args)})},i.prototype._operation=function(t,e){if(this._iterator)return this._iterator[t].apply(this._iterator,e);this._operations.push({method:t,args:e})},"next end".split(" ").forEach(function(t){i.prototype["_"+t]=function(){this._operation(t,arguments)}}),t.exports=i},function(t,e,n){var r=n(78),i=n(108).Readable,s=n(96);function o(t,e){if(!(this instanceof o))return new o(t,e);e=e||{},i.call(this,s(e,{objectMode:!0})),this._iterator=t,this._destroyed=!1,this._options=e,this.on("end",this._cleanup.bind(this))}t.exports=o,r(o,i),o.prototype._read=function(){var t=this,e=this._options;this._destroyed||this._iterator.next(function(n,r,i){if(!t._destroyed)return n?t.emit("error",n):void(void 0===r&&void 0===i?t.push(null):!1!==e.keys&&!1===e.values?t.push(r):!1===e.keys&&!1!==e.values?t.push(i):t.push({key:r,value:i}))})},o.prototype.destroy=o.prototype._cleanup=function(){var t=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(e){if(e)return t.emit("error",e);t.emit("close")}))}},function(t,e,n){(e=t.exports=n(109)).Stream=e,e.Readable=e,e.Writable=n(118),e.Duplex=n(117),e.Transform=n(121),e.PassThrough=n(122)},function(t,e,n){"use strict";(function(e,r){var i=n(110);t.exports=_;var s,o=n(103);_.ReadableState=m;n(77).EventEmitter;var a=function(t,e){return t.listeners(e).length},c=n(111),u=n(112).Buffer,l=e.Uint8Array||function(){};var h=n(113);h.inherits=n(78);var d=n(114),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=n(115),y=n(116);h.inherits(_,c);var v=["error","close","destroy","pause","resume"];function m(t,e){s=s||n(117),t=t||{},this.objectMode=!!t.objectMode,e instanceof s&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=n(120).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function _(t){if(s=s||n(117),!(this instanceof _))return new _(t);this._readableState=new m(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function b(t,e,n,r,i){var s,o=t._readableState;null===e?(o.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,E(t)}(t,o)):(i||(s=function(t,e){var n;(function(t){return u.isBuffer(t)||t instanceof l})(e)||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===u.prototype||(e=function(t){return u.from(t)}(e)),r?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):w(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(e=o.decoder.write(e),o.objectMode||0!==e.length?w(t,o,e,!1):T(t,o)):w(t,o,e,!1))):r||(o.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(o)}function w(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&E(t)),T(t,e)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),_.prototype.destroy=y.destroy,_.prototype._undestroy=y.undestroy,_.prototype._destroy=function(t,e){this.push(null),e(t)},_.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=u.from(t,e),e=""),n=!0),b(this,t,e,!1,n)},_.prototype.unshift=function(t){return b(this,t,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){return p||(p=n(120).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var S=8388608;function C(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=S?t=S:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function E(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i(x,t):x(t))}function x(t){f("emit readable"),t.emit("readable"),P(t)}function T(t,e){e.readingMore||(e.readingMore=!0,i(A,t,e))}function A(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function k(t){f("readable nexttick read 0"),t.read(0)}function O(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),P(t),e.flowing&&!e.reading&&t.read(0)}function P(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function R(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var r;t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,r=1,i=n.data;t-=i.length;for(;n=n.next;){var s=n.data,o=t>s.length?s.length:t;if(o===s.length?i+=s:i+=s.slice(0,t),0===(t-=o)){o===s.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=s.slice(o));break}++r}return e.length-=r,i}(t,e):function(t,e){var n=u.allocUnsafe(t),r=e.head,i=1;r.data.copy(n),t-=r.data.length;for(;r=r.next;){var s=r.data,o=t>s.length?s.length:t;if(s.copy(n,n.length-t,0,o),0===(t-=o)){o===s.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=s.slice(o));break}++i}return e.length-=i,n}(t,e);return r}(t,e.buffer,e.decoder),n);var n}function I(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i(F,e,t))}function F(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function D(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}_.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?I(this):E(this),null;if(0===(t=C(t,e))&&e.ended)return 0===e.length&&I(this),null;var r,i=e.needReadable;return f("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",i=!0),e.ended||e.reading?f("reading or ended",i=!1):i&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=C(n,e))),null===(r=t>0?R(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&I(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(t,e){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,f("pipe count=%d opts=%j",s.pipesCount,e);var c=(!e||!1!==e.end)&&t!==r.stdout&&t!==r.stderr?l:_;function u(e,r){f("onunpipe"),e===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),t.removeListener("close",v),t.removeListener("finish",m),t.removeListener("drain",h),t.removeListener("error",y),t.removeListener("unpipe",u),n.removeListener("end",l),n.removeListener("end",_),n.removeListener("data",g),d=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||h())}function l(){f("onend"),t.end()}s.endEmitted?i(c):n.once("end",c),t.on("unpipe",u);var h=function(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,P(t))}}(n);t.on("drain",h);var d=!1;var p=!1;function g(e){f("ondata"),p=!1,!1!==t.write(e)||p||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==D(s.pipes,t))&&!d&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function y(e){f("onerror",e),_(),t.removeListener("error",y),0===a(t,"error")&&t.emit("error",e)}function v(){t.removeListener("finish",m),_()}function m(){f("onfinish"),t.removeListener("close",v),_()}function _(){f("unpipe"),n.unpipe(t)}return n.on("data",g),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",y),t.once("close",v),t.once("finish",m),t.emit("pipe",n),s.flowing||(f("pipe resume"),n.resume()),t},_.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n),this);if(!t){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=D(e.pipes,t);return-1===o?this:(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n),this)},_.prototype.on=function(t,e){var n=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&E(this):i(k,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i(O,t,e))}(this,t)),this},_.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",function(){if(f("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(i){(f("wrapped data"),e.decoder&&(i=e.decoder.write(i)),!e.objectMode||null!==i&&void 0!==i)&&((e.objectMode||i&&i.length)&&(r.push(i)||(n=!0,t.pause())))}),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var s=0;s<v.length;s++)t.on(v[s],r.emit.bind(r,v[s]));return r._read=function(e){f("wrapped _read",e),n&&(n=!1,t.resume())},r},_._fromList=R}).call(this,n(1),n(47))},function(t,e,n){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,r)});case 4:return e.nextTick(function(){t.call(null,n,r,i)});default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return e.nextTick(function(){t.apply(null,s)})}}:t.exports=e.nextTick}).call(this,n(47))},function(t,e,n){t.exports=n(77).EventEmitter},function(t,e,n){var r=n(100),i=r.Buffer;function s(t,e){for(var n in t)e[n]=t[n]}function o(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(s(r,e),e.Buffer=o),s(i,o),o.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},o.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e,n){(function(t){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,n(100).Buffer)},function(t,e){},function(t,e,n){"use strict";var r=n(112).Buffer;function i(t,e,n){t.copy(e,n)}t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e=r.allocUnsafe(t>>>0),n=this.head,s=0;n;)i(n.data,e,s),s+=n.data.length,n=n.next;return e},t}()},function(t,e,n){"use strict";var r=n(110);function i(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;s||o?e?e(t):!t||this._writableState&&this._writableState.errorEmitted||r(i,this,t):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(r(i,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){"use strict";var r=n(110),i=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=h;var s=n(113);s.inherits=n(78);var o=n(109),a=n(118);s.inherits(h,o);for(var c=i(a.prototype),u=0;u<c.length;u++){var l=c[u];h.prototype[l]||(h.prototype[l]=a.prototype[l])}function h(t){if(!(this instanceof h))return new h(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r(f,this)}function f(t){t.end()}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),h.prototype._destroy=function(t,e){this.push(null),this.end(),r(e,t)}},function(t,e,n){"use strict";(function(e,r,i){var s=n(110);function o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var r=t.entry;t.entry=null;for(;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=m;var a,c=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?r:s;m.WritableState=v;var u=n(113);u.inherits=n(78);var l={deprecate:n(119)},h=n(111),d=n(112).Buffer,f=i.Uint8Array||function(){};var p,g=n(116);function y(){}function v(t,e){a=a||n(117),t=t||{},this.objectMode=!!t.objectMode,e instanceof a&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,r,i){--e.pendingcb,n?(s(i,r),s(E,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(i(r),t._writableState.errorEmitted=!0,t.emit("error",r),E(t,e))}(t,n,r,e,i);else{var o=S(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||w(t,n),r?c(b,t,n,o,i):b(t,n,o,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function m(t){if(a=a||n(117),!(p.call(m,this)||this instanceof a))return new m(t);this._writableState=new v(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function _(t,e,n,r,i,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function b(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),E(t,e)}function w(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),s=e.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,_(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new o(e)}else{for(;n;){var u=n.chunk,l=n.encoding,h=n.callback;if(_(t,e,!1,e.objectMode?1:u.length,u,l,h),n=n.next,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=n,e.bufferProcessing=!1}function S(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function C(t,e){t._final(function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),E(t,e)})}function E(t,e){var n=S(e);return n&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,s(C,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}u.inherits(m,h),v.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(v.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(m,Symbol.hasInstance,{value:function(t){return!!p.call(this,t)||t&&t._writableState instanceof v}})):p=function(t){return t instanceof this},m.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},m.prototype.write=function(t,e,n){var r=this._writableState,i=!1,o=function(t){return d.isBuffer(t)||t instanceof f}(t)&&!r.objectMode;return o&&!d.isBuffer(t)&&(t=function(t){return d.from(t)}(t)),"function"==typeof e&&(n=e,e=null),o?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=y),r.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),s(e,n)}(this,n):(o||function(t,e,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),s(r,o),i=!1),i}(this,r,t,n))&&(r.pendingcb++,i=function(t,e,n,r,i,s){if(!n){var o=function(t,e,n){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=d.from(e,n));return e}(e,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,a,r,i,s);return c}(this,r,o,t,e,n)),i},m.prototype.cork=function(){this._writableState.corked++},m.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||w(this,t))},m.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},m.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},m.prototype._writev=null,m.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!==t&&void 0!==t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,n){e.ending=!0,E(t,e),n&&(e.finished?s(n):t.once("finish",n));e.ended=!0,t.writable=!1}(this,r,n)},Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),m.prototype.destroy=g.destroy,m.prototype._undestroy=g.undestroy,m.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,n(47),n(54).setImmediate,n(1))},function(t,e,n){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(t,e){if(n("noDeprecation"))return t;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this,n(1))},function(t,e,n){"use strict";var r=n(112).Buffer,i=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(r.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=c,this.end=u,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=l,this.end=h,e=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function a(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"�".repeat(n);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�".repeat(n+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�".repeat(n+2)}}(this,t,e);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function u(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function l(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function h(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function f(t){return t&&t.length?this.write(t):""}e.StringDecoder=s,s.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�".repeat(this.lastTotal-this.lastNeed):e},s.prototype.text=function(t,e){var n=function(t,e,n){var r=e.length-1;if(r<n)return 0;var i=o(e[r]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--r<n)return 0;if((i=o(e[r]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--r<n)return 0;if((i=o(e[r]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){"use strict";t.exports=o;var r=n(117),i=n(113);function s(t){this.afterTransform=function(e,n){return function(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&t.push(n);i(e);var s=t._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&t._read(s.highWaterMark)}(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function o(t){if(!(this instanceof o))return new o(t);r.call(this,t),this._transformState=new s(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(e)})}function a(t,e,n){if(e)return t.emit("error",e);null!==n&&void 0!==n&&t.push(n);var r=t._writableState,i=t._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=n(78),i.inherits(o,r),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var n=this;r.prototype._destroy.call(this,t,function(t){e(t),n.emit("close")})}},function(t,e,n){"use strict";t.exports=s;var r=n(121),i=n(113);function s(t){if(!(this instanceof s))return new s(t);r.call(this,t)}i.inherits=n(78),i.inherits(s,r),s.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){var r=n(124).WriteError,i=n(128);function s(t){this._levelup=t,this.batch=t.db.batch(),this.ops=[],this.length=0}s.prototype.put=function(t,e){try{this.batch.put(t,e)}catch(t){throw new r(t)}return this.ops.push({type:"put",key:t,value:e}),this.length++,this},s.prototype.del=function(t){try{this.batch.del(t)}catch(t){throw new r(t)}return this.ops.push({type:"del",key:t}),this.length++,this},s.prototype.clear=function(){try{this.batch.clear()}catch(t){throw new r(t)}return this.ops=[],this.length=0,this},s.prototype.write=function(t){var e,n=this._levelup,s=this.ops;t||(e=(t=i()).promise);try{this.batch.write(function(e){if(e)return t(new r(e));n.emit("batch",s),t()})}catch(t){throw new r(t)}return e},t.exports=s},function(t,e,n){var r=n(125).create,i=r("LevelUPError"),s=r("NotFoundError",i);s.prototype.notFound=!0,s.prototype.status=404,t.exports={LevelUPError:i,InitializationError:r("InitializationError",i),OpenError:r("OpenError",i),ReadError:r("ReadError",i),WriteError:r("WriteError",i),NotFoundError:s,EncodingError:r("EncodingError",i)}},function(t,e,n){var r=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},r.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=n(126)(t.exports),t.exports.create=t.exports.custom.createError},function(t,e,n){var r=n(127);function i(t,e,n){r(this,{type:t,name:t,cause:"string"!=typeof e?e:n,message:e&&"string"!=typeof e?e.message:e},"ewr")}function s(t,e){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),i.call(this,"CustomError",t,e)}s.prototype=new Error,t.exports=function(t){var e=function(e,n){return function(t,e,n){var r=function(n,s){i.call(this,e,n,s),"FilesystemError"==e&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(t.errno[this.cause.errno]?t.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,r)};return r.prototype=n?new n:new s,r}(t,e,n)};return{CustomError:s,FilesystemError:e("FilesystemError"),createError:e}}},function(t,e,n){
/*!
  * prr
  * (c) 2013 Rod Vagg <rod@vagg.org>
  * https://github.com/rvagg/prr
  * License: MIT
  */
!function(e,n,r){t.exports?t.exports=r():n.prr=r()}(0,this,function(){var t="function"==typeof Object.defineProperty?function(t,e,n){return Object.defineProperty(t,e,n),t}:function(t,e,n){return t[e]=n.value,t};return function(e,n,r,i){var s;if(i=function(t,e){var n="object"==typeof e,r=!n&&"string"==typeof e,i=function(t){return n?!!e[t]:!!r&&e.indexOf(t[0])>-1};return{enumerable:i("enumerable"),configurable:i("configurable"),writable:i("writable"),value:t}}(r,i),"object"==typeof n){for(s in n)Object.hasOwnProperty.call(n,s)&&(i.value=n[s],t(e,s,i));return e}return t(e,n,i)}})},function(t,e){t.exports=function(){var t,e=new Promise(function(e,n){t=function(t,r){t?n(t):e(r)}});return t.promise=e,t}},function(t,e,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function r(t,e){if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0}function i(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var s=n(94),o=Object.prototype.hasOwnProperty,a=Array.prototype.slice,c="foo"===function(){}.name;function u(t){return Object.prototype.toString.call(t)}function l(t){return!i(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var h=t.exports=v,d=/\s*function\s+([^\(\s]*)\s*/;function f(t){if(s.isFunction(t)){if(c)return t.name;var e=t.toString().match(d);return e&&e[1]}}function p(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function g(t){if(c||!s.isFunction(t))return s.inspect(t);var e=f(t);return"[Function"+(e?": "+e:"")+"]"}function y(t,e,n,r,i){throw new h.AssertionError({message:n,actual:t,expected:e,operator:r,stackStartFunction:i})}function v(t,e){t||y(t,!0,e,"==",h.ok)}function m(t,e,n,o){if(t===e)return!0;if(i(t)&&i(e))return 0===r(t,e);if(s.isDate(t)&&s.isDate(e))return t.getTime()===e.getTime();if(s.isRegExp(t)&&s.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&u(t)===u(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(i(t)!==i(e))return!1;var c=(o=o||{actual:[],expected:[]}).actual.indexOf(t);return-1!==c&&c===o.expected.indexOf(e)||(o.actual.push(t),o.expected.push(e),function(t,e,n,r){if(null===t||void 0===t||null===e||void 0===e)return!1;if(s.isPrimitive(t)||s.isPrimitive(e))return t===e;if(n&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=_(t),o=_(e);if(i&&!o||!i&&o)return!1;if(i)return t=a.call(t),e=a.call(e),m(t,e,n);var c,u,l=S(t),h=S(e);if(l.length!==h.length)return!1;for(l.sort(),h.sort(),u=l.length-1;u>=0;u--)if(l[u]!==h[u])return!1;for(u=l.length-1;u>=0;u--)if(c=l[u],!m(t[c],e[c],n,r))return!1;return!0}(t,e,n,o))}return n?t===e:t==e}function _(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function b(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function w(t,e,n,r){var i;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(t){var e;try{t()}catch(t){e=t}return e}(e),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),t&&!i&&y(i,n,"Missing expected exception"+r);var o="string"==typeof r,a=!t&&s.isError(i),c=!t&&i&&!n;if((a&&o&&b(i,n)||c)&&y(i,n,"Got unwanted exception"+r),t&&i&&n&&!b(i,n)||!t&&i)throw i}h.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function(t){return p(g(t.actual),128)+" "+t.operator+" "+p(g(t.expected),128)}(this),this.generatedMessage=!0);var e=t.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var n=new Error;if(n.stack){var r=n.stack,i=f(e),s=r.indexOf("\n"+i);if(s>=0){var o=r.indexOf("\n",s+1);r=r.substring(o+1)}this.stack=r}}},s.inherits(h.AssertionError,Error),h.fail=y,h.ok=v,h.equal=function(t,e,n){t!=e&&y(t,e,n,"==",h.equal)},h.notEqual=function(t,e,n){t==e&&y(t,e,n,"!=",h.notEqual)},h.deepEqual=function(t,e,n){m(t,e,!1)||y(t,e,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(t,e,n){m(t,e,!0)||y(t,e,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(t,e,n){m(t,e,!1)&&y(t,e,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function t(e,n,r){m(e,n,!0)&&y(e,n,r,"notDeepStrictEqual",t)},h.strictEqual=function(t,e,n){t!==e&&y(t,e,n,"===",h.strictEqual)},h.notStrictEqual=function(t,e,n){t===e&&y(t,e,n,"!==",h.notStrictEqual)},h.throws=function(t,e,n){w(!0,t,e,n)},h.doesNotThrow=function(t,e,n){w(!1,t,e,n)},h.ifError=function(t){if(t)throw t};var S=Object.keys||function(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e}}).call(this,n(1))},function(t,e,n){"use strict";n.r(e);var r=n(131),i=n.n(r),s=n(78),o=n.n(s),a=n(77),c=n.n(a),u=n(132),l=n.n(u),h=n(144),d=n.n(h);function f(t){return function(t){return"function"==typeof t}(t.prefix)?t.prefix():t}function p(){Error.call(this)}o()(p,Error),p.prototype.name="NotFoundError";var g=c.a.EventEmitter,y=new p,v=function(t,e,n,r){var i=new g;function s(t){var e,n={};if(r)for(e in r)void 0!==r[e]&&(n[e]=r[e]);if(t)for(e in t)void 0!==t[e]&&(n[e]=t[e]);return n}return i.sublevels={},i.options=r,i.version="6.5.4",i.methods={},e=e||[],i.put=function(n,r,o,a){"function"==typeof o&&(a=o,o={}),t.apply([{key:n,value:r,prefix:e.slice(),type:"put"}],s(o),function(t){if(t)return a(t);i.emit("put",n,r),a(null)})},i.prefix=function(){return e.slice()},i.batch=function(n,r,o){"function"==typeof r&&(o=r,r={}),n=n.map(function(t){return{key:t.key,value:t.value,prefix:t.prefix||e,keyEncoding:t.keyEncoding,valueEncoding:t.valueEncoding,type:t.type}}),t.apply(n,s(r),function(t){if(t)return o(t);i.emit("batch",n),o(null)})},i.get=function(n,r,i){"function"==typeof r&&(i=r,r={}),t.get(n,e,s(r),function(t,e){t?i(y):i(null,e)})},i.sublevel=function(r,o){return i.sublevels[r]=i.sublevels[r]||v(t,e.concat(r),n,s(o))},i.readStream=i.createReadStream=function(r){var i;(r=s(r)).prefix=e;var o=t.iterator(r);return(i=n(r,t.createDecoder(r))).setIterator(o),i},i.close=function(e){t.close(e)},i.isOpen=t.isOpen,i.isClosed=t.isClosed,i},m=l.a.Readable;function _(t,e){if(!(this instanceof _))return new _(t,e);m.call(this,{objectMode:!0,highWaterMark:t.highWaterMark}),this._waiting=!1,this._options=t,this._makeData=e}o()(_,m),_.prototype.setIterator=function(t){return this._iterator=t,this._destroyed?t.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},_.prototype._read=function(){var t=this;if(!t._destroyed)return t._iterator?void t._iterator.next(function(e,n,r){if(e||void 0===n&&void 0===r)return e||t._destroyed||t.push(null),t._cleanup(e);r=t._makeData(n,r),t._destroyed||t.push(r)}):this._waiting=!0},_.prototype._cleanup=function(t){if(!this._destroyed){this._destroyed=!0;var e=this;t&&"iterator has ended"!==t.message&&e.emit("error",t),e._iterator?e._iterator.end(function(){e._iterator=null,e.emit("close")}):e.emit("close")}},_.prototype.destroy=function(){this._cleanup()};var b={encode:function(t){return"ÿ"+t[0]+"ÿ"+t[1]},decode:function(t){var e=t.toString(),n=e.indexOf("ÿ",1);return[e.substring(1,n),e.substring(n+1)]},lowerBound:"\0",upperBound:"ÿ"},w=new d.a;e.default=function(t){return v(function(t,e,n){function r(t,r,i,s){return e.encode([t,n.encodeKey(r,i,s)])}function s(t,e){return e&&e.options&&(t.keyEncoding=t.keyEncoding||e.options.keyEncoding,t.valueEncoding=t.valueEncoding||e.options.valueEncoding),t}return t.open(function(){}),{apply:function(e,i,o){i=i||{};for(var a=[],c=-1,u=e.length;++c<u;){var l=e[c];s(l,l.prefix),l.prefix=f(l.prefix),a.push({key:r(l.prefix,l.key,i,l),value:"del"!==l.type&&n.encodeValue(l.value,i,l),type:l.type})}t.db.batch(a,i,o)},get:function(e,i,s,o){return s.asBuffer=n.valueAsBuffer(s),t.db.get(r(i,e,s),s,function(t,e){t?o(t):o(null,n.decodeValue(e,s))})},createDecoder:function(t){return function(r,i){return{key:n.decodeKey(e.decode(r)[1],t),value:n.decodeValue(i,t)}}},isClosed:function(){return t.isClosed()},close:function(e){return t.close(e)},iterator:function(s){var o=function(t){var e={};for(var n in t)e[n]=t[n];return e}(s||{}),a=s.prefix||[];return i.a.toLtgt(s,o,function(t){return r(a,t,o,{})},e.lowerBound,e.upperBound),o.prefix=null,o.keyAsBuffer=o.valueAsBuffer=!1,"number"!=typeof o.limit&&(o.limit=-1),o.keyAsBuffer=e.buffer,o.valueAsBuffer=n.valueAsBuffer(o),function(t){return{next:function(e){return t.next(e)},end:function(e){t.end(e)}}}(t.db.iterator(o))}}}(t,b,w),[],_,t.options)}},function(t,e,n){(function(t){function n(t){return void 0!==t&&""!==t}function r(t,e){return Object.hasOwnProperty.call(t,e)}function i(t,e){return Object.hasOwnProperty.call(t,e)&&e}e.compare=function(e,n){if(t.isBuffer(e)){for(var r=Math.min(e.length,n.length),i=0;i<r;i++){var s=e[i]-n[i];if(s)return s}return e.length-n.length}return e<n?-1:e>n?1:0};var s=e.lowerBoundKey=function(t){return i(t,"gt")||i(t,"gte")||i(t,"min")||(t.reverse?i(t,"end"):i(t,"start"))||void 0},o=e.lowerBound=function(t,e){var n=s(t);return n?t[n]:e},a=e.lowerBoundInclusive=function(t){return!r(t,"gt")},c=e.upperBoundInclusive=function(t){return!r(t,"lt")},u=e.lowerBoundExclusive=function(t){return!a(t)},l=e.upperBoundExclusive=function(t){return!c(t)},h=e.upperBoundKey=function(t){return i(t,"lt")||i(t,"lte")||i(t,"max")||(t.reverse?i(t,"start"):i(t,"end"))||void 0},d=e.upperBound=function(t,e){var n=h(t);return n?t[n]:e};function f(t){return t}e.start=function(t,e){return t.reverse?d(t,e):o(t,e)},e.end=function(t,e){return t.reverse?o(t,e):d(t,e)},e.startInclusive=function(t){return t.reverse?c(t):a(t)},e.endInclusive=function(t){return t.reverse?a(t):c(t)},e.toLtgt=function(t,n,i,s,o){n=n||{},i=i||f;var a=arguments.length>3,c=e.lowerBoundKey(t),u=e.upperBoundKey(t);return c?"gt"===c?n.gt=i(t.gt,!1):n.gte=i(t[c],!1):a&&(n.gte=i(s,!1)),u?"lt"===u?n.lt=i(t.lt,!0):n.lte=i(t[u],!0):a&&(n.lte=i(o,!0)),null!=t.reverse&&(n.reverse=!!t.reverse),r(n,"max")&&delete n.max,r(n,"min")&&delete n.min,r(n,"start")&&delete n.start,r(n,"end")&&delete n.end,n},e.contains=function(t,r,i){i=i||e.compare;var s=o(t);if(n(s)&&((a=i(r,s))<0||0===a&&u(t)))return!1;var a,c=d(t);if(n(c)&&((a=i(r,c))>0||0===a&&l(t)))return!1;return!0},e.filter=function(t,n){return function(r){return e.contains(t,r,n)}}}).call(this,n(100).Buffer)},function(t,e,n){var r=n(133);(e=t.exports=n(138)).Stream=r,e.Readable=e,e.Writable=n(140),e.Duplex=n(141),e.Transform=n(142),e.PassThrough=n(143)},function(t,e,n){t.exports=i;var r=n(77).EventEmitter;function i(){r.call(this)}n(78)(i,r),i.Readable=n(108),i.Writable=n(134),i.Duplex=n(135),i.Transform=n(136),i.PassThrough=n(137),i.Stream=i,i.prototype.pipe=function(t,e){var n=this;function i(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function s(){n.readable&&n.resume&&n.resume()}n.on("data",i),t.on("drain",s),t._isStdio||e&&!1===e.end||(n.on("end",a),n.on("close",c));var o=!1;function a(){o||(o=!0,t.end())}function c(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function u(t){if(l(),0===r.listenerCount(this,"error"))throw t}function l(){n.removeListener("data",i),t.removeListener("drain",s),n.removeListener("end",a),n.removeListener("close",c),n.removeListener("error",u),t.removeListener("error",u),n.removeListener("end",l),n.removeListener("close",l),t.removeListener("close",l)}return n.on("error",u),t.on("error",u),n.on("end",l),n.on("close",l),t.on("close",l),t.emit("pipe",n),t}},function(t,e,n){t.exports=n(118)},function(t,e,n){t.exports=n(117)},function(t,e,n){t.exports=n(108).Transform},function(t,e,n){t.exports=n(108).PassThrough},function(t,e,n){(function(e){t.exports=l;var r=n(139),i=n(100).Buffer;l.ReadableState=u;var s=n(77).EventEmitter;s.listenerCount||(s.listenerCount=function(t,e){return t.listeners(e).length});var o,a=n(133),c=n(113);function u(t,e){var r=(t=t||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(o||(o=n(120).StringDecoder),this.decoder=new o(t.encoding),this.encoding=t.encoding)}function l(t){if(!(this instanceof l))return new l(t);this._readableState=new u(t,this),this.readable=!0,a.call(this)}function h(t,n,r,s,o){var a=function(t,e){var n=null;i.isBuffer(e)||"string"==typeof e||null===e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(n,r);if(a)t.emit("error",a);else if(null===r||void 0===r)n.reading=!1,n.ended||function(t,e){if(e.decoder&&!e.ended){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,e.length>0?p(t):b(t)}(t,n);else if(n.objectMode||r&&r.length>0)if(n.ended&&!o){var c=new Error("stream.push() after EOF");t.emit("error",c)}else if(n.endEmitted&&o){c=new Error("stream.unshift() after end event");t.emit("error",c)}else!n.decoder||o||s||(r=n.decoder.write(r)),n.length+=n.objectMode?1:r.length,o?n.buffer.unshift(r):(n.reading=!1,n.buffer.push(r)),n.needReadable&&p(t),function(t,n){n.readingMore||(n.readingMore=!0,e.nextTick(function(){!function(t,e){var n=e.length;for(;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}(t,n)}))}(t,n);else o||(n.reading=!1);return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(n)}c.inherits=n(78),c.inherits(l,a),l.prototype.push=function(t,e){var n=this._readableState;return"string"!=typeof t||n.objectMode||(e=e||n.defaultEncoding)!==n.encoding&&(t=new i(t,e),e=""),h(this,n,t,e,!1)},l.prototype.unshift=function(t){return h(this,this._readableState,t,"",!0)},l.prototype.setEncoding=function(t){o||(o=n(120).StringDecoder),this._readableState.decoder=new o(t),this._readableState.encoding=t};var d=8388608;function f(t,e){return 0===e.length&&e.ended?0:e.objectMode?0===t?0:1:null===t||isNaN(t)?e.flowing&&e.buffer.length?e.buffer[0].length:e.length:t<=0?0:(t>e.highWaterMark&&(e.highWaterMark=function(t){if(t>=d)t=d;else{t--;for(var e=1;e<32;e<<=1)t|=t>>e;t++}return t}(t)),t>e.length?e.ended?e.length:(e.needReadable=!0,0):t)}function p(t){var n=t._readableState;n.needReadable=!1,n.emittedReadable||(n.emittedReadable=!0,n.sync?e.nextTick(function(){g(t)}):g(t))}function g(t){t.emit("readable")}function y(t){var e,n=t._readableState;function r(t,r,i){!1===t.write(e)&&n.awaitDrain++}for(n.awaitDrain=0;n.pipesCount&&null!==(e=t.read());)if(1===n.pipesCount?r(n.pipes):w(n.pipes,r),t.emit("data",e),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(s.listenerCount(t,"data")>0&&m(t));n.ranOut=!0}function v(){this._readableState.ranOut&&(this._readableState.ranOut=!1,y(this))}function m(t,n){if(t._readableState.flowing)throw new Error("Cannot switch to old mode now.");var r=n||!1,i=!1;t.readable=!0,t.pipe=a.prototype.pipe,t.on=t.addListener=a.prototype.on,t.on("readable",function(){var e;for(i=!0;!r&&null!==(e=t.read());)t.emit("data",e);null===e&&(i=!1,t._readableState.needReadable=!0)}),t.pause=function(){r=!0,this.emit("pause")},t.resume=function(){r=!1,i?e.nextTick(function(){t.emit("readable")}):this.read(0),this.emit("resume")},t.emit("readable")}function _(t,e){var n,r=e.buffer,s=e.length,o=!!e.decoder,a=!!e.objectMode;if(0===r.length)return null;if(0===s)n=null;else if(a)n=r.shift();else if(!t||t>=s)n=o?r.join(""):i.concat(r,s),r.length=0;else{if(t<r[0].length)n=(h=r[0]).slice(0,t),r[0]=h.slice(t);else if(t===r[0].length)n=r.shift();else{n=o?"":new i(t);for(var c=0,u=0,l=r.length;u<l&&c<t;u++){var h=r[0],d=Math.min(t-c,h.length);o?n+=h.slice(0,d):h.copy(n,c,0,d),d<h.length?r[0]=h.slice(d):r.shift(),c+=d}}}return n}function b(t){var n=t._readableState;if(n.length>0)throw new Error("endReadable called on non-empty stream");!n.endEmitted&&n.calledRead&&(n.ended=!0,e.nextTick(function(){n.endEmitted||0!==n.length||(n.endEmitted=!0,t.readable=!1,t.emit("end"))}))}function w(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}l.prototype.read=function(t){var e=this._readableState;e.calledRead=!0;var n,r=t;if(("number"!=typeof t||t>0)&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return p(this),null;if(0===(t=f(t,e))&&e.ended)return n=null,e.length>0&&e.decoder&&(n=_(t,e),e.length-=n.length),0===e.length&&b(this),n;var i=e.needReadable;return e.length-t<=e.highWaterMark&&(i=!0),(e.ended||e.reading)&&(i=!1),i&&(e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1),i&&!e.reading&&(t=f(r,e)),null===(n=t>0?_(t,e):null)&&(e.needReadable=!0,t=0),e.length-=t,0!==e.length||e.ended||(e.needReadable=!0),e.ended&&!e.endEmitted&&0===e.length&&b(this),n},l.prototype._read=function(t){this.emit("error",new Error("not implemented"))},l.prototype.pipe=function(t,n){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1;var a=(!n||!1!==n.end)&&t!==e.stdout&&t!==e.stderr?u:h;function c(t){t===i&&h()}function u(){t.end()}o.endEmitted?e.nextTick(a):i.once("end",a),t.on("unpipe",c);var l=function(t){return function(){var e=t._readableState;e.awaitDrain--,0===e.awaitDrain&&y(t)}}(i);function h(){t.removeListener("close",f),t.removeListener("finish",p),t.removeListener("drain",l),t.removeListener("error",d),t.removeListener("unpipe",c),i.removeListener("end",u),i.removeListener("end",h),t._writableState&&!t._writableState.needDrain||l()}function d(e){g(),t.removeListener("error",d),0===s.listenerCount(t,"error")&&t.emit("error",e)}function f(){t.removeListener("finish",p),g()}function p(){t.removeListener("close",f),g()}function g(){i.unpipe(t)}return t.on("drain",l),t._events&&t._events.error?r(t._events.error)?t._events.error.unshift(d):t._events.error=[d,t._events.error]:t.on("error",d),t.once("close",f),t.once("finish",p),t.emit("pipe",i),o.flowing||(this.on("readable",v),o.flowing=!0,e.nextTick(function(){y(i)})),t},l.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,this.removeListener("readable",v),e.flowing=!1,t&&t.emit("unpipe",this),this);if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,this.removeListener("readable",v),e.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}return-1===(i=function(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}(e.pipes,t))?this:(e.pipes.splice(i,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this),this)},l.prototype.on=function(t,e){var n=a.prototype.on.call(this,t,e);if("data"!==t||this._readableState.flowing||m(this),"readable"===t&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&p(this):this.read(0))}return n},l.prototype.addListener=l.prototype.on,l.prototype.resume=function(){m(this),this.read(0),this.emit("resume")},l.prototype.pause=function(){m(this,!0),this.emit("pause")},l.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",function(){if(e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(i){(e.decoder&&(i=e.decoder.write(i)),!e.objectMode||null!==i&&void 0!==i)&&((e.objectMode||i&&i.length)&&(r.push(i)||(n=!0,t.pause())))}),t)"function"==typeof t[i]&&void 0===this[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return w(["error","close","destroy","pause","resume"],function(e){t.on(e,r.emit.bind(r,e))}),r._read=function(e){n&&(n=!1,t.resume())},r},l._fromList=_}).call(this,n(47))},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e,n){(function(e){t.exports=a;var r=n(100).Buffer;a.WritableState=o;var i=n(113);i.inherits=n(78);var s=n(133);function o(t,n){var r=(t=t||{}).highWaterMark;this.highWaterMark=r||0===r?r:16384,this.objectMode=!!t.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===t.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,n){var r=t._writableState,i=r.sync,s=r.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),n)!function(t,n,r,i,s){r?e.nextTick(function(){s(i)}):s(i);t._writableState.errorEmitted=!0,t.emit("error",i)}(t,0,i,n,s);else{var o=l(t,r);o||r.bufferProcessing||!r.buffer.length||function(t,e){e.bufferProcessing=!0;for(var n=0;n<e.buffer.length;n++){var r=e.buffer[n],i=r.chunk,s=r.encoding,o=r.callback,a=e.objectMode?1:i.length;if(c(t,e,a,i,s,o),e.writing){n++;break}}e.bufferProcessing=!1,n<e.buffer.length?e.buffer=e.buffer.slice(n):e.buffer.length=0}(t,r),i?e.nextTick(function(){u(t,r,o,s)}):u(t,r,o,s)}}(n,t)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function a(t){var e=n(141);if(!(this instanceof a||this instanceof e))return new a(t);this._writableState=new o(t,this),this.writable=!0,s.call(this)}function c(t,e,n,r,i,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,t._write(r,i,e.onwrite),e.sync=!1}function u(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),r(),n&&h(t,e)}function l(t,e){return e.ending&&0===e.length&&!e.finished&&!e.writing}function h(t,e){var n=l(0,e);return n&&(e.finished=!0,t.emit("finish")),n}i.inherits(a,s),a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},a.prototype.write=function(t,n,i){var s=this._writableState,o=!1;return"function"==typeof n&&(i=n,n=null),r.isBuffer(t)?n="buffer":n||(n=s.defaultEncoding),"function"!=typeof i&&(i=function(){}),s.ended?function(t,n,r){var i=new Error("write after end");t.emit("error",i),e.nextTick(function(){r(i)})}(this,0,i):function(t,n,i,s){var o=!0;if(!r.isBuffer(i)&&"string"!=typeof i&&null!==i&&void 0!==i&&!n.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");t.emit("error",a),e.nextTick(function(){s(a)}),o=!1}return o}(this,s,t,i)&&(o=function(t,e,n,i,s){n=function(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=new r(e,n)),e}(e,n,i),r.isBuffer(n)&&(i="buffer");var o=e.objectMode?1:n.length;e.length+=o;var a=e.length<e.highWaterMark;a||(e.needDrain=!0);e.writing?e.buffer.push(new function(t,e,n){this.chunk=t,this.encoding=e,this.callback=n}(n,i,s)):c(t,e,o,n,i,s);return a}(this,s,t,n,i)),o},a.prototype._write=function(t,e,n){n(new Error("not implemented"))},a.prototype.end=function(t,n,r){var i=this._writableState;"function"==typeof t?(r=t,t=null,n=null):"function"==typeof n&&(r=n,n=null),void 0!==t&&null!==t&&this.write(t,n),i.ending||i.finished||function(t,n,r){n.ending=!0,h(t,n),r&&(n.finished?e.nextTick(r):t.once("finish",r));n.ended=!0}(this,i,r)}}).call(this,n(47))},function(t,e,n){(function(e){t.exports=a;var r=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e},i=n(113);i.inherits=n(78);var s=n(138),o=n(140);function a(t){if(!(this instanceof a))return new a(t);s.call(this,t),o.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",c)}function c(){this.allowHalfOpen||this._writableState.ended||e.nextTick(this.end.bind(this))}i.inherits(a,s),function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}(r(o.prototype),function(t){a.prototype[t]||(a.prototype[t]=o.prototype[t])})}).call(this,n(47))},function(t,e,n){t.exports=o;var r=n(141),i=n(113);function s(t,e){this.afterTransform=function(t,n){return function(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&t.push(n);i&&i(e);var s=t._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&t._read(s.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(t){if(!(this instanceof o))return new o(t);r.call(this,t);this._transformState=new s(t,this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(t){a(e,t)}):a(e)})}function a(t,e){if(e)return t.emit("error",e);var n=t._writableState,r=(t._readableState,t._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return t.push(null)}i.inherits=n(78),i.inherits(o,r),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,n){throw new Error("not implemented")},o.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}},function(t,e,n){t.exports=s;var r=n(142),i=n(113);function s(t){if(!(this instanceof s))return new s(t);r.call(this,t)}i.inherits=n(78),i.inherits(s,r),s.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){var r=n(145);function i(t){this.opts=t||{},this.encodings=r}t.exports=i,i.prototype._encoding=function(t){return"string"==typeof t&&(t=r[t]),t||(t=r.id),t},i.prototype._keyEncoding=function(t,e){return this._encoding(e&&e.keyEncoding||t&&t.keyEncoding||this.opts.keyEncoding)},i.prototype._valueEncoding=function(t,e){return this._encoding(e&&(e.valueEncoding||e.encoding)||t&&(t.valueEncoding||t.encoding)||this.opts.valueEncoding||this.opts.encoding)},i.prototype.encodeKey=function(t,e,n){return this._keyEncoding(e,n).encode(t)},i.prototype.encodeValue=function(t,e,n){return this._valueEncoding(e,n).encode(t)},i.prototype.decodeKey=function(t,e){return this._keyEncoding(e).decode(t)},i.prototype.decodeValue=function(t,e){return this._valueEncoding(e).decode(t)},i.prototype.encodeBatch=function(t,e){var n=this;return t.map(function(t){var r={type:t.type,key:n.encodeKey(t.key,e,t)};return n.keyAsBuffer(e,t)&&(r.keyEncoding="binary"),t.prefix&&(r.prefix=t.prefix),"value"in t&&(r.value=n.encodeValue(t.value,e,t),n.valueAsBuffer(e,t)&&(r.valueEncoding="binary")),r})};var s=["lt","gt","lte","gte","start","end"];i.prototype.encodeLtgt=function(t){var e=this,n={};return Object.keys(t).forEach(function(r){n[r]=s.indexOf(r)>-1?e.encodeKey(t[r],t):t[r]}),n},i.prototype.createStreamDecoder=function(t){var e=this;return t.keys&&t.values?function(n,r){return{key:e.decodeKey(n,t),value:e.decodeValue(r,t)}}:t.keys?function(n){return e.decodeKey(n,t)}:t.values?function(n,r){return e.decodeValue(r,t)}:function(){}},i.prototype.keyAsBuffer=function(t){return this._keyEncoding(t).buffer},i.prototype.valueAsBuffer=function(t){return this._valueEncoding(t).buffer}},function(t,e,n){(function(t){e.utf8=e["utf-8"]={encode:function(t){return r(t)?t:String(t)},decode:function(t){return"string"==typeof t?t:String(t)},buffer:!1,type:"utf8"},e.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},e.binary={encode:function(e){return r(e)?e:new t(e)},decode:n,buffer:!0,type:"binary"},e.none={encode:n,decode:n,buffer:!1,type:"id"},e.id=e.none;function n(t){return t}function r(e){return void 0===e||null===e||t.isBuffer(e)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(n){e[n]={encode:function(e){return r(e)?e:new t(e,n)},decode:function(t){return t.toString(n)},buffer:!0,type:n}})}).call(this,n(100).Buffer)},function(t,e,n){(function(e){var r=n(136),i=n(94).inherits,s=n(96);function o(t){r.call(this,t),this._destroyed=!1}function a(t,e,n){n(null,t)}function c(t){return function(e,n,r){return"function"==typeof e&&(r=n,n=e,e={}),"function"!=typeof n&&(n=a),"function"!=typeof r&&(r=null),t(e,n,r)}}i(o,r),o.prototype.destroy=function(t){if(!this._destroyed){this._destroyed=!0;var n=this;e.nextTick(function(){t&&n.emit("error",t),n.emit("close")})}},t.exports=c(function(t,e,n){var r=new o(t);return r._transform=e,n&&(r._flush=n),r}),t.exports.ctor=c(function(t,e,n){function r(e){if(!(this instanceof r))return new r(e);this.options=s(t,e),o.call(this,this.options)}return i(r,o),r.prototype._transform=e,n&&(r.prototype._flush=n),r}),t.exports.obj=c(function(t,e,n){var r=new o(s({objectMode:!0,highWaterMark:16},t));return r._transform=e,n&&(r._flush=n),r})}).call(this,n(47))},function(t,e,n){"use strict";function r(t){if(this._capacity=s(t),this._length=0,this._front=0,i(t)){for(var e=t.length,n=0;n<e;++n)this[n]=t[n];this._length=e}}r.prototype.toArray=function(){for(var t=this._length,e=new Array(t),n=this._front,r=this._capacity,i=0;i<t;++i)e[i]=this[n+i&r-1];return e},r.prototype.push=function(t){var e=arguments.length,n=this._length;if(e>1){var r=this._capacity;if(n+e>r){for(var i=0;i<e;++i){this._checkCapacity(n+1),this[s=this._front+n&this._capacity-1]=arguments[i],n++,this._length=n}return n}for(var s=this._front,i=0;i<e;++i)this[s+n&r-1]=arguments[i],s++;return this._length=n+e,n+e}return 0===e?n:(this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=t,this._length=n+1,n+1)},r.prototype.pop=function(){var t=this._length;if(0!==t){var e=this._front+t-1&this._capacity-1,n=this[e];return this[e]=void 0,this._length=t-1,n}},r.prototype.shift=function(){var t=this._length;if(0!==t){var e=this._front,n=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length=t-1,n}},r.prototype.unshift=function(t){var e=this._length,n=arguments.length;if(n>1){if(e+n>(i=this._capacity)){for(var r=n-1;r>=0;r--){this._checkCapacity(e+1);var i=this._capacity;this[o=(this._front-1&i-1^i)-i]=arguments[r],e++,this._length=e,this._front=o}return e}var s=this._front;for(r=n-1;r>=0;r--){var o;this[o=(s-1&i-1^i)-i]=arguments[r],s=o}return this._front=s,this._length=e+n,e+n}if(0===n)return e;this._checkCapacity(e+1);i=this._capacity;return this[r=(this._front-1&i-1^i)-i]=t,this._length=e+1,this._front=r,e+1},r.prototype.peekBack=function(){var t=this._length;if(0!==t)return this[this._front+t-1&this._capacity-1]},r.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},r.prototype.get=function(t){var e=t;if(e===(0|e)){var n=this._length;if(e<0&&(e+=n),!(e<0||e>=n))return this[this._front+e&this._capacity-1]}},r.prototype.isEmpty=function(){return 0===this._length},r.prototype.clear=function(){for(var t=this._length,e=this._front,n=this._capacity,r=0;r<t;++r)this[e+r&n-1]=void 0;this._length=0,this._front=0},r.prototype.toString=function(){return this.toArray().toString()},r.prototype.valueOf=r.prototype.toString,r.prototype.removeFront=r.prototype.shift,r.prototype.removeBack=r.prototype.pop,r.prototype.insertFront=r.prototype.unshift,r.prototype.insertBack=r.prototype.push,r.prototype.enqueue=r.prototype.push,r.prototype.dequeue=r.prototype.shift,r.prototype.toJSON=r.prototype.toArray,Object.defineProperty(r.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(s(1.5*this._capacity+16))},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,r=this._length;n+r>e&&function(t,e,n,r,i){for(var s=0;s<i;++s)n[s+r]=t[s+e],t[s+e]=void 0}(this,0,this,e,n+r&e-1)};var i=Array.isArray;function s(t){if("number"!=typeof t){if(!i(t))return 16;t=t.length}return function(t){return t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)}(Math.min(Math.max(16,t),1073741824))}t.exports=r},function(t,e,n){(function(e){var n=Object.prototype.toString,r="function"==typeof e.alloc&&"function"==typeof e.allocUnsafe&&"function"==typeof e.from;t.exports=function(t,i,s){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return function(t){return"ArrayBuffer"===n.call(t).slice(8,-1)}(t)?function(t,n,i){n>>>=0;var s=t.byteLength-n;if(s<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=s;else if((i>>>=0)>s)throw new RangeError("'length' is out of bounds");return r?e.from(t.slice(n,n+i)):new e(new Uint8Array(t.slice(n,n+i)))}(t,i,s):"string"==typeof t?function(t,n){if("string"==typeof n&&""!==n||(n="utf8"),!e.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');return r?e.from(t,n):new e(t,n)}(t,i):r?e.from(t):new e(t)}}).call(this,n(100).Buffer)},function(t,e,n){"use strict";n.r(e),n.d(e,"allDocsKeysQuery",function(){return u}),n.d(e,"parseDoc",function(){return p}),n.d(e,"preprocessAttachments",function(){return v}),n.d(e,"processDocs",function(){return _}),n.d(e,"updateDoc",function(){return m});var r=n(87);n.d(e,"invalidIdError",function(){return r.invalidIdError}),n.d(e,"normalizeDdocFunctionName",function(){return r.normalizeDdocFunctionName}),n.d(e,"parseDdocFunctionName",function(){return r.parseDdocFunctionName});var i=n(89),s=n(91),o=n(90),a=n(150);n.d(e,"isDeleted",function(){return a.isDeleted}),n.d(e,"isLocalId",function(){return a.isLocalId});var c=n(88);function u(t,e){var n=e.keys,i={offset:e.skip};return Promise.all(n.map(function(n){var s=Object(r.assign)({key:n,deleted:"ok"},e);return["limit","skip","keys"].forEach(function(t){delete s[t]}),new Promise(function(r,o){t._allDocs(s,function(t,s){if(t)return o(t);e.update_seq&&void 0!==s.update_seq&&(i.update_seq=s.update_seq),i.total_rows=s.total_rows,r(s.rows[0]||{key:n,error:"not_found"})})})})).then(function(t){return i.rows=t,i})}function l(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}var h=l(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),d=l(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function f(t){if(!/^\d+-./.test(t))return Object(i.createError)(i.INVALID_REV);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function p(t,e,n){var s,o,a;n||(n={deterministic_revs:!0});var c={status:"available"};if(t._deleted&&(c.deleted=!0),e)if(t._id||(t._id=Object(r.uuid)()),o=Object(r.rev)(t,n.deterministic_revs),t._rev){if((a=f(t._rev)).error)return a;t._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[o,c,[]]]]}],s=a.prefix+1}else t._rev_tree=[{pos:1,ids:[o,c,[]]}],s=1;else if(t._revisions&&(t._rev_tree=function(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],s=1,o=r.length;s<o;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}(t._revisions,c),s=t._revisions.start,o=t._revisions.ids[0]),!t._rev_tree){if((a=f(t._rev)).error)return a;s=a.prefix,o=a.id,t._rev_tree=[{pos:s,ids:[o,c,[]]}]}Object(r.invalidIdError)(t._id),t._rev=s+"-"+o;var u={metadata:{},data:{}};for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var p="_"===l[0];if(p&&!h[l]){var g=Object(i.createError)(i.DOC_VALIDATION,l);throw g.message=i.DOC_VALIDATION.message+": "+l,g}p&&!d[l]?u.metadata[l.slice(1)]=t[l]:u.data[l]=t[l]}return u}function g(t,e,n){var r=function(t){try{return Object(s.atob)(t)}catch(t){return{error:Object(i.createError)(i.BAD_ARG,"Attachment is not a valid base64 string")}}}(t.data);if(r.error)return n(r.error);t.length=r.length,t.data="blob"===e?Object(s.binaryStringToBlobOrBuffer)(r,t.content_type):"base64"===e?Object(s.btoa)(r):r,Object(o.binaryMd5)(r,function(e){t.digest="md5-"+e,n()})}function y(t,e,n){if(t.stub)return n();"string"==typeof t.data?g(t,e,n):function(t,e,n){Object(o.binaryMd5)(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,"binary"===e?Object(s.blobOrBufferToBinaryString)(t.data,function(e){t.data=e,n()}):"base64"===e?Object(s.blobOrBufferToBase64)(t.data,function(e){t.data=e,n()}):n()})}(t,e,n)}function v(t,e,n){if(!t.length)return n();var r,i=0;function s(){i++,t.length===i&&(r?n(r):n())}t.forEach(function(t){var n=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],i=0;if(!n.length)return s();function o(t){r=t,++i===n.length&&s()}for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&y(t.data._attachments[a],e,o)})}function m(t,e,n,r,s,o,c,u){if(Object(a.revExists)(e.rev_tree,n.metadata.rev)&&!u)return r[s]=n,o();var l=e.winningRev||Object(a.winningRev)(e),h="deleted"in e?e.deleted:Object(a.isDeleted)(e,l),d="deleted"in n.metadata?n.metadata.deleted:Object(a.isDeleted)(n.metadata),f=/^1-/.test(n.metadata.rev);if(h&&!d&&u&&f){var g=n.data;g._rev=l,g._id=n.metadata.id,n=p(g,u)}var y=Object(a.merge)(e.rev_tree,n.metadata.rev_tree[0],t);if(u&&(h&&d&&"new_leaf"!==y.conflicts||!h&&"new_leaf"!==y.conflicts||h&&!d&&"new_branch"===y.conflicts)){var v=Object(i.createError)(i.REV_CONFLICT);return r[s]=v,o()}var m=n.metadata.rev;n.metadata.rev_tree=y.tree,n.stemmedRevs=y.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var _=Object(a.winningRev)(n.metadata),b=Object(a.isDeleted)(n.metadata,_),w=h===b?0:h<b?-1:1;c(n,_,b,m===_?b:Object(a.isDeleted)(n.metadata,m),!0,w,s,o)}function _(t,e,n,r,s,o,u,l,h){t=t||1e3;var d=l.new_edits,f=new c.Map,p=0,g=e.length;function y(){++p===g&&h&&h()}e.forEach(function(t,e){if(t._id&&Object(a.isLocalId)(t._id)){var r=t._deleted?"_removeLocal":"_putLocal";n[r](t,{ctx:s},function(t,n){o[e]=t||n,y()})}else{var i=t.metadata.id;f.has(i)?(g--,f.get(i).push([t,e])):f.set(i,[[t,e]])}}),f.forEach(function(e,n){var s=0;function c(){++s<e.length?h():y()}function h(){var h=e[s],f=h[0],p=h[1];if(r.has(n))m(t,r.get(n),f,o,p,c,u,d);else{var g=Object(a.merge)([],f.metadata.rev_tree[0],t);f.metadata.rev_tree=g.tree,f.stemmedRevs=g.stemmedRevs||[],function(t,e,n){var r=Object(a.winningRev)(t.metadata),s=Object(a.isDeleted)(t.metadata,r);if("was_delete"in l&&s)return o[e]=Object(i.createError)(i.MISSING_DOC,"deleted"),n();if(d&&function(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}(t)){var c=Object(i.createError)(i.REV_CONFLICT);return o[e]=c,n()}u(t,r,s,s,!1,s?0:1,e,n)}(f,p,c)}}h()})}},function(t,e,n){"use strict";function r(t){for(var e,n,r,i,s=t.rev_tree.slice();i=s.pop();){var o=i.ids,a=o[2],c=i.pos;if(a.length)for(var u=0,l=a.length;u<l;u++)s.push({pos:c+1,ids:a[u]});else{var h=!!o[1].deleted,d=o[0];e&&!(r!==h?r:n!==c?n<c:e<d)||(e=d,n=c,r=h)}}return n+"-"+e}function i(t,e){for(var n,r=t.slice();n=r.pop();)for(var i=n.pos,s=n.ids,o=s[2],a=e(0===o.length,i,s[0],n.ctx,s[1]),c=0,u=o.length;c<u;c++)r.push({pos:i+1,ids:o[c],ctx:a})}function s(t,e){return t.pos-e.pos}function o(t){var e=[];i(t,function(t,n,r,i,s){t&&e.push({rev:n+"-"+r,pos:n,opts:s})}),e.sort(s).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function a(t){for(var e=r(t),n=o(t.rev_tree),i=[],s=0,a=n.length;s<a;s++){var c=n[s];c.rev===e||c.opts.deleted||i.push(c.rev)}return i}function c(t){var e=[];return i(t.rev_tree,function(t,n,r,i,s){"available"!==s.status||t||(e.push(n+"-"+r),s.status="missing")}),e}function u(t){for(var e,n=[],r=t.slice();e=r.pop();){var i=e.pos,s=e.ids,o=s[0],a=s[1],c=s[2],u=0===c.length,l=e.history?e.history.slice():[];l.push({id:o,opts:a}),u&&n.push({pos:i+1-l.length,ids:l});for(var h=0,d=c.length;h<d;h++)r.push({pos:i+1,ids:c[h],history:l})}return n.reverse()}function l(t,e){return t.pos-e.pos}function h(t,e,n){var r=function(t,e,n){for(var r,i=0,s=t.length;i<s;)n(t[r=i+s>>>1],e)<0?i=r+1:s=r;return i}(t,e,n);t.splice(r,0,e)}function d(t,e){for(var n,r,i=e,s=t.length;i<s;i++){var o=t[i],a=[o.id,o.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function f(t,e){return t[0]<e[0]?-1:1}function p(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,o=i.tree2;(s[1].status||o[1].status)&&(s[1].status="available"===s[1].status||"available"===o[1].status?"available":"missing");for(var a=0;a<o[2].length;a++)if(s[2][0]){for(var c=!1,u=0;u<s[2].length;u++)s[2][u][0]===o[2][a][0]&&(n.push({tree1:s[2][u],tree2:o[2][a]}),c=!0);c||(r="new_branch",h(s[2],o[2][a],f))}else r="new_leaf",s[2][0]=o[2][a]}return{conflicts:r,tree:t}}function g(t,e,n){var r,i=[],s=!1,o=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var u=t[a];if(u.pos===e.pos&&u.ids[0]===e.ids[0])r=p(u.ids,e.ids),i.push({pos:u.pos,ids:r.tree}),s=s||r.conflicts,o=!0;else if(!0!==n){var h=u.pos<e.pos?u:e,d=u.pos<e.pos?e:u,f=d.pos-h.pos,g=[],y=[];for(y.push({ids:h.ids,diff:f,parent:null,parentIdx:null});y.length>0;){var v=y.pop();if(0!==v.diff)for(var m=v.ids[2],_=0,b=m.length;_<b;_++)y.push({ids:m[_],diff:v.diff-1,parent:v.ids,parentIdx:_});else v.ids[0]===d.ids[0]&&g.push(v)}var w=g[0];w?(r=p(w.ids,d.ids),w.parent[2][w.parentIdx]=r.tree,i.push({pos:h.pos,ids:h.ids}),s=s||r.conflicts,o=!0):i.push(u)}else i.push(u)}return o||i.push(e),i.sort(l),{tree:i,conflicts:s||"internal_node"}}function y(t,e,n){var r=g(t,e),s=function(t,e){for(var n,r,s=u(t),o=0,a=s.length;o<a;o++){var c,l=s[o],h=l.ids;if(h.length>e){n||(n={});var f=h.length-e;c={pos:l.pos+f,ids:d(h,f)};for(var p=0;p<f;p++){var y=l.pos+p+"-"+h[p].id;n[y]=!0}}else c={pos:l.pos,ids:d(h,0)};r=r?g(r,c,!0).tree:[c]}return n&&i(r,function(t,e,r){delete n[e+"-"+r]}),{tree:r,revs:n?Object.keys(n):[]}}(r.tree,n);return{tree:s.tree,stemmedRevs:s.revs,conflicts:r.conflicts}}function v(t,e){for(var n,r=t.slice(),i=e.split("-"),s=parseInt(i[0],10),o=i[1];n=r.pop();){if(n.pos===s&&n.ids[0]===o)return!0;for(var a=n.ids[2],c=0,u=a.length;c<u;c++)r.push({pos:n.pos+1,ids:a[c]})}return!1}function m(t){return t.ids}function _(t,e){e||(e=r(t));for(var n,i=e.substring(e.indexOf("-")+1),s=t.rev_tree.map(m);n=s.pop();){if(n[0]===i)return!!n[1].deleted;s=s.concat(n[2])}}function b(t){return/^_local/.test(t)}function w(t,e){for(var n,r=e.rev_tree.slice();n=r.pop();){var i=n.pos,s=n.ids,o=s[0],a=s[1],c=s[2],u=0===c.length,l=n.history?n.history.slice():[];if(l.push({id:o,pos:i,opts:a}),u)for(var h=0,d=l.length;h<d;h++){var f=l[h];if(f.pos+"-"+f.id===t)return i+"-"+o}for(var p=0,g=c.length;p<g;p++)r.push({pos:i+1,ids:c[p],history:l})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}n.r(e),n.d(e,"collectConflicts",function(){return a}),n.d(e,"collectLeaves",function(){return o}),n.d(e,"compactTree",function(){return c}),n.d(e,"isDeleted",function(){return _}),n.d(e,"isLocalId",function(){return b}),n.d(e,"merge",function(){return y}),n.d(e,"revExists",function(){return v}),n.d(e,"rootToLeaf",function(){return u}),n.d(e,"traverseRevTree",function(){return i}),n.d(e,"winningRev",function(){return r}),n.d(e,"latest",function(){return w})},function(t,e,n){"use strict";n.r(e),n.d(e,"safeJsonParse",function(){return s}),n.d(e,"safeJsonStringify",function(){return o});var r=n(85),i=n.n(r);function s(t){try{return JSON.parse(t)}catch(e){return i.a.parse(t)}}function o(t){try{return JSON.stringify(t)}catch(e){return i.a.stringify(t)}}},function(t,e,n){(function(e){var r=n(78),i=n(153).AbstractLevelDOWN,s=n(153).AbstractIterator,o=n(158),a=n(159),c={},u=n(160);function l(t){return o.compare(t,this._end)>0}function h(t){return o.compare(t,this._end)>=0}function d(t){return o.compare(t,this._end)<0}function f(t){return o.compare(t,this._end)<=0}function p(t,e){s.call(this,t),this._limit=e.limit,-1===this._limit&&(this._limit=1/0);var n=t._store[t._location];this.keyAsBuffer=!1!==e.keyAsBuffer,this.valueAsBuffer=!1!==e.valueAsBuffer,this._reverse=e.reverse,this._options=e,this._done=0,this._reverse?(this._incr="prev",this._start=o.upperBound(e),this._end=o.lowerBound(e),void 0===this._start?this._tree=n.end:o.upperBoundInclusive(e)?this._tree=n.le(this._start):this._tree=n.lt(this._start),this._end&&(o.lowerBoundInclusive(e)?this._test=h:this._test=l)):(this._incr="next",this._start=o.lowerBound(e),this._end=o.upperBound(e),void 0===this._start?this._tree=n.begin:o.lowerBoundInclusive(e)?this._tree=n.ge(this._start):this._tree=n.gt(this._start),this._end&&(o.upperBoundInclusive(e)?this._test=f:this._test=d))}function g(t){if(!(this instanceof g))return new g(t);i.call(this,"string"==typeof t?t:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?c:this,this._store[this._location]=this._store[this._location]||a(o.compare)}r(p,s),p.prototype._next=function(t){var n,r;return this._done++>=this._limit?u(t):this._tree.valid?(n=this._tree.key,r=this._tree.value,this._test(n)?(this.keyAsBuffer&&(n=new e(n)),this.valueAsBuffer&&(r=new e(r)),this._tree[this._incr](),void u(function(){t(null,n,r)})):u(t)):u(t)},p.prototype._test=function(){return!0},g.clearGlobalStore=function(t){t?Object.keys(c).forEach(function(t){delete c[t]}):c={}},r(g,i),g.prototype._open=function(t,e){var n=this;u(function(){e(null,n)})},g.prototype._put=function(t,e,n,r){void 0!==e&&null!==e||(e="");var i=this._store[this._location].find(t);i.valid?this._store[this._location]=i.update(e):this._store[this._location]=this._store[this._location].insert(t,e),u(r)},g.prototype._get=function(t,n,r){var i=this._store[this._location].get(t);if(void 0===i)return u(function(){r(new Error("NotFound"))});!1===n.asBuffer||this._isBuffer(i)||(i=new e(String(i))),u(function(){r(null,i)})},g.prototype._del=function(t,e,n){this._store[this._location]=this._store[this._location].remove(t),u(n)},g.prototype._batch=function(t,e,n){for(var r,i,s,o=-1,a=t.length,c=this._store[this._location];++o<a;)t[o]&&(r=this._isBuffer(t[o].key)?t[o].key:String(t[o].key),s=c.find(r),"put"===t[o].type?(i=this._isBuffer(t[o].value)?t[o].value:String(t[o].value),c=s.valid?s.update(i):c.insert(r,i)):c=s.remove());this._store[this._location]=c,u(n)},g.prototype._iterator=function(t){return new p(this,t)},g.prototype._isBuffer=function(t){return e.isBuffer(t)},g.destroy=function(t,e){var n="$"+t;n in c&&delete c[n],u(e)},t.exports=g}).call(this,n(100).Buffer)},function(t,e,n){e.AbstractLevelDOWN=n(154),e.AbstractIterator=n(155),e.AbstractChainedBatch=n(156),e.isLevelDOWN=n(157)},function(t,e,n){(function(e,r){var i=n(96),s=n(155),o=n(156);function a(t){if(!arguments.length||void 0===t)throw new Error("constructor requires at least a location argument");if("string"!=typeof t)throw new Error("constructor requires a location string argument");this.location=t,this.status="new"}a.prototype.open=function(t,n){var r=this,i=this.status;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("open() requires a callback argument");"object"!=typeof t&&(t={}),t.createIfMissing=0!=t.createIfMissing,t.errorIfExists=!!t.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(t,function(t){if(t)return r.status=i,n(t);r.status="open",n()})):(this.status="open",e.nextTick(n))},a.prototype.close=function(t){var n=this,r=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(e){if(e)return n.status=r,t(e);n.status="closed",t()})):(this.status="closed",e.nextTick(t))},a.prototype.get=function(t,n,r){var i;if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("get() requires a callback argument");return(i=this._checkKey(t,"key",this._isBuffer))?r(i):(this._isBuffer(t)||(t=String(t)),"object"!=typeof n&&(n={}),n.asBuffer=0!=n.asBuffer,"function"==typeof this._get?this._get(t,n,r):void e.nextTick(function(){r(new Error("NotFound"))}))},a.prototype.put=function(t,n,r,i){var s;if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");return(s=this._checkKey(t,"key",this._isBuffer))?i(s):(this._isBuffer(t)||(t=String(t)),null==n||this._isBuffer(n)||e.browser||(n=String(n)),"object"!=typeof r&&(r={}),"function"==typeof this._put?this._put(t,n,r,i):void e.nextTick(i))},a.prototype.del=function(t,n,r){var i;if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("del() requires a callback argument");return(i=this._checkKey(t,"key",this._isBuffer))?r(i):(this._isBuffer(t)||(t=String(t)),"object"!=typeof n&&(n={}),"function"==typeof this._del?this._del(t,n,r):void e.nextTick(r))},a.prototype.batch=function(t,n,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof n&&(r=n),"function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(t))return r(new Error("batch(array) requires an array argument"));n&&"object"==typeof n||(n={});for(var i,s,o=0,a=t.length;o<a;o++)if("object"==typeof(i=t[o])){if(s=this._checkKey(i.type,"type",this._isBuffer))return r(s);if(s=this._checkKey(i.key,"key",this._isBuffer))return r(s)}if("function"==typeof this._batch)return this._batch(t,n,r);e.nextTick(r)},a.prototype.approximateSize=function(t,n,r){if(null==t||null==n||"function"==typeof t||"function"==typeof n)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof r)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(t)||(t=String(t)),this._isBuffer(n)||(n=String(n)),"function"==typeof this._approximateSize)return this._approximateSize(t,n,r);e.nextTick(function(){r(null,0)})},a.prototype._setupIteratorOptions=function(t){var e=this;return t=i(t),["start","end","gt","gte","lt","lte"].forEach(function(n){t[n]&&e._isBuffer(t[n])&&0===t[n].length&&delete t[n]}),t.reverse=!!t.reverse,t.keys=0!=t.keys,t.values=0!=t.values,t.limit="limit"in t?t.limit:-1,t.keyAsBuffer=0!=t.keyAsBuffer,t.valueAsBuffer=0!=t.valueAsBuffer,t},a.prototype.iterator=function(t){return"object"!=typeof t&&(t={}),t=this._setupIteratorOptions(t),"function"==typeof this._iterator?this._iterator(t):new s(this)},a.prototype._chainedBatch=function(){return new o(this)},a.prototype._isBuffer=function(t){return r.isBuffer(t)},a.prototype._checkKey=function(t,e){if(null===t||void 0===t)return new Error(e+" cannot be `null` or `undefined`");if(this._isBuffer(t)){if(0===t.length)return new Error(e+" cannot be an empty Buffer")}else if(""===String(t))return new Error(e+" cannot be an empty String")},t.exports=a}).call(this,n(47),n(100).Buffer)},function(t,e,n){(function(e){function n(t){this.db=t,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?t(new Error("cannot call next() after end()")):n._nexting?t(new Error("cannot call next() before previous next() has completed")):(n._nexting=!0,"function"==typeof n._next?n._next(function(){n._nexting=!1,t.apply(null,arguments)}):void e.nextTick(function(){n._nexting=!1,t()}))},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=n}).call(this,n(47))},function(t,e,n){(function(e){function n(t){this._db=t,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(t,e){this._checkWritten();var n=this._db._checkKey(t,"key",this._db._isBuffer);if(n)throw n;return this._db._isBuffer(t)||(t=String(t)),this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._put?this._put(t,e):this._operations.push({type:"put",key:t,value:e}),this},n.prototype.del=function(t){this._checkWritten();var e=this._db._checkKey(t,"key",this._db._isBuffer);if(e)throw e;return this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._del?this._del(t):this._operations.push({type:"del",key:t}),this},n.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},n.prototype.write=function(t,n){if(this._checkWritten(),"function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(n):"function"==typeof this._db._batch?this._db._batch(this._operations,t,n):void e.nextTick(n)},t.exports=n}).call(this,n(47))},function(t,e,n){var r=n(154);t.exports=function(t){return!(!t||"object"!=typeof t)&&Object.keys(r.prototype).filter(function(t){return"_"!=t[0]&&"approximateSize"!=t}).every(function(e){return"function"==typeof t[e]})}},function(t,e,n){(function(t){function n(t,e){return Object.hasOwnProperty.call(t,e)}function r(t){return void 0!==t&&""!==t}function n(t,e){return Object.hasOwnProperty.call(t,e)}function i(t,e){return Object.hasOwnProperty.call(t,e)&&e}e.compare=function(e,n){if(t.isBuffer(e)){for(var r=Math.min(e.length,n.length),i=0;i<r;i++){var s=e[i]-n[i];if(s)return s}return e.length-n.length}return e<n?-1:e>n?1:0};var s=e.lowerBoundKey=function(t){return i(t,"gt")||i(t,"gte")||i(t,"min")||(t.reverse?i(t,"end"):i(t,"start"))||void 0},o=e.lowerBound=function(t){var e=s(t);return e&&t[e]},a=e.lowerBoundInclusive=function(t){return!n(t,"gt")},c=e.upperBoundInclusive=function(t){return!n(t,"lt")},u=e.lowerBoundExclusive=function(t){return!a(t)},l=e.upperBoundExclusive=function(t){return!c(t)},h=e.upperBoundKey=function(t){return i(t,"lt")||i(t,"lte")||i(t,"max")||(t.reverse?i(t,"start"):i(t,"end"))||void 0},d=e.upperBound=function(t){var e=h(t);return e&&t[e]};function f(t){return t}e.toLtgt=function(t,r,i,s,o){r=r||{},i=i||f;var a=arguments.length>3,c=e.lowerBoundKey(t),u=e.upperBoundKey(t);return c?"gt"===c?r.gt=i(t.gt,!1):r.gte=i(t[c],!1):a&&(r.gte=i(s,!1)),u?"lt"===u?r.lt=i(t.lt,!0):r.lte=i(t[u],!0):a&&(r.lte=i(o,!0)),null!=t.reverse&&(r.reverse=!!t.reverse),n(r,"max")&&delete r.max,n(r,"min")&&delete r.min,n(r,"start")&&delete r.start,n(r,"end")&&delete r.end,r},e.contains=function(t,n,i){i=i||e.compare;var s=o(t);if(r(s)&&((a=i(n,s))<0||0===a&&u(t)))return!1;var a,c=d(t);if(r(c)&&((a=i(n,c))>0||0===a&&l(t)))return!1;return!0},e.filter=function(t,n){return function(r){return e.contains(t,r,n)}}}).call(this,n(100).Buffer)},function(t,e,n){"use strict";t.exports=function(t){return new u(t||p,null)};var r=0,i=1;function s(t,e,n,r,i,s){this._color=t,this.key=e,this.value=n,this.left=r,this.right=i,this._count=s}function o(t){return new s(t._color,t.key,t.value,t.left,t.right,t._count)}function a(t,e){return new s(t,e.key,e.value,e.left,e.right,e._count)}function c(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function u(t,e){this._compare=t,this.root=e}var l=u.prototype;function h(t,e){this.tree=t,this._stack=e}Object.defineProperty(l,"keys",{get:function(){var t=[];return this.forEach(function(e,n){t.push(e)}),t}}),Object.defineProperty(l,"values",{get:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t}}),Object.defineProperty(l,"length",{get:function(){return this.root?this.root._count:0}}),l.insert=function(t,e){for(var n=this._compare,o=this.root,l=[],h=[];o;){var d=n(t,o.key);l.push(o),h.push(d),o=d<=0?o.left:o.right}l.push(new s(r,t,e,null,null,1));for(var f=l.length-2;f>=0;--f){o=l[f];h[f]<=0?l[f]=new s(o._color,o.key,o.value,l[f+1],o.right,o._count+1):l[f]=new s(o._color,o.key,o.value,o.left,l[f+1],o._count+1)}for(f=l.length-1;f>1;--f){var p=l[f-1];o=l[f];if(p._color===i||o._color===i)break;var g=l[f-2];if(g.left===p)if(p.left===o){if(!(y=g.right)||y._color!==r){if(g._color=r,g.left=p.right,p._color=i,p.right=g,l[f-2]=p,l[f-1]=o,c(g),c(p),f>=3)(v=l[f-3]).left===g?v.left=p:v.right=p;break}p._color=i,g.right=a(i,y),g._color=r,f-=1}else{if(!(y=g.right)||y._color!==r){if(p.right=o.left,g._color=r,g.left=o.right,o._color=i,o.left=p,o.right=g,l[f-2]=o,l[f-1]=p,c(g),c(p),c(o),f>=3)(v=l[f-3]).left===g?v.left=o:v.right=o;break}p._color=i,g.right=a(i,y),g._color=r,f-=1}else if(p.right===o){if(!(y=g.left)||y._color!==r){if(g._color=r,g.right=p.left,p._color=i,p.left=g,l[f-2]=p,l[f-1]=o,c(g),c(p),f>=3)(v=l[f-3]).right===g?v.right=p:v.left=p;break}p._color=i,g.left=a(i,y),g._color=r,f-=1}else{var y;if(!(y=g.left)||y._color!==r){var v;if(p.left=o.right,g._color=r,g.right=o.left,o._color=i,o.right=p,o.left=g,l[f-2]=o,l[f-1]=p,c(g),c(p),c(o),f>=3)(v=l[f-3]).right===g?v.right=o:v.left=o;break}p._color=i,g.left=a(i,y),g._color=r,f-=1}}return l[0]._color=i,new u(n,l[0])},l.forEach=function(t,e,n){if(this.root)switch(arguments.length){case 1:return function t(e,n){var r;if(n.left&&(r=t(e,n.left)))return r;return(r=e(n.key,n.value))||(n.right?t(e,n.right):void 0)}(t,this.root);case 2:return function t(e,n,r,i){if(n(e,i.key)<=0){var s;if(i.left&&(s=t(e,n,r,i.left)))return s;if(s=r(i.key,i.value))return s}if(i.right)return t(e,n,r,i.right)}(e,this._compare,t,this.root);case 3:if(this._compare(e,n)>=0)return;return function t(e,n,r,i,s){var o,a=r(e,s.key),c=r(n,s.key);if(a<=0){if(s.left&&(o=t(e,n,r,i,s.left)))return o;if(c>0&&(o=i(s.key,s.value)))return o}if(c>0&&s.right)return t(e,n,r,i,s.right)}(e,n,this._compare,t,this.root)}},Object.defineProperty(l,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new h(this,t)}}),Object.defineProperty(l,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new h(this,t)}}),l.at=function(t){if(t<0)return new h(this,[]);for(var e=this.root,n=[];;){if(n.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new h(this,n);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new h(this,[])},l.ge=function(t){for(var e=this._compare,n=this.root,r=[],i=0;n;){var s=e(t,n.key);r.push(n),s<=0&&(i=r.length),n=s<=0?n.left:n.right}return r.length=i,new h(this,r)},l.gt=function(t){for(var e=this._compare,n=this.root,r=[],i=0;n;){var s=e(t,n.key);r.push(n),s<0&&(i=r.length),n=s<0?n.left:n.right}return r.length=i,new h(this,r)},l.lt=function(t){for(var e=this._compare,n=this.root,r=[],i=0;n;){var s=e(t,n.key);r.push(n),s>0&&(i=r.length),n=s<=0?n.left:n.right}return r.length=i,new h(this,r)},l.le=function(t){for(var e=this._compare,n=this.root,r=[],i=0;n;){var s=e(t,n.key);r.push(n),s>=0&&(i=r.length),n=s<0?n.left:n.right}return r.length=i,new h(this,r)},l.find=function(t){for(var e=this._compare,n=this.root,r=[];n;){var i=e(t,n.key);if(r.push(n),0===i)return new h(this,r);n=i<=0?n.left:n.right}return new h(this,[])},l.remove=function(t){var e=this.find(t);return e?e.remove():this},l.get=function(t){for(var e=this._compare,n=this.root;n;){var r=e(t,n.key);if(0===r)return n.value;n=r<=0?n.left:n.right}};var d=h.prototype;function f(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function p(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(d,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(d,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),d.clone=function(){return new h(this.tree,this._stack.slice())},d.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),n=t[t.length-1];e[e.length-1]=new s(n._color,n.key,n.value,n.left,n.right,n._count);for(var l=t.length-2;l>=0;--l){(n=t[l]).left===t[l+1]?e[l]=new s(n._color,n.key,n.value,e[l+1],n.right,n._count):e[l]=new s(n._color,n.key,n.value,n.left,e[l+1],n._count)}if((n=e[e.length-1]).left&&n.right){var h=e.length;for(n=n.left;n.right;)e.push(n),n=n.right;var d=e[h-1];e.push(new s(n._color,d.key,d.value,n.left,n.right,n._count)),e[h-1].key=n.key,e[h-1].value=n.value;for(l=e.length-2;l>=h;--l)n=e[l],e[l]=new s(n._color,n.key,n.value,n.left,e[l+1],n._count);e[h-1].left=e[h]}if((n=e[e.length-1])._color===r){var p=e[e.length-2];p.left===n?p.left=null:p.right===n&&(p.right=null),e.pop();for(l=0;l<e.length;++l)e[l]._count--;return new u(this.tree._compare,e[0])}if(n.left||n.right){n.left?f(n,n.left):n.right&&f(n,n.right),n._color=i;for(l=0;l<e.length-1;++l)e[l]._count--;return new u(this.tree._compare,e[0])}if(1===e.length)return new u(this.tree._compare,null);for(l=0;l<e.length;++l)e[l]._count--;var g=e[e.length-2];return function(t){for(var e,n,s,u,l=t.length-1;l>=0;--l){if(e=t[l],0===l)return void(e._color=i);if((n=t[l-1]).left===e){if((s=n.right).right&&s.right._color===r)return u=(s=n.right=o(s)).right=o(s.right),n.right=s.left,s.left=n,s.right=u,s._color=n._color,e._color=i,n._color=i,u._color=i,c(n),c(s),l>1&&((h=t[l-2]).left===n?h.left=s:h.right=s),void(t[l-1]=s);if(s.left&&s.left._color===r)return u=(s=n.right=o(s)).left=o(s.left),n.right=u.left,s.left=u.right,u.left=n,u.right=s,u._color=n._color,n._color=i,s._color=i,e._color=i,c(n),c(s),c(u),l>1&&((h=t[l-2]).left===n?h.left=u:h.right=u),void(t[l-1]=u);if(s._color===i){if(n._color===r)return n._color=i,void(n.right=a(r,s));n.right=a(r,s);continue}s=o(s),n.right=s.left,s.left=n,s._color=n._color,n._color=r,c(n),c(s),l>1&&((h=t[l-2]).left===n?h.left=s:h.right=s),t[l-1]=s,t[l]=n,l+1<t.length?t[l+1]=e:t.push(e),l+=2}else{if((s=n.left).left&&s.left._color===r)return u=(s=n.left=o(s)).left=o(s.left),n.left=s.right,s.right=n,s.left=u,s._color=n._color,e._color=i,n._color=i,u._color=i,c(n),c(s),l>1&&((h=t[l-2]).right===n?h.right=s:h.left=s),void(t[l-1]=s);if(s.right&&s.right._color===r)return u=(s=n.left=o(s)).right=o(s.right),n.left=u.right,s.right=u.left,u.right=n,u.left=s,u._color=n._color,n._color=i,s._color=i,e._color=i,c(n),c(s),c(u),l>1&&((h=t[l-2]).right===n?h.right=u:h.left=u),void(t[l-1]=u);if(s._color===i){if(n._color===r)return n._color=i,void(n.left=a(r,s));n.left=a(r,s);continue}var h;s=o(s),n.left=s.right,s.right=n,s._color=n._color,n._color=r,c(n),c(s),l>1&&((h=t[l-2]).right===n?h.right=s:h.left=s),t[l-1]=s,t[l]=n,l+1<t.length?t[l+1]=e:t.push(e),l+=2}}}(e),g.left===n?g.left=null:g.right=null,new u(this.tree._compare,e[0])},Object.defineProperty(d,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(d,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(d,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var n=this.tree.root;return n?n._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var r=e.length-2;r>=0;--r)e[r+1]===e[r].right&&(++t,e[r].left&&(t+=e[r].left._count));return t},enumerable:!0}),d.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(d,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),d.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can't update empty node!");var n=new Array(e.length),r=e[e.length-1];n[n.length-1]=new s(r._color,r.key,t,r.left,r.right,r._count);for(var i=e.length-2;i>=0;--i)(r=e[i]).left===e[i+1]?n[i]=new s(r._color,r.key,r.value,n[i+1],r.right,r._count):n[i]=new s(r._color,r.key,r.value,r.left,n[i+1],r._count);return new u(this.tree._compare,n[0])},d.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(d,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},function(t,e,n){t.exports=n(161)},function(t,e,n){"use strict";var r,i,s,o=[n(162),n(163),n(164),n(165),n(166)],a=-1,c=[],u=!1;function l(){r&&i&&(r=!1,i.length?c=i.concat(c):a=-1,c.length&&h())}function h(){if(!r){u=!1,r=!0;for(var t=c.length,e=setTimeout(l);t;){for(i=c,c=[];i&&++a<t;)i[a].run();a=-1,t=c.length}i=null,a=-1,r=!1,clearTimeout(e)}}for(var d=-1,f=o.length;++d<f;)if(o[d]&&o[d].test&&o[d].test()){s=o[d].install(h);break}function p(t,e){this.fun=t,this.array=e}p.prototype.run=function(){var t=this.fun,e=this.array;switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);default:return t.apply(null,e)}},t.exports=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),u||r||(u=!0,s())}},function(t,e,n){"use strict";(function(t){e.test=function(){return void 0!==t&&!t.browser},e.install=function(e){return function(){t.nextTick(e)}}}).call(this,n(47))},function(t,e,n){"use strict";(function(t){var n=t.MutationObserver||t.WebKitMutationObserver;e.test=function(){return n},e.install=function(e){var r=0,i=new n(e),s=t.document.createTextNode("");return i.observe(s,{characterData:!0}),function(){s.data=r=++r%2}}}).call(this,n(1))},function(t,e,n){"use strict";(function(t){e.test=function(){return!t.setImmediate&&void 0!==t.MessageChannel},e.install=function(e){var n=new t.MessageChannel;return n.port1.onmessage=e,function(){n.port2.postMessage(0)}}}).call(this,n(1))},function(t,e,n){"use strict";(function(t){e.test=function(){return"document"in t&&"onreadystatechange"in t.document.createElement("script")},e.install=function(e){return function(){var n=t.document.createElement("script");return n.onreadystatechange=function(){e(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},t.document.documentElement.appendChild(n),e}}}).call(this,n(1))},function(t,e,n){"use strict";e.test=function(){return!0},e.install=function(t){return function(){setTimeout(t,0)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ArcHandle",function(){return h}),n.d(e,"SyntheticStorage",function(){return f});var r,i,s=n(3),o=n(48),a=n(49),c=n(4),u=n(31),l=n(67);
// @license
class h{constructor(t,e,n){this.storageKey=t,this.type=e,this.tags=n}}!function(t){t[t.arc=1]="arc"}(r||(r={})),function(t){t[t.handles=1]="handles"}(i||(i={}));class d extends a.KeyBase{constructor(t){super();const e=t.match(/^synthetic:\/\/([^/]+)\/([^/]+)\/(.+)$/);if(null===e||4!==e.length)throw new Error(`invalid synthetic key: ${t}`);if(this.scope=r[e[1]],this.category=i[e[2]],this.targetKey=e[3],this.scope!==r.arc)throw new Error(`invalid scope '${e[1]}' for synthetic key: ${t}`);if(this.targetType=c.Type.newArcInfo(),this.category!==i.handles)throw new Error(`invalid category '${e[2]}' for synthetic key: ${t}`);this.syntheticType=c.Type.newHandleInfo()}get protocol(){return"synthetic"}childKeyForHandle(t){return Object(s.assert)(!1,"childKeyForHandle not supported for synthetic keys"),null}toString(){return`${this.protocol}://${r[this.scope]}/${i[this.category]}/${this.targetKey}`}}class f extends o.StorageBase{constructor(t,e){super(t),this.storageFactory=e}async construct(t,e,n){throw new Error("cannot construct SyntheticStorage providers; use connect")}async connect(t,e,n){Object(s.assert)(null===e,"SyntheticStorage does not accept a type parameter");const r=new d(n),i=await this.storageFactory.connect(t,r.targetType,r.targetKey);return null===i?null:new p(r.syntheticType,t,n,i,this.storageFactory)}async baseStorageFor(t,e){throw new Error("baseStorageFor not implemented for SyntheticStorage")}baseStorageKey(t,e){throw new Error("baseStorageKey not implemented for SyntheticStorage")}parseStringAsKey(t){return new d(t)}}class p extends o.StorageProviderBase{constructor(t,e,n,r,i){let s;super(t,void 0,e,n),this.model=[],this.backingStore=void 0,this.targetStore=r,this.storageFactory=i,this.initialized=new Promise(t=>s=t),r.get().then(async t=>{await this.process(t,!1),s(),r.on("change",t=>this.process(t.data,!0),this)})}async process(t,e){let n;try{if(t){const e=await u.Manifest.parse(t.serialized.replace(/\bimport .*\n/g,""),{});n=e.activeRecipe&&e.activeRecipe.handles}}catch(t){console.warn(`Error parsing manifest at ${this.storageKey}:\n${t.message}`)}const r=this.model;this.model=[];for(const t of n||[])this.storageFactory.isPersistent(t._storageKey)&&this.model.push(new h(t.storageKey,t.mappedType,t.tags));if(e){const t=Object(l.setDiffCustom)(r,this.model,JSON.stringify),e=t.add.map(t=>({value:t})),n=t.remove.map(t=>({value:t}));this._fire("change",new o.ChangeEvent({add:e,remove:n}))}}async toList(){return await this.initialized,this.model}async toLiteral(){return this.toList()}cloneFrom(){throw new Error("cloneFrom should never be called on SyntheticCollection!")}ensureBackingStore(){throw new Error("ensureBackingStore should never be called on SyntheticCollection!")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ManifestMeta",function(){return r});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{constructor(){this.storageKey=null,this.name=null}apply(t){t.forEach(t=>{this[t.key]=t.value})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Id",function(){return i});var r=n(170);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{constructor(t,e=[]){this.nextIdComponent=0,this.components=[],this.session=t,this.currentSession=t,this.components=e}static newSessionId(){const t=Math.floor(r.Random.next()*Math.pow(2,50))+"";return new i(t)}fromString(t){const e=new i(this.currentSession);let n=t.split(":");return"!"===n[0][0]&&(e.session=n[0].slice(1),n=n.slice(1)),e.components.push(...n),e}toString(){return`!${this.session}:${this.components.join(":")}`}toStringWithoutSessionForTesting(){return this.components.join(":")}createId(t=""){const e=new i(this.currentSession,this.components.slice());return e.components.push(t+this.nextIdComponent++),e}equal(t){if(t.session!==this.session||t.components.length!==this.components.length)return!1;for(let e=0;e<t.components.length;e++)if(t.components[e]!==this.components[e])return!1;return!0}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Random",function(){return c});var r=n(171),i=n.n(r);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{}class o extends s{constructor(){super(...arguments),this.generator=new i.a(7)}next(){return this.generator.random()}}let a=new class extends s{next(){return Math.random()}};class c{static next(){return a.next()}static seedForTests(){a=new o}}},function(t,e){var n=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};n.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},n.prototype.init_by_array=function(t,e){var n,r,i;for(this.init_seed(19650218),n=1,r=0,i=this.N>e?this.N:e;i;i--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+t[r]+r,this.mt[n]>>>=0,r++,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),r>=e&&(r=0)}for(i=this.N-1;i;i--){s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-n,this.mt[n]>>>=0,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648},n.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^t>>>1^e[1&t];for(;n<this.N-1;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},n.prototype.random_int31=function(){return this.random_int()>>>1},n.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},n.prototype.random=function(){return this.random_int()*(1/4294967296)},n.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},n.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)},t.exports=n},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotInfo",function(){return r});
// @license
class r{constructor({formFactor:t,handle:e}){this.formFactor=t,this.handle=e}}},function(t,e,n){"use strict";n.r(e),n.d(e,"RecipeUtil",function(){return a});var r=n(34),i=n(3),s=n(4);class o{constructor(t,e,n,r){this.recipe=t,this.particles=e,this.handles=n,this.reverse=new Map;for(const t of Object.keys(e))this.reverse.set(e[t],t);for(const t of n.keys())this.reverse.set(n.get(t),t);for(const t of Object.keys(r))this.reverse.set(r[t],t)}}class a{static makeShape(t,e,n,i){i=i||new r.Recipe;const s={},a=new Map,c={};return t.forEach(t=>s[t]=i.newParticle(t)),e.forEach(t=>a.set(t,i.newHandle())),Object.keys(n).forEach(t=>{Object.keys(n[t]).forEach(e=>{let r=n[t][e],i="=",o=[];r.handle&&(i={"->":"out","<-":"in","=":"="}[r.direction],o=r.tags||[],r=r.handle),r.localName&&(a.get(r).localName=r.localName);const u=s[t].addConnectionName(e);u.direction=i,a.get(r).tags=o,u.connectToHandle(a.get(r)),c[t+":"+e]=s[t].connections[e]})}),new o(i,s,a,c)}static recipeToShape(t){const e={};let n=0;t.particles.forEach(t=>e[t.name]=t);const r=new Map;t.handles.forEach(t=>r.set("h"+n++,t));const i={};return t.handleConnections.forEach(t=>i[t.particle.name+":"+t.name]=t),new o(t,e,r,i)}static find(t,e){function n(t,e,n,s){const{forward:o,reverse:a,score:c}=n;let u=!1;for(const n of t.handleConnections){if(a.has(n))continue;if(n.particle.name!==e.particle.name)continue;if(e.name&&e.name!==n.name)continue;const t={in:["in","inout"],out:["out","inout"],"=":["in","out","inout"],inout:["inout"],host:["host"]};if(n.direction&&!t[e.direction].includes(n.direction))continue;if(e.handle&&n.handle&&e.handle.localName&&e.handle.localName!==n.handle.localName)continue;if(a.has(n.particle)){if(a.get(n.particle)!==e.particle)continue}else if(o.has(e.particle))continue;if(e.handle&&n.handle){if(a.has(n.handle)){if(a.get(n.handle)!==e.handle)continue}else if(o.has(e.handle)&&null!==o.get(e.handle))continue;if("create"!==e.handle.fate||"create"!==n.handle.fate&&"create"!==n.handle.originalFate){if(Boolean(e.handle.immediateValue)!==Boolean(n.handle.immediateValue))continue;if(n.handle.immediateValue){if(!n.handle.immediateValue.equals(e.handle.immediateValue))continue}else if(e.handle.id!==n.handle.id&&e.handle.id!==n.handle.originalId)continue}}const r={forward:new Map(o),reverse:new Map(a),score:c};Object(i.assert)(!r.reverse.has(n.particle)||r.reverse.get(n.particle)===e.particle),Object(i.assert)(!r.forward.has(e.particle)||r.forward.get(e.particle)===n.particle),r.forward.set(e.particle,n.particle),r.reverse.set(n.particle,e.particle),e.handle&&(n.handle?(r.forward.set(e.handle,n.handle),r.reverse.set(n.handle,e.handle)):r.forward.has(e.handle)||(r.forward.set(e.handle,null),r.score-=2)),r.forward.set(e,n),r.reverse.set(n,e),s.push(r),u=!0}if(!1===u){if(n.forward.get(e.particle))return;const i=[];r(t,e.particle,n,i),i.forEach(t=>{e.handle&&!t.forward.has(e.handle)&&(t.forward.set(e.handle,null),t.score-=2),t.forward.set(e,null),t.score-=1,s.push(t)})}}function r(t,e,n,r){const{forward:s,reverse:o,score:a}=n;let c=!1;for(const n of t.particles){if(o.has(n))continue;if(n.name!==e.name)continue;let t=!0;for(const r of Object.keys(n.connections)){const i=n.connections[r];if(!i.handle)continue;const s=e.connections[r];if(s&&s.handle&&s.handle.localName&&s.handle.localName!==i.handle.localName){t=!1;break}}if(!t)continue;const u={forward:new Map(s),reverse:new Map(o),score:a};Object(i.assert)(!u.forward.has(e)||u.forward.get(e)===n),Object(i.assert)(!u.reverse.has(n)||u.reverse.get(n)===e),u.forward.set(e,n),u.reverse.set(n,e),r.push(u),c=!0}if(!1===c){const t={forward:new Map,reverse:new Map,score:0};s.forEach((e,n)=>{Object(i.assert)(!t.forward.has(n)||t.forward.get(n)===e),t.forward.set(n,e)}),o.forEach((e,n)=>{Object(i.assert)(!t.reverse.has(n)||t.reverse.get(n)===e),t.reverse.set(n,e)}),t.forward.has(e)||(t.forward.set(e,null),t.score=n.score-1),r.push(t)}}function s(t,n,r){if(1===n.length){const e=[],{forward:i,reverse:s,score:o}=t;for(const t of r){let r=!0;for(const e of t.tags)if(!n[0].tags.includes(e)){r=!1;break}if(!r)continue;const a={forward:new Map(i),reverse:new Map(s),score:o+1};a.forward.set(t,n[0]),a.reverse.set(n[0],t),e.push(a)}return e}const i=n.pop(),o=s(t,n,r);let a=[];for(const t of o){const n=[...e.handles.values()].filter(e=>null===t.forward.get(e));n.length>0?a=a.concat(s(t,[i],n)):a.concat(t)}return a}let o=[{forward:new Map,reverse:new Map,score:0}];for(const r of e.recipe.handleConnections){const e=[];for(const i of o)n(t,r,i,e);o=e}for(const n of e.recipe.particles){if(Object.keys(n.connections).length>0)continue;if(n.unnamedConnections.length>0)continue;const e=[];for(const i of o)r(t,n,i,e);o=e}const a=t.handles.filter(t=>0===t.connections.length);if(a.length>0){let t=[];for(const n of o){const r=[...e.handles.values()].filter(t=>null===n.forward.get(t));r.length>0?t=t.concat(s(n,a,r)):t.concat(n)}o=t}return o.map(({forward:t,score:n})=>{const r={};return t.forEach((t,n)=>r[e.reverse.get(n)]=t),{match:r,score:n}})}static constructImmediateValueHandle(t,e,n){if(Object(i.assert)(t.type instanceof s.InterfaceType),!(t.type instanceof s.InterfaceType&&t.type.interfaceShape.restrictType(e)))return null;const r=t.type.clone(new Map);r.maybeEnsureResolved();const o=t.recipe.newHandle();return o.id=n,o.mappedType=r,o.fate="copy",o.immediateValue=e,o}static directionCounts(t){const e={in:0,out:0,inout:0,unknown:0};for(const n of t.connections){let t=n.direction;void 0===e[t]&&(t="unknown"),e[t]++}return e.in+=e.inout,e.out+=e.inout,e}static matchesRecipe(t,e){const n=a.recipeToShape(e);return a.find(t,n).some(t=>0===t.score)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"RecipeResolver",function(){return i});var r=n(175);class i{constructor(t){this.resolver=new r.ResolveRecipe(t)}async resolve(t){t=t.clone();const e={errors:new Map};if(!t.normalize(e))return console.warn(`could not normalize a recipe: ${[...e.errors.values()].join("\n")}.\n${t.toString()}`),null;const n=await this.resolver.generate({generated:[{result:t,score:1}],terminal:[]});return 0===n.length?null:n[0].result}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ResolveRecipe",function(){return c});var r=n(35),i=n(176),s=n(34),o=n(173),a=n(178);class c extends r.Strategy{async generate(t){const e=this.arc;return s.Recipe.over(this.getResults(t),new class extends i.Walker{onHandle(t,n){if(0===n.connections.length||n.id&&n.storageKey||!n.type||!n.fate)return;let r;if(n.id){if(!n.storageKey){let t;switch(n.fate){case"use":t=e.findStoreById(n.id);break;case"map":case"copy":t=e.context.findStoreById(n.id);break;case"create":case"?":break;default:throw new Error(`unexpected fate ${n.fate}`)}r=t?[t]:[]}}else{const t=o.RecipeUtil.directionCounts(n);switch(n.fate){case"use":r=e.findStoresByType(n.type,{tags:n.tags,subtype:0===t.out});break;case"map":case"copy":r=e.context.findStoreByType(n.type,{tags:n.tags,subtype:!0});break;case"create":case"?":r=[];break;default:throw new Error(`unexpected fate ${n.fate}`)}}return 1===(r=r.filter(e=>{for(const r of t.handles)if(e.id===r.id&&r!==n)return!1;return!0})).length?(t,e)=>{e.mapToStorage(r[0])}:void 0}onSlotConnection(t,n){if(n.isConnected())return;const{local:r,remote:i}=a.MapSlots.findAllSlotCandidates(n,e),s=[...r,...i];if(1!==s.length)return;const o=s[0];return(t,e)=>(a.MapSlots.connectSlotConnection(e,o),1)}onObligation(t,e){const n=e.from.instance,r=e.to.instance;for(const t of Object.values(n.connections))for(const e of Object.values(r.connections))if(t.handle&&t.handle===e.handle)return(t,e)=>(t.removeObligation(e),1)}}(i.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Walker",function(){return i});var r=n(177);class i extends r.WalkerBase{onResult(t){super.onResult(t);const e=t.result,n=[];this.onRecipe&&(t=this.onRecipe(e,t),this.isEmptyResult(t)||n.push({continuation:t}));for(const t of e.particles)if(this.onParticle){const r=this.onParticle(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}for(const t of e.handleConnections)if(this.onHandleConnection){const r=this.onHandleConnection(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}for(const t of e.handles)if(this.onHandle){const r=this.onHandle(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}for(const t of e.slotConnections)if(this.onSlotConnection){const r=this.onSlotConnection(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}for(const t of e.slots)if(this.onSlot){const r=this.onSlot(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}for(const t of e.obligations)if(this.onObligation){const r=this.onObligation(e,t);this.isEmptyResult(r)||n.push({continuation:r,context:t})}this._runUpdateList(e,n)}}i.Permuted=r.WalkerTactic.Permuted,i.Independent=r.WalkerTactic.Independent},function(t,e,n){"use strict";n.r(e),n.d(e,"WalkerTactic",function(){return r}),n.d(e,"WalkerBase",function(){return o});var r,i=n(3),s=n(35);!function(t){t.Permuted="permuted",t.Independent="independent"}(r||(r={}));class o extends s.StrategizerWalker{constructor(t){super(),Object(i.assert)(t),this.tactic=t}_runUpdateList(t,e){const n=[];if(e.length)switch(this.tactic){case r.Permuted:{let r=[[]];e.forEach(({continuation:t,context:e})=>{const n=[];"function"==typeof t&&(t=[t]),t.forEach(t=>{r.forEach(r=>{const i=r.slice();i.push({f:t,context:e}),n.push(i)})}),r=n});for(let e of r){const r=new Map,i=t.clone(r);let s=0;0!==(e=e.filter(t=>null!==t.f)).length&&(e.forEach(({f:t,context:e})=>{s+=t(i,r.get(e))}),n.push({recipe:i,score:s}))}break}case r.Independent:e.forEach(({continuation:e,context:r})=>{"function"==typeof e&&(e=[e]),e.forEach(e=>{null==e&&(e=(()=>0));const i=new Map,s=t.clone(i),o=e(s,i.get(r));n.push({recipe:s,score:o})})});break;default:throw new Error(`${this.tactic} not supported`)}for(const t of n){this.createDescendant(t.recipe,t.score)}}createDescendant(t,e){const n=t.normalize(),r=n?t.digest():null;super.createDescendant(t,e,r,n)}isEmptyResult(t){return!t||(t.constructor===Array&&t.length<=0||(Object(i.assert)("function"==typeof t||t.length),!1))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MapSlots",function(){return a});var r=n(35),i=n(34),s=n(176),o=n(3);class a extends r.Strategy{async generate(t){const e=this.arc;return i.Recipe.over(this.getResults(t),new class extends s.Walker{onSlotConnection(t,n){if(void 0==n.slotSpec)return;if(n.isConnected())return;const{local:r,remote:i}=a.findAllSlotCandidates(n,e);return r.length+i.length<2?void 0:(r.length>0?r:i).map(t=>(e,n)=>(a.connectSlotConnection(n,t),1))}}(s.Walker.Permuted),this)}static connectSlotConnection(t,e){const n=t.recipe;if(!t.targetSlot){let r=n.updateToClone({selectedSlot:e}).selectedSlot;r||void 0==(r=n.slots.find(t=>e.id&&e.id===t.id))&&((r=n.newSlot(e.name)).id=e.id),t.connectToSlot(r)}Object(o.assert)(!e.id||!t.targetSlot.id||e.id===t.targetSlot.id,`Cannot override slot id '${t.targetSlot.id}' with '${e.id}'`),t.targetSlot.id=e.id||t.targetSlot.id,t.targetSlot.tags=[...e.tags]}static findAllSlotCandidates(t,e){return{local:t.targetSlot?[]:a._findSlotCandidates(t,t.recipe.slots),remote:a._findSlotCandidates(t,e.pec.slotComposer.getAvailableContexts())}}static _findSlotCandidates(t,e){const n=e.filter(e=>this.slotMatches(t,e));return n.sort((t,e)=>t.name<e.name),n}static slotMatches(t,e){return!!a.specMatch(t,e)&&(!!a.tagsOrNameMatch(t,e)&&!!a.handlesMatch(t,e))}static specMatch(t,e){return t.slotSpec&&t.slotSpec.isSet===e.spec.isSet}static tagsOrNameMatch(t,e){const n=[].concat(t.slotSpec.tags||[],t.tags,t.targetSlot?t.targetSlot.tags:[]),r=new Set([].concat(e.tags,e.spec.tags||[],[e.name]));return!!(n.length>0&&n.some(t=>r.has(t)))||t.name===e.name}static handlesMatch(t,e){return 0===e.handles.length||Object.values(t.particle.connections).find(t=>e.handles.includes(t.handle)||t.handle&&t.handle.id&&e.handles.map(t=>t.id).includes(t.handle.id))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"reportSystemException",function(){return i}),n.d(e,"registerSystemExceptionHandler",function(){return s}),n.d(e,"removeSystemExceptionHandler",function(){return o});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const r=[];function i(t,e,n){for(const i of r)i(t,e,n)}function s(t){r.includes(t)||r.push(t)}function o(t){const e=r.indexOf(t);e>-1&&r.splice(e,1)}s((t,e,n)=>{throw console.log(e,n),t})},function(t,e,n){"use strict";n.r(e),n.d(e,"Description",function(){return o}),n.d(e,"DescriptionFormatter",function(){return a});var r=n(3),i=n(12),s=n(4);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(t){this.relevance=null,this._particle=void 0,this.arc=t}async getArcDescription(t=a){const e=await new t(this).getDescription(this.arc.activeRecipe);if(e)return e}async getRecipeSuggestion(t=a){const e=await new t(this),n=await e.getDescription(this.arc.recipes[this.arc.recipes.length-1]);return n||e._capitalizeAndPunctuate(this.arc.activeRecipe.name||o.defaultDescription)}async getHandleDescription(t){Object(r.assert)(t.connections.length>0,"handle has no connections?");const e=new a(this);return e.excludeValues=!0,await e.getHandleDescription(t)}}o.defaultDescription="i'm feeling lucky";class a{constructor(t){this.particleDescriptions=[],this.seenHandles=new Set,this.seenParticles=new Set,this.excludeValues=!1,this.description=t,this.arc=t.arc}async getDescription(t){if(await this._updateDescriptionHandles(this.description),t.patterns.length>0){let e=[];for(const n of t.patterns)e.push(await this.patternToSuggestion(n,{_recipe:t}));if((e=e.filter(t=>Boolean(t))).length>0)return this._capitalizeAndPunctuate(this._joinDescriptions(e))}const e=new Set(t.particles);let n=this.particleDescriptions.filter(t=>e.has(t._particle)&&this._isSelectedDescription(t));if(n.find(t=>t._particle.spec.slots.size>0)&&(n=n.filter(t=>t._particle.spec.slots.size>0)),(n=n.sort(a.sort)).length>0)return this._combineSelectedDescriptions(n)}_isSelectedDescription(t){return!!t.pattern}async getHandleDescription(t){await this._updateDescriptionHandles(this.description);const e=this._selectHandleConnection(t)||t.connections[0],n=this.arc.findStoreById(t.id);return this._formatDescription(e,n)}async _updateDescriptionHandles(t){this.particleDescriptions=[];const e={};t.arc.recipes.forEach(t=>{[...t.innerArcs.values()].forEach(t=>{t.recipes.forEach(t=>{t.particles.forEach(t=>{e[t.name]||(e[t.name]=t)})})})});const n=t.arc.activeRecipe.particles.concat(Object.values(e));await Promise.all(n.map(async e=>{this.particleDescriptions.push(await this._createParticleDescription(e,t.relevance))}))}async _createParticleDescription(t,e){let n={_particle:t,_connections:{}};e&&(n._rank=e.calcParticleRelevance(t));const r=await this._getPatternByNameFromDescriptionHandle(t)||{};return n=Object.assign({},n,this._populateParticleDescription(t,r)),Object.values(t.connections).forEach(e=>{const i=t.spec.connectionMap.get(e.name),s=r[e.name]||i.pattern;if(s){const t={pattern:s,_handleConn:e,_store:this.arc.findStoreById(e.handle.id)};n._connections[e.name]=t}}),n}async _getPatternByNameFromDescriptionHandle(t){const e=t.connections.descriptions;if(e&&e.handle&&e.handle.id){const t=this.arc.findStoreById(e.handle.id);if(t){const e={};return(await t.toList()).forEach(t=>e[t.rawData.key]=t.rawData.value),e}}}_populateParticleDescription(t,e){const n=e.pattern||t.spec.pattern;return n?{pattern:n}:{}}async _combineSelectedDescriptions(t,e={}){const n=[];await Promise.all(t.map(async t=>{this.seenParticles.has(t._particle)||n.push(await this.patternToSuggestion(t.pattern,t))}));const r=this._joinDescriptions(n);if(r)return e.skipFormatting?r:this._capitalizeAndPunctuate(r)}_joinDescriptions(t){const e=t.filter(t=>t),n=e.length;if(n>0){const t=["",""," and ",", and "][Math.min(3,n)],r=e.pop();return`${e.join(", ")}${t}${r}`}}_joinTokens(t){return t.join("")}_capitalizeAndPunctuate(t){Object(r.assert)(t);const e=t.length-1;return`${t[0].toUpperCase()}${t.slice(1,e)}${t[e]}${t[e].match(/[a-z0-9()'>\]]/i)?".":""}`}async patternToSuggestion(t,e){const n=this._initTokens(t,e).map(async t=>await this.tokenToString(t)),r=await Promise.all(n);if(0===r.filter(t=>void 0==t).length)return this._joinTokens(r)}_initTokens(t,e){t=t.replace(/</g,"&lt;");let n=[];for(;t.length>0;){const i=t.match(/\${[a-zA-Z0-9.]+}(?:\.[_a-zA-Z]+)?/g);let s,o;i?(s=i[0],o=t.indexOf(s)):(s="",o=t.length),Object(r.assert)(o>=0);const a=t.substring(0,o);a.length>0&&n.push({text:a}),s.length>0&&(n=n.concat(this._initSubTokens(s,e))),t=t.substring(o+s.length)}return n}_initSubTokens(t,e){const n=t.match(/\${([a-zA-Z0-9.]+)}(?:\.([_a-zA-Z]+))?/),i=n[1].split("."),s=3===n.length?n[2]:void 0;if(!e._particle){const t=i.shift();if(t[0]!==t[0].toUpperCase())return console.warn(`Invalid particle name '${t}' - must start with a capital letter.`),[];const n=this.particleDescriptions.filter(n=>n._particle.name===t&&e._recipe.particles.find(t=>t===n._particle));if(0===n.length)return console.warn(`Cannot find particles with name ${t}.`),[];e=n[n.length-1]}const o=e._particle;if(0===i.length)return[{particleName:o.spec.name,particleDescription:e}];const a=o.connections[i[0]];if(a)return Object(r.assert)(a.handle&&a.handle.id,"Missing id???"),[{fullName:n[0],handleName:a.name,properties:i.splice(1),extra:s,_handleConn:a,_store:this.arc.findStoreById(a.handle.id)}];if(2!==i.length)return 1===i.length?console.warn(`Unknown handle connection name '${i[0]}'`):console.warn(`Slot connections tokens must have exactly 2 names, found ${i.length} in '${i.join(".")}'`),[];const c=o.consumedSlotConnections[i[0]].providedSlots[i[1]];return Object(r.assert)(c,`Could not find handle ${i.join(".")}`),[{fullName:n[0],consumeSlotName:i[0],provideSlotName:i[1],extra:s,_providedSlotConn:c}]}async tokenToString(t){if(t.text)return t.text;if(t.particleName)return this._particleTokenToString(t);if(t.handleName)return this._handleTokenToString(t);if(t.consumeSlotName&&t.provideSlotName)return this._slotTokenToString(t);throw new Error("no handle or slot name")}async _particleTokenToString(t){return this._combineSelectedDescriptions([t.particleDescription],{skipFormatting:!0})}async _handleTokenToString(t){switch(t.extra){case"_type_":return t._handleConn.type.toPrettyString().toLowerCase();case"_values_":return this._formatStoreValue(t.handleName,t._store);case"_name_":return this._formatDescription(t._handleConn,t._store);default:{if(Object(r.assert)(!t.extra,`Unrecognized extra ${t.extra}`),t._handleConn.type instanceof s.InterfaceType){return i.ParticleSpec.fromLiteral(await t._store.get()).pattern}if(t.properties&&t.properties.length>0)return this._propertyTokenToString(t.handleName,t._store,t.properties);let e=await this._formatDescriptionPattern(t._handleConn)||this._formatStoreDescription(t._handleConn,t._store);const n=await this._formatStoreValue(t.handleName,t._store);if(!e){const e=t._store.type;if(n&&!this.excludeValues&&!(e instanceof s.CollectionType)&&!(e instanceof s.BigCollectionType))return n}return e=e||this._formatHandleType(t._handleConn),!n||this.excludeValues||this.seenHandles.has(t._store.id)?e:(this.seenHandles.add(t._store.id),this._combineDescriptionAndValue(t,e,n))}}}_combineDescriptionAndValue(t,e,n){return e===n?e:`${e} (${n})`}async _slotTokenToString(t){switch(t.extra){case"_empty_":return 0===t._providedSlotConn.consumeConnections.length;default:Object(r.assert)(!t.extra,`Unrecognized slot extra ${t.extra}`)}const e=await Promise.all(t._providedSlotConn.consumeConnections.map(async t=>{const e=t.particle,n=this.particleDescriptions.find(t=>t._particle===e);return this.seenParticles.add(e),this.patternToSuggestion(e.spec.pattern,n)}));return this._joinDescriptions(e)}async _propertyTokenToString(t,e,n){Object(r.assert)(!(e.type instanceof s.CollectionType||e.type instanceof s.BigCollectionType),`Cannot return property ${n.join(",")} for Collection or BigCollection`);const i=await e.get();if(i){let e=i.rawData;if(n.forEach(t=>{e&&(e=e[t])}),e)return this._formatEntityProperty(t,n,e)}}_formatEntityProperty(t,e,n){return n}async _formatStoreValue(t,e){if(e)if(e.type instanceof s.CollectionType){const n=await e.toList();if(n&&n.length>0)return this._formatCollection(t,n)}else if(e.type instanceof s.BigCollectionType){const n=await e.stream(1),{value:r,done:i}=await e.cursorNext(n);if(e.cursorClose(n),!i&&r[0].rawData.name)return await this._formatBigCollection(t,r[0])}else{const n=await e.get();if(n)return this._formatSingleton(t,n,e.type.data.description.value)}}_formatCollection(t,e){return e[0].rawData.name?e.length>2?`${e[0].rawData.name} plus ${e.length-1} other items`:e.map(t=>t.rawData.name).join(", "):`${e.length} items`}_formatBigCollection(t,e){return`collection of items like ${e.rawData.name}`}_formatSingleton(t,e,n){if(n){let t,r=n;for(;t=r.match(/\${([a-zA-Z0-9.]+)}/);)r=r.replace(t[0],e.rawData[t[1]]);return r}if(e.rawData.name)return e.rawData.name}async _formatDescription(t,e){return await this._formatDescriptionPattern(t)||this._formatStoreDescription(t,e)||this._formatHandleType(t)}async _formatDescriptionPattern(t){let e=t;if(!e.spec.isOutput){const n=this._selectHandleConnection(t.handle);n&&(e=n)}const n=this.particleDescriptions.find(t=>t._particle===e.particle),r=n?n._connections[e.name]:null;if(r)return await this.patternToSuggestion(r.pattern,n)}_formatStoreDescription(t,e){if(e){const n=this.arc.getStoreDescription(e),r=this._formatHandleType(t);if(n&&n!==r)return n}}_formatHandleType(t){return(t.handle&&t.handle.type.isResolved()?t.handle.type:t.type).toPrettyString().toLowerCase()}_selectHandleConnection(t){const e=t.connections.filter(t=>{const e=t.spec,n=this.particleDescriptions.find(e=>e._particle===t.particle);return!!e.pattern||!!n._connections[t.name]});if(e.sort((t,e)=>{const n=t.spec.isOutput;if(n!==e.spec.isOutput)return n?-1:1;const r=this.particleDescriptions.find(e=>e._particle===t.particle);return this.particleDescriptions.find(t=>t._particle===e.particle)._rank-r._rank}),e.length>0)return e[0]}static sort(t,e){const n=t=>"root"===t.name||t.tags.includes("root"),r=Boolean([...t._particle.spec.slots.values()].find(t=>n(t)));if(r!==Boolean([...e._particle.spec.slots.values()].find(t=>n(t))))return r?-1:1;if(t._rank!==e._rank)return e._rank-t._rank;let i=0,s=0;return t._particle.spec.slots.forEach(t=>{t.isSet||++i}),e._particle.spec.slots.forEach(t=>{t.isSet||++s}),s-i}}},function(t,e,n){"use strict";n.r(e),n.d(e,"FakePecFactory",function(){return a});var r=n(182),i=n(184),s=n(185),o=n(196);
// @license
function a(t){return e=>{const n=new i.MessageChannel,a=t instanceof o.StubLoader?t.clone():new s.Loader;new r.ParticleExecutionContext(n.port1,`${e}:inner`,a);return n.port2}}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"ParticleExecutionContext",function(){return a});var r=n(11),i=n(3),s=n(15),o=n(183);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a{constructor(e,n,r){this.particles=[],this._nextLocalID=0,this.pendingLoads=[],this.scheduler=new o.StorageProxyScheduler,this.keyedProxies={},this.apiPort=new s.PECInnerPort(e),this.idBase=n,this.loader=r,r.setParticleExecutionContext(this),this.apiPort.onDefineHandle=(({type:t,identifier:e,name:n})=>o.StorageProxy.newProxy(e,t,this.apiPort,this,this.scheduler,n)),this.apiPort.onGetBackingStoreCallback=(({type:t,id:e,name:n,callback:r,storageKey:i})=>{const s=o.StorageProxy.newProxy(e,t,this.apiPort,this,this.scheduler,n);return s.storageKey=i,[s,()=>r(s,i)]}),this.apiPort.onCreateHandleCallback=(({type:t,id:e,name:n,callback:r})=>{const i=o.StorageProxy.newProxy(e,t,this.apiPort,this,this.scheduler,n);return[i,()=>r(i)]}),this.apiPort.onMapHandleCallback=(({id:t,callback:e})=>[t,()=>e(t)]),this.apiPort.onCreateSlotCallback=(({hostedSlotId:t,callback:e})=>[t,()=>e(t)]),this.apiPort.onInnerArcRender=(({transformationParticle:t,transformationSlotName:e,hostedSlotId:n,content:r})=>{t.renderHostedSlot(e,n,r)}),this.apiPort.onStop=(()=>{t.close&&t.close()}),this.apiPort.onInstantiateParticle=(({id:t,spec:e,handles:n})=>this._instantiateParticle(t,e,n)),this.apiPort.onSimpleCallback=(({callback:t,data:e})=>t(e)),this.apiPort.onConstructArcCallback=(({callback:t,arc:e})=>t(e)),this.apiPort.onAwaitIdle=(({version:t})=>this.idle.then(e=>{setTimeout(()=>{this.apiPort.Idle({version:t,relevance:this.relevance})},0)})),this.apiPort.onUIEvent=(({particle:t,slotName:e,event:n})=>t.fireEvent(e,n)),this.apiPort.onStartRender=(({particle:t,slotName:e,providedSlots:n,contentTypes:r})=>{t._slotByName.set(e,new class{constructor(t,e,n,r){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.slotName=n,this.particle=e,this.pec=t,this.providedSlots=r}get isRendered(){return this._isRendered}render(n){n.template&&this.providedSlots.size>0&&("string"==typeof(n=Object.assign({},n)).template?n.template=this.substituteSlotNamesForIds(n.template):n.template=Object.entries(n.template).reduce((t,[e,n])=>(t[e]=this.substituteSlotNamesForIds(n),t),{})),this.pec.apiPort.Render({particle:t,slotName:e,content:n}),Object.keys(n).forEach(t=>{this.requestedContentTypes.delete(t)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(n).length>0}substituteSlotNamesForIds(t){return this.providedSlots.forEach((e,n)=>{t=t.replace(new RegExp(`slotid="${n}"`,"gi"),`slotid="${e}"`)}),t}registerEventHandler(t,e){this.handlers.has(t)||this.handlers.set(t,[]),this.handlers.get(t).push(e)}clearEventHandlers(t){this.handlers.set(t,[])}fireEvent(t){for(const e of this.handlers.get(t.handler)||[])e(t)}}(this,t,e,n)),t.renderSlot(e,r)}),this.apiPort.onStopRender=(({particle:t,slotName:e})=>{Object(i.assert)(t._slotByName.has(e),`Stop render called for particle ${t.name} slot ${e} without start render being called.`),t._slotByName.delete(e)})}generateIDComponents(){return{base:this.idBase,component:()=>this._nextLocalID++}}generateID(){return`${this.idBase}:${this._nextLocalID++}`}innerArcHandle(t,e){const n=this;return{createHandle:(i,s,o)=>new Promise((a,c)=>n.apiPort.ArcCreateHandle({arc:t,type:i,name:s,callback:t=>{const n=Object(r.handleFor)(t,s,e);a(n),o&&t.register(o,n)}})),mapHandle:e=>new Promise((r,i)=>n.apiPort.ArcMapHandle({arc:t,handle:e,callback:t=>{r(t)}})),createSlot:(e,r,i,s,o)=>new Promise((a,c)=>n.apiPort.ArcCreateSlot({arc:t,transformationParticle:e,transformationSlotName:r,hostedParticleName:i,hostedSlotName:s,handleId:o,callback:t=>{a(t)}})),loadRecipe:e=>new Promise((r,i)=>n.apiPort.ArcLoadRecipe({arc:t,recipe:e,callback:t=>{void 0==t?r():i(t)}}))}}getStorageProxy(t,e){return this.keyedProxies[t]||(this.keyedProxies[t]=new Promise((n,r)=>{this.apiPort.GetBackingStore({storageKey:t,type:e,callback:(t,e)=>{this.keyedProxies[e]=t,n(t)}})})),this.keyedProxies[t]}defaultCapabilitySet(){return{constructInnerArc:t=>new Promise((e,n)=>this.apiPort.ConstructInnerArc({callback:n=>{e(this.innerArcHandle(n,t.id))},particle:t}))}}async _instantiateParticle(t,e,n){e.name;let i=null;const s=new Promise(t=>i=t);this.pendingLoads.push(s);const o=await this.loader.loadParticleClass(e),a=this.defaultCapabilitySet(),c=new o;c.id=t,c.capabilities=a,this.particles.push(c);const u=new Map,l=[];return n.forEach((n,i)=>{const s=e.connectionMap.get(i),o=Object(r.handleFor)(n,i,t,s.isInput,s.isOutput);u.set(i,o),l.push({proxy:n,particle:c,handle:o})}),[c,async()=>{await c.setHandles(u),l.forEach(({proxy:t,particle:e,handle:n})=>t.register(e,n));const t=this.pendingLoads.indexOf(s);this.pendingLoads.splice(t,1),i()}]}get relevance(){const t=new Map;return this.particles.forEach(e=>{0!==e.relevances.length&&(t.set(e,e.relevances),e.relevances=[])}),t}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||this.particles.filter(t=>t.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const t=this.particles.filter(t=>t.busy).map(t=>t.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...t]).then(()=>this.idle)}}}.call(this,n(1))},function(t,e,n){"use strict";n.r(e),n.d(e,"StorageProxy",function(){return a}),n.d(e,"CollectionProxy",function(){return c}),n.d(e,"VariableProxy",function(){return u}),n.d(e,"BigCollectionProxy",function(){return l}),n.d(e,"StorageProxyScheduler",function(){return h});var r,i=n(3),s=n(50),o=n(4);!function(t){t[t.none=0]="none",t[t.pending=1]="pending",t[t.full=2]="full"}(r||(r={}));class a{constructor(t,e,n,i,s,o){this.localIDComponent=0,this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=r.none,this.observers=[],this.updates=[],this.barrier=null,this.id=t,this.type=e,this.port=n,this.scheduler=s,this.name=o,this.baseForNewID=i.generateID(),this.updates=[],this.pec=i}static newProxy(t,e,n,r,i,s){return e instanceof o.CollectionType?new c(t,e,n,r,i,s):e instanceof o.BigCollectionType?new l(t,e,n,r,i,s):new u(t,e,n,r,i,s)}raiseSystemException(t,e,n){this.port.RaiseSystemException({exception:{message:t.message,stack:t.stack,name:t.name},methodName:e,particleId:n})}register(t,e){if(e.canRead&&(this.observers.push({particle:t,handle:e}),this.listenerAttached||(this.port.InitializeProxy({handle:this,callback:t=>this._onUpdate(t)}),this.listenerAttached=!0),e.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy({handle:this,callback:t=>this._onSynchronize(t)}),this.keepSynced=!0),e.options.notifySync&&this.synchronized===r.full))){const n=this._getModelForSync();this.scheduler.enqueue(t,e,["sync",t,n])}}_onSynchronize({version:t,model:e}){if(void 0!==this.version&&t<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${t}; `+`current is ${this.version}`);if(!this._synchronizeModel(t,e))return;for(this.synchronized=r.full;this.updates.length>0&&this.updates[0].version<=t;)this.updates.shift();const n=this._getModelForSync();this._notify("sync",n,t=>t.keepSynced&&t.notifySync),this._processUpdates()}_onUpdate(t){if(this.observers.find(({handle:t})=>!t.options.keepSynced&&t.options.notifyUpdate)){const e=this._processUpdate(t,!1);this._notify("update",e,t=>!t.keepSynced&&t.notifyUpdate)}this.keepSynced&&(t.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${t.version}; `+`current is ${this.version}`):(this.updates.push(t),this.updates.sort((t,e)=>t.version-e.version),this._processUpdates()))}_notify(t,e,n=(t=>!0)){for(const{handle:r,particle:i}of this.observers)n(r.options)&&this.scheduler.enqueue(i,r,[t,i,e])}_processUpdates(){const t=t=>t.version===this.version+1||!(!this.barrier||t.barrier!==this.barrier);for(;this.updates.length>0&&t(this.updates[0]);){const t=this.updates.shift(),e=this._processUpdate(t);this.version=t.version,e&&this._notify("update",e,t=>t.keepSynced&&t.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==r.none){this.synchronized=r.none,this.port.SynchronizeProxy({handle:this,callback:t=>this._onSynchronize(t)});for(const{handle:t,particle:e}of this.observers)t.options.notifyDesync&&this.scheduler.enqueue(e,t,["desync",e])}}else this.synchronized!==r.full&&(this.synchronized=r.full)}generateID(){return`${this.baseForNewID}:${this.localIDComponent++}`}generateIDComponents(){return{base:this.baseForNewID,component:()=>this.localIDComponent++}}}class c extends a{constructor(){super(...arguments),this.model=new s.CrdtCollectionModel}_getModelForSync(){return this.model.toList()}_synchronizeModel(t,e){return this.version=t,this.model=new s.CrdtCollectionModel(e),!0}_processUpdate(t,e=!0){if(this.synchronized===r.full)for(const{handle:e}of this.observers)if(t.originatorId===e._particleId)return null;const n=[],i=[];if("add"in t)for(const{value:r,keys:i,effective:s}of t.add)(e&&this.model.add(r.id,r,i)||!e&&s)&&n.push(r);else{if(!("remove"in t))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(t)}`);for(const{value:n,keys:r,effective:s}of t.remove){const t=this.model.getValue(n.id);(e&&this.model.remove(n.id,r)||!e&&s)&&i.push(t)}}if(n.length||i.length){const e={originatorId:t.originatorId};return n.length&&(e.add=n),i.length&&(e.remove=i),e}return null}toList(){return this.synchronized===r.full?Promise.resolve(this.model.toList()):new Promise(t=>this.port.HandleToList({callback:t,handle:this}))}get(t,e){return this.synchronized===r.full?Promise.resolve(this.model.getValue(t)):new Promise((n,r)=>this.port.HandleToList({callback:e=>n(e.find(e=>e.id===t)),handle:this,particleId:e}))}store(t,e,n){const i=t.id,s={value:t,keys:e};if(this.port.HandleStore({handle:this,callback:()=>{},data:s,particleId:n}),this.synchronized!==r.full)return;if(!this.model.add(i,t,e))return;const o={originatorId:n,add:[t]};this._notify("update",o,t=>t.notifyUpdate)}clear(t){this.synchronized!==r.full&&this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:[],particleId:t});let e=this.model.toList().map(t=>({id:t.id,keys:this.model.getKeys(t.id)}));this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:e,particleId:t}),(e=(e=e.map(({id:t,keys:e})=>({rawData:this.model.getValue(t).rawData,id:t,keys:e}))).filter(t=>this.model.remove(t.id,t.keys))).length>0&&this._notify("update",{originatorId:t,remove:e},t=>t.notifyUpdate)}remove(t,e,n){if(this.synchronized!==r.full){const e={id:t,keys:[]};return void this.port.HandleRemove({handle:this,callback:()=>{},data:e,particleId:n})}const i=this.model.getValue(t);if(!i)return;0===e.length&&(e=this.model.getKeys(t));const s={id:t,keys:e};if(this.port.HandleRemove({handle:this,callback:()=>{},data:s,particleId:n}),!this.model.remove(t,e))return;const o={originatorId:n,remove:[i]};this._notify("update",o,t=>t.notifyUpdate)}}class u extends a{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(t,e){return null==this.barrier&&(this.version=t,this.model=0===e.length?null:e[0].value,Object(i.assert)(void 0!==this.model),!0)}_processUpdate(t,e=!0){if(Object(i.assert)("data"in t),!e)return t;if(null!=this.barrier){if(t.barrier===this.barrier&&(this.barrier=null,this.synchronized!==r.full)){this.synchronized=r.full;const t=this._getModelForSync();this._notify("sync",t,t=>t.keepSynced&&t.notifySync)}return null}return this.model=t.data,t}get(){return this.synchronized===r.full?Promise.resolve(this.model):new Promise(t=>this.port.HandleGet({callback:t,handle:this}))}set(t,e){if(Object(i.assert)(void 0!==t),JSON.stringify(this.model)===JSON.stringify(t))return;let n;n=this.listenerAttached?this.generateID():null,this.model=JSON.parse(JSON.stringify(t)),this.barrier=n,this.port.HandleSet({data:t,handle:this,particleId:e,barrier:n});const r={originatorId:e,data:t};this._notify("update",r,t=>t.notifyUpdate)}clear(t){if(null==this.model)return;const e=this.generateID();this.model=null,this.barrier=e,this.port.HandleClear({handle:this,particleId:t,barrier:e});const n={originatorId:t,data:null};this._notify("update",n,t=>t.notifyUpdate)}}class l extends a{register(t,e){e.canRead&&this.scheduler.enqueue(t,e,["sync",t,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async store(t,e,n){return new Promise(r=>this.port.HandleStore({handle:this,callback:r,data:{value:t,keys:e},particleId:n}))}async remove(t,e){return new Promise(n=>this.port.HandleRemove({handle:this,callback:n,data:{id:t,keys:[]},particleId:e}))}async stream(t,e){return new Promise(n=>this.port.HandleStream({handle:this,callback:n,pageSize:t,forward:e}))}async cursorNext(t){return new Promise(e=>this.port.StreamCursorNext({handle:this,callback:e,cursorId:t}))}cursorClose(t){this.port.StreamCursorClose({handle:this,cursorId:t})}}class h{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(t,e,n){this._queues.has(t)||this._queues.set(t,new Map);const r=this._queues.get(t);r.has(e)||r.set(e,[]),r.get(e).push(n),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(t=>this._idleResolver=t)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const t=[...this._queues.keys()][0],e=this._queues.get(t);this._queues.delete(t);for(const[t,n]of e.entries())for(const e of n)try{t._notify(...e)}catch(e){console.error("Error dispatching to particle",e),t._proxy.raiseSystemException(e,"StorageProxyScheduler::_dispatch",t._particleId)}}this._updateIdle()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MessagePort",function(){return r}),n.d(e,"MessageChannel",function(){return s});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{constructor(t,e,n){this._channel=t,this._id=e,this._other=n,this._onmessage=void 0}postMessage(t){this._channel._post(this._other,t)}set onmessage(t){this._onmessage=t}close(){this.postMessage=(()=>{})}}class i{constructor(t){this.data=t}}class s{constructor(){this.port1=new r(this,0,1),this.port2=new r(this,1,0),this._ports=[this.port1,this.port2]}async _post(t,e){if(e=JSON.parse(JSON.stringify(e)),this._ports[t]._onmessage)try{await 0,await this._ports[t]._onmessage(new i(e))}catch(t){console.error("Exception in particle code\n",t)}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Loader",function(){return p});var r=n(186),i=n(187),s=n(188),o=n(3),a=n(189),c=n(190),u=n(193),l=n(10),h=n(194),d=n(195);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const f=(t,...e)=>(t[0]+e.map((e,n)=>e+t[n+1]).join("")).trim();class p{path(t){return t.replace(/[/][^/]+$/,"/")}join(t,e){return/^https?:\/\//.test(e)?e:"/"===e[0]||":"===e[1]?e:(t=this.path(t),e=this.normalizeDots(`${t}${e}`))}normalizeDots(t){const e=t=>t.replace(/(?:^|\/)[^./]*\/\.\./g,"");for(let n=e(t=(t=t.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));n!==t;n=e(t=n));return t}loadResource(t){return/^https?:\/\//.test(t)?this._loadURL(t):this._loadFile(t)}_loadFile(t){return new Promise((e,n)=>{r.fs.readFile(t,(t,r)=>{t?n(t):e(r.toString("utf-8"))})})}_loadURL(t){return/\/\/schema.org\//.test(t)?t.endsWith("/Thing")?Object(s.fetch)("https://schema.org/Product.jsonld").then(t=>t.text()).then(t=>d.JsonldToManifest.convert(t,{"@id":"schema:Thing"})):Object(s.fetch)(t+".jsonld").then(t=>t.text()).then(t=>d.JsonldToManifest.convert(t)):Object(s.fetch)(t).then(t=>t.text())}async loadParticleClass(t){const e=await this.requireParticle(t.implFile);return e.spec=t,e}async requireParticle(t){null===t&&(t="");const e=await this.loadResource(t),n=new i.vm.Script(e,{filename:t,displayErrors:!0}),r=[],a={defineParticle(t){r.push(t)},console:console,fetch:s.fetch,setTimeout:setTimeout,importScripts:t=>null};return n.runInNewContext(a,{filename:t,displayErrors:!0}),Object(o.assert)(r.length>0&&"function"==typeof r[0],`Error while instantiating particle implementation from ${t}`),this.unwrapParticle(r[0])}setParticleExecutionContext(t){this.pec=t}unwrapParticle(t){return Object(o.assert)(this.pec),t({Particle:a.Particle,DomParticle:c.DomParticle,TransformationDomParticle:h.TransformationDomParticle,MultiplexerDomParticle:u.MultiplexerDomParticle,Reference:l.Reference.newClientReference(this.pec),html:f})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"fs",function(){return r});const r={}},function(t,e,n){"use strict";n.r(e),n.d(e,"vm",function(){return r});const r={}},function(t,e,n){"use strict";n.r(e),n.d(e,"fetch",function(){return r});const r=fetch},function(t,e,n){"use strict";n.r(e),n.d(e,"Particle",function(){return r});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{constructor(t){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this._slotByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0),this.capabilities=t||{}}setHandles(t){}setViews(t){}onHandleSync(t,e){}onHandleUpdate(t,e){}onHandleDesync(t){}constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(t){this.relevances.push(t)}startBusy(){0===this._busy&&(this._idle=new Promise(t=>this._idleResolver=t)),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}getSlot(t){return this._slotByName.get(t)}static buildManifest(t,...e){const n=[];for(let r=0;r<e.length;r++){const i=t[r],s=/ *$/.exec(i)[0];let o;o=(o="string"==typeof e[r]?e[r]:e[r].toManifestString()).replace(/(\n)/g,"$1"+s),n.push(i),n.push(o)}return t.length>e.length&&n.push(t[t.length-1]),n.join("")}setParticleDescription(t){return this.setDescriptionPattern("pattern",t)}setDescriptionPattern(t,e){const n=this.handles.get("descriptions");if(n){const r=n.entityClass;return n.store(new r({key:t,value:e},this.spec.name+"-"+t)),!0}throw new Error("A particle needs a description handle to set a decription pattern")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"DomParticle",function(){return s});var r=n(191),i=n(192);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s extends(Object(r.XenStateMixin)(i.DomParticleBase)){constructor(){super(),this.state=this._state,this.props=this._props}willReceiveProps(){}update(){}shouldRender(){return!0}render(){return{}}setState(t){return this._setState(t)}setIfDirty(t){return console.warn("DomParticle: `setIfDirty` is deprecated, please use `setState` instead"),this._setState(t)}configureHandles(t){}get config(){return{handleNames:this.spec.inputs.map(t=>t.name),slotNames:[...this.spec.slots.values()].map(t=>t.name)}}_willReceiveProps(...t){this.willReceiveProps(...t)}_update(...t){this.update(...t),this.shouldRender(...t)&&(this.relevance=1),this.config.slotNames.forEach(t=>this.renderSlot(t,["model"]))}get _views(){return console.warn(`Particle ${this.spec.name} uses deprecated _views getter.`),this.handles}async setViews(t){return console.warn(`Particle ${this.spec.name} uses deprecated setViews method.`),this.setHandles(t)}async setHandles(t){this.configureHandles(t),this.handles=t,this._handlesToSync=new Set;for(const e of this.config.handleNames){const n=t.get(e);n&&n.options.keepSynced&&n.options.notifySync&&this._handlesToSync.add(e)}setTimeout(()=>!this._hasProps&&this._invalidate(),200)}async onHandleSync(t,e){this._handlesToSync.delete(t.name),0==this._handlesToSync.size&&await this._handlesToProps()}async onHandleUpdate(t,e){this._debounce("handleUpdateDebounce",()=>{this._handlesToProps()},100)}async _handlesToProps(){const t=this.config,e=await Promise.all(t.handleNames.map(t=>this.handles.get(t)).map(t=>t.toList?t.toList():t.get?t.get():t)),n=Object.create(null);t.handleNames.forEach((t,r)=>{n[t]=e[r]}),this._hasProps=!0,this._setProps(n)}fireEvent(t,{handler:e,data:n}){this[e]&&this[e]({data:n},this._state)}_debounce(t,e,n){const r=`_debounce_${t}`;this._state[r]||this.startBusy();super._debounce(t,()=>{this.doneBusy(),e(),this._state[r]=null},n)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"XenStateMixin",function(){return s}),n.d(e,"nob",function(){return r}),n.d(e,"debounce",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const r=()=>Object.create(null),i=(t,e,n)=>{if(t&&clearTimeout(t),e&&n)return setTimeout(e,n)},s=t=>(class extends t{constructor(){super(),this._pendingProps=r(),this._props=this._getInitialProps()||r(),this._lastProps=r(),this._state=this._getInitialState()||r(),this._lastState=r()}_getInitialProps(){}_getInitialState(){}_getProperty(t){return this._pendingProps[t]||this._props[t]}_setProperty(t,e){(this._validator||this._wouldChangeProp(t,e))&&(this._pendingProps[t]=e,this._invalidateProps())}_wouldChangeValue(t,e,n){return t[e]!==n}_wouldChangeProp(t,e){return this._wouldChangeValue(this._props,t,e)}_wouldChangeState(t,e){return this._wouldChangeValue(this._state,t,e)}_setProps(t){Object.assign(this._pendingProps,t),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setImmutableState(t,e){"object"==typeof t&&(console.warn("Xen:: _setImmutableState takes name and value args for a single property, dictionaries not supported."),e=Object.values(t)[0],t=Object.names(t)[0]),"object"==typeof e&&(e=Object.assign(Object.create(null),e)),this._state[t]=e,this._invalidate()}_setState(t){let e=!1;const n=this._state;for(const r in t){const i=t[r];this._wouldChangeState(r,i)&&(e=!0,n[r]=i)}if(e)return this._invalidate(),!0}_setIfDirty(t){return this._setState(t)}_async(t){return Promise.resolve().then(t.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const t=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...t),this._propsInvalid=!1),this._shouldUpdate(...t)&&(this._ensureMount(),this._doUpdate(...t))}catch(t){console.error(t)}this._validator=null,this._lastProps=Object.assign(r(),this._props),this._lastState=Object.assign(r(),this._state)}_doUpdate(...t){this._update(...t),this._didUpdate(...t)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(t,e,n){t=`_debounce_${t}`,this._state[t]=i(this._state[t],e,null!=n?n:16)}})},function(t,e,n){"use strict";n.r(e),n.d(e,"DomParticleBase",function(){return s});var r=n(3),i=n(189);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s extends i.Particle{constructor(){super()}get template(){return""}getTemplate(t){return this.template}getTemplateName(t){return"default"}shouldRender(){return!0}render(){return{}}renderSlot(t,e){const n=this._getStateArgs(),r=this.getSlot(t);if(r){if(this.currentSlotName=t,e.forEach(t=>r.requestedContentTypes.add(t)),this.shouldRender(...n)){const t={};r.requestedContentTypes.has("template")&&(t.template=this.getTemplate(r.slotName)),r.requestedContentTypes.has("model")&&(t.model=this.render(...n)),t.templateName=this.getTemplateName(r.slotName),r.render(t)}else r.isRendered&&r.render({});this.currentSlotName=void 0}}_getStateArgs(){return[]}forceRenderTemplate(t){this._slotByName.forEach((e,n)=>{t&&n!=t||e.requestedContentTypes.add("template")})}fireEvent(t,{handler:e,data:n}){this[e]&&this[e]({data:n})}setParticleDescription(t){if("string"==typeof t)return super.setParticleDescription(t);Object(r.assert)(!!t.template&&!!t.model,"Description pattern must either be string or have template and model"),super.setDescriptionPattern("_template_",t.template),super.setDescriptionPattern("_model_",JSON.stringify(t.model))}async clearHandle(t){await this.handles.get(t).clear()}async mergeEntitiesToHandle(t,e){const n={},r=this.handles.get(t);(await r.toList()).forEach(t=>n[t.id]=t);for(const t of e)n[t.id]||r.store(t)}async appendEntitiesToHandle(t,e){const n=this.handles.get(t);n&&Promise.all(e.map(t=>n.store(t)))}async appendRawDataToHandle(t,e){const n=this.handles.get(t);n&&Promise.all(e.map(t=>n.store(new n.entityClass(t))))}updateVariable(t,e){const n=this.handles.get(t);if(n){const t=new n.entityClass(e);return n.set(t),t}}async updateSet(t,e){const n=this.handles.get(t);n&&(n.remove(e),n.store(e))}boxQuery(t,e){return t.filter(t=>e===t.getUserID().split("|")[0])}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MultiplexerDomParticle",function(){return o});var r=n(3),i=n(12),s=n(194);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o extends s.TransformationDomParticle{constructor(){super(),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(t,e,n,r,i){const s=[],o=[];let a=2;const c=[t,e];for(const[t,e]of r){if(c.includes(t))continue;s.push(`use '${await i.mapHandle(e._proxy)}' as v${a}`);const r=n.connections.find(t=>t.isCompatibleType(e.type));r&&(o.push(`${r.name} = v${a++}`),this._connByHostedConn.set(r.name,t))}return[s,o]}async setHandles(t){this.handleIds={};const e=await this.constructInnerArc(),n=t.get("hostedParticle");let r=null,i=[],s=[];n&&(r=await n.get())&&([i,s]=await this._mapParticleConnections("list","hostedParticle",r,t,e)),this.setState({arc:e,type:t.get("list").type,hostedParticle:r,otherMappedHandles:i,otherConnections:s}),super.setHandles(t)}async willReceiveProps({list:t},{arc:e,type:n,hostedParticle:r,otherMappedHandles:s,otherConnections:o}){t.length>0&&(this.relevance=.1);for(const[a,c]of this.getListEntries(t)){let t=r;if(this.handleIds[c.id]){(await this.handleIds[c.id]).set(c);continue}const u=e.createHandle(n.primitiveType(),"item"+a);this.handleIds[c.id]=u;const l=await u;if(!t){if(!c.renderParticleSpec)continue;t=i.ParticleSpec.fromLiteral(JSON.parse(c.renderParticleSpec));const n="list",r="renderParticle";[s,o]=await this._mapParticleConnections(n,r,t,this.handles,e)}const h=[...t.slots.keys()][0],d=[...this.spec.slots.values()][0].name,f=await e.createSlot(this,d,t.name,h,l._id);if(f){this._itemSubIdByHostedSlotId.set(f,c.id);try{const n=this.constructInnerRecipe(t,c,l,{name:h,id:f},{connections:o,handles:s});await e.loadRecipe(n,this),l.set(c)}catch(t){console.log(t)}}}}combineHostedModel(t,e,n){const r=this._itemSubIdByHostedSlotId.get(e);if(!r)return;const i=this._state.renderModel?this._state.renderModel.items:[],s=i.findIndex(t=>t.subId==r),o=Object.assign({},n.model,{subId:r});s>=0&&s<i.length?i[s]=o:i.push(o),this._setState({renderModel:{items:i}})}combineHostedTemplate(t,e,n){const i=this._itemSubIdByHostedSlotId.get(e);if(i&&(Object(r.assert)(n.templateName,`Template name is missing for slot '${t}' (hosted slot ID: '${e}')`),this._setState({templateName:Object.assign(this._state.templateName||{},{[i]:`${n.templateName}`})}),n.template)){let t=n.template;t=t.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((e,n)=>{t=t.replace(new RegExp(`{{${n}.description}}`,"g"),`{{${e}.description}}`)}),this._setState({template:Object.assign(this._state.template||{},{[n.templateName]:t})}),this.forceRenderTemplate()}}constructInnerRecipe(t,e,n,r,i){}getListEntries(t){return t.entries()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"TransformationDomParticle",function(){return i});var r=n(190);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends r.DomParticle{getTemplate(t){return this._state.template}getTemplateName(t){return this._state.templateName}render(t,e){return e.renderModel}shouldRender(t,e){return Boolean((e.template||e.templateName)&&e.renderModel)}renderHostedSlot(t,e,n){this.combineHostedTemplate(t,e,n),this.combineHostedModel(t,e,n)}combineHostedTemplate(t,e,n){}combineHostedModel(t,e,n){}static propsToItems(t){return t?t.map(({rawData:t,id:e})=>Object.assign({},t,{subId:e})):[]}}},function(t,e,n){"use strict";n.r(e),n.d(e,"JsonldToManifest",function(){return i});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const r=["Text","URL","Number","Boolean"];class i{static convert(t,e){const n=JSON.parse(t),i={},s={};n["@graph"]||(n["@graph"]=[n]);for(const t of n["@graph"])"rdf:Property"===t["@type"]?s[t["@id"]]=t:"rdfs:Class"===t["@type"]&&(i[t["@id"]]=t,t.subclasses=[],t.superclass=null);for(const t of Object.values(i))if(void 0!==t["rdfs:subClassOf"]){void 0==t["rdfs:subClassOf"].length&&(t["rdfs:subClassOf"]=[t["rdfs:subClassOf"]]);for(const e of t["rdfs:subClassOf"]){const n=e["@id"];void 0==t.superclass&&(t.superclass=[]),i[n]?(i[n].subclasses.push(t),t.superclass.push(i[n])):t.superclass.push({"@id":n})}}for(const t of Object.values(i))0===t.subclasses.length&&void 0==e&&(e=t);const o=[];for(const t of Object.values(s)){let n=t["schema:domainIncludes"];if(n||(n={"@id":e["@id"]}),n.length||(n=[n]),(n=n.map(t=>t["@id"])).includes(e["@id"])){const e=t["@id"].split(":")[1];let n=t["schema:rangeIncludes"];n||console.log(t),n.length||(n=[n]),(n=(n=n.map(t=>t["@id"].split(":")[1])).filter(t=>r.includes(t))).length>0&&o.push({name:e,type:n})}}const a=e["@id"].split(":")[1],c=e&&e.superclass?e.superclass.map(t=>t["@id"].split(":")[1]):[];let u="";for(const t of c)u+=`import 'https://schema.org/${t}'\n\n`;if(u+=`schema ${a}`,c.length>0&&(u+=` extends ${c.join(", ")}`),o.length>0)for(const t of o){let e;u+=`\n  ${e=t.type.length>1?"("+t.type.join(" or ")+")":t.type[0]} ${t.name}`}return u+="\n"}}},function(t,e,n){"use strict";n.r(e),n.d(e,"StubLoader",function(){return i});var r=n(185);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends r.Loader{constructor(t){super(),this._fileMap=t,t.hasOwnProperty("*")&&(this._cannedResponse=t["*"])}loadResource(t){return this._fileMap.hasOwnProperty(t)?this._fileMap[t]:this._cannedResponse||super.loadResource(t)}path(t){return this._fileMap.hasOwnProperty(t)||this._cannedResponse?t:super.path(t)}join(t,e){return this._fileMap.hasOwnProperty(t)||this._cannedResponse?e:super.join(t,e)}clone(){return new i(this._fileMap)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ArcDebugHandler",function(){return a});var r=n(198),i=n(199),s=n(233),o=n(26);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
o.DevtoolsConnection.onceConnected.then(t=>{Object(r.enableTracingAdapter)(t)});class a{constructor(t){this._devtoolsChannel=null,this._arcId=t.id.toString(),this._isSpeculative=t.isSpeculative,o.DevtoolsConnection.onceConnected.then(e=>{this._devtoolsChannel=e,t.isSpeculative||(new i.ArcPlannerInvoker(t,e),new s.ArcStoresFetcher(t,e)),e.send({messageType:"arc-available",messageBody:{id:t.id.toString(),isSpeculative:t.isSpeculative}})})}recipeInstantiated({particles:t}){if(!this._devtoolsChannel||this._isSpeculative)return;const e=({id:t,name:e})=>({id:t,name:e}),n=[];t.forEach(t=>Object.values(t.consumedSlotConnections).forEach(t=>{n.push({arcId:this._arcId,particleId:t.particle.id,consumed:e(t.targetSlot),provided:Object.values(t.providedSlots).map(t=>e(t))})})),this._devtoolsChannel.send({messageType:"recipe-instantiated",messageBody:{slotConnections:n}})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"enableTracingAdapter",function(){return s});var r=n(46);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */let i=!1;function s(t){i||(r.Tracing.enabled||r.Tracing.enable(),t.send({messageType:"trace-time-sync",messageBody:{traceTime:r.Tracing.now(),localTime:Date.now()}}),r.Tracing.stream(e=>t.send({messageType:"trace",messageBody:e}),t=>t.ov),i=!0)}},function(t,e,n){"use strict";n.r(e),n.d(e,"ArcPlannerInvoker",function(){return s});var r=n(200),i=n(31);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(t,e){this.arc=t,this.planner=new r.Planner,this.planner.init(t),e.listen(t,"fetch-strategies",()=>e.send({messageType:"fetch-strategies-result",messageBody:this.planner.strategizer._strategies.map(t=>t.constructor.name)})),e.listen(t,"invoke-planner",async t=>e.send({messageType:"invoke-planner-result",messageBody:await this.invokePlanner(t.messageBody)}))}async invokePlanner(t){const e=this.planner.strategizer._strategies.find(e=>e.constructor.name===t.strategy);if(!e)return{error:"could not find strategy"};let n;try{n=await i.Manifest.parse(t.recipe,{loader:this.arc._loader,fileName:"manifest.manifest"})}catch(t){return{error:t.message}}const r=n.recipes[0];r.normalize();const s=await e.generate({generation:0,generated:[{result:r,score:1}],population:[{result:r,score:1}],terminal:[]});for(const t of s){t.hash=await t.hash,t.derivation=void 0;const e=t.result;if(t.result=e.toString({showUnresolved:!0}),!Object.isFrozen(e)){const n=new Map;e.normalize({errors:n}),t.errors=[...n.keys()].map(t=>({id:t.id,error:n.get(t)})),t.normalized=e.toString()}}return{results:s}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Planner",function(){return P});var r=n(201),i=n(35),s=n(202),o=n(214),a=n(173),c=n(203),u=n(204),l=n(205),h=n(178),d=n(206),f=n(207),p=n(215),g=n(208),y=n(209),v=n(210),m=n(216),_=n(211),b=n(212),w=n(213),S=n(217),C=n(218),E=n(219),x=n(175),T=n(220),A=n(222),k=n(46),O=n(26);class P{constructor(){this._relevances=[]}init(t,{strategies:e=P.AllStrategies,ruleset:n=s.Empty,strategyArgs:r={}}={}){r=Object.freeze(Object.assign({},r)),this._arc=t;const o=e.map(e=>new e(t,r));this.strategizer=new i.Strategizer(o,[],n)}async plan(t,e){const n=k.Tracing.start({cat:"planning",name:"Planner::plan",overview:!0,args:{timeout:t}});t=t||-1;const i=[],s=Object(r.now)();do{const o=await n.wait(this.strategizer.generate()),a=this.strategizer.generated;n.addArgs({generated:a.length,generation:this.strategizer.generation}),e&&e.push({generated:a,record:o});const c=this.strategizer.generated.map(t=>t.result).filter(t=>t.isResolved());i.push(...c);const u=Object(r.now)()-s;if(t>=0&&u>t){console.warn(`Planner.plan timed out [elapsed=${Math.floor(u)}ms, timeout=${t}ms].`);break}}while(this.strategizer.generated.length+this.strategizer.terminal.length>0);return n.end(),i}_speculativeThreadCount(){const t=o.DeviceInfo.hardwareConcurrency(),e=o.DeviceInfo.deviceMemory();if(!t||!e)return 2;const n=e/4/.125,r=t/2;return Math.max(2,Math.min(n,r))}_splitToGroups(t,e){const n=[];if(!t||0===t.length)return n;const r=Math.max(1,Math.floor(t.length/e));let i=0;for(let s=0;s<e&&i<t.length;s++)n.push(t.slice(i,i+r)),i+=r;return i<t.length&&n[n.length-1].push(...t.slice(i,t.length)),n}async suggest(t,e=[],n){const r=k.Tracing.start({cat:"planning",name:"Planner::suggest",overview:!0,args:{timeout:t}});!e&&O.DevtoolsConnection.isConnected&&(e=[]);const i=await r.wait(this.plan(t,e));n=n||new T.Speculator;const s=this._speculativeThreadCount(),o=this._splitToGroups(i,s);let c=await r.wait(Promise.all(o.map(async(t,r)=>{const i=[];for(const s of t){const t=(t=>t.substring(t.length-4))(await s.digest());if(a.RecipeUtil.matchesRecipe(this._arc.activeRecipe,s)){this._updateGeneration(e,t,t=>t.active=!0);continue}const o=k.Tracing.start({cat:"speculating",sequence:`speculator_${r}`,overview:!0,args:{groupIndex:r}}),c=await n.speculate(this._arc,s,t);if(this._relevances.push(c),!c.isRelevant(s)){this._updateGeneration(e,t,t=>t.irrelevant=!0),o.end({name:"[Irrelevant suggestion]",hash:t,groupIndex:r});continue}const u=c.calcRelevanceScore();c.newArc.description.relevance=c;const l=await c.newArc.description.getRecipeSuggestion();this._updateGeneration(e,t,t=>t.description=l),c.newArc.stop();const h=new A.Suggestion(s,t,u,this._arc);h.setSearch(s.search),await h.setDescription(c.newArc.description),h.groupIndex=r,i.push(h),o.end({name:l,args:{rank:u,hash:t,groupIndex:r}})}return i})));return c=[].concat(...c),this._relevances=[],r.endWith(c)}_updateGeneration(t,e,n){t&&t.forEach(t=>{t.generated.forEach(t=>{t.hash.endsWith(e)&&n(t)})})}dispose(){this._relevances.forEach(t=>t.newArc.dispose()),this._relevances=[]}}P.InitializationStrategies=[l.InitPopulation,v.InitSearch],P.ResolutionStrategies=[_.SearchTokensToParticles,m.SearchTokensToHandles,b.GroupHandleConnections,S.CreateHandleGroup,c.ConvertConstraintsToConnections,h.MapSlots,u.AssignHandles,d.MatchParticleByVerb,f.MatchRecipeByVerb,p.NameUnnamedConnections,g.AddMissingHandles,y.CreateDescriptionHandle,w.MatchFreeHandlesToConnections,x.ResolveRecipe,C.FindHostedParticle,E.CoalesceRecipes],P.AllStrategies=P.InitializationStrategies.concat(P.ResolutionStrategies)},function(t,e,n){"use strict";function r(){return performance.now()}n.r(e),n.d(e,"now",function(){return r})},function(t,e,n){"use strict";n.r(e),n.d(e,"Empty",function(){return v}),n.d(e,"ExperimentalPhased",function(){return m}),n.d(e,"ExperimentalLinear",function(){return _});var r=n(35),i=n(203),s=n(204),o=n(205),a=n(178),c=n(206),u=n(207),l=n(208),h=n(209),d=n(210),f=n(211),p=n(212),g=n(213),y=n(175);const v=(new r.Ruleset.Builder).build(),m=(new r.Ruleset.Builder).order([o.InitPopulation,d.InitSearch],f.SearchTokensToParticles,[u.MatchRecipeByVerb,c.MatchParticleByVerb],i.ConvertConstraintsToConnections,p.GroupHandleConnections,[l.AddMissingHandles,s.AssignHandles,g.MatchFreeHandlesToConnections],a.MapSlots,h.CreateDescriptionHandle,y.ResolveRecipe).build(),_=(new r.Ruleset.Builder).order(o.InitPopulation,d.InitSearch,f.SearchTokensToParticles,u.MatchRecipeByVerb,c.MatchParticleByVerb,i.ConvertConstraintsToConnections,p.GroupHandleConnections,g.MatchFreeHandlesToConnections,l.AddMissingHandles,s.AssignHandles,a.MapSlots,h.CreateDescriptionHandle,y.ResolveRecipe).build()},function(t,e,n){"use strict";n.r(e),n.d(e,"ConvertConstraintsToConnections",function(){return c});var r=n(35),i=n(34),s=n(176),o=n(173),a=n(36);class c extends r.Strategy{constructor(t,e){super(t,e),this.modality=t.pec.slotComposer?t.pec.slotComposer.modality:null}async generate(t){const e=this.modality;return i.Recipe.over(this.getResults(t),new class extends s.Walker{onRecipe(t){const n=new Set,r=new Set,i={},s={};let c=0;const u=[];if(0===t.connectionConstraints.length)return;for(const o of t.connectionConstraints){const t=o.from,l=o.to;if(e&&t instanceof a.ParticleEndPoint&&l instanceof a.ParticleEndPoint&&(!t.particle.matchModality(e)||!l.particle.matchModality(e)))return;const h={"->":"<-","=":"=","<-":"->"};let d,f=!1,p=!1;t instanceof a.ParticleEndPoint&&(n.add(t.particle.name),void 0==i[t.particle.name]&&(i[t.particle.name]={},s[t.particle.name]=t.particle),t.connection?(f=!0,d=i[t.particle.name][t.connection]):p=!0),t instanceof a.HandleEndPoint&&(d={handle:t.handle,direction:h[o.direction]},r.add(d.handle)),l instanceof a.ParticleEndPoint&&(n.add(l.particle.name),void 0==i[l.particle.name]&&(i[l.particle.name]={},s[l.particle.name]=l.particle),l.connection?(f=!0,d||(d=i[l.particle.name][l.connection])):p=!0),l instanceof a.HandleEndPoint&&(d={handle:l.handle,direction:o.direction},r.add(d.handle)),void 0==d&&(d={handle:"v"+c++,direction:o.direction},f&&r.add(d.handle)),t instanceof a.TagEndPoint?d.tags=t.tags:l instanceof a.TagEndPoint&&(d.tags=l.tags),p&&u.push({from:t._clone(),to:l._clone(),direction:o.direction});const g=(t,e)=>"="===t?"=":"="===e?"=":t!==e?"=":t;let y=o.direction;if(t instanceof a.ParticleEndPoint){const e=t.connection;if(e){const n=i[t.particle.name][e];if(n&&null==(y=g(y,n.direction)))return;i[t.particle.name][e]={handle:d.handle,direction:y,tags:d.tags}}}if(y=h[o.direction],l instanceof a.ParticleEndPoint){const t=l.connection;if(t){const e=i[l.particle.name][t];if(e&&null==(y=g(y,e.direction)))return;i[l.particle.name][t]={handle:d.handle,direction:y,tags:d.tags}}}}const l=o.RecipeUtil.makeShape([...n.values()],[...r.values()],i);o.RecipeUtil.find(t,l);return o.RecipeUtil.find(t,l).filter(t=>{const e={};for(const n of Object.keys(i))for(const r of Object.keys(i[n])){const o=i[n][r].handle;if(!e[o])if(t.match[o])e[o]=!0;else{const t=s[n];e[o]=t.isOutput(r)}}return Object.values(e).every(t=>t)}).map(t=>e=>{const n=e.connectionConstraints.length+t.score,r=e.updateToClone(t.match);for(const t of Object.keys(i)){let n=r[t];n||((n=e.newParticle(t)).spec=s[t],r[t]=n);for(const s of Object.keys(i[t])){const o=i[t][s];let a=n.connections[s];void 0==a&&(a=n.addConnectionName(s));let c=r[o.handle];null==c&&null==a.handle&&((c=e.newHandle()).fate="create",c.tags=o.tags||[],r[o.handle]=c),null==a.handle&&a.connectToHandle(c)}}e.clearConnectionConstraints();for(const t of u){const n=new a.InstanceEndPoint(r[t.from.particle.name],t.from.connection),i=new a.InstanceEndPoint(r[t.to.particle.name],t.to.connection);e.newObligation(n,i,t.direction)}return n})}}(s.Walker.Independent),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"AssignHandles",function(){return c});var r=n(35),i=n(176),s=n(34),o=n(173),a=n(3);class c extends r.Strategy{async generate(t){const e=this;return s.Recipe.over(this.getResults(t),new class extends i.Walker{onHandle(t,n){if(!["?","use","copy","map"].includes(n.fate))return;if(0===n.connections.length)return;if(n.id)return;if(!n.type)return;const r=o.RecipeUtil.directionCounts(n);if(r.unknown>0)return;const i=this._getScore(r,n.tags);if(r.out>0&&"map"===n.fate)return;const s=e.getMappableStores(n.fate,n.type,n.tags,r);return"?"!==n.fate&&s.size<2?void 0:[...s.keys()].map(t=>(e,n)=>(Object(a.assert)(t.id),e.handles.find(e=>e.id===t.id)?0:(n.mapToStorage(t),"?"===n.fate?n.fate=s.get(t):Object(a.assert)(n.fate,s.get(t)),i)))}_getScore(t,e){let n=-1;return 0!==t.in&&0!==t.out||(n=0===t.out?1:0),e.length>0&&(n+=4),n}}(i.Walker.Permuted),this)}getMappableStores(t,e,n,r){const i=new Map;if("use"===t||"?"===t){const t=0===r.out;this.arc.findStoresByType(e,{tags:n,subtype:t}).forEach(t=>i.set(t,"use"))}return"map"!==t&&"copy"!==t&&"?"!==t||this.arc.context.findStoreByType(e,{tags:n,subtype:!0}).forEach(e=>i.set(e,"?"===t?r.out>0?"copy":"map":t)),i}}},function(t,e,n){"use strict";n.r(e),n.d(e,"InitPopulation",function(){return i});var r=n(35);class i extends r.Strategy{constructor(t,{contextual:e=!1}){super(t,{contextual:e}),this._contextual=e,this._loadedParticles=new Set(this.arc.loadedParticles().map(t=>t.implFile))}async generate({generation:t}){if(0!==t)return[];return await this.arc.recipeIndex.ready,(this._contextual?this._contextualResults():this._allResults()).map(({recipe:t,score:e=1})=>({result:t,score:e,derivation:[{strategy:this,parent:void 0}],hash:t.digest(),valid:Object.isFrozen(t)}))}_contextualResults(){const t=[];for(const e of this.arc.activeRecipe.slots.filter(t=>t.sourceConnection))t.push(...this.arc.recipeIndex.findConsumeSlotConnectionMatch(e).map(({slotConn:t})=>({recipe:t.recipe})));let e=[];for(const t of this.arc.recipes)for(const n of[...t.innerArcs.values()])e=e.concat(n.activeRecipe.handles);for(const n of this.arc.activeRecipe.handles.concat(e))t.push(...this.arc.recipeIndex.findHandleMatch(n,["use","?"]).map(t=>({recipe:t.recipe})));return t}_allResults(){return this.arc.recipeIndex.recipes.map(t=>({recipe:t,score:1-t.particles.filter(t=>t.spec&&this._loadedParticles.has(t.spec.implFile)).length}))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MatchParticleByVerb",function(){return o});var r=n(35),i=n(34),s=n(176);class o extends r.Strategy{async generate(t){const e=this.arc;return i.Recipe.over(this.getResults(t),new class extends s.Walker{onParticle(t,n){if(n.name)return;return e.context.findParticlesByVerb(n.primaryVerb).filter(t=>!e.pec.slotComposer||t.matchModality(e.pec.slotComposer.modality)).map(t=>(e,n)=>{return n.name=t.name,n.spec=t,1})}}(s.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MatchRecipeByVerb",function(){return c});var r=n(35),i=n(34),s=n(176),o=n(43),a=n(3);class c extends r.Strategy{async generate(t){const e=this.arc;return i.Recipe.over(this.getResults(t),new class extends s.Walker{onParticle(t,n){if(n.name)return;let r=e.context.findRecipesByVerb(n.primaryVerb);const i={};for(const t of Object.values(n.consumedSlotConnections)){const e=t.targetSlot&&t.targetSlot.sourceConnection?t.targetSlot:null;i[t.name]={targetSlot:e,providedSlots:{}};for(const e of Object.keys(t.providedSlots)){const n=t.providedSlots[e].consumeConnections.length>0?t.providedSlots[e]:null;i[t.name].providedSlots[e]=n}}const s={named:{},unnamed:[]};for(const t of Object.values(n.connections))s.named[t.name]={direction:t.direction,handle:t.handle};for(const t of n.unnamedConnections)s.unnamed.push({direction:t.direction,handle:t.handle});return(r=r.filter(t=>c.satisfiesSlotConstraints(t,i)).filter(t=>c.satisfiesHandleConstraints(t,s))).map(t=>(e,n)=>{const{handles:r,particles:o,slots:u}=t.mergeInto(e);n.remove();for(const t in i)if(i[t].targetSlot||Object.values(i[t].providedSlots).filter(t=>null!=t).length>0){let n=!1;for(const r of o)if(c.slotsMatchConstraint(r.consumedSlotConnections,t,i[t].providedSlots)){if(i[t].targetSlot){const{mappedSlot:n}=e.updateToClone({mappedSlot:i[t].targetSlot});r.consumedSlotConnections[t]._targetSlot=n,n.consumeConnections.push(r.consumedSlotConnections[t])}for(const n of Object.keys(i[t].providedSlots)){const s=i[t].providedSlots[n];if(null==s)continue;const{mappedSlot:o}=e.updateToClone({mappedSlot:s});r.consumedSlotConnections[t].providedSlots[n].remove(),r.consumedSlotConnections[t].providedSlots[n]=o,o._sourceConnection=r.consumedSlotConnections[t]}n=!0;break}Object(a.assert)(n)}function l(t,e,r,i){if(null!=e.handle)return!1;if(!c.connectionMatchesConstraint(e,r))return!1;for(let r=0;r<i.connections.length;r++){const s=i.connections[r];if(s.particle===n&&s.name==t)return e._handle=i,i.connections[r]=e,!0}return!1}function h(t,n,r){const{mappedHandle:i}=e.updateToClone({mappedHandle:r});for(const e of o)if(t){if(l(t,e.connections[t],n,i))return!0}else for(const r of Object.values(e.connections))if(l(t,r,n,i))return!0;return!1}for(const t in s.named)s.named[t].handle&&Object(a.assert)(h(t,s.named[t],s.named[t].handle));for(const t of s.unnamed)t.handle&&Object(a.assert)(h(null,t,t.handle));return 1})}}(s.Walker.Permuted),this)}static satisfiesHandleConstraints(t,e){for(const n in e.named)if(!c.satisfiesHandleConnection(t,n,e.named[n]))return!1;for(const n of e.unnamed)if(!c.satisfiesUnnamedHandleConnection(t,n))return!1;return!0}static satisfiesUnnamedHandleConnection(t,e){if(!e.handle)return!1;for(const n of t.particles)for(const t of Object.values(n.connections))if(c.connectionMatchesConstraint(t,e))return!0;return!1}static satisfiesHandleConnection(t,e,n){for(const r of t.particles)if(r.connections[e]&&c.connectionMatchesConstraint(r.connections[e],n))return!0;return!1}static connectionMatchesConstraint(t,e){return t.direction===e.direction&&(!e.handle||null!=o.Handle.effectiveType(e.handle._mappedType,e.handle.connections.concat(t)))}static satisfiesSlotConstraints(t,e){for(const n in e)if(!c.satisfiesSlotConnection(t,n,e[n]))return!1;return!0}static satisfiesSlotConnection(t,e,n){for(const r of t.particles)if(c.slotsMatchConstraint(r.consumedSlotConnections,e,n))return!0;return!1}static slotsMatchConstraint(t,e,n){if(null==t[e])return!1;if(null!=t[e]._targetSlot&&null!=n.targetSlot)return!1;for(const r in n.providedSlots)if(null==t[e].providedSlots[r])return!1;return!0}}},function(t,e,n){"use strict";n.r(e),n.d(e,"AddMissingHandles",function(){return o});var r=n(35),i=n(34),s=n(176);class o extends r.Strategy{async generate(t){return i.Recipe.over(this.getResults(t),new class extends s.Walker{onRecipe(t){if(t.connectionConstraints.length>0)return;if(t.handles.filter(t=>0===t.connections.length).length>0)return;const e=t.handleConnections.filter(t=>null==t.handle&&!t.isOptional&&"descriptions"!==t.name&&"host"!==t.direction);return 0!==e.length?t=>(e.forEach(e=>{const n=t.updateToClone({hc:e}).hc,r=t.newHandle();r.fate="?",n.connectToHandle(r)}),0):void 0}}(s.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"CreateDescriptionHandle",function(){return o});var r=n(35),i=n(34),s=n(176);class o extends r.Strategy{async generate(t){return i.Recipe.over(this.getResults(t),new class extends s.Walker{onHandleConnection(t,e){if(!e.handle&&"descriptions"===e.name)return(t,e)=>{const n=t.newHandle();return n.fate="create",e.connectToHandle(n),1}}}(s.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"InitSearch",function(){return o});var r=n(35),i=n(34),s=n(3);class o extends r.Strategy{constructor(t,{search:e}){super(t,{search:e}),this._search=e}async generate({generation:t}){if(null==this._search||0!==t)return[];const e=new i.Recipe;return e.setSearchPhrase(this._search),Object(s.assert)(e.normalize()),Object(s.assert)(!e.isResolved()),[{result:e,score:0,derivation:[{strategy:this,parent:void 0}],hash:e.digest(),valid:!0}]}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SearchTokensToParticles",function(){return a});var r=n(3),i=n(35),s=n(34),o=n(176);class a extends i.Strategy{constructor(t,e){super(t,e);const n={},i={};t.context.particles.forEach(t=>{this._addThing(t.name,{spec:t},n,i),t.verbs.forEach(e=>this._addThing(e,{spec:t},n,i))}),t.context.allRecipes.forEach(t=>{const e={innerRecipe:t};this._addThing(t.name,e,n,i),t.verbs.forEach(t=>this._addThing(t,e,n,i))});this._walker=new class extends o.Walker{constructor(t,e){super(t),this.index=e.recipeIndex}onRecipe(t){if(!t.search||!t.search.unresolvedTokens.length)return;const e={},s=new Set,o=(t,n)=>{n.forEach(n=>{e[t]=e[t]||[],e[t].push(n),t.split(" ").forEach(t=>s.add(t))})};for(const[e,n]of Object.entries(i))e.split(" ").every(e=>t.search.unresolvedTokens.includes(e))&&t.search.phrase.includes(e)&&o(e,n);for(const e of t.search.unresolvedTokens){if(s.has(e))continue;const t=n[e];t&&o(e,t)}if(0===s.size)return;const a=t=>[].concat(...t);return((...t)=>t.reduce((t,e)=>a(t.map(t=>e.map(e=>[...t,e]))),[[]]))(...Object.values(e).map(t=>a(t))).map(t=>e=>(s.forEach(t=>e.search.resolveToken(t)),t.forEach(({spec:t,innerRecipe:n})=>{if(t)e.newParticle(t.name).spec=t;else{const t=this.index.findCoalescableHandles(e,n);Object(r.assert)(n);const{cloneMap:i}=n.mergeInto(e);t.forEach((t,e)=>i.get(t).mergeInto(e))}}),s.size))}}(o.Walker.Permuted,t)}get walker(){return this._walker}getResults(t){Object(r.assert)(t);const e=super.getResults(t).filter(t=>!t.result.isResolved()),n=t.terminal;return[...e,...n]}_addThing(t,e,n,r){if(!t)return;this._addThingByToken(t.toLowerCase(),e,n);const i=t.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim();i!==t&&this._addThingByToken(i.toLowerCase(),e,r)}_addThingByToken(t,e,n){Object(r.assert)(t===t.toLowerCase()),n[t]=n[t]||[],n[t].find(t=>t===e)||n[t].push(e)}async generate(t){return await this.walker.index.ready,s.Recipe.over(this.getResults(t),this.walker,this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"GroupHandleConnections",function(){return a});var r=n(3),i=n(35),s=n(34),o=n(176);class a extends i.Strategy{constructor(t,e){super(t,e),this._walker=new class extends o.Walker{onRecipe(t,e){if(t.handleConnections.find(t=>!t.type||!t.name||t.isOptional))return;const n=new Set;t.handleConnections.forEach(t=>{t.isOptional||t.handle||Array.from(n).find(e=>e.equals(t.type))||n.add(t.type)});const i=new Map;return n.forEach(e=>{const n=t=>Object.values(t).filter(t=>!t.isOptional&&!t.handle&&e.equals(t.type)).length,s=[...t.particles].sort((t,e)=>n(e.connections)-n(t.connections)).filter(t=>n(t.connections)>0);Object(r.assert)(s.length>0);const o=s[0],a=new Map;let c=t.handleConnections.filter(t=>!t.isOptional&&!t.handle&&e.equals(t.type)&&t.particle!==o),u=0;for(;c.length>0;)Object.values(o.connections).forEach(t=>{if(!e.equals(t.type))return;a.has(t)||a.set(t,[]);const n=a.get(t),r=c.filter(t=>!n.find(e=>e.particle===t.particle));let i=r.find(e=>t.isInput!==e.isInput||t.isOutput!==e.isOutput);if(!i){if(0===r.length||0===u)return;i=r[0]}n.push(i),c=c.filter(t=>t!==i)}),u++;a.forEach((t,e)=>{0===t.length?a.delete(e):t.push(e)}),0!==a.size&&i.set(e,a)}),i.size>0?t=>{i.forEach((e,n)=>{e.forEach(e=>{const n=t.newHandle();e.forEach(e=>{t.updateToClone({conn:e}).conn.connectToHandle(n)})})})}:void 0}}(o.Walker.Permuted)}get walker(){return this._walker}async generate(t){return s.Recipe.over(this.getResults(t),this.walker,this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MatchFreeHandlesToConnections",function(){return o});var r=n(35),i=n(176),s=n(34);class o extends r.Strategy{async generate(t){return s.Recipe.over(this.getResults(t),new class extends i.Walker{onHandle(t,e){if(e.connections.length>0)return;return t.handleConnections.filter(t=>void 0==t.handle&&"descriptions"!==t.name).map(t=>(e,n)=>{return e.updateToClone({connection:t}).connection.connectToHandle(n),1})}}(i.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"DeviceInfo",function(){return r});class r{static hardwareConcurrency(){return navigator.hardwareConcurrency}static deviceMemory(){return navigator.deviceMemory}}},function(t,e,n){"use strict";n.r(e),n.d(e,"NameUnnamedConnections",function(){return o});var r=n(35),i=n(34),s=n(176);class o extends r.Strategy{async generate(t){return i.Recipe.over(this.getResults(t),new class extends s.Walker{onHandleConnection(t,e){if(e.name)return;if(!e.particle.spec)return;return e.particle.spec.connections.filter(t=>!t.isOptional&&e.handle.type.equals(t.type)&&!e.particle.getConnectionByName(t.name).handle).map(t=>(e,n)=>(n.particle.nameConnection(n,t.name),1))}}(s.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SearchTokensToHandles",function(){return a});var r=n(35),i=n(34),s=n(173),o=n(176);class a extends r.Strategy{async generate(t){const e=this.arc,n=(t,n)=>{const r=s.RecipeUtil.directionCounts(n);let i=e.findStoresByType(n.type,{tags:[`${t}`],subtype:0===r.out}),o="use";return 0===i.length&&(i=e.context.findStoreByType(n.type,{tags:[`${t}`],subtype:0===r.out}),o=0===r.out?"map":"copy"),(i=i.filter(t=>!n.recipe.handles.find(e=>e.id===t.id))).map(e=>({store:e,fate:o,token:t}))};return i.Recipe.over(this.getResults(t),new class extends o.Walker{onHandle(t,e){if(!t.search||0===t.search.unresolvedTokens.length)return;if(e.isResolved()||0===e.connections.length)return;const r=[];for(const i of t.search.unresolvedTokens)r.push(...n(i,e));return 0!==r.length?r.map(t=>(e,n)=>{n.fate=t.fate,n.mapToStorage(t.store),e.search.resolveToken(t.token)}):void 0}}(o.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"CreateHandleGroup",function(){return a});var r=n(35),i=n(34),s=n(176),o=n(43);class a extends r.Strategy{async generate(t){return i.Recipe.over(this.getResults(t),new class extends s.Walker{onRecipe(t,e){if(t.connectionConstraints.length>0)return;const n=t.handleConnections.filter(t=>!t.handle&&!t.isOptional);let r=null;for(const t of n.filter(t=>t.isOutput)){const e=[t];let i=o.Handle.effectiveType(null,e),s=null;const a=new Set([t.particle]);let c=!1;for(const t of n.filter(t=>t.isInput))a.has(t.particle)||null===(s=o.Handle.effectiveType(i,[t]))||(e.push(t),a.add(t.particle),i=s,c=!0);if(c){for(const t of n.filter(t=>t.isOutput))a.has(t.particle)||null===(s=o.Handle.effectiveType(i,[t]))||(e.push(t),a.add(t.particle),i=s);(!r||e.length>r.length)&&(r=e)}}return r?t=>{const e=t.newHandle();e.fate="create";for(const n of r){t.updateToClone({conn:n}).conn.connectToHandle(e)}}:void 0}}(s.Walker.Independent),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"FindHostedParticle",function(){return u});var r=n(35),i=n(34),s=n(176),o=n(3),a=n(4),c=n(173);class u extends r.Strategy{async generate(t){const e=this.arc;return i.Recipe.over(this.getResults(t),new class extends s.Walker{onHandleConnection(t,n){if("host"!==n.direction||n.handle)return;Object(o.assert)(n.type instanceof a.InterfaceType);const r=n.type,i=[];for(const t of e.context.particles){const n=r.interfaceShape.cloneWithResolutions(new Map);!1!==n.restrictType(t)&&(n.canEnsureResolved()&&i.push((n,r)=>{const i=c.RecipeUtil.constructImmediateValueHandle(r,t,e.generateID());Object(o.assert)(i),r.connectToHandle(i)}))}return i}}(s.Walker.Permuted),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"CoalesceRecipes",function(){return l});var r=n(35),i=n(34),s=n(173),o=n(176),a=n(43),c=n(4),u=n(3);class l extends r.Strategy{getResults(t){return t.terminal.filter(t=>!t.result.isResolved()||0===t.result.slots.length)}async generate(t){const e=this.arc,n=this.arc.recipeIndex;return await n.ready,i.Recipe.over(this.getResults(t),new class extends o.Walker{onSlotConnection(t,r){if(r.isResolved())return;if(!r.name||!r.particle)return;if(r.targetSlot)return;const i=[];for(const o of n.findProvidedSlot(r))t.particles.length+o.recipe.particles.length>10||s.RecipeUtil.matchesRecipe(e.activeRecipe,o.recipe)||i.push((t,e)=>{const r=n.findCoalescableHandles(t,o.recipe),{cloneMap:i}=o.recipe.mergeInto(e.recipe),s=i.get(o);return e.connectToSlot(s),this._connectOtherHandles(r,i,!1),t.verbs.splice(0),t.name=null,1});return i.length>0?i:void 0}onSlot(t,r){if(r.consumeConnections.length>0)return;if(!r.sourceConnection||!r.sourceConnection.slotSpec.getProvidedSlotSpec(r.name).isRequired)return;const i=[];for(const{slotConn:o,matchingHandles:a}of n.findConsumeSlotConnectionMatch(r))t.particles.length+o.recipe.particles.length>10||s.RecipeUtil.matchesRecipe(e.activeRecipe,o.recipe)||s.RecipeUtil.matchesRecipe(t,o.recipe)||i.push((t,e)=>{const r=n.findCoalescableHandles(t,o.recipe,new Set(e.handleConnections.map(t=>t.handle).concat(a.map(({handle:t,matchingConn:e})=>e.handle)))),{cloneMap:i}=o.recipe.mergeInto(e.recipe);i.get(o).connectToSlot(e);for(const{handle:n,matchingConn:r}of a){const s=i.get(r).handle,o=e.handleConnections.find(t=>t.handle&&t.handle.id===n.id).handle;if(s!==o){for(;s.connections.length>0;){const t=s.connections[0];t.disconnectHandle(),t.connectToHandle(o)}t.removeHandle(s)}}return this._connectOtherHandles(r,i,!1),t.verbs.splice(0),t.name=null,1});return i.length>0?i:void 0}onHandle(t,r){if(!n.coalescableFates.includes(r.fate)||r.id||0===r.connections.length||"descriptions"===r.name)return;const i=[];for(const o of n.findHandleMatch(r,n.coalescableFates))if(!(t.particles.length+o.recipe.particles.length>10||o.connections.find(t=>"in"===t.direction))){if(o.type.hasVariable){let t=o.type.resolvedType();if((t=t.getContainedType()||t)instanceof c.VariableType&&!t.canReadSubset)continue}s.RecipeUtil.matchesRecipe(e.activeRecipe,o.recipe)||s.RecipeUtil.matchesRecipe(t,o.recipe)||i.push((t,e)=>{const r=n.findCoalescableHandles(t,o.recipe,new Set([e,o])),{cloneMap:i}=o.recipe.mergeInto(e.recipe);return i.get(o).mergeInto(e),this._connectOtherHandles(r,i,!0),t.verbs.splice(0),t.name=null,1})}return i}_connectOtherHandles(t,e,n){t.forEach((t,r)=>{const i=e.get(t);n&&!this._reverifyHandleTypes(r,i)||i.mergeInto(r)})}_reverifyHandleTypes(t,e){Object(u.assert)(t.recipe===e.recipe);const n=new Map;return t.recipe.clone(n).normalize(),a.Handle.effectiveType(n.get(t).type,[...n.get(t).connections,...n.get(e).connections])}}(o.Walker.Independent),this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Speculator",function(){return s});var r=n(3),i=n(221);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(){this._relevanceByHash=new Map}async speculate(t,e,n){if(Object(r.assert)(e.isResolved(),`Cannot speculate on an unresolved plan: ${e.toString({showUnresolved:!0})}`),this._relevanceByHash.has(n)){const r=t.getStoresState({includeContext:!0}),i=this._relevanceByHash.get(n),s=i.arcState;if(e.handles.every(t=>r.get(t.id)===s.get(t.id)))return i}const s=await t.cloneForSpeculativeExecution(),o=new i.Relevance(t.getStoresState({includeContext:!0})),a=this._relevanceByHash;return s.instantiate(e).then(t=>(async function t(){const e=s.pec.messageCount;return o.apply(await s.pec.idle),s.pec.messageCount!==e+2?t():(o.newArc=s,a.set(n,o),o)})())}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Relevance",function(){return r});class r{constructor(t){this.arcState=t,this.relevanceMap=new Map}apply(t){for(const e of t.keys())this.relevanceMap.has(e)?this.relevanceMap.set(e,this.relevanceMap.get(e).concat(t.get(e))):this.relevanceMap.set(e,t.get(e))}calcRelevanceScore(){let t=1,e=!1;for(const n of this.relevanceMap.values()){const i=r.particleRelevance(n);i<0&&(e=!0),t*=Math.abs(i)}return t*(e?-1:1)}isRelevant(t){const e=t.particles.some(t=>Object.keys(t.consumedSlotConnections).length>0);let n=!1;for(const[t,e]of this.relevanceMap)if(!(e[e.length-1]<0)&&Object.keys(t.consumedSlotConnections).length){n=!0;break}return e===n}static scaleRelevance(t){return void 0==t&&(t=5),(t=Math.max(-1,Math.min(t,10)))/5}static particleRelevance(t){let e=1,n=!1;return t.forEach(t=>{const i=r.scaleRelevance(t);i<0&&(n=!0),e*=Math.abs(i)}),e*(n?-1:1)}calcParticleRelevance(t){return this.relevanceMap.has(t)?r.particleRelevance(this.relevanceMap.get(t)):-1}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Suggestion",function(){return o});var r=n(3),i=n(31),s=n(223);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(t,e,n,i){this.descriptionByModality={},this.searchGroups=[],Object(r.assert)(t,"plan cannot be null"),Object(r.assert)(e,"hash cannot be null"),this.plan=t,this.hash=e,this.rank=n,this.arc=i}get descriptionText(){return this.getDescription("text")}getDescription(t){return Object(r.assert)(this.descriptionByModality[t],`No description for modality '${t}'`),this.descriptionByModality[t]}async setDescription(t){this.descriptionByModality.text=await t.getRecipeSuggestion();const e=this.arc.pec.slotComposer&&this.arc.pec.slotComposer.modality;e&&"text"!==e&&(this.descriptionByModality[e]=await t.getRecipeSuggestion(s.Modality.forName(e).descriptionFormatter))}isEquivalent(t){return this.hash===t.hash&&this.descriptionText===t.descriptionText}static compare(t,e){return e.rank-t.rank}hasSearch(t){const e=t.split(" ");return this.searchGroups.some(t=>e.every(e=>t.includes(e)))}setSearch(t){this.searchGroups=[],t&&this._addSearch(t.resolvedTokens)}mergeSearch(t){let e=!1;for(const n of t.searchGroups)this._addSearch(n)&&(1===this.searchGroups.length&&this.searchGroups.push([""]),e=!0);return this.searchGroups.sort(),e}_addSearch(t){return!this.searchGroups.find(e=>((t,e)=>t.length===e.length&&t.every(t=>e.includes(t)))(e,t))&&(this.searchGroups.push(t),!0)}serialize(){return{plan:this._planToString(this.plan),hash:this.hash,rank:this.rank,searchGroups:this.searchGroups,descriptionByModality:this.descriptionByModality}}static async deserialize({plan:t,hash:e,rank:n,searchGroups:r,descriptionByModality:i},s,a){const c=await o._planFromString(t,s,a);if(c){const t=new o(c,e,n,s);return t.searchGroups=r,t.descriptionByModality=i,t}}async instantiate(){if(Object(r.assert)(this.arc,"Cannot instantiate suggestion without and arc"),this.arc)return this.arc.instantiate(this.plan)}_planToString(t){if(t.slots.every(t=>Boolean(t.id)))return t.toString();const e=t.clone();return e.slots.forEach(t=>t.id=t.id||`slotid-${this.arc.generateID()}`),e.toString()}static async _planFromString(t,e,n){try{const s=await i.Manifest.parse(t,{loader:e.loader,context:e.context,fileName:""});Object(r.assert)(1===s.recipes.length);let o=s.recipes[0];if(Object(r.assert)(o.normalize({}),`can't normalize deserialized suggestion: ${o.toString()}`),!o.isResolved()){const t=await n.resolve(o);Object(r.assert)(t,`can't resolve plan: ${o.toString({showUnresolved:!0})}`),t&&(o=t)}for(const t of s.stores)e.context._addStore(t,[]);return o}catch(t){console.error(`Failed to parse suggestion ${t}.`)}return null}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Modality",function(){return u});var r=n(3),i=n(224),s=n(229),o=n(230),a=n(231),c=n(232);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class u{constructor(t,e,n,r){this.name=t,this.slotConsumerClass=e,this.suggestionConsumerClass=n,this.descriptionFormatter=r}static forName(t){return Object(r.assert)(u._modalities[t],`Unsupported modality ${t}`),u._modalities[t]}}u._modalities={dom:new u("dom",i.SlotDomConsumer,s.SuggestDomConsumer,c.DescriptionDomFormatter),"dom-touch":new u("dom-touch",i.SlotDomConsumer,s.SuggestDomConsumer,c.DescriptionDomFormatter),vr:new u("vr",i.SlotDomConsumer,s.SuggestDomConsumer,c.DescriptionDomFormatter),mock:new u("mock",o.MockSlotDomConsumer,a.MockSuggestDomConsumer)}},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotDomConsumer",function(){return c});var r=n(3),i=n(225),s=n(227),o=n(228);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const a=new Map;class c extends i.SlotConsumer{constructor(t,e){super(t,e),this._observer=this._initMutationObserver()}constructRenderRequest(t){const e=["model"],n=[this.templatePrefix];return t&&(n.push(t.consumeConn.particle.name),n.push(t.consumeConn.name)),c.hasTemplate(n.join("::"))||e.push("template"),e}static hasTemplate(t){return[...a.keys()].find(e=>e.startsWith(t))}isSameContainer(t,e){return t.parentNode===e}createNewContainer(t,e){Object(r.assert)(t,"contextContainer cannot be null");const n=document.createElement(this.containerKind||"div");return this.consumeConn&&n.setAttribute("particle-host",this.consumeConn.getQualifiedName()),t.appendChild(n),n.attachShadow({mode:"open"}),s.default.stamp(`<style>${o.default}</style>`).appendTo(n.shadowRoot),n.shadowRoot}deleteContainer(t){(t=t.host||t).parentNode&&t.parentNode.removeChild(t)}formatContent(t,e){const n={};if(Object.keys(t).indexOf("model")>=0)if(t.model){let r;if(!(r=this.slotContext.spec.isSet&&this.consumeConn.slotSpec.isSet?this._modelForSetSlotConsumedAsSetSlot(t.model,e):this.slotContext.spec.isSet&&!this.consumeConn.slotSpec.isSet?this._modelForSetSlotConsumedAsSingletonSlot(t.model,e):this._modelForSingletonSlot(t.model,e)))return null;n.model=Object.assign({},r,t.descriptions)}else n.model=void 0;return t.templateName&&(n.templateName="string"==typeof t.templateName?t.templateName:t.templateName[e],t.template&&(n.template="string"==typeof t.template?t.template:t.template[n.templateName])),n}_modelForSingletonSlot(t,e){return Object(r.assert)(!e,"subId should be absent for a Singleton Slot"),t}_modelForSetSlotConsumedAsSetSlot(t,e){return Object(r.assert)(t.items&&t.items.every(t=>t.subId),"model for a Set Slot consumed as a Set Slot needs to have items array, with every element having subId"),t.items.find(t=>t.subId===e)}_modelForSetSlotConsumedAsSingletonSlot(t,e){return Object(r.assert)(t.subId,"model for a Set Slot consumed as a Singleton Slot needs to have subId"),e===t.subId?t:null}setContainerContent(t,e,n){if(t.container){if(!e||0===Object.keys(e).length)return this.clearContainer(t),void(t.model=null);this._setTemplate(t,this.templatePrefix,e.templateName,e.template),t.model=e.model,this._onUpdate(t)}}clearContainer(t){t.liveDom&&(t.liveDom.root.textContent=""),t.liveDom=null}dispose(){this._observer&&this._observer.disconnect(),this.renderings.forEach(([t,{container:e}])=>this.deleteContainer(e))}static clear(t){t.textContent=""}static dispose(){c.multitenant||a.clear()}static findRootContainers(t){const e={};return Array.from(t.querySelectorAll("[slotid]")).forEach(t=>{const n=t.getAttribute("slotid");Object(r.assert)(!e[n],`Duplicate root slot ${n}`),e[n]=t}),e}createTemplateElement(t){return Object.assign(document.createElement("template"),{innerHTML:t})}get templatePrefix(){return this.consumeConn.getQualifiedName()}_setTemplate(t,e,n,r){n&&(t.templateName=[e,n].filter(t=>t).join("::"),r&&(a.has(t.templateName)&&this.clearContainer(t),a.set(t.templateName,this.createTemplateElement(r))))}_onUpdate(t){if(this._observe(t.container),t.templateName){const e=a.get(t.templateName);Object(r.assert)(e,`No template for ${t.templateName}`),this._stampTemplate(t,e)}this._updateModel(t)}_observe(t){Object(r.assert)(t,"Cannot observe without a container"),this._observer&&this._observer.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["subid"]})}_stampTemplate(t,e){t.liveDom||(t.container._eventMapper=this._eventMapper.bind(this,this.eventHandler),t.liveDom=s.default.stamp(e).events(t.container._eventMapper).appendTo(t.container))}_updateModel(t){t.liveDom&&t.liveDom.set(t.model)}initInnerContainers(t){Array.from(t.querySelectorAll("[slotid]")).forEach(e=>{if(!this.isDirectInnerSlot(t,e))return;const n=this.getNodeValue(e,"slotid"),i=this.providedSlotContexts.find(t=>t.id===n);if(!i)return void console.warn(`Slot ${this.consumeConn.slotSpec.name} has unexpected inner slot ${n}`);const s=this.getNodeValue(e,"subid");Object(r.assert)(Boolean(s)===i.spec.isSet,`Sub-id ${s} for slot ${i.name} doesn't match set spec: ${i.spec.isSet}`),this._initInnerSlotContainer(n,s,e)})}getNodeValue(t,e){return t[e]||t.getAttribute(e)}isDirectInnerSlot(t,e){if(e===t)return!0;const n=t=>t.parentNode;let r=n(e);for(;r;){if(r===t)return!0;if(r.getAttribute&&r.getAttribute("slotid"))return!1;r=n(r)}return!1}_initMutationObserver(){return this.consumeConn?new MutationObserver(async t=>{this._observer.disconnect();const e=new Map;for(const[n,{container:r}]of this.renderings)t.some(t=>this.isDirectInnerSlot(r,t.target))&&e.set(n,r);const n=[...e.values()];n.length>0&&(this._clearInnerSlotContainers([...e.keys()]),n.forEach(t=>this.initInnerContainers(t)),this.updateProvidedContexts(),n.forEach(t=>this._observe(t)))}):null}_eventMapper(t,e,n,r){e.addEventListener(n,n=>{n.stopPropagation();const{altKey:i,ctrlKey:s,metaKey:o,shiftKey:a,code:c,key:u,repeat:l}=n;t({handler:r,data:{key:e.key,value:e.value,keys:{altKey:i,ctrlKey:s,metaKey:o,shiftKey:a,code:c,key:u,repeat:l}}})})}formatHostedContent(t,e){if(e.templateName){if("string"!=typeof e.templateName)throw new Error("TODO: Implement this!");e.templateName=`${t.consumeConn.particle.name}::${t.consumeConn.name}::${e.templateName}`}return e}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotConsumer",function(){return s});var r=n(3),i=n(226);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(t,e){this.providedSlotContexts=[],this._renderingBySubId=new Map,this.innerContainerBySlotId={},this._consumeConn=t,this.containerKind=e}get consumeConn(){return this._consumeConn}getRendering(t){return this._renderingBySubId.get(t)}get renderings(){return[...this._renderingBySubId.entries()]}addRenderingBySubId(t,e){this._renderingBySubId.set(t,e)}onContainerUpdate(t,e){if(Boolean(t)!==Boolean(e)&&(t?this.startRender():this.stopRender()),t!==e){const t=new Map;this.slotContext&&this.slotContext.spec.isSet?Object.keys(this.slotContext.container||{}).forEach(e=>t.set(e,this.slotContext.container[e])):t.set(void 0,this.slotContext.container);for(const[e,n]of t){this._renderingBySubId.has(e)||this._renderingBySubId.set(e,{});const t=this.getRendering(e);t.container&&this.isSameContainer(t.container,n)||(t.container&&this.clearContainer(t),t.container=this.createNewContainer(n,e))}for(const[e,n]of this.renderings)t.has(e)||(this.deleteContainer(n.container),this._renderingBySubId.delete(e))}}createProvidedContexts(){return this.consumeConn.slotSpec.providedSlots.map(t=>new i.SlotContext(this.consumeConn.providedSlots[t.name].id,t.name,[],null,t,this))}updateProvidedContexts(){this.providedSlotContexts.forEach(t=>{t.container=this.getInnerContainer(t.id)})}startRender(){this.consumeConn&&this.startRenderCallback&&this.startRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name,providedSlots:new Map(this.providedSlotContexts.map(t=>[t.name,t.id])),contentTypes:this.constructRenderRequest()})}stopRender(){this.consumeConn&&this.stopRenderCallback&&this.stopRenderCallback({particle:this.consumeConn.particle,slotName:this.consumeConn.name})}async setContent(t,e,n){t&&Object.keys(t).length>0&&n&&(t.descriptions=await this.populateHandleDescriptions(n)),this.eventHandler=e;for(const[e,n]of this.renderings)this.setContainerContent(n,this.formatContent(t,e),e)}async populateHandleDescriptions(t){const e={};return await Promise.all(Object.values(this.consumeConn.particle.connections).map(async n=>{n.handle&&(e[`${n.name}.description`]=(await t.description.getHandleDescription(n.handle)).toString())})),e}getInnerContainer(t){return this.innerContainerBySlotId[t]}_initInnerSlotContainer(t,e,n){e?(this.innerContainerBySlotId[t]||(this.innerContainerBySlotId[t]={}),Object(r.assert)(!this.innerContainerBySlotId[t][e],`Multiple ${t}:${e} inner slots cannot be provided`),this.innerContainerBySlotId[t][e]=n):this.innerContainerBySlotId[t]=n}_clearInnerSlotContainers(t){t.forEach(t=>{t?Object.values(this.innerContainerBySlotId).forEach(e=>delete e[t]):this.innerContainerBySlotId={}})}isSameContainer(t,e){return t===e}get hostedConsumers(){return this.providedSlotContexts.filter(t=>"HostedSlotContext"===t.constructor.name).map(t=>t.sourceSlotConsumer).filter(t=>t!==this)}constructRenderRequest(t=null){return[]}dispose(){}createNewContainer(t,e){return null}deleteContainer(t){}clearContainer(t){}setContainerContent(t,e,n){}formatContent(t,e){return null}formatHostedContent(t,e){return null}static clear(t){}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotContext",function(){return s});var r=n(3),i=n(12);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(t,e,n,s,o,a=null){this.tags=[],this.slotConsumers=[],Object(r.assert)(Boolean(s)!==Boolean(o),"Exactly one of either container or slotSpec may be set"),Object(r.assert)(Boolean(o)==Boolean(o),"Spec and source slot can only be set together"),this.id=t,this.name=e,this.tags=n||[],this._container=s,this.spec=o||new i.ProvidedSlotSpec({name:e}),this.sourceSlotConsumer=a,this.sourceSlotConsumer&&this.sourceSlotConsumer.providedSlotContexts.push(this),this.handles=this.spec&&this.sourceSlotConsumer?this.spec.handles.map(t=>this.sourceSlotConsumer.consumeConn.particle.connections[t].handle).filter(t=>void 0!==t):[]}get container(){return this._container}static createContextForContainer(t,e,n,r){return new s(t,e,r,n,null)}isSameContainer(t){return this.spec.isSet?Boolean(this.container)===Boolean(t)&&(!this.container||Object.keys(this.container).length===Object.keys(t).length&&Object.keys(this.container).every(e=>Object.keys(t).some(t=>t===e))&&Object.values(this.container).every(e=>Object.values(t).some(t=>t===e))):this.container===t}set container(t){if(this.isSameContainer(t))return;const e=this.container;this._container=t,this.slotConsumers.forEach(t=>t.onContainerUpdate(this.container,e))}addSlotConsumer(t){this.slotConsumers.push(t),t.slotContext=this,this.container&&t.onContainerUpdate(this.container,null)}clearSlotConsumers(){this.slotConsumers.forEach(t=>t.slotContext=null),this.slotConsumers=[]}}},function(t,e,n){"use strict";n.r(e),
/*
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
"undefined"==typeof document||"currentImport"in document||Object.defineProperty(document,"currentImport",{get(){const t=this.currentScript;let e=t.ownerDocument||this;return window.HTMLImports&&((e=window.HTMLImports.importForElement(t)).URL=t.parentElement.href),e}});const r=function(t,e,n){n=n||[];for(const i in e){const s=e[i];if(s){const e=t.childNodes[i];n[s.key]=e.nodeType===Node.TEXT_NODE?e.parentElement:e,s.sub&&r(e,s.sub,n)}}return n},i=function(t,e,n){if(o(t,e,n,"textContent",t.textContent))return t.textContent="",!0},s=function(t,e,n){if(t.hasAttributes()){let r=!1;for(let i,s=t.attributes,c=s.length-1;c>=0&&(i=s[c]);c--)(a(t,e,n,i.name,i.value)||o(t,e,n,i.name,i.value))&&(t.removeAttribute(i.name),r=!0);return r}},o=function(t,e,n,r,i){if("{{"===i.slice(0,2)){"class"===r&&(r="className");let t=i.slice(2,-2);const s=t.split(":");return 2===s.length&&(r=s[0],t=s[1]),c(n,e,"mustaches",r,t),"$"===t[0]&&c(n,"xlate",t,!0),!0}},a=function(t,e,n,r,i){if("on-"===r.slice(0,3))return"{{"===i.slice(0,2)&&(i=i.slice(2,-2),console.warn(`Xen: event handler for '${r}' expressed as a mustache, which is not supported. Using literal value '${i}' instead.`)),c(n,e,"events",r.slice(3),i),!0},c=function(t,e,n,r,i){const s=t[e]||(t[e]=Object.create(null));(s[n]||(s[n]={}))[r]=i},u=new class{constructor(t){this.cb=t}annotate(t,e,n){return this.notes=e,this.opts=n||0,this.key=this.opts.key||0,e.locator=this._annotateSubtree(t),e}_annotateSubtree(t){let e;for(let n,r=0,i=t.firstChild,s=null;i;r++){const o=this._annotateNode(i);o&&((e=e||{})[r]=o),(n=s?s.nextSibling:t.firstChild)===i?(s=i,i=i.nextSibling):(i=n,r--)}return e}_annotateNode(t){const e=this.key++,n=this.cb(t,e,this.notes,this.opts),r=this._annotateSubtree(t);if(n||r){const t=Object.create(null);return t.key=e,r&&(t.sub=r),t}}}(function(t,e,n,r){if(r.annotator&&r.annotator(t,e,n,r))return!0;switch(t.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:return;case Node.ELEMENT_NODE:return s(t,e,n);case Node.TEXT_NODE:return i(t,e,n)}}),l=function(t,e,n,r){const i=e.slice(-1);if("style%"===e||"style"===e||"xen:style"===e)"string"==typeof n?t.style.cssText=n:Object.assign(t.style,n);else if("$"==i){const r=e.slice(0,-1);"boolean"==typeof n||void 0===n?h(t,r,Boolean(n)):t.setAttribute(r,n)}else"textContent"===e?n&&(n.$template||n.template)?d(t,n,r):t.textContent=n||"":"unsafe-html"===e?t.innerHTML=n||"":"value"===e?t.value!==n&&(t.value=n):t[e]=n},h=function(t,e,n){t[(void 0===n?!t.hasAttribute(e):n)?"setAttribute":"removeAttribute"](e,"")},d=function(t,e,n){let{template:r,models:i}=e;if(r)r=g(r);else{r=t.getRootNode().querySelector(`template[${e.$template}]`)}f(t,n,r,i)},f=function(t,e,n,r){let i,s=t.firstElementChild;for(n&&r&&r&&r.forEach((r,o)=>{if(i=s&&s.nextElementSibling,!s){const r=p(n).events(e);(s=r.root.firstElementChild)&&(s._subtreeDom=r,t.appendChild(s),!n._shapeWarning&&r.root.firstElementChild&&(n._shapeWarning=!0,console.warn("xen-template: subtemplate has multiple root nodes: only the first is used.",n)))}s&&(s._subtreeDom.set(r),s=i)});s;)i=s.nextElementSibling,s.remove(),s=i},p=function(t,e){const n=function(t,e,n){return t._notes||(t._notes=u.annotate(t.content,{},e,n))}(t=g(t),e),i=document.importNode(t.content,!0),s=r(i,n.locator);return{root:i,notes:n,map:s,$(t){return this.root.querySelector(t)},set:function(t){return t&&function(t,e,n,r){if(n)for(const i in t){const s=e[i];if(s){s.scope=n;const e=t[i].mustaches;for(const t in e){const i=e[t];i in n&&l(s,t,n[i],r)}}}}(n,s,t,this.controller),this},events:function(t){return t&&"function"!=typeof t&&(t=function(t,e,n,r){e.addEventListener(n,function(e){if(t[r])return t[r](e,e.detail)})}.bind(this,t)),this.controller=t,t&&function(t,e,n){for(const r in t){const i=e[r],s=t[r]&&t[r].events;if(i&&s)for(const t in s)n(i,t,s[t])}}(n,s,t),this},appendTo:function(t){return this.root?t.appendChild(this.root):console.warn("Xen: cannot appendTo, template stamped no DOM"),this.root=t,this}}},g=t=>"string"==typeof t?y(t):t,y=t=>Object.assign(document.createElement("template"),{innerHTML:t});e.default={createTemplate:y,setBoolAttribute:h,stamp:p}},function(t,e,n){"use strict";n.r(e),e.default='\n  icon {\n    font-family: "Material Icons";\n    font-size: 24px;\n    font-style: normal;\n    -webkit-font-feature-settings: "liga";\n    -webkit-font-smoothing: antialiased;\n    cursor: pointer;\n    user-select: none;\n    flex-shrink: 0;\n    /* partial FOUC prevention */\n    display: inline-block;\n    width: 24px;\n    height: 24px;\n    overflow: hidden;\n  }\n  icon[hidden] {\n    /* required because of display rule above,\n    display rule required for overflow: hidden */\n    display: none;\n  }\n'},function(t,e,n){"use strict";n.r(e),n.d(e,"SuggestDomConsumer",function(){return i});var r=n(224);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i extends r.SlotDomConsumer{constructor(t,e,n,r){super(null,t),this._suggestion=e,this._suggestionContent=n,this._eventHandler=r}get suggestion(){return this._suggestion}get templatePrefix(){return"suggest"}formatContent(t){return{template:`<suggestion-element inline key="{{hash}}" on-click="">${t.template}</suggestion-element>`,templateName:"suggestion",model:Object.assign({hash:this.suggestion.hash},t.model)}}onContainerUpdate(t,e){super.onContainerUpdate(t,e),t&&this.setContent(this._suggestionContent,this._eventHandler)}static render(t,e,n){const i=Object.assign(document.createElement("suggestion-element"),{plan:e});t.appendChild(i,t.firstElementChild);const s={container:i,model:n.model},o=new r.SlotDomConsumer;return o.addRenderingBySubId(void 0,s),o.eventHandler=(()=>{}),o._stampTemplate(s,o.createTemplateElement(n.template)),o._onUpdate(s),o}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MockSlotDomConsumer",function(){return s});var r=n(3),i=n(224);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s extends i.SlotDomConsumer{constructor(t){super(t),this._content={},this.contentAvailable=new Promise(t=>this._contentAvailableResolve=t)}async setContent(t,e){await super.setContent(t,e),t?(this._content.templateName=t.templateName,t.template&&(this._content.template=t.template),this._content.model=t.model,this._contentAvailableResolve()):this._content={}}createNewContainer(t,e){return t}isSameContainer(t,e){return t==e}getInnerContainer(t){const e=this.renderings.map(([t,{model:e}])=>e)[0],n=this.providedSlotContexts.find(e=>e.id===t);if(n){if(n.spec.isSet&&e&&e.items&&e.items.models){const t={};for(const n of e.items.models)Object(r.assert)(n.id),t[n.id]=n.id;return t}return t}console.warn(`Cannot find provided spec for ${t} in ${this.consumeConn.getQualifiedName()}`)}createTemplateElement(t){return t}static findRootContainers(t){return t}static clear(t){}_onUpdate(t){}_stampTemplate(t){}_initMutationObserver(){}_observe(){}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MockSuggestDomConsumer",function(){return i});n(3);var r=n(230);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class i extends r.MockSlotDomConsumer{constructor(t,e,n,r){super(null,t),this._suggestion=e,this._suggestionContent=n.template?n:{template:`<dummy-suggestion>${n}</dummy-element>`,templateName:"dummy-suggestion",model:{}},this._setContentPromise=null}get suggestion(){return this._suggestion}get templatePrefix(){return"suggest"}onContainerUpdate(t,e){super.onContainerUpdate(t,e),t&&(this._setContentPromise=this.setContent(this._suggestionContent,this._eventHandler))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"DescriptionDomFormatter",function(){return s});var r=n(3),i=n(180);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s extends i.DescriptionFormatter{constructor(){super(...arguments),this.nextID=0}_isSelectedDescription(t){return super._isSelectedDescription(t)||!!t.template&&!!t.model}_populateParticleDescription(t,e){const n=super._populateParticleDescription(t,e);return e._template_?Object.assign({},n,{template:e._template_,model:JSON.parse(e._model_)}):n}async _combineSelectedDescriptions(t,e){const n=new Map;for(const r of t){if(this.seenParticles.has(r._particle))continue;let{template:t,model:i}=this._retrieveTemplateAndModel(r,n.size,e||{});(await Promise.all(Object.keys(i).map(async e=>{const n=this._initSubTokens(i[e],r);return(await Promise.all(n.map(async n=>{const r=await this.tokenToString(n);if(void 0==r)return!1;if(r&&r.template&&r.model)t=t.replace(`{{${e}}}`,r.template),delete i[e],i=Object.assign({},i,r.model);else{const n=`${e}${++this.nextID}`;t=t.replace(`{{${e}}}`,`{{${n}}}`),delete i[e],i[n]=r}return!0}))).every(t=>!!t)}))).every(t=>!!t)&&n.set(r,{template:t,model:i})}const r=[];if(t.forEach(t=>{n.has(t)&&r.push(n.get(t))}),r.length>0){const t=this._joinDescriptions(r);return e&&e.skipFormatting||(t.template+="."),t}}_retrieveTemplateAndModel(t,e,n){if(t.template&&t.model)return{template:t.template,model:t.model};Object(r.assert)(t.pattern,"Description must contain template and model, or pattern");let i="";const s={};return this._initTokens(t.pattern,t).forEach((t,r)=>{if(t.text)i=i.concat(`${0!==e||0!==r||n.skipFormatting?t.text:t.text[0].toUpperCase()+t.text.slice(1)}`);else{const e=t.fullName.replace(/[.{}_$]/g,"");let o="";0!==r||n.skipFormatting||(i=i.concat("<style>\n            [firstletter]::first-letter { text-transform: capitalize; }\n            [firstletter] {display: inline-block}\n            </style>"),o=" firstletter"),i=i.concat(`<span${o}>{{${e}}}</span>`),s[e]=t.fullName}}),{template:i,model:s}}_capitalizeAndPunctuate(t){if("string"==typeof t)return{template:super._capitalizeAndPunctuate(t),model:{}};const e=t.template.match(/<[a-zA-Z0-9]+>{{([a-zA-Z0-9]*)}}<\/[a-zA-Z0-9]+>/);if(e&&e.length>1&&t.model[e[1]]){const n=t.model[e[1]];n.length>0&&(t.model[e[1]]=`${n[0].toUpperCase()}${n.substr(1)}`)}return t.template+=".",t}_joinDescriptions(t){if(t.every(t=>"string"==typeof t))return super._joinDescriptions(t);const e={template:"",model:{}},n=t.length;return t.forEach((t,r)=>{let i;"string"==typeof t&&(t={template:t,model:{}}),e.template+=t.template,e.model=Object.assign({},e.model,t.model),r<n-2?i=", ":r===n-2&&(i=["",""," and ",", and "][Math.min(3,n)]),i&&(e.template+=i)}),e}_joinTokens(t){if(t.every(t=>"string"==typeof t))return super._joinTokens(t);const e=(t=t.map(t=>"object"!=typeof t?{template:`<span>{{text${++this.nextID}}}</span>`,model:{[`text${this.nextID}`]:t}}:t)).filter(t=>t&&!!t.template&&!!t.model);return{template:e.map(t=>t.template).join(""),model:e.map(t=>t.model).reduce((t,e)=>Object.assign({},t,e),{})}}_combineDescriptionAndValue(t,e,n){if(e.template&&e.model)return{template:`${e.template} (${n.template})`,model:Object.assign({},e.model,n.model)};const r=`${t.handleName}Description${++this.nextID}`;return{template:`<span>{{${r}}}</span> (${n.template})`,model:Object.assign({[r]:e},n.model)}}_formatEntityProperty(t,e,n){const r=`${t}${e.join("")}Value${++this.nextID}`;return{template:`<b>{{${r}}}</b>`,model:{[`${r}`]:n}}}_formatCollection(t,e){const n=`${t}${++this.nextID}`;return e[0].rawData.name?e.length>2?{template:`<b>{{${n}FirstName}}</b> plus <b>{{${n}OtherCount}}</b> other items`,model:{[`${n}FirstName`]:e[0].rawData.name,[`${n}OtherCount`]:e.length-1}}:{template:e.map((t,e)=>`<b>{{${n}${e}}}</b>`).join(", "),model:Object.assign({},...e.map((t,e)=>({[`${n}${e}`]:t.rawData.name})))}:{template:`<b>{{${n}Length}}</b> items`,model:{[`${n}Length`]:e.length}}}_formatBigCollection(t,e){return{template:`collection of items like {{${t}FirstName}}`,model:{[`${t}FirstName`]:e.rawData.name}}}_formatSingleton(t,e,n){const r=super._formatSingleton(t,e,n);if(r)return{template:`<b>{{${t}Var}}</b>`,model:{[`${t}Var`]:r}}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"ArcStoresFetcher",function(){return r});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{constructor(t,e){this._arc=t,e.listen(t,"fetch-stores",async()=>e.send({messageType:"fetch-stores-result",messageBody:await this._listStores()}))}async _listStores(){const t=e=>{let n=[...e.storeTags];return e.imports&&e.imports.forEach(e=>n=n.concat(t(e))),n};return{arcStores:await this._digestStores(this._arc.storeTags),contextStores:await this._digestStores(t(this._arc.context))}}async _digestStores(t){const e=[];for(const[n,r]of t){let t="(don't know how to dereference)";n.toList?t=await n.toList():n.get&&(t=await n.get()),e.push({name:n.name,tags:r?[...r]:[],id:n.id,storage:n.storageKey,type:n.type,description:n.description,value:t})}return e}}},function(t,e,n){"use strict";n.r(e),n.d(e,"RecipeIndex",function(){return C});var r=n(31),i=n(2),s=n(235),o=n(35),a=n(238),c=n(46),u=n(203),l=n(213),h=n(175),d=n(217),f=n(208),p=n(202),g=n(178),y=n(26),v=n(173),m=n(43),_=n(3),b=n(239);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class w extends o.Strategy{constructor(t,e){super(),this._recipes=[];for(let n of t.allRecipes){if(e&&void 0!==n.particles.find(t=>t.spec&&!t.spec.matchModality(e)))continue;n=n.clone();const t={errors:new Map};n.normalize(t)?this._recipes.push(n):console.warn(`could not normalize a context recipe: ${[...t.errors.values()].join("\n")}.\n${n.toString()}`)}}async generate({generation:t}){return 0!==t?[]:this._recipes.map(t=>({result:t,score:1,derivation:[{strategy:this,parent:void 0}],hash:t.digest(),valid:Object.isFrozen(t)}))}}const S=[u.ConvertConstraintsToConnections,f.AddMissingHandles,h.ResolveRecipe,l.MatchFreeHandlesToConnections,d.CreateHandleGroup];class C{constructor(t,e,n){this._isReady=!1;const u=c.Tracing.start({cat:"indexing",name:"RecipeIndex::constructor",overview:!0}),l=new i.Arc({id:"index-stub",context:new r.Manifest({id:"empty-context"}),loader:e,slotComposer:n?new s.SlotComposer({modality:n,noRoot:!0}):null,recipeIndex:this,speculative:!0}),h=new o.Strategizer([new w(t,n),...S.map(t=>new t(l))],[],p.Empty);this.ready=u.endWith(new Promise(async t=>{const e=[];do{const t=await h.generate();e.push({record:t,generated:h.generated})}while(h.generated.length+h.terminal.length>0);y.DevtoolsConnection.isConnected&&a.StrategyExplorerAdapter.processGenerations(b.PlanningResult.formatSerializableGenerations(e),y.DevtoolsConnection.get(),{label:"Index",keep:!0});const n=h.population,r=new Set(n);for(const t of n)for(const e of t.derivation)e.parent&&r.delete(e.parent);this._recipes=[...r].map(t=>t.result),this._isReady=!0,t(!0)}))}get recipes(){if(!this._isReady)throw Error("await on recipeIndex.ready before accessing");return this._recipes}ensureReady(){Object(_.assert)(this._isReady,"await on recipeIndex.ready before accessing")}findHandleMatch(t,e){this.ensureReady();const n=t.connections.map(t=>t.particle.name),r=[];for(const i of this._recipes)if(!i.particles.some(t=>!t.name))for(const s of i.handles){if(e&&!e.includes(s.fate))continue;if(!this.doesHandleMatch(t,s))continue;const i=s.connections.map(t=>t.particle.name);new Set([...n,...i]).size===n.length&&n.length===i.length||r.push(s)}return r}doesHandleMatch(t,e){if(Boolean(t.id)&&Boolean(e.id)&&t.id!==e.id)return!1;if(0===e.connections.length||"descriptions"===e.localName)return!1;const n=[t.originalFate,t.fate,e.originalFate,e.fate];if(!n.includes("copy")&&!n.includes("map")){const n=v.RecipeUtil.directionCounts(t),r=v.RecipeUtil.directionCounts(e);if(r.in+n.in===0||r.out+n.out===0)return!1}return!(t.tags.length>0&&!t.tags.some(t=>e.tags.includes(t)))&&!!m.Handle.effectiveType(t.mappedType,[...t.connections,...e.connections])}findConsumeSlotConnectionMatch(t){this.ensureReady();const e=[];for(const n of this._recipes)if(!n.particles.some(t=>!t.name))for(const r of n.slotConnections)if(!r.targetSlot&&g.MapSlots.specMatch(r,t)&&g.MapSlots.tagsOrNameMatch(r,t)){const n=[];if(!g.MapSlots.handlesMatch(r,t)&&(t.handleConnections.forEach(t=>{Object.values(r.particle.connections).filter(e=>"host"!==e.direction&&(!e.handle||!e.handle.id||e.handle.id===t.handle.id)&&m.Handle.effectiveType(t.handle.mappedType,[e])).forEach(e=>{this._fatesAndDirectionsMatch(t,e)&&n.push({handle:t.handle,matchingConn:e})})}),0===n.length))continue;e.push({slotConn:r,matchingHandles:n})}return e}findProvidedSlot(t){this.ensureReady();const e=[];for(const n of this._recipes)if(!n.particles.some(t=>!t.name))for(const r of n.slotConnections)for(const n of Object.values(r.providedSlots))g.MapSlots.slotMatches(t,n)&&e.push(n);return e}_fatesAndDirectionsMatch(t,e){const n=e.handle,r=(n?n.connections:[e]).find(t=>["out","inout"].includes(t.direction));switch(t.handle.fate){case"create":case"use":return!n||["use","?"].includes(n.fate);case"copy":return!n||"create"!==n.fate;case"map":return!(r||n&&"copy"===n.fate);case"?":return!1;default:throw new Error(`Unexpected fate ${t.handle.fate}`)}}get coalescableFates(){return["create","use","?"]}findCoalescableHandles(t,e,n){Object(_.assert)(t!==e,"Cannot coalesce handles in the same recipe");const r=new Map;n=n||new Set;for(const i of t.handles)if(!n.has(i)&&this.coalescableFates.includes(i.fate))for(const t of e.handles)!n.has(t)&&this.coalescableFates.includes(t.fate)&&this.doesHandleMatch(i,t)&&(r.set(i,t),n.add(i),n.add(t));return r}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SlotComposer",function(){return a});var r=n(3),i=n(223),s=n(226),o=n(236);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a{constructor(t){if(this._consumers=[],this._contexts=[],Object(r.assert)(t.modality,"Modality is mandatory"),t.rootContainer=t.rootContainer||t.rootContext||(t.containers||Object).root,Object(r.assert)(void 0!==t.rootContainer!=(!0===t.noRoot),"Root container is mandatory unless it is explicitly skipped"),this._containerKind=t.containerKind,this._modality=i.Modality.forName(t.modality),Object(r.assert)(this._modality.slotConsumerClass),t.noRoot)return;const e=t.containers||this._modality.slotConsumerClass.findRootContainers(t.rootContainer)||{};0===Object.keys(e).length&&(e.root=t.rootContainer),Object.keys(e).forEach(t=>{this._contexts.push(s.SlotContext.createContextForContainer(`rootslotid-${t}`,t,e[t],[`${t}`]))})}get modality(){return this._modality.name}get consumers(){return this._consumers}get containerKind(){return this._containerKind}getSlotConsumer(t,e){return this.consumers.find(n=>n.consumeConn.particle===t&&n.consumeConn.name===e)}findContainerByName(t){const e=this._contexts.filter(e=>e.name===t);if(0===e.length)console.warn(`No containers for '${t}'`);else if(1===e.length)return e[0].container;console.warn(`Ambiguous containers for '${t}'`)}findContextById(t){return this._contexts.find(({id:e})=>e===t)}createHostedSlot(t,e,n,i,s){const a=this.arc.generateID(),c=this.getSlotConsumer(t,e);Object(r.assert)(c,`Unexpected transformation slot particle ${t.name}:${e}, hosted particle ${n}, slot name ${i}`);const u=new o.HostedSlotConsumer(c,n,i,a,s,this.arc);return u.renderCallback=this.arc.pec.innerArcRender.bind(this.arc.pec),this._addSlotConsumer(u),this.findContextById(c.consumeConn.targetSlot.id).addSlotConsumer(u),a}_addSlotConsumer(t){t.startRenderCallback=this.arc.pec.startRender.bind(this.arc.pec),t.stopRenderCallback=this.arc.pec.stopRender.bind(this.arc.pec),this._consumers.push(t)}initializeRecipe(t){const e=[];t.forEach(t=>{Object.values(t.consumedSlotConnections).forEach(n=>{if(!n.targetSlot)return void Object(r.assert)(!n.slotSpec.isRequired,`No target slot for particle's ${t.name} required consumed slot: ${n.name}.`);let i=this.consumers.find(t=>t instanceof o.HostedSlotConsumer&&t.hostedSlotId===n.targetSlot.id),s=null;i&&i instanceof o.HostedSlotConsumer?(i.consumeConn=n,s=i.transformationSlotConsumer):(i=new this._modality.slotConsumerClass(n,this._containerKind),e.push(i));const a=i.createProvidedContexts();this._contexts=this._contexts.concat(a),s&&(s.providedSlotContexts.push(...a),s.slotContext.container&&i.startRender())})}),e.forEach(t=>{this._addSlotConsumer(t);const e=this.findContextById(t.consumeConn.targetSlot.id);Object(r.assert)(e,`No context found for ${t.consumeConn.getQualifiedName()}`),e.addSlotConsumer(t)})}async renderSlot(t,e,n){const i=this.getSlotConsumer(t,e);Object(r.assert)(i,`Cannot find slot (or hosted slot) ${e} for particle ${t.name}`),await i.setContent(n,async n=>{if(this.arc.pec.sendEvent(t,e,n),n.data&&n.data.key){const t=this.consumers.filter(t=>t instanceof o.HostedSlotConsumer&&t.transformationSlotConsumer===i);for(const e of t)if(e instanceof o.HostedSlotConsumer&&e.storeId){const t=this.arc.findStoreById(e.storeId);Object(r.assert)(t);const i=await t.get();i&&i.id===n.data.key&&this.arc.pec.sendEvent(e.consumeConn.particle,e.consumeConn.name,n)}}},this.arc)}getAvailableContexts(){return this._contexts}dispose(){this.consumers.forEach(t=>t.dispose()),this._modality.slotConsumerClass.dispose(),this._contexts.forEach(t=>{t.clearSlotConsumers(),t.container&&this._modality.slotConsumerClass.clear(t.container)}),this._contexts=this._contexts.filter(t=>!t.sourceSlotConsumer),this._consumers=[]}}},function(t,e,n){"use strict";n.r(e),n.d(e,"HostedSlotConsumer",function(){return o});var r=n(3),i=n(225),s=n(237);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o extends i.SlotConsumer{constructor(t,e,n,r,i,s){super(null,null),this.transformationSlotConsumer=t,this.hostedParticleName=e,this.hostedSlotName=n,this.hostedSlotId=r,this.storeId=i,this._arc=s}get arc(){return this._arc}get consumeConn(){return this._consumeConn}set consumeConn(t){Object(r.assert)(!this._consumeConn,"Consume connection can be set only once"),Object(r.assert)(this.hostedSlotId===t.targetSlot.id,`Expected target slot ${this.hostedSlotId}, but got ${t.targetSlot.id}`),Object(r.assert)(this.hostedParticleName===t.particle.name,`Expected particle ${this.hostedParticleName} for slot ${this.hostedSlotId}, but got ${t.particle.name}`),Object(r.assert)(this.hostedSlotName===t.name,`Expected slot ${this.hostedSlotName} for slot ${this.hostedSlotId}, but got ${t.name}`),this._consumeConn=t}async setContent(t,e,n){return this.renderCallback&&this.renderCallback(this.transformationSlotConsumer.consumeConn.particle,this.transformationSlotConsumer.consumeConn.name,this.hostedSlotId,this.transformationSlotConsumer.formatHostedContent(this,t)),null}constructRenderRequest(){return this.transformationSlotConsumer.constructRenderRequest(this)}getInnerContainer(t){const e=this.transformationSlotConsumer.getInnerContainer(t);if(e&&this.storeId){return e[this.arc.findStoreById(this.storeId)._stored.id]}return e}createProvidedContexts(){return Object(r.assert)(this.consumeConn,`Cannot create provided context without consume connection for hosted slot ${this.hostedSlotId}`),this.consumeConn.slotSpec.providedSlots.map(t=>new s.HostedSlotContext(this.consumeConn.providedSlots[t.name].id,t,this))}updateProvidedContexts(){}}},function(t,e,n){"use strict";n.r(e),n.d(e,"HostedSlotContext",function(){return o});var r=n(3),i=n(226),s=n(236);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o extends i.SlotContext{constructor(t,e,n){super(t,e.name,e.tags,null,e,n),Object(r.assert)(this.sourceSlotConsumer instanceof s.HostedSlotConsumer);const i=this.sourceSlotConsumer;i.storeId&&(this.handles=[{id:i.storeId}])}}},function(t,e,n){"use strict";n.r(e),n.d(e,"StrategyExplorerAdapter",function(){return r});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class r{static processGenerations(t,e,n={}){e.send({messageType:"generations",messageBody:{results:t,options:n}})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PlanningResult",function(){return o});var r=n(3),i=n(174),s=n(222);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(t,e={}){this.contextual=!0,Object(r.assert)(t,"Arc cannot be null"),this.arc=t,this._suggestions=e.suggestions,this.lastUpdated=e.lastUpdated||new Date(null),this.generations=e.generations||[]}get suggestions(){return this._suggestions||[]}set suggestions(t){Object(r.assert)(Boolean(t),"Cannot set uninitialized suggestions"),this._suggestions=t}static formatSerializableGenerations(t){const e=new Map;let n=0;const r=t=>{e.set(t,n);const{result:r,score:i,derivation:s,description:o,hash:a,valid:c,active:u,irrelevant:l}=t;return{result:r.toString({showUnresolved:!0,showInvalid:!1,details:""}),resolved:r.isResolved(),score:i,derivation:s,description:o,hash:a,valid:c,active:u,irrelevant:l,id:n++}};return(t=t.map(t=>({record:t.record,generated:t.generated.map(r)}))).map(t=>{const n=t.generated,r=t.record;r.resolvedDerivations=0,r.resolvedDerivationsByStrategy={},n.forEach(t=>{if(t.derivation=t.derivation.map(t=>{let n,r;return t.parent&&(n=e.get(t.parent)),t.strategy&&(r=t.strategy.constructor.name),{parent:n,strategy:r}}),t.resolved){r.resolvedDerivations++;const e=t.derivation[0].strategy;void 0===r.resolvedDerivationsByStrategy[e]&&(r.resolvedDerivationsByStrategy[e]=0),r.resolvedDerivationsByStrategy[e]++}});const i={};n.forEach(t=>{void 0==i[t.derivation[0].strategy]&&(i[t.derivation[0].strategy]=[]),i[t.derivation[0].strategy].push(t)});const s={population:[],record:r};return Object.keys(i).forEach(t=>{s.population.push({strategy:t,recipes:i[t]})}),s})}set({suggestions:t,lastUpdated:e=new Date,generations:n=[],contextual:r=!0}){return!this.isEquivalent(t)&&(this.suggestions=t,this.generations=n,this.lastUpdated=e,this.contextual=r,!0)}append({suggestions:t,lastUpdated:e=new Date,generations:n=[]}){const r=[];let i=!1;for(const e of t){const t=this.suggestions.find(t=>t.isEquivalent(e));t?i=t.mergeSearch(e):r.push(e)}if(r.length>0)this.suggestions=this.suggestions.concat(r);else if(!i)return!1;return this.generations.push(...n),this.lastUpdated=e,!0}olderThan(t){return this.lastUpdated<t.lastUpdated}isEquivalent(t){return o.isEquivalent(this._suggestions,t)}static isEquivalent(t,e){return Object(r.assert)(e,"New suggestions cannot be null."),t&&t.length===e.length&&t.every(t=>e.find(e=>t.isEquivalent(e)))}async deserialize({suggestions:t,generations:e,lastUpdated:n}){const r=new i.RecipeResolver(this.arc);return this.set({suggestions:(await Promise.all(t.map(t=>s.Suggestion.deserialize(t,this.arc,r)))).filter(t=>t),generations:JSON.parse(e||"[]"),lastUpdated:new Date(n),contextual:t.contextual})}serialize(){return{suggestions:this.suggestions.map(t=>t.serialize()),generations:JSON.stringify(this.generations),lastUpdated:this.lastUpdated.toString(),contextual:this.contextual}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Planificator",function(){return u});var r=n(3),i=n(241),s=n(243),o=n(245),a=n(5),c=n(4);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class u{constructor(t,e,n,r,a,c){this.search=null,this.arcCallback=this._onPlanInstantiated.bind(this),this.arc=t,this.userid=e,this.searchStore=r,a||(this.producer=new s.PlanProducer(t,n,r,{debug:c}),this.replanQueue=new o.ReplanQueue(this.producer),this.dataChangeCallback=(()=>this.replanQueue.addChange()),this._listenToArcStores()),this.consumer=new i.PlanConsumer(t,n),this.lastActivatedPlan=null,this.arc.registerInstantiatePlanCallback(this.arcCallback)}static async create(t,{userid:e,protocol:n,onlyConsumer:r,debug:i=!1}){i=i||"volatile"===n;const s=await u._initSuggestStore(t,{userid:e,protocol:n,arcKey:null}),o=await u._initSearchStore(t,{userid:e}),a=new u(t,e,s,o,r,i);return a.requestPlanning({contextual:a.isArcPopulated()}),a}async requestPlanning(t={}){this.consumerOnly||await this.producer.produceSuggestions(t)}get consumerOnly(){return!Boolean(this.producer)}async loadSuggestions(){return this.consumer.loadSuggestions()}async setSearch(t){if(t=""!==(t=t?t.toLowerCase().trim():null)?t:null,this.search!==t){this.search=t,await this._storeSearch(this.arcKey,this.search);const e="*"===this.search,n=e?null:this.search;this.consumer.setSuggestFilter(e,n)}}get arcKey(){return this.arc.storageKey.substring(this.arc.storageKey.lastIndexOf("/")+1)}registerSuggestionsChangedCallback(t){this.consumer.registerSuggestionsChangedCallback(t)}registerVisibleSuggestionsChangedCallback(t){this.consumer.registerVisibleSuggestionsChangedCallback(t)}dispose(){this.arc.unregisterInstantiatePlanCallback(this.arcCallback),this.consumerOnly||(this._unlistenToArcStores(),this.producer.dispose()),this.consumer.store.dispose(),this.consumer.dispose()}getLastActivatedPlan(){return{plan:this.lastActivatedPlan}}_onPlanInstantiated(t){this.lastActivatedPlan=t,this.requestPlanning()}_listenToArcStores(){this.arc.onDataChange(this.dataChangeCallback,this),this.arc.context.allStores.forEach(t=>{t.on&&t.on("change",this.dataChangeCallback,this)})}_unlistenToArcStores(){this.arc.clearDataChange(this),this.arc.context.allStores.forEach(t=>{t.off&&t.off("change",this.dataChangeCallback)})}static async _initSuggestStore(t,{userid:e,protocol:n,arcKey:i}){Object(r.assert)(e,"Missing user id.");const s=t.storageProviderFactory._storageForKey(t.storageKey).parseStringAsKey(t.storageKey);n&&(s.protocol=n),s.location.includes("/arcs/")?s.location=s.location.replace(/\/arcs\/([a-zA-Z0-9_\-]+)$/,`/users/${e}/suggestions/${i||"$1"}`):s.location=s.location.replace(/\/([a-zA-Z0-9_\-]+)$/,"/suggestions/$1");const o=new a.Schema({names:["Suggestions"],fields:{current:"Object"}}),l=c.Type.newEntity(o);return u._initStore(t,"suggestions-id",l,s)}static async _initSearchStore(t,{userid:e}){const n=t.storageProviderFactory._storageForKey(t.storageKey).parseStringAsKey(t.storageKey);n.location.includes("/arcs/")?n.location=n.location.replace(/\/arcs\/([a-zA-Z0-9_\-]+)$/,`/users/${e}/search`):n.location=n.location.replace(/\/([a-zA-Z0-9_\-]+)$/,`/suggestions/${e}/search`);const r=new a.Schema({names:["Search"],fields:{current:"Object"}}),i=c.Type.newEntity(r);return u._initStore(t,"search-id",i,n)}static async _initStore(t,e,n,i){const s=i.toString(),o=t.storageProviderFactory._storageForKey(s);let a=null;switch(i.protocol){case"firebase":return o._join(e,n,s,"unknown",!1);case"volatile":case"pouchdb":try{a=await o.construct(e,n,s)}catch(t){a=await o.connect(e,n,s)}return Object(r.assert)(a,`Failed initializing '${i.protocol}' store.`),a.referenceMode=!1,a;default:throw new Error(`Unsupported protocol '${i.protocol}'`)}}async _storeSearch(t,e){const n=await this.searchStore.get()||[],r=[];for(const{arc:e,search:i}of n)e!==t&&r.push({arc:e,search:i});return r.push({search:this.search,arc:this.arcKey}),this.searchStore.set(r)}isArcPopulated(){if(0===this.arc.recipes.length)return!1;if(1===this.arc.recipes.length){const[t]=this.arc.recipes;if(0===t.particles.length||1===t.particles.length&&"Launcher"===t.particles[0].name)return!1}return!0}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PlanConsumer",function(){return c});var r=n(3),i=n(239),s=n(242),o=n(26),a=n(238);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(t,e){this.suggestionsChangeCallbacks=[],this.visibleSuggestionsChangeCallbacks=[],this.suggestionComposer=null,Object(r.assert)(t,"arc cannot be null"),Object(r.assert)(e,"store cannot be null"),this.arc=t,this.result=new i.PlanningResult(t),this.store=e,this.suggestFilter={showAll:!1},this.suggestionsChangeCallbacks=[],this.visibleSuggestionsChangeCallbacks=[],this.storeCallback=(()=>this.loadSuggestions()),this.store.on("change",this.storeCallback,this),this._initSuggestionComposer()}registerSuggestionsChangedCallback(t){this.suggestionsChangeCallbacks.push(t)}registerVisibleSuggestionsChangedCallback(t){this.visibleSuggestionsChangeCallbacks.push(t)}setSuggestFilter(t,e){if(Object(r.assert)(!t||!e),this.suggestFilter.showAll===t&&this.suggestFilter.search===e)return;const n=this.getCurrentSuggestions();this.suggestFilter={showAll:t,search:e},this._onMaybeSuggestionsChanged(n)}async loadSuggestions(){Object(r.assert)(this.store.get,"Unsupported getter in suggestion storage");const t=await this.store.get()||{};if(!t.suggestions)return;const e=this.getCurrentSuggestions();await this.result.deserialize(t)&&(this._onSuggestionsChanged(),this._onMaybeSuggestionsChanged(e),this.result.generations.length&&o.DevtoolsConnection.isConnected&&a.StrategyExplorerAdapter.processGenerations(this.result.generations,o.DevtoolsConnection.get()))}getCurrentSuggestions(){const t=this.result.suggestions.filter(t=>t.plan.slots.length>0);return this.suggestFilter.showAll?t:this.suggestFilter.search?t.filter(t=>t.descriptionText.toLowerCase().includes(this.suggestFilter.search)||t.hasSearch(this.suggestFilter.search)):t.filter(t=>{const e=t.plan.handles.find(t=>!!t.id&&!!this.arc.activeRecipe.handles.find(e=>e.id===t.id)),n=t.plan.slots.find(t=>!t.name.includes("root")&&!t.tags.includes("root")&&t.id&&!t.id.includes("root")&&Boolean(this.arc.pec.slotComposer.findContextById(t.id))),r=!t.plan.slots.find(t=>t.name.includes("root")||t.tags.includes("root"));return e&&n||r})}dispose(){this.store.off("change",this.storeCallback),this.suggestionsChangeCallbacks=[],this.visibleSuggestionsChangeCallbacks=[],this.suggestionComposer&&this.suggestionComposer.clear()}_onSuggestionsChanged(){this.suggestionsChangeCallbacks.forEach(t=>t({suggestions:this.result.suggestions}))}_onMaybeSuggestionsChanged(t){const e=this.getCurrentSuggestions();i.PlanningResult.isEquivalent(t,e)||this.visibleSuggestionsChangeCallbacks.forEach(t=>t(e))}_initSuggestionComposer(){const t=this.arc.pec.slotComposer;t&&t.findContextById("rootslotid-suggestions")&&(this.suggestionComposer=new s.SuggestionComposer(t),this.registerVisibleSuggestionsChangedCallback(t=>this.suggestionComposer.setSuggestions(t)))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SuggestionComposer",function(){return s});var r=n(223),i=n(222);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(t){this._suggestions=[],this._suggestConsumers=[],this._modality=r.Modality.forName(t.modality),this._container=t.findContainerByName("suggestions"),this._slotComposer=t}clear(){this._container&&this._modality.slotConsumerClass.clear(this._container),this._suggestConsumers.forEach(t=>t.dispose()),this._suggestConsumers=[]}setSuggestions(t){this.clear();const e=t.sort(i.Suggestion.compare);for(const t of e){const e=t.getDescription(this._modality.name)||t.descriptionText;if(!e)throw new Error("No suggestion content available");this._container&&this._modality.suggestionConsumerClass.render(this._container,t,e),this._addInlineSuggestion(t,e)}}_addInlineSuggestion(t,e){const n=t.plan.slots.filter(t=>!!t.id);if(1!==n.length)return;const r=n[0],i=this._slotComposer.findContextById(r.id);if(!i)throw new Error("Missing context for "+r.id);if(i.spec.isSet)return;if(!i.sourceSlotConsumer)return;if(0===i.spec.handles.length)return;if(!i.spec.handles.map(t=>i.sourceSlotConsumer.consumeConn.particle.connections[t].handle.id).find(e=>t.plan.handles.find(t=>t.id===e)))return;const s=new this._modality.suggestionConsumerClass(this._slotComposer.containerKind,t,e,t=>{const e=this._suggestions.find(e=>e.hash===t.data.key);if(s.dispose(),e){const t=this._suggestConsumers.findIndex(t=>t===s);if(t<0)throw new Error("cannot find suggest slot context");this._suggestConsumers.splice(t,1),this._slotComposer.arc.instantiate(e.plan)}});i.addSlotConsumer(s),this._suggestConsumers.push(s)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PlanProducer",function(){return f});var r=n(3),i=n(210),s=n(244),o=n(201),a=n(200),c=n(239),u=n(220);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const l=5e3,h=Object(s.logFactory)("PlanProducer","#ff0090","log"),d=Object(s.logFactory)("PlanProducer","#ff0090","error");class f{constructor(t,e,n,{debug:i=!1}={}){this.planner=null,this.stateChangedCallbacks=[],this.debug=!1,Object(r.assert)(t,"arc cannot be null"),Object(r.assert)(e,"store cannot be null"),this.arc=t,this.result=new c.PlanningResult(t),this.store=e,this.speculator=new u.Speculator,this.searchStore=n,this.searchStore&&(this.searchStoreCallback=(()=>this.onSearchChanged()),this.searchStore.on("change",this.searchStoreCallback,this)),this.debug=i}get isPlanning(){return this._isPlanning}set isPlanning(t){this.isPlanning!==t&&(this._isPlanning=t,this.stateChangedCallbacks.forEach(t=>t(this.isPlanning)))}registerStateChangedCallback(t){this.stateChangedCallbacks.push(t)}async onSearchChanged(){const t=(await this.searchStore.get()||[]).find(t=>t.arc===this.arcKey);if(t&&t.search!==this.search&&(this.search=t.search,this.search))if("*"===this.search)this.result.contextual&&this.produceSuggestions({contextual:!1});else{const t={cancelOngoingPlanning:this.result.suggestions.length>0,search:this.search};this.result.contextual?t.contextual=!1:(t.append=!0,t.strategies=[i.InitSearch,...a.Planner.ResolutionStrategies]),this.produceSuggestions(t)}}get arcKey(){return this.arc.storageKey.substring(this.arc.storageKey.lastIndexOf("/")+1)}dispose(){this.searchStore.off("change",this.searchStoreCallback)}async produceSuggestions(t={}){if(t.cancelOngoingPlanning&&this.isPlanning&&this._cancelPlanning(),this.needReplan=!0,this.replanOptions=t,this.isPlanning)return;this.isPlanning=!0;let e=Object(o.now)(),n=[],r=[];for(;this.needReplan;)this.needReplan=!1,r=[],n=await this.runPlanner(this.replanOptions,r);e=((Object(o.now)()-e)/1e3).toFixed(2),n&&(h(`Produced ${n.length}${this.replanOptions.append?" additional":""} suggestions [elapsed=${e}s].`),this.isPlanning=!1,await this._updateResult({suggestions:n,generations:this.debug?r:[]},this.replanOptions))}async runPlanner(t,e){let n=[];return Object(r.assert)(!this.planner,"Planner must be null"),this.planner=new a.Planner,this.planner.init(this.arc,{strategies:t.strategies,strategyArgs:{contextual:t.contextual,search:t.search}}),n=await this.planner.suggest(t.timeout||l,e,this.speculator),this.planner?(this.planner=null,n):null}_cancelPlanning(){this.planner&&(this.planner.dispose(),this.planner=null),this.needReplan=!1,this.isPlanning=!1,h("Cancel planning")}async _updateResult({suggestions:t,generations:e},n){if(e=c.PlanningResult.formatSerializableGenerations(e),n.append){if(Object(r.assert)(!n.contextual,"Cannot append to contextual options"),!this.result.append({suggestions:t,generations:e}))return}else if(!this.result.set({suggestions:t,generations:e,contextual:n.contextual}))return;try{Object(r.assert)(this.store.set,"Unsupported setter in suggestion storage"),await this.store.set(this.result.serialize())}catch(t){throw d("Failed storing suggestions: ",t),t}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"logFactory",function(){return r});const r=(t,e,n="log")=>console[n].bind(console,`%c${t}`,`background: ${e}; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`)},function(t,e,n){"use strict";n.r(e),n.d(e,"ReplanQueue",function(){return s});var r=n(201);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const i=3e3;class s{constructor(t,e={}){this.options={},this.planProducer=t,this.options=e,this.options.defaultReplanDelayMs=this.options.defaultReplanDelayMs||i,this.changes=[],this.replanTimer=null,this.planProducer.registerStateChangedCallback(this._onPlanningStateChanged.bind(this))}addChange(){this.changes.push(Object(r.now)()),this._isReplanningScheduled()?this._postponeReplan():this.planProducer.isPlanning||this._scheduleReplan(this.options.defaultReplanDelayMs)}_onPlanningStateChanged(t){if(t)this._cancelReplanIfScheduled(),this.changes=[];else if(this.changes.length>0){const t=Object(r.now)();this.changes.forEach((e,n)=>this.changes[n]=t),this._scheduleReplan(this.options.defaultReplanDelayMs)}}_isReplanningScheduled(){return Boolean(this.replanTimer)}_scheduleReplan(t){this._cancelReplanIfScheduled(),this.replanTimer=setTimeout(()=>this.planProducer.produceSuggestions({contextual:this.planProducer.result.contextual}),t)}_cancelReplanIfScheduled(){this._isReplanningScheduled()&&(clearTimeout(this.replanTimer),this.replanTimer=null)}_postponeReplan(){if(this.changes.length<=1)return;const t=this.changes[this.changes.length-1]-this.changes[0];if(this._canPostponeReplan(t)){this._cancelReplanIfScheduled();let e=this.options.defaultReplanDelayMs;this.options.maxNoReplanMs&&(e=Math.min(e,this.options.maxNoReplanMs-t)),this._scheduleReplan(e)}}_canPostponeReplan(t){return!this.options.maxNoReplanMs||t<this.options.maxNoReplanMs}}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"KeyManager",function(){return s});var r=n(247),i=n(251);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{static getGenerator(){return r.WebCryptoKeyGenerator.getInstance()}static getStorage(){return null!=("undefined"!=typeof window?window:"undefined"!=typeof self?self:t).indexedDB?r.WebCryptoKeyIndexedDBStorage.getInstance():i.WebCryptoMemoryKeyStorage.getInstance()}}}.call(this,n(1))},function(t,e,n){"use strict";n.r(e),n.d(e,"WebCryptoKeyGenerator",function(){return w}),n.d(e,"WebCryptoKeyIndexedDBStorage",function(){return S});var r=n(248),i=n.n(r),s=n(249),o=n(250),a=n.n(o);
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const c="RSA-OAEP",u="RSA-OAEP",l="SHA-1",h="SHA-512",d="AES-GCM",f="ArcsKeyManagementStore",p="ArcsKeyManagement";class g{constructor(t){this.key=t}algorithm(){return this.key.algorithm?this.key.algorithm.name:this.key.publicKey.algorithm.name}storableKey(){return this.key}}class y{constructor(t,e){this.wrappedKeyData=t,this.wrappedBy=e}algorithm(){return this.wrappedBy.algorithm()}unwrap(t){const e=t;return crypto.subtle.unwrapKey("raw",this.wrappedKeyData,e.cryptoKey(),{name:t.algorithm()},{name:d},!0,["encrypt","decrypt"]).then(t=>new _(t))}rewrap(t,e){return this.unwrap(t).then(t=>t.disposeToWrappedKeyUsing(e))}export(){return Object(s.encode)(this.wrappedKeyData.buffer)}fingerprint(){return Promise.resolve(Object(s.encode)(this.wrappedKeyData.buffer))}}class v extends g{constructor(t){super(t)}cryptoKey(){return this.storableKey()}}class m extends g{constructor(t){super(t)}cryptoKey(){return this.storableKey()}static digest(t){return m.sha256(t)}static hex(t){const e=[],n=new DataView(t);for(let t=0;t<n.byteLength;t+=4){const r="00000000",i=(r+n.getUint32(t).toString(16)).slice(-r.length);e.push(i)}return e.join("")}static sha256(t){const e=new Uint8Array(t.split("").map(t=>t.charCodeAt(0)));return crypto.subtle.digest("SHA-256",e).then(t=>m.hex(t))}fingerprint(){return crypto.subtle.exportKey("jwk",this.cryptoKey()).then(t=>m.digest(t.n))}}class _{decrypt(t,e){return crypto.subtle.decrypt({name:this.algorithm(),iv:e},this.sessionKey,t)}encrypt(t,e){return crypto.subtle.encrypt({name:this.algorithm(),iv:e},this.sessionKey,t)}constructor(t){this.sessionKey=t}export(){return crypto.subtle.exportKey("raw",this.sessionKey).then(t=>{let e="";return new Uint8Array(t).forEach(t=>e+=(t<16?"0":"")+t.toString(16)),e})}algorithm(){return this.sessionKey.algorithm.name}disposeToWrappedKeyUsing(t){try{const e=t;return crypto.subtle.wrapKey("raw",this.sessionKey,t.cryptoKey(),{name:e.algorithm()}).then(e=>new y(new Uint8Array(e),t))}finally{this.sessionKey=null}}isDisposed(){return null!=this.sessionKey}}class b extends g{algorithm(){return this.publicKey().algorithm()}constructor(t){super(t)}privateKey(){return new v(this.key.privateKey)}publicKey(){return new m(this.key.publicKey)}fingerprint(){return this.publicKey().fingerprint()}}class w{generateWrappedStorageKey(t){return crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt","wrapKey","unwrapKey"]).then(t=>new _(t)).then(e=>e.disposeToWrappedKeyUsing(t.publicKey()))}static getInstance(){return new w}generateAndStoreRecoveryKey(){return Promise.reject("Not implemented")}generateDeviceKey(){return crypto.subtle.generateKey({hash:{name:h},name:c,modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},!1,["encrypt","decrypt","wrapKey","unwrapKey"]).then(t=>new b(t))}importKey(t){const e=a.a.KEYUTIL.getKey(t),n=a.a.KEYUTIL.getJWKFromKey(e);return crypto.subtle.importKey("jwk",n,{name:u,hash:{name:l}},!0,["encrypt","wrapKey"]).then(t=>new m(t))}importWrappedKey(t,e){const n=Object(s.decode)(t);return Promise.resolve(new y(n,e))}}class S{async runOnStore(t){try{const e=await i.a.open(p,1,t=>t.createObjectStore(f,{keyPath:"keyFingerPrint"})),n=e.transaction(f,"readwrite"),r=n.objectStore(f),s=await t(r);return await n.complete,e.close(),Promise.resolve(s)}catch(t){return Promise.reject(t)}}async find(t){const e=await this.runOnStore(e=>e.get(t));if(!e)return Promise.resolve(null);if(e.key&&e.key.privateKey&&e.key.publicKey)return Promise.resolve(new b(e.key));if(e.key instanceof CryptoKey)return Promise.resolve(new m(e.key));if(e.key instanceof Uint8Array){const t=await this.find(e.wrappingKeyFingerprint);return Promise.resolve(new y(e.key,t))}return Promise.reject("Unrecognized key type found in keystore.")}async write(t,e){if(e instanceof g){const n=e;return await this.runOnStore(e=>e.put({keyFingerPrint:t,key:n.storableKey()})),t}if(e instanceof y){const n=e,r=await n.wrappedBy.fingerprint();return await this.runOnStore(e=>e.put({keyFingerPrint:t,key:n.wrappedKeyData,wrappingKeyFingerprint:r})),t}return Promise.reject("Can't write key that isn't StorableKey or WrappedKey.")}static getInstance(){return new S}}},function(t,e,n){"use strict";!function(){function e(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function n(t,n,r){var i,s=new Promise(function(s,o){e(i=t[n].apply(t,r)).then(s,o)});return s.request=i,s}function r(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function i(t,e,r,i){i.forEach(function(i){i in r.prototype&&(t.prototype[i]=function(){return n(this[e],i,arguments)})})}function s(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function o(t,e,r,i){i.forEach(function(i){i in r.prototype&&(t.prototype[i]=function(){return function(t,e,r){var i=n(t,e,r);return i.then(function(t){if(t)return new c(t,i.request)})}(this[e],i,arguments)})})}function a(t){this._index=t}function c(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function h(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new l(n)}function d(t){this._db=t}r(a,"_index",["name","keyPath","multiEntry","unique"]),i(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(c,"_cursor",["direction","key","primaryKey","value"]),i(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,r),e(n._request).then(function(t){if(t)return new c(t,n._request)})})})}),u.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},r(u,"_store",["name","keyPath","indexNames","autoIncrement"]),i(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(u,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},r(l,"_tx",["objectStoreNames","mode"]),s(l,"_tx",IDBTransaction,["abort"]),h.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},r(h,"_db",["name","version","objectStoreNames"]),s(h,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),s(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[u,a].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[a,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})});var f={open:function(t,e,r){var i=n(indexedDB,"open",[t,e]),s=i.request;return s&&(s.onupgradeneeded=function(t){r&&r(new h(s.result,t.oldVersion,s.transaction))}),i.then(function(t){return new d(t)})},delete:function(t){return n(indexedDB,"deleteDatabase",[t])}};t.exports=f,t.exports.default=t.exports}()},function(t,e,n){"use strict";n.r(e),n.d(e,"encode",function(){return s}),n.d(e,"decode",function(){return o});const r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i={};for(let t=0;t<64;++t)i[r[t]]=t;function s(t){const e=new Uint8Array(t),n=[];let i,s,o=0;for(;o+2<e.byteLength;)s=(i=e[o]<<16|e[o+1]<<8|e[o+2])>>18&63,n.push(r[s]),s=i>>12&63,n.push(r[s]),s=i>>6&63,n.push(r[s]),s=63&i,n.push(r[s]),o+=3;return o+1===e.byteLength?(s=(i=e[o]<<4)>>6&63,n.push(r[s]),s=63&i,n.push(r[s]),n.push("==")):o+2===e.byteLength&&(s=(i=e[o]<<10|e[o+1]<<2)>>12&63,n.push(r[s]),s=i>>6&63,n.push(r[s]),s=63&i,n.push(r[s]),n.push("=")),n.join("")}function o(t){let e=t.length;if(0===e)return new Uint8Array(new ArrayBuffer(0));if(e%4!=0)throw new Error("Bad length: "+e);if(!t.match(/^[a-zA-Z0-9+/]+={0,2}$/))throw new Error("Invalid base64 encoded value");let n=e/4*3,r=0;"="===t.charAt(e-1)&&(r++,n--),"="===t.charAt(e-2)&&(r++,n--);const s=new Uint8Array(new ArrayBuffer(n));let o,a=0,c=0;for(r>0&&(e-=4);a<e;){o=0;for(let e=0;e<4;++e)o=o<<6|i[t.charAt(a+e)];s[c++]=o>>16&255,s[c++]=o>>8&255,s[c++]=255&o,a+=4}if(r>0){o=0;for(let e=0;e<4-r;++e)o=o<<6|i[t.charAt(a+e)];1===r?(o>>=2,s[c++]=o>>8&255,s[c++]=255&o):(o>>=4,s[c++]=255&o)}return s}},function(t,e,n){(function(t){var n={userAgent:!1},r={};
/*!
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/
if(void 0===i)var i={};i.lang={extend:function(t,e,r){if(!e||!t)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var i=function(){};if(i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e),r){var s;for(s in r)t.prototype[s]=r[s];var o=function(){},a=["toString","valueOf"];try{/MSIE/.test(n.userAgent)&&(o=function(t,e){for(s=0;s<a.length;s+=1){var n=a[s],r=e[n];"function"==typeof r&&r!=Object.prototype[n]&&(t[n]=r)}})}catch(t){}o(t.prototype,r)}}};
/*! CryptoJS v3.1.2 core-fix.js
 * code.google.com/p/crypto-js
 * (c) 2009-2013 by Jeff Mott. All rights reserved.
 * code.google.com/p/crypto-js/wiki/License
 * THIS IS FIX of 'core.js' to fix Hmac issue.
 * https://code.google.com/p/crypto-js/issues/detail?id=84
 * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 */
var s=s||function(t,e){var n={},r=n.lib={},i=r.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||a).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,i=t.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;e[r+s>>>2]|=o<<24-(r+s)%4*8}else for(s=0;s<i;s+=4)e[r+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],r=0;r<e;r+=4)n.push(4294967296*t.random()|0);return new s.init(n,e)}}),o=n.enc={},a=o.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var s=e[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(n,e/2)}},c=o.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var s=e[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(n,e)}},u=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*o,u=t.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(r,l);var h=r.splice(0,c);n.sigBytes-=u}return new s.init(h,u)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),h=(r.Hasher=l.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}}),n.algo={});return n}(Math);!function(t){var e,n=(e=s).lib,r=n.Base,i=n.WordArray;(e=e.x64={}).Word=r.extend({init:function(t,e){this.high=t,this.low=e}}),e.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],r=0;r<e;r++){var s=t[r];n.push(s.high),n.push(s.low)}return i.create(n,this.sigBytes)},clone:function(){for(var t=r.clone.call(this),e=t.words=this.words.slice(0),n=e.length,i=0;i<n;i++)e[i]=e[i].clone();return t}})}(),s.lib.Cipher||function(t){var e=(p=s).lib,n=e.Base,r=e.WordArray,i=e.BufferedBlockAlgorithm,o=p.enc.Base64,a=p.algo.EvpKDF,c=e.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,n,r){return("string"==typeof n?g:f).encrypt(t,e,n,r)},decrypt:function(e,n,r){return("string"==typeof n?g:f).decrypt(t,e,n,r)}}}});e.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=p.mode={},l=function(t,e,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)t[e+i]^=r[i]},h=(e.BlockCipherMode=n.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}})).extend();h.Encryptor=h.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize;l.call(this,t,e,r),n.encryptBlock(t,e),this._prevBlock=t.slice(e,e+r)}}),h.Decryptor=h.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,i=t.slice(e,e+r);n.decryptBlock(t,e),l.call(this,t,e,r),this._prevBlock=i}}),u=u.CBC=h,h=(p.pad={}).Pkcs7={pad:function(t,e){for(var n,i=(n=(n=4*e)-t.sigBytes%n)<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(i);n=r.create(s,n),t.concat(n)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},e.BlockCipher=c.extend({cfg:c.cfg.extend({mode:u,padding:h}),reset:function(){c.reset.call(this);var t=(e=this.cfg).iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var d=e.CipherParams=n.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),f=(u=(p.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return((t=t.salt)?r.create([1398893684,1701076831]).concat(t).concat(e):e).toString(o)},parse:function(t){var e=(t=o.parse(t)).words;if(1398893684==e[0]&&1701076831==e[1]){var n=r.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return d.create({ciphertext:t,salt:n})}},e.SerializableCipher=n.extend({cfg:n.extend({format:u}),encrypt:function(t,e,n,r){r=this.cfg.extend(r);var i=t.createEncryptor(n,r);return e=i.finalize(e),i=i.cfg,d.create({ciphertext:e,key:n,iv:i.iv,algorithm:t,mode:i.mode,padding:i.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(n,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}})),p=(p.kdf={}).OpenSSL={execute:function(t,e,n,i){return i||(i=r.random(8)),t=a.create({keySize:e+n}).compute(t,i),n=r.create(t.words.slice(e),4*n),t.sigBytes=4*e,d.create({key:t,iv:n,salt:i})}},g=e.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(t,e,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,t.keySize,t.ivSize),r.iv=n.iv,(t=f.encrypt.call(this,t,e,n.key,r)).mixIn(n),t},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),n=r.kdf.execute(n,t.keySize,t.ivSize,e.salt),r.iv=n.iv,f.decrypt.call(this,t,e,n.key,r)}})}(),function(){for(var t=s,e=t.lib.BlockCipher,n=t.algo,r=[],i=[],o=[],a=[],c=[],u=[],l=[],h=[],d=[],f=[],p=[],g=0;256>g;g++)p[g]=128>g?g<<1:g<<1^283;var y=0,v=0;for(g=0;256>g;g++){var m=(m=v^v<<1^v<<2^v<<3^v<<4)>>>8^255&m^99;r[y]=m,i[m]=y;var _=p[y],b=p[_],w=p[b],S=257*p[m]^16843008*m;o[y]=S<<24|S>>>8,a[y]=S<<16|S>>>16,c[y]=S<<8|S>>>24,u[y]=S,S=16843009*w^65537*b^257*_^16843008*y,l[m]=S<<24|S>>>8,h[m]=S<<16|S>>>16,d[m]=S<<8|S>>>24,f[m]=S,y?(y=_^p[p[p[w^_]]],v^=p[p[v]]):y=v=1}var C=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=e.extend({_doReset:function(){for(var t=(n=this._key).words,e=n.sigBytes/4,n=4*((this._nRounds=e+6)+1),i=this._keySchedule=[],s=0;s<n;s++)if(s<e)i[s]=t[s];else{var o=i[s-1];s%e?6<e&&4==s%e&&(o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o]):(o=r[(o=o<<8|o>>>24)>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o],o^=C[s/e|0]<<24),i[s]=i[s-e]^o}for(t=this._invKeySchedule=[],e=0;e<n;e++)s=n-e,o=e%4?i[s]:i[s-4],t[e]=4>e||4>=s?o:l[r[o>>>24]]^h[r[o>>>16&255]]^d[r[o>>>8&255]]^f[r[255&o]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,o,a,c,u,r)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,l,h,d,f,i),n=t[e+1],t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,r,i,s,o,a){for(var c=this._nRounds,u=t[e]^n[0],l=t[e+1]^n[1],h=t[e+2]^n[2],d=t[e+3]^n[3],f=4,p=1;p<c;p++){var g=r[u>>>24]^i[l>>>16&255]^s[h>>>8&255]^o[255&d]^n[f++],y=r[l>>>24]^i[h>>>16&255]^s[d>>>8&255]^o[255&u]^n[f++],v=r[h>>>24]^i[d>>>16&255]^s[u>>>8&255]^o[255&l]^n[f++];d=r[d>>>24]^i[u>>>16&255]^s[l>>>8&255]^o[255&h]^n[f++],u=g,l=y,h=v}g=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[f++],y=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&u])^n[f++],v=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[f++],d=(a[d>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[f++],t[e]=g,t[e+1]=y,t[e+2]=v,t[e+3]=d},keySize:8});t.AES=e._createHelper(n)}(),function(){function t(t,e){var n=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=n,this._lBlock^=n<<t}function e(t,e){var n=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=n,this._rBlock^=n<<t}var n=s,r=(i=n.lib).WordArray,i=i.BlockCipher,o=n.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],c=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=i.extend({_doReset:function(){for(var t=this._key.words,e=[],n=0;56>n;n++){var r=a[n]-1;e[n]=t[r>>>5]>>>31-r%32&1}for(t=this._subKeys=[],r=0;16>r;r++){var i=t[r]=[],s=u[r];for(n=0;24>n;n++)i[n/6|0]|=e[(c[n]-1+s)%28]<<31-n%6,i[4+(n/6|0)]|=e[28+(c[n+24]-1+s)%28]<<31-n%6;for(i[0]=i[0]<<1|i[0]>>>31,n=1;7>n;n++)i[n]>>>=4*(n-1)+3;i[7]=i[7]<<5|i[7]>>>27}for(e=this._invSubKeys=[],n=0;16>n;n++)e[n]=t[15-n]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(n,r,i){this._lBlock=n[r],this._rBlock=n[r+1],t.call(this,4,252645135),t.call(this,16,65535),e.call(this,2,858993459),e.call(this,8,16711935),t.call(this,1,1431655765);for(var s=0;16>s;s++){for(var o=i[s],a=this._lBlock,c=this._rBlock,u=0,d=0;8>d;d++)u|=l[d][((c^o[d])&h[d])>>>0];this._lBlock=c,this._rBlock=a^u}i=this._lBlock,this._lBlock=this._rBlock,this._rBlock=i,t.call(this,1,1431655765),e.call(this,8,16711935),e.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),n[r]=this._lBlock,n[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=i._createHelper(d),o=o.TripleDES=i.extend({_doReset:function(){var t=this._key.words;this._des1=d.createEncryptor(r.create(t.slice(0,2))),this._des2=d.createEncryptor(r.create(t.slice(2,4))),this._des3=d.createEncryptor(r.create(t.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2}),n.TripleDES=i._createHelper(o)}(),function(){var t=s,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp(),t=[];for(var i=0;i<n;i+=3)for(var s=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;4>o&&i+.75*o<n;o++)t.push(r.charAt(s>>>6*(3-o)&63));if(e=r.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var n=t.length,r=this._map;(i=r.charAt(64))&&(-1!=(i=t.indexOf(i))&&(n=i));for(var i=[],s=0,o=0;o<n;o++)if(o%4){var a=r.indexOf(t.charAt(o-1))<<o%4*2,c=r.indexOf(t.charAt(o))>>>6-o%4*2;i[s>>>2]|=(a|c)<<24-s%4*8,s++}return e.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,n,r,i,s,o){return((t=t+(e&n|~e&r)+i+o)<<s|t>>>32-s)+e}function n(t,e,n,r,i,s,o){return((t=t+(e&r|n&~r)+i+o)<<s|t>>>32-s)+e}function r(t,e,n,r,i,s,o){return((t=t+(e^n^r)+i+o)<<s|t>>>32-s)+e}function i(t,e,n,r,i,s,o){return((t=t+(n^(e|~r))+i+o)<<s|t>>>32-s)+e}for(var o=s,a=(u=o.lib).WordArray,c=u.Hasher,u=o.algo,l=[],h=0;64>h;h++)l[h]=4294967296*t.abs(t.sin(h+1))|0;u=u.MD5=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,s){for(var o=0;16>o;o++){var a=t[h=s+o];t[h]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c,u,h=t[s+0],d=(a=t[s+1],t[s+2]),f=t[s+3],p=t[s+4],g=t[s+5],y=t[s+6],v=t[s+7],m=t[s+8],_=t[s+9],b=t[s+10],w=t[s+11],S=t[s+12],C=t[s+13],E=t[s+14],x=t[s+15],T=o[0],A=i(A=i(A=i(A=i(A=r(A=r(A=r(A=r(A=n(A=n(A=n(A=n(A=e(A=e(A=e(A=e(A=o[1],u=e(u=o[2],c=e(c=o[3],T=e(T,A,u,c,h,7,l[0]),A,u,a,12,l[1]),T,A,d,17,l[2]),c,T,f,22,l[3]),u=e(u,c=e(c,T=e(T,A,u,c,p,7,l[4]),A,u,g,12,l[5]),T,A,y,17,l[6]),c,T,v,22,l[7]),u=e(u,c=e(c,T=e(T,A,u,c,m,7,l[8]),A,u,_,12,l[9]),T,A,b,17,l[10]),c,T,w,22,l[11]),u=e(u,c=e(c,T=e(T,A,u,c,S,7,l[12]),A,u,C,12,l[13]),T,A,E,17,l[14]),c,T,x,22,l[15]),u=n(u,c=n(c,T=n(T,A,u,c,a,5,l[16]),A,u,y,9,l[17]),T,A,w,14,l[18]),c,T,h,20,l[19]),u=n(u,c=n(c,T=n(T,A,u,c,g,5,l[20]),A,u,b,9,l[21]),T,A,x,14,l[22]),c,T,p,20,l[23]),u=n(u,c=n(c,T=n(T,A,u,c,_,5,l[24]),A,u,E,9,l[25]),T,A,f,14,l[26]),c,T,m,20,l[27]),u=n(u,c=n(c,T=n(T,A,u,c,C,5,l[28]),A,u,d,9,l[29]),T,A,v,14,l[30]),c,T,S,20,l[31]),u=r(u,c=r(c,T=r(T,A,u,c,g,4,l[32]),A,u,m,11,l[33]),T,A,w,16,l[34]),c,T,E,23,l[35]),u=r(u,c=r(c,T=r(T,A,u,c,a,4,l[36]),A,u,p,11,l[37]),T,A,v,16,l[38]),c,T,b,23,l[39]),u=r(u,c=r(c,T=r(T,A,u,c,C,4,l[40]),A,u,h,11,l[41]),T,A,f,16,l[42]),c,T,y,23,l[43]),u=r(u,c=r(c,T=r(T,A,u,c,_,4,l[44]),A,u,S,11,l[45]),T,A,x,16,l[46]),c,T,d,23,l[47]),u=i(u,c=i(c,T=i(T,A,u,c,h,6,l[48]),A,u,v,10,l[49]),T,A,E,15,l[50]),c,T,g,21,l[51]),u=i(u,c=i(c,T=i(T,A,u,c,S,6,l[52]),A,u,f,10,l[53]),T,A,b,15,l[54]),c,T,a,21,l[55]),u=i(u,c=i(c,T=i(T,A,u,c,m,6,l[56]),A,u,x,10,l[57]),T,A,y,15,l[58]),c,T,C,21,l[59]),u=i(u,c=i(c,T=i(T,A,u,c,p,6,l[60]),A,u,w,10,l[61]),T,A,d,15,l[62]),c,T,_,21,l[63]);o[0]=o[0]+T|0,o[1]=o[1]+A|0,o[2]=o[2]+u|0,o[3]=o[3]+c|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;n[i>>>5]|=128<<24-i%32;var s=t.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(n.length+1),this._process(),n=(e=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return e},clone:function(){var t=c.clone.call(this);return t._hash=this._hash.clone(),t}}),o.MD5=c._createHelper(u),o.HmacMD5=c._createHmacHelper(u)}(Math),function(){var t=s,e=(i=t.lib).WordArray,n=i.Hasher,r=[],i=t.algo.SHA1=n.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],s=n[1],o=n[2],a=n[3],c=n[4],u=0;80>u;u++){if(16>u)r[u]=0|t[e+u];else{var l=r[u-3]^r[u-8]^r[u-14]^r[u-16];r[u]=l<<1|l>>>31}l=(i<<5|i>>>27)+c+r[u],l=20>u?l+(1518500249+(s&o|~s&a)):40>u?l+(1859775393+(s^o^a)):60>u?l+((s&o|s&a|o&a)-1894007588):l+((s^o^a)-899497514),c=a,a=o,o=s<<30|s>>>2,s=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=n._createHelper(i),t.HmacSHA1=n._createHmacHelper(i)}(),function(t){for(var e=s,n=(i=e.lib).WordArray,r=i.Hasher,i=e.algo,o=[],a=[],c=function(t){return 4294967296*(t-(0|t))|0},u=2,l=0;64>l;){var h;t:{h=u;for(var d=t.sqrt(h),f=2;f<=d;f++)if(!(h%f)){h=!1;break t}h=!0}h&&(8>l&&(o[l]=c(t.pow(u,.5))),a[l]=c(t.pow(u,1/3)),l++),u++}var p=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],c=n[4],u=n[5],l=n[6],h=n[7],d=0;64>d;d++){if(16>d)p[d]=0|t[e+d];else{var f=p[d-15],g=p[d-2];p[d]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+p[d-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+p[d-16]}f=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&l)+a[d]+p[d],g=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&s^i&s),h=l,l=u,u=c,c=o+f|0,o=s,s=i,i=r,r=f+g|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+c|0,n[5]=n[5]+u|0,n[6]=n[6]+l|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=r._createHelper(i),e.HmacSHA256=r._createHmacHelper(i)}(Math),function(){var t=s,e=t.lib.WordArray,n=(r=t.algo).SHA256,r=r.SHA224=n.extend({_doReset:function(){this._hash=new e.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=n._doFinalize.call(this);return t.sigBytes-=4,t}});t.SHA224=n._createHelper(r),t.HmacSHA224=n._createHmacHelper(r)}(),function(){function t(){return r.create.apply(r,arguments)}for(var e=s,n=e.lib.Hasher,r=(o=e.x64).Word,i=o.WordArray,o=e.algo,a=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],c=[],u=0;80>u;u++)c[u]=t();o=o.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=(h=this._hash.words)[0],r=h[1],i=h[2],s=h[3],o=h[4],u=h[5],l=h[6],h=h[7],d=n.high,f=n.low,p=r.high,g=r.low,y=i.high,v=i.low,m=s.high,_=s.low,b=o.high,w=o.low,S=u.high,C=u.low,E=l.high,x=l.low,T=h.high,A=h.low,k=d,O=f,P=p,R=g,I=y,F=v,D=m,N=_,j=b,M=w,B=S,L=C,H=E,q=x,U=T,V=A,K=0;80>K;K++){var $=c[K];if(16>K)var W=$.high=0|t[e+2*K],z=$.low=0|t[e+2*K+1];else{W=((z=(W=c[K-15]).high)>>>1|(G=W.low)<<31)^(z>>>8|G<<24)^z>>>7;var G=(G>>>1|z<<31)^(G>>>8|z<<24)^(G>>>7|z<<25),Q=((z=(Q=c[K-2]).high)>>>19|(J=Q.low)<<13)^(z<<3|J>>>29)^z>>>6,J=(J>>>19|z<<13)^(J<<3|z>>>29)^(J>>>6|z<<26),Y=(z=c[K-7]).high,X=(Z=c[K-16]).high,Z=Z.low;W=(W=(W=W+Y+((z=G+z.low)>>>0<G>>>0?1:0))+Q+((z=z+J)>>>0<J>>>0?1:0))+X+((z=z+Z)>>>0<Z>>>0?1:0);$.high=W,$.low=z}Y=j&B^~j&H,Z=M&L^~M&q,$=k&P^k&I^P&I;var tt=O&R^O&F^R&F,et=(G=(k>>>28|O<<4)^(k<<30|O>>>2)^(k<<25|O>>>7),Q=(O>>>28|k<<4)^(O<<30|k>>>2)^(O<<25|k>>>7),(J=a[K]).high),nt=J.low;X=(X=(X=(X=U+((j>>>14|M<<18)^(j>>>18|M<<14)^(j<<23|M>>>9))+((J=V+((M>>>14|j<<18)^(M>>>18|j<<14)^(M<<23|j>>>9)))>>>0<V>>>0?1:0))+Y+((J=J+Z)>>>0<Z>>>0?1:0))+et+((J=J+nt)>>>0<nt>>>0?1:0))+W+((J=J+z)>>>0<z>>>0?1:0),$=G+$+((z=Q+tt)>>>0<Q>>>0?1:0),U=H,V=q,H=B,q=L,B=j,L=M,j=D+X+((M=N+J|0)>>>0<N>>>0?1:0)|0,D=I,N=F,I=P,F=R,P=k,R=O,k=X+$+((O=J+z|0)>>>0<J>>>0?1:0)|0}f=n.low=f+O,n.high=d+k+(f>>>0<O>>>0?1:0),g=r.low=g+R,r.high=p+P+(g>>>0<R>>>0?1:0),v=i.low=v+F,i.high=y+I+(v>>>0<F>>>0?1:0),_=s.low=_+N,s.high=m+D+(_>>>0<N>>>0?1:0),w=o.low=w+M,o.high=b+j+(w>>>0<M>>>0?1:0),C=u.low=C+L,u.high=S+B+(C>>>0<L>>>0?1:0),x=l.low=x+q,l.high=E+H+(x>>>0<q>>>0?1:0),A=h.low=A+V,h.high=T+U+(A>>>0<V>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),e[31+(r+128>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32}),e.SHA512=n._createHelper(o),e.HmacSHA512=n._createHmacHelper(o)}(),function(){var t=s,e=(i=t.x64).Word,n=i.WordArray,r=(i=t.algo).SHA512,i=i.SHA384=r.extend({_doReset:function(){this._hash=new n.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var t=r._doFinalize.call(this);return t.sigBytes-=16,t}});t.SHA384=r._createHelper(i),t.HmacSHA384=r._createHmacHelper(i)}(),function(){var t=s,e=(r=t.lib).WordArray,n=r.Hasher,r=t.algo,i=e.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=e.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),a=e.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=e.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=e.create([0,1518500249,1859775393,2400959708,2840853838]),l=e.create([1352829926,1548603684,1836072691,2053994217,0]);r=r.RIPEMD160=n.extend({_doReset:function(){this._hash=e.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=0;16>n;n++){var r=t[b=e+n];t[b]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var s,h,d,f,p,g,y,v,m,_,b=this._hash.words,w=(r=u.words,l.words),S=i.words,C=o.words,E=a.words,x=c.words;g=s=b[0],y=h=b[1],v=d=b[2],m=f=b[3],_=p=b[4];var T;for(n=0;80>n;n+=1)T=s+t[e+S[n]]|0,T=16>n?T+((h^d^f)+r[0]):32>n?T+((h&d|~h&f)+r[1]):48>n?T+(((h|~d)^f)+r[2]):64>n?T+((h&f|d&~f)+r[3]):T+((h^(d|~f))+r[4]),T=(T=(T|=0)<<E[n]|T>>>32-E[n])+p|0,s=p,p=f,f=d<<10|d>>>22,d=h,h=T,T=g+t[e+C[n]]|0,T=16>n?T+((y^(v|~m))+w[0]):32>n?T+((y&m|v&~m)+w[1]):48>n?T+(((y|~v)^m)+w[2]):64>n?T+((y&v|~y&m)+w[3]):T+((y^v^m)+w[4]),T=(T=(T|=0)<<x[n]|T>>>32-x[n])+_|0,g=_,_=m,m=v<<10|v>>>22,v=y,y=T;T=b[1]+d+m|0,b[1]=b[2]+f+_|0,b[2]=b[3]+p+g|0,b[3]=b[4]+s+y|0,b[4]=b[0]+h+v|0,b[0]=T},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;for(e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process(),e=(t=this._hash).words,n=0;5>n;n++)r=e[n],e[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.RIPEMD160=n._createHelper(r),t.HmacRIPEMD160=n._createHmacHelper(r)}(Math),function(){var t=s,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=e.parse(n));var r=t.blockSize,i=4*r;n.sigBytes>i&&(n=t.finalize(n)),n.clamp();for(var s=this._oKey=n.clone(),o=this._iKey=n.clone(),a=s.words,c=o.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;s.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(){var t,e=s,n=(t=e.lib).Base,r=t.WordArray,i=(t=e.algo).HMAC,o=t.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:t.SHA1,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){var n=this.cfg,s=i.create(n.hasher,t),o=r.create(),a=r.create([1]),c=o.words,u=a.words,l=n.keySize;for(n=n.iterations;c.length<l;){var h=s.update(e).finalize(a);s.reset();for(var d=h.words,f=d.length,p=h,g=1;g<n;g++){p=s.finalize(p),s.reset();for(var y=p.words,v=0;v<f;v++)d[v]^=y[v]}o.concat(h),u[0]++}return o.sigBytes=4*l,o}});e.PBKDF2=function(t,e,n){return o.create(n).compute(t,e)}}();
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
var o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="=";function u(t){var e,n,r="";for(e=0;e+3<=t.length;e+=3)n=parseInt(t.substring(e,e+3),16),r+=a.charAt(n>>6)+a.charAt(63&n);if(e+1==t.length?(n=parseInt(t.substring(e,e+1),16),r+=a.charAt(n<<2)):e+2==t.length&&(n=parseInt(t.substring(e,e+2),16),r+=a.charAt(n>>2)+a.charAt((3&n)<<4)),c)for(;(3&r.length)>0;)r+=c;return r}function l(t){var e,n,r,i="",s=0;for(e=0;e<t.length&&t.charAt(e)!=c;++e)(r=a.indexOf(t.charAt(e)))<0||(0==s?(i+=m(r>>2),n=3&r,s=1):1==s?(i+=m(n<<2|r>>4),n=15&r,s=2):2==s?(i+=m(n),i+=m(r>>2),n=3&r,s=3):(i+=m(n<<2|r>>4),i+=m(15&r),s=0));return 1==s&&(i+=m(n<<2)),i}function h(t){var e,n=l(t),r=new Array;for(e=0;2*e<n.length;++e)r[e]=parseInt(n.substring(2*e,2*e+2),16);return r}function d(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function f(){return new d(null)}"Microsoft Internet Explorer"==n.appName?(d.prototype.am=function(t,e,n,r,i,s){for(var o=32767&e,a=e>>15;--s>=0;){var c=32767&this[t],u=this[t++]>>15,l=a*c+u*o;i=((c=o*c+((32767&l)<<15)+n[r]+(1073741823&i))>>>30)+(l>>>15)+a*u+(i>>>30),n[r++]=1073741823&c}return i},o=30):"Netscape"!=n.appName?(d.prototype.am=function(t,e,n,r,i,s){for(;--s>=0;){var o=e*this[t++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=67108863&o}return i},o=26):(d.prototype.am=function(t,e,n,r,i,s){for(var o=16383&e,a=e>>14;--s>=0;){var c=16383&this[t],u=this[t++]>>14,l=a*c+u*o;i=((c=o*c+((16383&l)<<14)+n[r]+i)>>28)+(l>>14)+a*u,n[r++]=268435455&c}return i},o=28),d.prototype.DB=o,d.prototype.DM=(1<<o)-1,d.prototype.DV=1<<o;d.prototype.FV=Math.pow(2,52),d.prototype.F1=52-o,d.prototype.F2=2*o-52;var p,g,y="0123456789abcdefghijklmnopqrstuvwxyz",v=new Array;for(p="0".charCodeAt(0),g=0;g<=9;++g)v[p++]=g;for(p="a".charCodeAt(0),g=10;g<36;++g)v[p++]=g;for(p="A".charCodeAt(0),g=10;g<36;++g)v[p++]=g;function m(t){return y.charAt(t)}function _(t,e){var n=v[t.charCodeAt(e)];return null==n?-1:n}function b(t){var e=f();return e.fromInt(t),e}function w(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function S(t){this.m=t}function C(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function E(t,e){return t&e}function x(t,e){return t|e}function T(t,e){return t^e}function A(t,e){return t&~e}function k(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function O(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function P(){}function R(t){return t}function I(t){this.r2=f(),this.q3=f(),d.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}S.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},S.prototype.revert=function(t){return t},S.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},S.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},S.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},C.prototype.convert=function(t){var e=f();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(d.ZERO)>0&&this.m.subTo(e,e),e},C.prototype.revert=function(t){var e=f();return t.copyTo(e),this.reduce(e),e},C.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],r=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},C.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},C.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},d.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},d.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},d.prototype.fromString=function(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var r=t.length,i=!1,s=0;--r>=0;){var o=8==n?255&t[r]:_(t,r);o<0?"-"==t.charAt(r)&&(i=!0):(i=!1,0==s?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&d.ZERO.subTo(this,this)},d.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},d.prototype.dlShiftTo=function(t,e){var n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s},d.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},d.prototype.lShiftTo=function(t,e){var n,r=t%this.DB,i=this.DB-r,s=(1<<i)-1,o=Math.floor(t/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)e[n+o+1]=this[n]>>i|a,a=(this[n]&s)<<r;for(n=o-1;n>=0;--n)e[n]=0;e[o]=a,e.t=this.t+o+1,e.s=this.s,e.clamp()},d.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var r=t%this.DB,i=this.DB-r,s=(1<<r)-1;e[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)e[o-n-1]|=(this[o]&s)<<i,e[o-n]=this[o]>>r;r>0&&(e[this.t-n-1]|=(this.s&s)<<i),e.t=this.t-n,e.clamp()}},d.prototype.subTo=function(t,e){for(var n=0,r=0,i=Math.min(t.t,this.t);n<i;)r+=this[n]-t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r-=t[n],e[n++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[n++]=this.DV+r:r>0&&(e[n++]=r),e.t=n,e.clamp()},d.prototype.multiplyTo=function(t,e){var n=this.abs(),r=t.abs(),i=n.t;for(e.t=i+r.t;--i>=0;)e[i]=0;for(i=0;i<r.t;++i)e[i+n.t]=n.am(0,r[i],e,i,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&d.ZERO.subTo(e,e)},d.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){var r=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,r,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},d.prototype.divRemTo=function(t,e,n){var r=t.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=f());var s=f(),o=this.s,a=t.s,c=this.DB-w(r[r.t-1]);c>0?(r.lShiftTo(c,s),i.lShiftTo(c,n)):(r.copyTo(s),i.copyTo(n));var u=s.t,l=s[u-1];if(0!=l){var h=l*(1<<this.F1)+(u>1?s[u-2]>>this.F2:0),p=this.FV/h,g=(1<<this.F1)/h,y=1<<this.F2,v=n.t,m=v-u,_=null==e?f():e;for(s.dlShiftTo(m,_),n.compareTo(_)>=0&&(n[n.t++]=1,n.subTo(_,n)),d.ONE.dlShiftTo(u,_),_.subTo(s,s);s.t<u;)s[s.t++]=0;for(;--m>=0;){var b=n[--v]==l?this.DM:Math.floor(n[v]*p+(n[v-1]+y)*g);if((n[v]+=s.am(0,b,n,m,0,u))<b)for(s.dlShiftTo(m,_),n.subTo(_,n);n[v]<--b;)n.subTo(_,n)}null!=e&&(n.drShiftTo(u,e),o!=a&&d.ZERO.subTo(e,e)),n.t=u,n.clamp(),c>0&&n.rShiftTo(c,n),o<0&&d.ZERO.subTo(n,n)}}},d.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},d.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},d.prototype.exp=function(t,e){if(t>4294967295||t<1)return d.ONE;var n=f(),r=f(),i=e.convert(this),s=w(t)-1;for(i.copyTo(n);--s>=0;)if(e.sqrTo(n,r),(t&1<<s)>0)e.mulTo(r,i,n);else{var o=n;n=r,r=o}return e.revert(n)},d.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,r=(1<<e)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this[o]>>a)>0&&(i=!0,s=m(n));o>=0;)a<e?(n=(this[o]&(1<<a)-1)<<e-a,n|=this[--o]>>(a+=this.DB-e)):(n=this[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=m(n));return i?s:"0"},d.prototype.negate=function(){var t=f();return d.ZERO.subTo(this,t),t},d.prototype.abs=function(){return this.s<0?this.negate():this},d.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;--n>=0;)if(0!=(e=this[n]-t[n]))return e;return 0},d.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+w(this[this.t-1]^this.s&this.DM)},d.prototype.mod=function(t){var e=f();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(d.ZERO)>0&&t.subTo(e,e),e},d.prototype.modPowInt=function(t,e){var n;return n=t<256||e.isEven()?new S(e):new C(e),this.exp(t,n)},d.ZERO=b(0),d.ONE=b(1),P.prototype.convert=R,P.prototype.revert=R,P.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},P.prototype.sqrTo=function(t,e){t.squareTo(e)},I.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=f();return t.copyTo(e),this.reduce(e),e},I.prototype.revert=function(t){return t},I.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},I.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},I.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var F=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],D=(1<<26)/F[F.length-1];
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
function N(){this.i=0,this.j=0,this.S=new Array}d.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},d.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),r=b(n),i=f(),s=f(),o="";for(this.divRemTo(r,i,s);i.signum()>0;)o=(n+s.intValue()).toString(t).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(t)+o},d.prototype.fromRadix=function(t,e){this.fromInt(0),null==e&&(e=10);for(var n=this.chunkSize(e),r=Math.pow(e,n),i=!1,s=0,o=0,a=0;a<t.length;++a){var c=_(t,a);c<0?"-"==t.charAt(a)&&0==this.signum()&&(i=!0):(o=e*o+c,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&d.ZERO.subTo(this,this)},d.prototype.fromNumber=function(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(d.ONE.shiftLeft(t-1),x,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(d.ONE.shiftLeft(t-1),this);else{var r=new Array,i=7&t;r.length=1+(t>>3),e.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}},d.prototype.bitwiseTo=function(t,e,n){var r,i,s=Math.min(t.t,this.t);for(r=0;r<s;++r)n[r]=e(this[r],t[r]);if(t.t<this.t){for(i=t.s&this.DM,r=s;r<this.t;++r)n[r]=e(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=s;r<t.t;++r)n[r]=e(i,t[r]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},d.prototype.changeBit=function(t,e){var n=d.ONE.shiftLeft(t);return this.bitwiseTo(n,e,n),n},d.prototype.addTo=function(t,e){for(var n=0,r=0,i=Math.min(t.t,this.t);n<i;)r+=this[n]+t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r+=t[n],e[n++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[n++]=r:r<-1&&(e[n++]=this.DV+r),e.t=n,e.clamp()},d.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},d.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},d.prototype.multiplyLowerTo=function(t,e,n){var r,i=Math.min(this.t+t.t,e);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,t[i],n,i,0,this.t);for(r=Math.min(t.t,e);i<r;++i)this.am(0,t[i],n,i,0,e-i);n.clamp()},d.prototype.multiplyUpperTo=function(t,e,n){--e;var r=n.t=this.t+t.t-e;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)n[this.t+r-e]=this.am(e-r,t[r],n,0,0,this.t+r-e);n.clamp(),n.drShiftTo(1,n)},d.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(0==e)n=this[0]%t;else for(var r=this.t-1;r>=0;--r)n=(e*n+this[r])%t;return n},d.prototype.millerRabin=function(t){var e=this.subtract(d.ONE),n=e.getLowestSetBit();if(n<=0)return!1;var r=e.shiftRight(n);(t=t+1>>1)>F.length&&(t=F.length);for(var i=f(),s=0;s<t;++s){i.fromInt(F[Math.floor(Math.random()*F.length)]);var o=i.modPow(r,this);if(0!=o.compareTo(d.ONE)&&0!=o.compareTo(e)){for(var a=1;a++<n&&0!=o.compareTo(e);)if(0==(o=o.modPowInt(2,this)).compareTo(d.ONE))return!1;if(0!=o.compareTo(e))return!1}}return!0},d.prototype.clone=
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
function(){var t=f();return this.copyTo(t),t},d.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},d.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},d.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},d.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},d.prototype.toByteArray=function(){var t=this.t,e=new Array;e[0]=this.s;var n,r=this.DB-t*this.DB%8,i=0;if(t-- >0)for(r<this.DB&&(n=this[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this[t]&(1<<r)-1)<<8-r,n|=this[--t]>>(r+=this.DB-8)):(n=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e},d.prototype.equals=function(t){return 0==this.compareTo(t)},d.prototype.min=function(t){return this.compareTo(t)<0?this:t},d.prototype.max=function(t){return this.compareTo(t)>0?this:t},d.prototype.and=function(t){var e=f();return this.bitwiseTo(t,E,e),e},d.prototype.or=function(t){var e=f();return this.bitwiseTo(t,x,e),e},d.prototype.xor=function(t){var e=f();return this.bitwiseTo(t,T,e),e},d.prototype.andNot=function(t){var e=f();return this.bitwiseTo(t,A,e),e},d.prototype.not=function(){for(var t=f(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},d.prototype.shiftLeft=function(t){var e=f();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},d.prototype.shiftRight=function(t){var e=f();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},d.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+k(this[t]);return this.s<0?this.t*this.DB:-1},d.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=O(this[n]^e);return t},d.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},d.prototype.setBit=function(t){return this.changeBit(t,x)},d.prototype.clearBit=function(t){return this.changeBit(t,A)},d.prototype.flipBit=function(t){return this.changeBit(t,T)},d.prototype.add=function(t){var e=f();return this.addTo(t,e),e},d.prototype.subtract=function(t){var e=f();return this.subTo(t,e),e},d.prototype.multiply=function(t){var e=f();return this.multiplyTo(t,e),e},d.prototype.divide=function(t){var e=f();return this.divRemTo(t,e,null),e},d.prototype.remainder=function(t){var e=f();return this.divRemTo(t,null,e),e},d.prototype.divideAndRemainder=function(t){var e=f(),n=f();return this.divRemTo(t,e,n),new Array(e,n)},d.prototype.modPow=function(t,e){var n,r,i=t.bitLength(),s=b(1);if(i<=0)return s;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new S(e):e.isEven()?new I(e):new C(e);var o=new Array,a=3,c=n-1,u=(1<<n)-1;if(o[1]=r.convert(this),n>1){var l=f();for(r.sqrTo(o[1],l);a<=u;)o[a]=f(),r.mulTo(l,o[a-2],o[a]),a+=2}var h,d,p=t.t-1,g=!0,y=f();for(i=w(t[p])-1;p>=0;){for(i>=c?h=t[p]>>i-c&u:(h=(t[p]&(1<<i+1)-1)<<c-i,p>0&&(h|=t[p-1]>>this.DB+i-c)),a=n;0==(1&h);)h>>=1,--a;if((i-=a)<0&&(i+=this.DB,--p),g)o[h].copyTo(s),g=!1;else{for(;a>1;)r.sqrTo(s,y),r.sqrTo(y,s),a-=2;a>0?r.sqrTo(s,y):(d=s,s=y,y=d),r.mulTo(y,o[h],s)}for(;p>=0&&0==(t[p]&1<<i);)r.sqrTo(s,y),d=s,s=y,y=d,--i<0&&(i=this.DB-1,--p)}return r.revert(s)},d.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return d.ZERO;for(var n=t.clone(),r=this.clone(),i=b(1),s=b(0),o=b(0),a=b(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(t,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;r.isEven();)r.rShiftTo(1,r),e?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);n.compareTo(r)>=0?(n.subTo(r,n),e&&i.subTo(o,i),s.subTo(a,s)):(r.subTo(n,r),e&&o.subTo(i,o),a.subTo(s,a))}return 0!=r.compareTo(d.ONE)?d.ZERO:a.compareTo(t)>=0?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a},d.prototype.pow=function(t){return this.exp(t,new P)},d.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(e.compareTo(n)<0){var r=e;e=n,n=r}var i=e.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),n.rShiftTo(s,n));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),e.compareTo(n)>=0?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n},d.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=F[F.length-1]){for(e=0;e<F.length;++e)if(n[0]==F[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<F.length;){for(var r=F[e],i=e+1;i<F.length&&r<D;)r*=F[i++];for(r=n.modInt(r);e<i;)if(r%F[e++]==0)return!1}return n.millerRabin(t)},d.prototype.square=function(){var t=f();return this.squareTo(t),t},N.prototype.init=function(t){var e,n,r;for(e=0;e<256;++e)this.S[e]=e;for(n=0,e=0;e<256;++e)n=n+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[n],this.S[n]=r;this.i=0,this.j=0},N.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var j,M,B,L=256;
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function H(){!function(t){M[B++]^=255&t,M[B++]^=t>>8&255,M[B++]^=t>>16&255,M[B++]^=t>>24&255,B>=L&&(B-=L)}((new Date).getTime())}if(null==M){var q;if(M=new Array,B=0,void 0!==r&&(void 0!==r.crypto||void 0!==r.msCrypto)){var U=r.crypto||r.msCrypto;if(U.getRandomValues){var V=new Uint8Array(32);for(U.getRandomValues(V),q=0;q<32;++q)M[B++]=V[q]}else if("Netscape"==n.appName&&n.appVersion<"5"){var K=r.crypto.random(32);for(q=0;q<K.length;++q)M[B++]=255&K.charCodeAt(q)}}for(;B<L;)q=Math.floor(65536*Math.random()),M[B++]=q>>>8,M[B++]=255&q;B=0,H()}function $(){if(null==j){for(H(),(j=new N).init(M),B=0;B<M.length;++B)M[B]=0;B=0}return j.next()}function W(){}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
function z(t,e){return new d(t,e)}function G(t,e,n){for(var r="",i=0;r.length<e;)r+=n(String.fromCharCode.apply(String,t.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return r}function Q(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function J(t,e,n){for(var r="",i=0;r.length<e;)r+=n(t+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return r}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
function Y(t,e){this.x=e,this.q=t}function X(t,e,n,r){this.curve=t,this.x=e,this.y=n,this.z=null==r?d.ONE:r,this.zinv=null}function Z(t,e,n){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(n),this.infinity=new X(this,null,null)}W.prototype.nextBytes=function(t){var e;for(e=0;e<t.length;++e)t[e]=$()},Q.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},Q.prototype.setPublic=function(t,e){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof t)this.n=t,this.e=e;else{if(!(null!=t&&null!=e&&t.length>0&&e.length>0))throw"Invalid RSA public key";this.n=z(t,16),this.e=parseInt(e,16)}},Q.prototype.encrypt=function(t){var e=function(t,e){if(e<t.length+11)throw"Message too long for RSA";for(var n=new Array,r=t.length-1;r>=0&&e>0;){var i=t.charCodeAt(r--);i<128?n[--e]=i:i>127&&i<2048?(n[--e]=63&i|128,n[--e]=i>>6|192):(n[--e]=63&i|128,n[--e]=i>>6&63|128,n[--e]=i>>12|224)}n[--e]=0;for(var s=new W,o=new Array;e>2;){for(o[0]=0;0==o[0];)s.nextBytes(o);n[--e]=o[0]}return n[--e]=2,n[--e]=0,new d(n)}(t,this.n.bitLength()+7>>3);if(null==e)return null;var n=this.doPublic(e);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r},Q.prototype.encryptOAEP=function(t,e,n){var r=function(t,e,n,r){var i=et.crypto.MessageDigest,s=et.crypto.Util,o=null;if(n||(n="sha1"),"string"==typeof n&&(o=i.getCanonicalAlgName(n),r=i.getHashLength(o),n=function(t){return gt(s.hashHex(yt(t),o))}),t.length+2*r+2>e)throw"Message too long for RSA";var a,c="";for(a=0;a<e-t.length-2*r-2;a+=1)c+="\0";var u=n("")+c+""+t,l=new Array(r);(new W).nextBytes(l);var h=G(l,u.length,n),f=[];for(a=0;a<u.length;a+=1)f[a]=u.charCodeAt(a)^h.charCodeAt(a);var p=G(f,l.length,n),g=[0];for(a=0;a<l.length;a+=1)g[a+1]=l[a]^p.charCodeAt(a);return new d(g.concat(f))}(t,this.n.bitLength()+7>>3,e,n);if(null==r)return null;var i=this.doPublic(r);if(null==i)return null;var s=i.toString(16);return 0==(1&s.length)?s:"0"+s},Q.prototype.type="RSA",Q.prototype.doPrivate=function(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),n=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(n)<0;)e=e.add(this.p);return e.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)},Q.prototype.setPrivate=function(t,e,n){if(this.isPrivate=!0,"string"!=typeof t)this.n=t,this.e=e,this.d=n;else{if(!(null!=t&&null!=e&&t.length>0&&e.length>0))throw"Invalid RSA private key";this.n=z(t,16),this.e=parseInt(e,16),this.d=z(n,16)}},Q.prototype.setPrivateEx=function(t,e,n,r,i,s,o,a){if(this.isPrivate=!0,this.isPublic=!1,null==t)throw"RSASetPrivateEx N == null";if(null==e)throw"RSASetPrivateEx E == null";if(0==t.length)throw"RSASetPrivateEx N.length == 0";if(0==e.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=t&&null!=e&&t.length>0&&e.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=z(t,16),this.e=parseInt(e,16),this.d=z(n,16),this.p=z(r,16),this.q=z(i,16),this.dmp1=z(s,16),this.dmq1=z(o,16),this.coeff=z(a,16)},Q.prototype.generate=function(t,e){var n=new W,r=t>>1;this.e=parseInt(e,16);for(var i=new d(e,16);;){for(;this.p=new d(t-r,1,n),0!=this.p.subtract(d.ONE).gcd(i).compareTo(d.ONE)||!this.p.isProbablePrime(10););for(;this.q=new d(r,1,n),0!=this.q.subtract(d.ONE).gcd(i).compareTo(d.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var o=this.p.subtract(d.ONE),a=this.q.subtract(d.ONE),c=o.multiply(a);if(0==c.gcd(i).compareTo(d.ONE)){this.n=this.p.multiply(this.q),this.d=i.modInverse(c),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0},Q.prototype.decrypt=function(t){var e=z(t,16),n=this.doPrivate(e);return null==n?null:
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */
function(t,e){for(var n=t.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=e-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var s=255&n[r];s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((31&s)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&s)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}(n,this.n.bitLength()+7>>3)},Q.prototype.decryptOAEP=function(t,e,n){var r=z(t,16),i=this.doPrivate(r);return null==i?null:function(t,e,n,r){var i=et.crypto.MessageDigest,s=et.crypto.Util,o=null;for(n||(n="sha1"),"string"==typeof n&&(o=i.getCanonicalAlgName(n),r=i.getHashLength(o),n=function(t){return gt(s.hashHex(yt(t),o))}),t=t.toByteArray(),a=0;a<t.length;a+=1)t[a]&=255;for(;t.length<e;)t.unshift(0);if((t=String.fromCharCode.apply(String,t)).length<2*r+2)throw"Cipher too short";var a,c=t.substr(1,r),u=t.substr(r+1),l=J(u,r,n),h=[];for(a=0;a<c.length;a+=1)h[a]=c.charCodeAt(a)^l.charCodeAt(a);var d=J(String.fromCharCode.apply(String,h),t.length-r,n),f=[];for(a=0;a<u.length;a+=1)f[a]=u.charCodeAt(a)^d.charCodeAt(a);if((f=String.fromCharCode.apply(String,f)).substr(0,r)!==n(""))throw"Hash mismatch";var p=(f=f.substr(r)).indexOf("");if((-1!=p?f.substr(0,p).lastIndexOf("\0"):-1)+1!=p)throw"Malformed data";return f.substr(p+1)}(i,this.n.bitLength()+7>>3,e,n)},Y.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.x.equals(t.x)},Y.prototype.toBigInteger=function(){return this.x},Y.prototype.negate=function(){return new Y(this.q,this.x.negate().mod(this.q))},Y.prototype.add=function(t){return new Y(this.q,this.x.add(t.toBigInteger()).mod(this.q))},Y.prototype.subtract=function(t){return new Y(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))},Y.prototype.multiply=function(t){return new Y(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))},Y.prototype.square=function(){return new Y(this.q,this.x.square().mod(this.q))},Y.prototype.divide=function(t){return new Y(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))},X.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},X.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},X.prototype.equals=function(t){return t==this||(this.isInfinity()?t.isInfinity():t.isInfinity()?this.isInfinity():!!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(d.ZERO)&&t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(d.ZERO))},X.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(d.ZERO)&&!this.y.toBigInteger().equals(d.ZERO)},X.prototype.negate=function(){return new X(this.curve,this.x,this.y.negate(),this.z)},X.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var e=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),n=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q);if(d.ZERO.equals(n))return d.ZERO.equals(e)?this.twice():this.curve.getInfinity();var r=new d("3"),i=this.x.toBigInteger(),s=this.y.toBigInteger(),o=(t.x.toBigInteger(),t.y.toBigInteger(),n.square()),a=o.multiply(n),c=i.multiply(o),u=e.square().multiply(this.z),l=u.subtract(c.shiftLeft(1)).multiply(t.z).subtract(a).multiply(n).mod(this.curve.q),h=c.multiply(r).multiply(e).subtract(s.multiply(a)).subtract(u.multiply(e)).multiply(t.z).add(e.multiply(a)).mod(this.curve.q),f=a.multiply(this.z).multiply(t.z).mod(this.curve.q);return new X(this.curve,this.curve.fromBigInteger(l),this.curve.fromBigInteger(h),f)},X.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var t=new d("3"),e=this.x.toBigInteger(),n=this.y.toBigInteger(),r=n.multiply(this.z),i=r.multiply(n).mod(this.curve.q),s=this.curve.a.toBigInteger(),o=e.square().multiply(t);d.ZERO.equals(s)||(o=o.add(this.z.square().multiply(s)));var a=(o=o.mod(this.curve.q)).square().subtract(e.shiftLeft(3).multiply(i)).shiftLeft(1).multiply(r).mod(this.curve.q),c=o.multiply(t).multiply(e).subtract(i.shiftLeft(1)).shiftLeft(2).multiply(i).subtract(o.square().multiply(o)).mod(this.curve.q),u=r.square().multiply(r).shiftLeft(3).mod(this.curve.q);return new X(this.curve,this.curve.fromBigInteger(a),this.curve.fromBigInteger(c),u)},X.prototype.multiply=function(t){if(this.isInfinity())return this;if(0==t.signum())return this.curve.getInfinity();var e,n=t,r=n.multiply(new d("3")),i=this.negate(),s=this;for(e=r.bitLength()-2;e>0;--e){s=s.twice();var o=r.testBit(e);o!=n.testBit(e)&&(s=s.add(o?this:i))}return s},X.prototype.multiplyTwo=function(t,e,n){var r;r=t.bitLength()>n.bitLength()?t.bitLength()-1:n.bitLength()-1;for(var i=this.curve.getInfinity(),s=this.add(e);r>=0;)i=i.twice(),t.testBit(r)?i=n.testBit(r)?i.add(s):i.add(this):n.testBit(r)&&(i=i.add(e)),--r;return i},Z.prototype.getQ=function(){return this.q},Z.prototype.getA=function(){return this.a},Z.prototype.getB=function(){return this.b},Z.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)},Z.prototype.getInfinity=function(){return this.infinity},Z.prototype.fromBigInteger=function(t){return new Y(this.q,t)},Z.prototype.decodePointHex=function(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var e=(t.length-2)/2,n=t.substr(2,e),r=t.substr(e+2,e);return new X(this,this.fromBigInteger(new d(n,16)),this.fromBigInteger(new d(r,16)));default:return null}},
/*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
 */
Y.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},X.prototype.getEncoded=function(t){var e=function(t,e){var n=t.toByteArrayUnsigned();if(e<n.length)n=n.slice(n.length-e);else for(;e>n.length;)n.unshift(0);return n},n=this.getX().toBigInteger(),r=this.getY().toBigInteger(),i=e(n,32);return t?r.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(e(r,32))),i},X.decodeFrom=function(t,e){e[0];var n=e.length-1,r=e.slice(1,1+n/2),i=e.slice(1+n/2,1+n);r.unshift(0),i.unshift(0);var s=new d(r),o=new d(i);return new X(t,t.fromBigInteger(s),t.fromBigInteger(o))},X.decodeFromHex=function(t,e){e.substr(0,2);var n=e.length-2,r=e.substr(2,n/2),i=e.substr(2+n/2,n/2),s=new d(r,16),o=new d(i,16);return new X(t,t.fromBigInteger(s),t.fromBigInteger(o))},X.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var e=t.x.subtract(this.x),n=t.y.subtract(this.y).divide(e),r=n.square().subtract(this.x).subtract(t.x),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new X(this.curve,r,i)},X.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var t=this.curve.fromBigInteger(d.valueOf(2)),e=this.curve.fromBigInteger(d.valueOf(3)),n=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(t)),r=n.square().subtract(this.x.multiply(t)),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new X(this.curve,r,i)},X.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(0==t.signum())return this.curve.getInfinity();var e,n=t,r=n.multiply(new d("3")),i=this.negate(),s=this;for(e=r.bitLength()-2;e>0;--e){s=s.twice();var o=r.testBit(e);o!=n.testBit(e)&&(s=s.add2D(o?this:i))}return s},X.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),e=this.getY().toBigInteger(),n=this.curve.getA().toBigInteger(),r=this.curve.getB().toBigInteger(),i=this.curve.getQ(),s=e.multiply(e).mod(i),o=t.multiply(t).multiply(t).add(n.multiply(t)).add(r).mod(i);return s.equals(o)},X.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},X.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),n=this.getY().toBigInteger();if(e.compareTo(d.ONE)<0||e.compareTo(t.subtract(d.ONE))>0)throw new Error("x coordinate out of bounds");if(n.compareTo(d.ONE)<0||n.compareTo(t.subtract(d.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};
/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */
var tt=function(){var t=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),e=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function r(t,e,r){return e?n[e]:String.fromCharCode(parseInt(r,16))}var i=new String(""),s=(Object,Array,Object.hasOwnProperty);return function(n,o){var a,c,u=n.match(t),l=u[0],h=!1;"{"===l?a={}:"["===l?a=[]:(a=[],h=!0);for(var d=[a],f=1-h,p=u.length;f<p;++f){var g;switch((l=u[f]).charCodeAt(0)){default:(g=d[0])[c||g.length]=+l,c=void 0;break;case 34:if(-1!==(l=l.substring(1,l.length-1)).indexOf("\\")&&(l=l.replace(e,r)),g=d[0],!c){if(!(g instanceof Array)){c=l||i;break}c=g.length}g[c]=l,c=void 0;break;case 91:g=d[0],d.unshift(g[c||g.length]=[]),c=void 0;break;case 93:d.shift();break;case 102:(g=d[0])[c||g.length]=!1,c=void 0;break;case 110:(g=d[0])[c||g.length]=null,c=void 0;break;case 116:(g=d[0])[c||g.length]=!0,c=void 0;break;case 123:g=d[0],d.unshift(g[c||g.length]={}),c=void 0;break;case 125:d.shift()}}if(h){if(1!==d.length)throw new Error;a=a[0]}else if(d.length)throw new Error;if(o){var y=function(t,e){var n=t[e];if(n&&"object"==typeof n){var r=null;for(var i in n)if(s.call(n,i)&&n!==t){var a=y(n,i);void 0!==a?n[i]=a:(r||(r=[]),r.push(i))}if(r)for(var c=r.length;--c>=0;)delete n[r[c]]}return o.call(t,e,n)};a=y({"":a},"")}return a}}();void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),et.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if("-"!=e.substr(0,1))e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var n=e.substr(1).length;n%2==1?n+=1:e.match(/^[0-7]/)||(n+=2);for(var r="",i=0;i<n;i++)r+="f";e=new d(r,16).xor(t).add(d.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return bt(t,e)},this.newObject=function(t){var e=et.asn1,n=e.DERBoolean,r=e.DERInteger,i=e.DERBitString,s=e.DEROctetString,o=e.DERNull,a=e.DERObjectIdentifier,c=e.DEREnumerated,u=e.DERUTF8String,l=e.DERNumericString,h=e.DERPrintableString,d=e.DERTeletexString,f=e.DERIA5String,p=e.DERUTCTime,g=e.DERGeneralizedTime,y=e.DERSequence,v=e.DERSet,m=e.DERTaggedObject,_=e.ASN1Util.newObject,b=Object.keys(t);if(1!=b.length)throw"key of param shall be only one.";var w=b[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+w+":"))throw"undefined key: "+w;if("bool"==w)return new n(t[w]);if("int"==w)return new r(t[w]);if("bitstr"==w)return new i(t[w]);if("octstr"==w)return new s(t[w]);if("null"==w)return new o(t[w]);if("oid"==w)return new a(t[w]);if("enum"==w)return new c(t[w]);if("utf8str"==w)return new u(t[w]);if("numstr"==w)return new l(t[w]);if("prnstr"==w)return new h(t[w]);if("telstr"==w)return new d(t[w]);if("ia5str"==w)return new f(t[w]);if("utctime"==w)return new p(t[w]);if("gentime"==w)return new g(t[w]);if("seq"==w){for(var S=t[w],C=[],E=0;E<S.length;E++){var x=_(S[E]);C.push(x)}return new y({array:C})}if("set"==w){for(S=t[w],C=[],E=0;E<S.length;E++){x=_(S[E]);C.push(x)}return new v({array:C})}if("tag"==w){var T=t[w];if("[object Array]"===Object.prototype.toString.call(T)&&3==T.length){var A=_(T[2]);return new m({tag:T[0],explicit:T[1],obj:A})}var k={};if(void 0!==T.explicit&&(k.explicit=T.explicit),void 0!==T.tag&&(k.tag=T.tag),void 0===T.obj)throw"obj shall be specified for 'tag'.";return k.obj=_(T.obj),new m(k)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},et.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",n=parseInt(t.substr(0,2),16),r=(e=Math.floor(n/40)+"."+n%40,""),i=2;i<t.length;i+=2){var s=("00000000"+parseInt(t.substr(i,2),16).toString(2)).slice(-8);if(r+=s.substr(1,7),"0"==s.substr(0,1))e=e+"."+new d(r,2).toString(10),r=""}return e},et.asn1.ASN1Util.oidIntToHex=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},n=function(t){var n="",r=new d(t,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var s="",o=0;o<i;o++)s+="0";r=s+r;for(o=0;o<r.length-1;o+=7){var a=r.substr(o,7);o!=r.length-7&&(a="1"+a),n+=e(parseInt(a,2))}return n};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",i=t.split("."),s=40*parseInt(i[0])+parseInt(i[1]);r+=e(s),i.splice(0,2);for(var o=0;o<i.length;o++)r+=n(i[o]);return r},et.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var t=this.hV.length/2,e=t.toString(16);if(e.length%2==1&&(e="0"+e),t<128)return e;var n=e.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+n).toString(16)+e},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},et.asn1.DERAbstractString=function(t){et.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=ft(this.s).toLowerCase()},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?this.setString(t):void 0!==t.str?this.setString(t.str):void 0!==t.hex&&this.setStringHex(t.hex))},i.lang.extend(et.asn1.DERAbstractString,et.asn1.ASN1Object),et.asn1.DERAbstractTime=function(t){et.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(t){return utc=t.getTime()+6e4*t.getTimezoneOffset(),new Date(utc)},this.formatDate=function(t,e,n){var r=this.zeroPadding,i=this.localDateToUTC(t),s=String(i.getFullYear());"utc"==e&&(s=s.substr(2,2));var o=s+r(String(i.getMonth()+1),2)+r(String(i.getDate()),2)+r(String(i.getHours()),2)+r(String(i.getMinutes()),2)+r(String(i.getSeconds()),2);if(!0===n){var a=i.getMilliseconds();if(0!=a){var c=r(String(a),3);o=o+"."+(c=c.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=ct(t)},this.setByDateValue=function(t,e,n,r,i,s){var o=new Date(Date.UTC(t,e-1,n,r,i,s,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},i.lang.extend(et.asn1.DERAbstractTime,et.asn1.ASN1Object),et.asn1.DERAbstractStructured=function(t){et.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,void 0!==t&&void 0!==t.array&&(this.asn1Array=t.array)},i.lang.extend(et.asn1.DERAbstractStructured,et.asn1.ASN1Object),et.asn1.DERBoolean=function(){et.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},i.lang.extend(et.asn1.DERBoolean,et.asn1.ASN1Object),et.asn1.DERInteger=function(t){et.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=et.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new d(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.bigint?this.setByBigInteger(t.bigint):void 0!==t.int?this.setByInteger(t.int):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},i.lang.extend(et.asn1.DERInteger,et.asn1.ASN1Object),et.asn1.DERBitString=function(t){if(void 0!==t&&void 0!==t.obj){var e=et.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}et.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t},this.setUnusedBitsAndHexValue=function(t,e){if(t<0||7<t)throw"unused bits shall be from 0 to 7: u = "+t;var n="0"+t;this.hTLV=null,this.isModified=!0,this.hV=n+e},this.setByBinaryString=function(t){var e=8-(t=t.replace(/0+$/,"")).length%8;8==e&&(e=0);for(var n=0;n<=e;n++)t+="0";var r="";for(n=0;n<t.length-1;n+=8){var i=t.substr(n,8),s=parseInt(i,2).toString(16);1==s.length&&(s="0"+s),r+=s}this.hTLV=null,this.isModified=!0,this.hV="0"+e+r},this.setByBooleanArray=function(t){for(var e="",n=0;n<t.length;n++)1==t[n]?e+="1":e+="0";this.setByBinaryString(e)},this.newFalseArray=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=!1;return e},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):void 0!==t.hex?this.setHexValueIncludingUnusedBits(t.hex):void 0!==t.bin?this.setByBinaryString(t.bin):void 0!==t.array&&this.setByBooleanArray(t.array))},i.lang.extend(et.asn1.DERBitString,et.asn1.ASN1Object),et.asn1.DEROctetString=function(t){if(void 0!==t&&void 0!==t.obj){var e=et.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}et.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},i.lang.extend(et.asn1.DEROctetString,et.asn1.DERAbstractString),et.asn1.DERNull=function(){et.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},i.lang.extend(et.asn1.DERNull,et.asn1.ASN1Object),et.asn1.DERObjectIdentifier=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},n=function(t){var n="",r=new d(t,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var s="",o=0;o<i;o++)s+="0";r=s+r;for(o=0;o<r.length-1;o+=7){var a=r.substr(o,7);o!=r.length-7&&(a="1"+a),n+=e(parseInt(a,2))}return n};et.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",i=t.split("."),s=40*parseInt(i[0])+parseInt(i[1]);r+=e(s),i.splice(0,2);for(var o=0;o<i.length;o++)r+=n(i[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(t){var e=et.asn1.x509.OID.name2oid(t);if(""===e)throw"DERObjectIdentifier oidName undefined: "+t;this.setValueOidString(e)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t):void 0!==t.oid?this.setValueOidString(t.oid):void 0!==t.hex?this.setValueHex(t.hex):void 0!==t.name&&this.setValueName(t.name))},i.lang.extend(et.asn1.DERObjectIdentifier,et.asn1.ASN1Object),et.asn1.DEREnumerated=function(t){et.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=et.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new d(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.int?this.setByInteger(t.int):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},i.lang.extend(et.asn1.DEREnumerated,et.asn1.ASN1Object),et.asn1.DERUTF8String=function(t){et.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},i.lang.extend(et.asn1.DERUTF8String,et.asn1.DERAbstractString),et.asn1.DERNumericString=function(t){et.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},i.lang.extend(et.asn1.DERNumericString,et.asn1.DERAbstractString),et.asn1.DERPrintableString=function(t){et.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},i.lang.extend(et.asn1.DERPrintableString,et.asn1.DERAbstractString),et.asn1.DERTeletexString=function(t){et.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},i.lang.extend(et.asn1.DERTeletexString,et.asn1.DERAbstractString),et.asn1.DERIA5String=function(t){et.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},i.lang.extend(et.asn1.DERIA5String,et.asn1.DERAbstractString),et.asn1.DERUTCTime=function(t){et.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=ct(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=ct(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{12}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date))},i.lang.extend(et.asn1.DERUTCTime,et.asn1.DERAbstractTime),et.asn1.DERGeneralizedTime=function(t){et.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ct(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ct(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{14}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date),!0===t.millis&&(this.withMillis=!0))},i.lang.extend(et.asn1.DERGeneralizedTime,et.asn1.DERAbstractTime),et.asn1.DERSequence=function(t){et.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var t="",e=0;e<this.asn1Array.length;e++){t+=this.asn1Array[e].getEncodedHex()}return this.hV=t,this.hV}},i.lang.extend(et.asn1.DERSequence,et.asn1.DERAbstractStructured),et.asn1.DERSet=function(t){et.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,e=0;e<this.asn1Array.length;e++){var n=this.asn1Array[e];t.push(n.getEncodedHex())}return 1==this.sortFlag&&t.sort(),this.hV=t.join(""),this.hV},void 0!==t&&void 0!==t.sortflag&&0==t.sortflag&&(this.sortFlag=!1)},i.lang.extend(et.asn1.DERSet,et.asn1.DERAbstractStructured),et.asn1.DERTaggedObject=function(t){et.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(t,e,n){this.hT=e,this.isExplicit=t,this.asn1Object=n,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=n.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,e),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.tag&&(this.hT=t.tag),void 0!==t.explicit&&(this.isExplicit=t.explicit),void 0!==t.obj&&(this.asn1Object=t.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},i.lang.extend(et.asn1.DERTaggedObject,et.asn1.ASN1Object);var et,nt,rt,it=new function(){};function st(t){for(var e=new Array,n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function ot(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}function at(t){for(var e="",n=0;n<t.length;n++){var r=t[n].toString(16);1==r.length&&(r="0"+r),e+=r}return e}function ct(t){return at(st(t))}function ut(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function lt(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function ht(t){return t.length%2==1&&(t="0"+t),ut(u(t))}function dt(t){return l(lt(t))}function ft(t){return Et(Ot(t))}function pt(t){return decodeURIComponent(xt(t))}function gt(t){for(var e="",n=0;n<t.length-1;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2),16));return e}function yt(t){for(var e="",n=0;n<t.length;n++)e+=("0"+t.charCodeAt(n).toString(16)).slice(-2);return e}function vt(t){return u(t)}function mt(t){var e=vt(t).replace(/(.{64})/g,"$1\r\n");return e=e.replace(/\r\n$/,"")}function _t(t){return l(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function bt(t,e){return"-----BEGIN "+e+"-----\r\n"+mt(t)+"\r\n-----END "+e+"-----\r\n"}function wt(t,e){if(-1==t.indexOf("-----BEGIN "))throw"can't find PEM header: "+e;return _t(t=void 0!==e?(t=t.replace("-----BEGIN "+e+"-----","")).replace("-----END "+e+"-----",""):(t=t.replace(/-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----/,""))}function St(t){var e,n,r,i,s,o,a,c,u,l,h;if(h=t.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return c=h[1],e=parseInt(c),2===c.length&&(50<=e&&e<100?e=1900+e:0<=e&&e<50&&(e=2e3+e)),n=parseInt(h[2])-1,r=parseInt(h[3]),i=parseInt(h[4]),s=parseInt(h[5]),o=parseInt(h[6]),a=0,""!==(u=h[7])&&(l=(u.substr(1)+"00").substr(0,3),a=parseInt(l)),Date.UTC(e,n,r,i,s,o,a);throw"unsupported zulu format: "+t}function Ct(t){return~~(St(t)/1e3)}function Et(t){return t.replace(/%/g,"")}function xt(t){return t.replace(/(..)/g,"%$1")}function Tt(t){var e="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw e;var n=(t=t.toLowerCase()).split(":").length-1;if(n<2)throw e;var r=":".repeat(7-n+2),i=(t=t.replace("::",r)).split(":");if(8!=i.length)throw e;for(var s=0;s<8;s++)i[s]=("0000"+i[s]).slice(-4);return i.join("")}function At(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var e=(t=t.toLowerCase()).match(/.{1,4}/g),n=0;n<8;n++)e[n]=e[n].replace(/^0+/,""),""==e[n]&&(e[n]="0");var r=(t=":"+e.join(":")+":").match(/:(0:){2,}/g);if(null===r)return t.slice(1,-1);var i="";for(n=0;n<r.length;n++)r[n].length>i.length&&(i=r[n]);return(t=t.replace(i,"::")).slice(1,-1)}function kt(t){var e="malformed hex value";if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(8!=t.length)return 32==t.length?At(t):t;try{return parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16)}catch(t){throw e}}function Ot(t){for(var e=encodeURIComponent(t),n="",r=0;r<e.length;r++)"%"==e[r]?(n+=e.substr(r,3),r+=2):n=n+"%"+ct(e[r]);return n}function Pt(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}function Rt(t){t=(t=(t=t.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return t.split(/,/).map(function(t,e,n){var r=parseInt(t);if(r<0||255<r)throw"integer not in range 0-255";return("00"+r.toString(16)).slice(-2)}).join("")}catch(t){throw"malformed integer array string: "+t}}it.getLblen=function(t,e){if("8"!=t.substr(e+2,1))return 1;var n=parseInt(t.substr(e+3,1));return 0==n?-1:0<n&&n<10?n+1:-2},it.getL=function(t,e){var n=it.getLblen(t,e);return n<1?"":t.substr(e+2,2*n)},it.getVblen=function(t,e){var n;return""==(n=it.getL(t,e))?-1:("8"===n.substr(0,1)?new d(n.substr(2),16):new d(n,16)).intValue()},it.getVidx=function(t,e){var n=it.getLblen(t,e);return n<0?n:e+2*(n+1)},it.getV=function(t,e){var n=it.getVidx(t,e),r=it.getVblen(t,e);return t.substr(n,2*r)},it.getTLV=function(t,e){return t.substr(e,2)+it.getL(t,e)+it.getV(t,e)},it.getNextSiblingIdx=function(t,e){return it.getVidx(t,e)+2*it.getVblen(t,e)},it.getChildIdx=function(t,e){var n=it,r=new Array,i=n.getVidx(t,e);"03"==t.substr(e,2)?r.push(i+2):r.push(i);for(var s=n.getVblen(t,e),o=i,a=0;;){var c=n.getNextSiblingIdx(t,o);if(null==c||c-i>=2*s)break;if(a>=200)break;r.push(c),o=c,a++}return r},it.getNthChildIdx=function(t,e,n){return it.getChildIdx(t,e)[n]},it.getIdxbyList=function(t,e,n,r){var i,s,o=it;if(0==n.length){if(void 0!==r&&t.substr(e,2)!==r)throw"checking tag doesn't match: "+t.substr(e,2)+"!="+r;return e}return i=n.shift(),s=o.getChildIdx(t,e),o.getIdxbyList(t,s[i],n,r)},it.getTLVbyList=function(t,e,n,r){var i=it,s=i.getIdxbyList(t,e,n);if(void 0===s)throw"can't find nthList object";if(void 0!==r&&t.substr(s,2)!=r)throw"checking tag doesn't match: "+t.substr(s,2)+"!="+r;return i.getTLV(t,s)},it.getVbyList=function(t,e,n,r,i){var s,o,a=it;if(void 0===(s=a.getIdxbyList(t,e,n,r)))throw"can't find nthList object";return o=a.getV(t,s),!0===i&&(o=o.substr(2)),o},it.hextooidstr=function(t){var e=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},n=[],r=t.substr(0,2),i=parseInt(r,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);for(var s=t.substr(2),o=[],a=0;a<s.length/2;a++)o.push(parseInt(s.substr(2*a,2),16));var c=[],u="";for(a=0;a<o.length;a++)128&o[a]?u+=e((127&o[a]).toString(2),7):(u+=e((127&o[a]).toString(2),7),c.push(new String(parseInt(u,2))),u="");var l=n.join(".");return c.length>0&&(l=l+"."+c.join(".")),l},it.dump=function(t,e,n,r){var i=it,s=i.getV,o=i.dump,a=i.getChildIdx,c=t;t instanceof et.asn1.ASN1Object&&(c=t.getEncodedHex());var u=function(t,e){return t.length<=2*e?t:t.substr(0,e)+"..(total "+t.length/2+"bytes).."+t.substr(t.length-e,e)};void 0===e&&(e={ommit_long_octet:32}),void 0===n&&(n=0),void 0===r&&(r="");var l=e.ommit_long_octet;if("01"==c.substr(n,2))return"00"==(h=s(c,n))?r+"BOOLEAN FALSE\n":r+"BOOLEAN TRUE\n";if("02"==c.substr(n,2))return r+"INTEGER "+u(h=s(c,n),l)+"\n";if("03"==c.substr(n,2))return r+"BITSTRING "+u(h=s(c,n),l)+"\n";if("04"==c.substr(n,2)){var h=s(c,n);if(i.isASN1HEX(h)){var d=r+"OCTETSTRING, encapsulates\n";return d+=o(h,e,0,r+"  ")}return r+"OCTETSTRING "+u(h,l)+"\n"}if("05"==c.substr(n,2))return r+"NULL\n";if("06"==c.substr(n,2)){var f=s(c,n),p=et.asn1.ASN1Util.oidHexToInt(f),g=et.asn1.x509.OID.oid2name(p),y=p.replace(/\./g," ");return""!=g?r+"ObjectIdentifier "+g+" ("+y+")\n":r+"ObjectIdentifier ("+y+")\n"}if("0c"==c.substr(n,2))return r+"UTF8String '"+pt(s(c,n))+"'\n";if("13"==c.substr(n,2))return r+"PrintableString '"+pt(s(c,n))+"'\n";if("14"==c.substr(n,2))return r+"TeletexString '"+pt(s(c,n))+"'\n";if("16"==c.substr(n,2))return r+"IA5String '"+pt(s(c,n))+"'\n";if("17"==c.substr(n,2))return r+"UTCTime "+pt(s(c,n))+"\n";if("18"==c.substr(n,2))return r+"GeneralizedTime "+pt(s(c,n))+"\n";if("30"==c.substr(n,2)){if("3000"==c.substr(n,4))return r+"SEQUENCE {}\n";d=r+"SEQUENCE\n";var v=e;if((2==(b=a(c,n)).length||3==b.length)&&"06"==c.substr(b[0],2)&&"04"==c.substr(b[b.length-1],2)){g=i.oidname(s(c,b[0]));var m=JSON.parse(JSON.stringify(e));m.x509ExtName=g,v=m}for(var _=0;_<b.length;_++)d+=o(c,v,b[_],r+"  ");return d}if("31"==c.substr(n,2)){d=r+"SET\n";var b=a(c,n);for(_=0;_<b.length;_++)d+=o(c,e,b[_],r+"  ");return d}var w=parseInt(c.substr(n,2),16);if(0!=(128&w)){var S=31&w;if(0!=(32&w)){var d=r+"["+S+"]\n";for(b=a(c,n),_=0;_<b.length;_++)d+=o(c,e,b[_],r+"  ");return d}return"68747470"==(h=s(c,n)).substr(0,8)&&(h=pt(h)),"subjectAltName"===e.x509ExtName&&2==S&&(h=pt(h)),d=r+"["+S+"] "+h+"\n"}return r+"UNKNOWN("+c.substr(n,2)+") "+s(c,n)+"\n"},it.isASN1HEX=function(t){var e=it;if(t.length%2==1)return!1;var n=e.getVblen(t,0),r=t.substr(0,2),i=e.getL(t,0);return t.length-r.length-i.length==2*n},it.oidname=function(t){var e=et.asn1;et.lang.String.isHex(t)&&(t=e.ASN1Util.oidHexToInt(t));var n=e.x509.OID.oid2name(t);return""===n&&(n=t),n},void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),void 0!==et.asn1.x509&&et.asn1.x509||(et.asn1.x509={}),et.asn1.x509.Certificate=function(t){et.asn1.x509.Certificate.superclass.constructor.call(this);var e=et,n=(e.crypto,e.asn1),r=n.DERSequence,i=n.DERBitString;this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg;var t=new et.crypto.Signature({alg:this.asn1SignatureAlg.nameAlg});t.init(this.prvKey),t.updateHex(this.asn1TBSCert.getEncodedHex()),this.hexSig=t.sign(),this.asn1Sig=new i({hex:"00"+this.hexSig});var e=new r({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=e.getEncodedHex(),this.isModified=!1},this.setSignatureHex=function(t){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg,this.hexSig=t,this.asn1Sig=new i({hex:"00"+this.hexSig});var e=new r({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=e.getEncodedHex(),this.isModified=!1},this.getEncodedHex=function(){if(0==this.isModified&&null!=this.hTLV)return this.hTLV;throw"not signed yet"},this.getPEMString=function(){return"-----BEGIN CERTIFICATE-----\r\n"+mt(this.getEncodedHex())+"\r\n-----END CERTIFICATE-----\r\n"},void 0!==t&&(void 0!==t.tbscertobj&&(this.asn1TBSCert=t.tbscertobj),void 0!==t.prvkeyobj&&(this.prvKey=t.prvkeyobj))},i.lang.extend(et.asn1.x509.Certificate,et.asn1.ASN1Object),et.asn1.x509.TBSCertificate=function(t){et.asn1.x509.TBSCertificate.superclass.constructor.call(this);var e=et.asn1,n=e.DERSequence,r=e.DERInteger,i=e.DERTaggedObject,s=e.x509,o=s.Time,a=s.X500Name,c=s.SubjectPublicKeyInfo;this._initialize=function(){this.asn1Array=new Array,this.asn1Version=new i({obj:new r({int:2})}),this.asn1SerialNumber=null,this.asn1SignatureAlg=null,this.asn1Issuer=null,this.asn1NotBefore=null,this.asn1NotAfter=null,this.asn1Subject=null,this.asn1SubjPKey=null,this.extensionsArray=new Array},this.setSerialNumberByParam=function(t){this.asn1SerialNumber=new r(t)},this.setSignatureAlgByParam=function(t){this.asn1SignatureAlg=new s.AlgorithmIdentifier(t)},this.setIssuerByParam=function(t){this.asn1Issuer=new a(t)},this.setNotBeforeByParam=function(t){this.asn1NotBefore=new o(t)},this.setNotAfterByParam=function(t){this.asn1NotAfter=new o(t)},this.setSubjectByParam=function(t){this.asn1Subject=new a(t)},this.setSubjectPublicKey=function(t){this.asn1SubjPKey=new c(t)},this.setSubjectPublicKeyByGetKey=function(t){var e=It.getKey(t);this.asn1SubjPKey=new c(e)},this.appendExtension=function(t){this.extensionsArray.push(t)},this.appendExtensionByName=function(t,e){et.asn1.x509.Extension.appendByNameToArray(t,e,this.extensionsArray)},this.getEncodedHex=function(){if(null==this.asn1NotBefore||null==this.asn1NotAfter)throw"notBefore and/or notAfter not set";var t=new n({array:[this.asn1NotBefore,this.asn1NotAfter]});if(this.asn1Array=new Array,this.asn1Array.push(this.asn1Version),this.asn1Array.push(this.asn1SerialNumber),this.asn1Array.push(this.asn1SignatureAlg),this.asn1Array.push(this.asn1Issuer),this.asn1Array.push(t),this.asn1Array.push(this.asn1Subject),this.asn1Array.push(this.asn1SubjPKey),this.extensionsArray.length>0){var e=new n({array:this.extensionsArray}),r=new i({explicit:!0,tag:"a3",obj:e});this.asn1Array.push(r)}var s=new n({array:this.asn1Array});return this.hTLV=s.getEncodedHex(),this.isModified=!1,this.hTLV},this._initialize()},i.lang.extend(et.asn1.x509.TBSCertificate,et.asn1.ASN1Object),et.asn1.x509.Extension=function(t){et.asn1.x509.Extension.superclass.constructor.call(this);var e=et.asn1,n=e.DERObjectIdentifier,r=e.DEROctetString,i=(e.DERBitString,e.DERBoolean),s=e.DERSequence;this.getEncodedHex=function(){var t=new n({oid:this.oid}),e=new r({hex:this.getExtnValueHex()}),o=new Array;return o.push(t),this.critical&&o.push(new i),o.push(e),new s({array:o}).getEncodedHex()},this.critical=!1,void 0!==t&&void 0!==t.critical&&(this.critical=t.critical)},i.lang.extend(et.asn1.x509.Extension,et.asn1.ASN1Object),et.asn1.x509.Extension.appendByNameToArray=function(t,e,n){var r=t.toLowerCase(),i=et.asn1.x509;if("basicconstraints"==r){var s=new i.BasicConstraints(e);n.push(s)}else if("keyusage"==r){s=new i.KeyUsage(e);n.push(s)}else if("crldistributionpoints"==r){s=new i.CRLDistributionPoints(e);n.push(s)}else if("extkeyusage"==r){s=new i.ExtKeyUsage(e);n.push(s)}else if("authoritykeyidentifier"==r){s=new i.AuthorityKeyIdentifier(e);n.push(s)}else if("authorityinfoaccess"==r){s=new i.AuthorityInfoAccess(e);n.push(s)}else if("subjectaltname"==r){s=new i.SubjectAltName(e);n.push(s)}else{if("issueraltname"!=r)throw"unsupported extension name: "+t;s=new i.IssuerAltName(e);n.push(s)}},et.asn1.x509.KeyUsage=function(t){et.asn1.x509.KeyUsage.superclass.constructor.call(this,t);var e=Mt.KEYUSAGE_NAME;if(this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.oid="2.5.29.15",void 0!==t&&(void 0!==t.bin&&(this.asn1ExtnValue=new et.asn1.DERBitString(t)),void 0!==t.names&&void 0!==t.names.length)){for(var n=t.names,r="000000000",i=0;i<n.length;i++)for(var s=0;s<e.length;s++)n[i]===e[s]&&(r=r.substring(0,s)+"1"+r.substring(s+1,r.length));this.asn1ExtnValue=new et.asn1.DERBitString({bin:r})}},i.lang.extend(et.asn1.x509.KeyUsage,et.asn1.x509.Extension),et.asn1.x509.BasicConstraints=function(t){et.asn1.x509.BasicConstraints.superclass.constructor.call(this,t);this.getExtnValueHex=function(){var t=new Array;this.cA&&t.push(new et.asn1.DERBoolean),this.pathLen>-1&&t.push(new et.asn1.DERInteger({int:this.pathLen}));var e=new et.asn1.DERSequence({array:t});return this.asn1ExtnValue=e,this.asn1ExtnValue.getEncodedHex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==t&&(void 0!==t.cA&&(this.cA=t.cA),void 0!==t.pathLen&&(this.pathLen=t.pathLen))},i.lang.extend(et.asn1.x509.BasicConstraints,et.asn1.x509.Extension),et.asn1.x509.CRLDistributionPoints=function(t){et.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,t);var e=et.asn1,n=e.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.setByDPArray=function(t){this.asn1ExtnValue=new e.DERSequence({array:t})},this.setByOneURI=function(t){var e=new n.GeneralNames([{uri:t}]),r=new n.DistributionPointName(e),i=new n.DistributionPoint({dpobj:r});this.setByDPArray([i])},this.oid="2.5.29.31",void 0!==t&&(void 0!==t.array?this.setByDPArray(t.array):void 0!==t.uri&&this.setByOneURI(t.uri))},i.lang.extend(et.asn1.x509.CRLDistributionPoints,et.asn1.x509.Extension),et.asn1.x509.ExtKeyUsage=function(t){et.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,t);var e=et.asn1;this.setPurposeArray=function(t){this.asn1ExtnValue=new e.DERSequence;for(var n=0;n<t.length;n++){var r=new e.DERObjectIdentifier(t[n]);this.asn1ExtnValue.appendASN1Object(r)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.oid="2.5.29.37",void 0!==t&&void 0!==t.array&&this.setPurposeArray(t.array)},i.lang.extend(et.asn1.x509.ExtKeyUsage,et.asn1.x509.Extension),et.asn1.x509.AuthorityKeyIdentifier=function(t){et.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,t);var e=et.asn1,n=e.DERTaggedObject;this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var t=new Array;this.asn1KID&&t.push(new n({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&t.push(new n({explicit:!1,tag:"a1",obj:this.asn1CertIssuer})),this.asn1CertSN&&t.push(new n({explicit:!1,tag:"82",obj:this.asn1CertSN}));var r=new e.DERSequence({array:t});return this.asn1ExtnValue=r,this.asn1ExtnValue.getEncodedHex()},this.setKIDByParam=function(t){this.asn1KID=new et.asn1.DEROctetString(t)},this.setCertIssuerByParam=function(t){this.asn1CertIssuer=new et.asn1.x509.X500Name(t)},this.setCertSNByParam=function(t){this.asn1CertSN=new et.asn1.DERInteger(t)},this.oid="2.5.29.35",void 0!==t&&(void 0!==t.kid&&this.setKIDByParam(t.kid),void 0!==t.issuer&&this.setCertIssuerByParam(t.issuer),void 0!==t.sn&&this.setCertSNByParam(t.sn))},i.lang.extend(et.asn1.x509.AuthorityKeyIdentifier,et.asn1.x509.Extension),et.asn1.x509.AuthorityInfoAccess=function(t){et.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,t),this.setAccessDescriptionArray=function(t){for(var e=new Array,n=et.asn1,r=n.DERSequence,i=0;i<t.length;i++){var s=new r({array:[new n.DERObjectIdentifier(t[i].accessMethod),new n.x509.GeneralName(t[i].accessLocation)]});e.push(s)}this.asn1ExtnValue=new r({array:e})},this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==t&&void 0!==t.array&&this.setAccessDescriptionArray(t.array)},i.lang.extend(et.asn1.x509.AuthorityInfoAccess,et.asn1.x509.Extension),et.asn1.x509.SubjectAltName=function(t){et.asn1.x509.SubjectAltName.superclass.constructor.call(this,t),this.setNameArray=function(t){this.asn1ExtnValue=new et.asn1.x509.GeneralNames(t)},this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.oid="2.5.29.17",void 0!==t&&void 0!==t.array&&this.setNameArray(t.array)},i.lang.extend(et.asn1.x509.SubjectAltName,et.asn1.x509.Extension),et.asn1.x509.IssuerAltName=function(t){et.asn1.x509.IssuerAltName.superclass.constructor.call(this,t),this.setNameArray=function(t){this.asn1ExtnValue=new et.asn1.x509.GeneralNames(t)},this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()},this.oid="2.5.29.18",void 0!==t&&void 0!==t.array&&this.setNameArray(t.array)},i.lang.extend(et.asn1.x509.IssuerAltName,et.asn1.x509.Extension),et.asn1.x509.CRL=function(t){et.asn1.x509.CRL.superclass.constructor.call(this);this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCertList.asn1SignatureAlg,sig=new et.crypto.Signature({alg:"SHA1withRSA",prov:"cryptojs/jsrsa"}),sig.init(this.prvKey),sig.updateHex(this.asn1TBSCertList.getEncodedHex()),this.hexSig=sig.sign(),this.asn1Sig=new et.asn1.DERBitString({hex:"00"+this.hexSig});var t=new et.asn1.DERSequence({array:[this.asn1TBSCertList,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=t.getEncodedHex(),this.isModified=!1},this.getEncodedHex=function(){if(0==this.isModified&&null!=this.hTLV)return this.hTLV;throw"not signed yet"},this.getPEMString=function(){return"-----BEGIN X509 CRL-----\r\n"+mt(this.getEncodedHex())+"\r\n-----END X509 CRL-----\r\n"},void 0!==t&&(void 0!==t.tbsobj&&(this.asn1TBSCertList=t.tbsobj),void 0!==t.prvkeyobj&&(this.prvKey=t.prvkeyobj))},i.lang.extend(et.asn1.x509.CRL,et.asn1.ASN1Object),et.asn1.x509.TBSCertList=function(t){et.asn1.x509.TBSCertList.superclass.constructor.call(this);var e=et.asn1,n=e.DERSequence,r=e.x509,i=r.Time;this.setSignatureAlgByParam=function(t){this.asn1SignatureAlg=new r.AlgorithmIdentifier(t)},this.setIssuerByParam=function(t){this.asn1Issuer=new r.X500Name(t)},this.setThisUpdateByParam=function(t){this.asn1ThisUpdate=new i(t)},this.setNextUpdateByParam=function(t){this.asn1NextUpdate=new i(t)},this.addRevokedCert=function(t,e){var n={};void 0!=t&&null!=t&&(n.sn=t),void 0!=e&&null!=e&&(n.time=e);var i=new r.CRLEntry(n);this.aRevokedCert.push(i)},this.getEncodedHex=function(){if(this.asn1Array=new Array,null!=this.asn1Version&&this.asn1Array.push(this.asn1Version),this.asn1Array.push(this.asn1SignatureAlg),this.asn1Array.push(this.asn1Issuer),this.asn1Array.push(this.asn1ThisUpdate),null!=this.asn1NextUpdate&&this.asn1Array.push(this.asn1NextUpdate),this.aRevokedCert.length>0){var t=new n({array:this.aRevokedCert});this.asn1Array.push(t)}var e=new n({array:this.asn1Array});return this.hTLV=e.getEncodedHex(),this.isModified=!1,this.hTLV},this._initialize=function(){this.asn1Version=null,this.asn1SignatureAlg=null,this.asn1Issuer=null,this.asn1ThisUpdate=null,this.asn1NextUpdate=null,this.aRevokedCert=new Array},this._initialize()},i.lang.extend(et.asn1.x509.TBSCertList,et.asn1.ASN1Object),et.asn1.x509.CRLEntry=function(t){et.asn1.x509.CRLEntry.superclass.constructor.call(this);var e=et.asn1;this.setCertSerial=function(t){this.sn=new e.DERInteger(t)},this.setRevocationDate=function(t){this.time=new e.x509.Time(t)},this.getEncodedHex=function(){var t=new e.DERSequence({array:[this.sn,this.time]});return this.TLV=t.getEncodedHex(),this.TLV},void 0!==t&&(void 0!==t.time&&this.setRevocationDate(t.time),void 0!==t.sn&&this.setCertSerial(t.sn))},i.lang.extend(et.asn1.x509.CRLEntry,et.asn1.ASN1Object),et.asn1.x509.X500Name=function(t){et.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=new Array;var e=et.asn1,n=e.x509,r=wt;if(this.setByString=function(t){var e=t.split("/");e.shift();for(var r=[],i=0;i<e.length;i++)if(e[i].match(/^[^=]+=.+$/))r.push(e[i]);else{var s=r.length-1;r[s]=r[s]+"/"+e[i]}for(i=0;i<r.length;i++)this.asn1Array.push(new n.RDN({str:r[i]}))},this.setByLdapString=function(t){var e=n.X500Name.ldapToOneline(t);this.setByString(e)},this.setByObject=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=new et.asn1.x509.RDN({str:e+"="+t[e]});this.asn1Array?this.asn1Array.push(n):this.asn1Array=[n]}},this.getEncodedHex=function(){if("string"==typeof this.hTLV)return this.hTLV;var t=new e.DERSequence({array:this.asn1Array});return this.hTLV=t.getEncodedHex(),this.hTLV},void 0!==t){var i;if(void 0!==t.str?this.setByString(t.str):void 0!==t.ldapstr?this.setByLdapString(t.ldapstr):"object"==typeof t&&this.setByObject(t),void 0!==t.certissuer)(i=new Mt).hex=r(t.certissuer),this.hTLV=i.getIssuerHex();if(void 0!==t.certsubject)(i=new Mt).hex=r(t.certsubject),this.hTLV=i.getSubjectHex()}},i.lang.extend(et.asn1.x509.X500Name,et.asn1.ASN1Object),et.asn1.x509.X500Name.onelineToLDAP=function(t){if("/"!==t.substr(0,1))throw"malformed input";var e=(t=t.substr(1)).split("/");return e.reverse(),(e=e.map(function(t){return t.replace(/,/,"\\,")})).join(",")},et.asn1.x509.X500Name.ldapToOneline=function(t){for(var e=t.split(","),n=!1,r=[],i=0;e.length>0;i++){var s=e.shift();if(!0===n){var o=(r.pop()+","+s).replace(/\\,/g,",");r.push(o),n=!1}else r.push(s);"\\"===s.substr(-1,1)&&(n=!0)}return(r=r.map(function(t){return t.replace("/","\\/")})).reverse(),"/"+r.join("/")},et.asn1.x509.RDN=function(t){et.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=new Array,this.addByString=function(t){this.asn1Array.push(new et.asn1.x509.AttributeTypeAndValue({str:t}))},this.addByMultiValuedString=function(t){for(var e=et.asn1.x509.RDN.parseString(t),n=0;n<e.length;n++)this.addByString(e[n])},this.getEncodedHex=function(){var t=new et.asn1.DERSet({array:this.asn1Array});return this.TLV=t.getEncodedHex(),this.TLV},void 0!==t&&void 0!==t.str&&this.addByMultiValuedString(t.str)},i.lang.extend(et.asn1.x509.RDN,et.asn1.ASN1Object),et.asn1.x509.RDN.parseString=function(t){for(var e=t.split(/\+/),n=!1,r=[],i=0;e.length>0;i++){var s=e.shift();if(!0===n){var o=(r.pop()+"+"+s).replace(/\\\+/g,"+");r.push(o),n=!1}else r.push(s);"\\"===s.substr(-1,1)&&(n=!0)}var a=!1,c=[];for(i=0;r.length>0;i++){s=r.shift();if(!0===a){var u=c.pop();if(s.match(/"$/)){o=(u+"+"+s).replace(/^([^=]+)="(.*)"$/,"$1=$2");c.push(o),a=!1}else c.push(u+"+"+s)}else c.push(s);s.match(/^[^=]+="/)&&(a=!0)}return c},et.asn1.x509.AttributeTypeAndValue=function(t){et.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this);var e=et.asn1;this.setByString=function(t){var e=t.match(/^([^=]+)=(.+)$/);if(!e)throw"malformed attrTypeAndValueStr: "+t;this.setByAttrTypeAndValueStr(e[1],e[2])},this.setByAttrTypeAndValueStr=function(t,e){this.typeObj=et.asn1.x509.OID.atype2obj(t);var n="utf8";"C"==t&&(n="prn"),this.valueObj=this.getValueObj(n,e)},this.getValueObj=function(t,n){if("utf8"==t)return new e.DERUTF8String({str:n});if("prn"==t)return new e.DERPrintableString({str:n});if("tel"==t)return new e.DERTeletexString({str:n});if("ia5"==t)return new e.DERIA5String({str:n});throw"unsupported directory string type: type="+t+" value="+n},this.getEncodedHex=function(){var t=new e.DERSequence({array:[this.typeObj,this.valueObj]});return this.TLV=t.getEncodedHex(),this.TLV},void 0!==t&&void 0!==t.str&&this.setByString(t.str)},i.lang.extend(et.asn1.x509.AttributeTypeAndValue,et.asn1.ASN1Object),et.asn1.x509.SubjectPublicKeyInfo=function(t){et.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var e=et,n=e.asn1,r=n.DERInteger,i=n.DERBitString,s=n.DERObjectIdentifier,o=n.DERSequence,a=n.ASN1Util.newObject,c=n.x509.AlgorithmIdentifier,u=e.crypto;u.ECDSA,u.DSA;this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new o({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.getEncodedHex=function(){var t=this.getASN1Object();return this.hTLV=t.getEncodedHex(),this.hTLV},this.setPubKey=function(t){try{if(t instanceof Q){var e=a({seq:[{int:{bigint:t.n}},{int:{int:t.e}}]}).getEncodedHex();this.asn1AlgId=new c({name:"rsaEncryption"}),this.asn1SubjPKey=new i({hex:"00"+e})}}catch(t){}try{if(t instanceof et.crypto.ECDSA){var n=new s({name:t.curveName});this.asn1AlgId=new c({name:"ecPublicKey",asn1params:n}),this.asn1SubjPKey=new i({hex:"00"+t.pubKeyHex})}}catch(t){}try{if(t instanceof et.crypto.DSA){n=new a({seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]});this.asn1AlgId=new c({name:"dsa",asn1params:n});var o=new r({bigint:t.y});this.asn1SubjPKey=new i({hex:"00"+o.getEncodedHex()})}}catch(t){}},void 0!==t&&this.setPubKey(t)},i.lang.extend(et.asn1.x509.SubjectPublicKeyInfo,et.asn1.ASN1Object),et.asn1.x509.Time=function(t){et.asn1.x509.Time.superclass.constructor.call(this);var e=et.asn1,n=e.DERUTCTime,r=e.DERGeneralizedTime;this.setTimeParams=function(t){this.timeParams=t},this.getEncodedHex=function(){var t=null;return t=null!=this.timeParams?"utc"==this.type?new n(this.timeParams):new r(this.timeParams):"utc"==this.type?new n:new r,this.TLV=t.getEncodedHex(),this.TLV},this.type="utc",void 0!==t&&(void 0!==t.type?this.type=t.type:void 0!==t.str&&(t.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),t.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=t)},i.lang.extend(et.asn1.x509.Time,et.asn1.ASN1Object),et.asn1.x509.AlgorithmIdentifier=function(t){et.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var e=et.asn1;if(this.getEncodedHex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw"algorithm not specified";null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=e.x509.OID.name2obj(this.nameAlg));var t=[this.asn1Alg];null!==this.asn1Params&&t.push(this.asn1Params);var n=new e.DERSequence({array:t});return this.hTLV=n.getEncodedHex(),this.hTLV},void 0!==t&&(void 0!==t.name&&(this.nameAlg=t.name),void 0!==t.asn1params&&(this.asn1Params=t.asn1params),void 0!==t.paramempty&&(this.paramEmpty=t.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){var n=this.nameAlg.toLowerCase();"withdsa"!==n.substr(-7,7)&&"withecdsa"!==n.substr(-9,9)&&(this.asn1Params=new e.DERNull)}},i.lang.extend(et.asn1.x509.AlgorithmIdentifier,et.asn1.ASN1Object),et.asn1.x509.GeneralName=function(t){et.asn1.x509.GeneralName.superclass.constructor.call(this);var e={rfc822:"81",dns:"82",dn:"a4",uri:"86",ip:"87"},n=et.asn1,r=(n.DERSequence,n.DEROctetString),i=n.DERIA5String,s=n.DERTaggedObject,o=n.ASN1Object,a=n.x509.X500Name,c=wt;this.explicit=!1,this.setByParam=function(t){var n=null;if(void 0!==t){if(void 0!==t.rfc822&&(this.type="rfc822",n=new i({str:t[this.type]})),void 0!==t.dns&&(this.type="dns",n=new i({str:t[this.type]})),void 0!==t.uri&&(this.type="uri",n=new i({str:t[this.type]})),void 0!==t.dn&&(this.type="dn",this.explicit=!0,n=new a({str:t.dn})),void 0!==t.ldapdn&&(this.type="dn",this.explicit=!0,n=new a({ldapstr:t.ldapdn})),void 0!==t.certissuer){this.type="dn",this.explicit=!0;var u=null;if((h=t.certissuer).match(/^[0-9A-Fa-f]+$/),-1!=h.indexOf("-----BEGIN ")&&(u=c(h)),null==u)throw"certissuer param not cert";(d=new Mt).hex=u;var l=d.getIssuerHex();(n=new o).hTLV=l}if(void 0!==t.certsubj){this.type="dn",this.explicit=!0;var h,d;u=null;if((h=t.certsubj).match(/^[0-9A-Fa-f]+$/),-1!=h.indexOf("-----BEGIN ")&&(u=c(h)),null==u)throw"certsubj param not cert";(d=new Mt).hex=u;l=d.getSubjectHex();(n=new o).hTLV=l}if(void 0!==t.ip){this.type="ip",this.explicit=!1;var f,p=t.ip,g="malformed IP address";if(p.match(/^[0-9.]+[.][0-9.]+$/)){if(8!==(f=Rt("["+p.split(".").join(",")+"]")).length)throw g}else if(p.match(/^[0-9A-Fa-f:]+:[0-9A-Fa-f:]+$/))f=Tt(p);else{if(!p.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw g;f=p}n=new r({hex:f})}if(null==this.type)throw"unsupported type in params="+t;this.asn1Obj=new s({explicit:this.explicit,tag:e[this.type],obj:n})}},this.getEncodedHex=function(){return this.asn1Obj.getEncodedHex()},void 0!==t&&this.setByParam(t)},i.lang.extend(et.asn1.x509.GeneralName,et.asn1.ASN1Object),et.asn1.x509.GeneralNames=function(t){et.asn1.x509.GeneralNames.superclass.constructor.call(this);var e=et.asn1;this.setByParamArray=function(t){for(var n=0;n<t.length;n++){var r=new e.x509.GeneralName(t[n]);this.asn1Array.push(r)}},this.getEncodedHex=function(){return new e.DERSequence({array:this.asn1Array}).getEncodedHex()},this.asn1Array=new Array,void 0!==t&&this.setByParamArray(t)},i.lang.extend(et.asn1.x509.GeneralNames,et.asn1.ASN1Object),et.asn1.x509.DistributionPointName=function(t){et.asn1.x509.DistributionPointName.superclass.constructor.call(this);var e=et.asn1,n=e.DERTaggedObject;if(this.getEncodedHex=function(){if("full"!=this.type)throw"currently type shall be 'full': "+this.type;return this.asn1Obj=new n({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.getEncodedHex(),this.hTLV},void 0!==t){if(!e.x509.GeneralNames.prototype.isPrototypeOf(t))throw"This class supports GeneralNames only as argument";this.type="full",this.tag="a0",this.asn1V=t}},i.lang.extend(et.asn1.x509.DistributionPointName,et.asn1.ASN1Object),et.asn1.x509.DistributionPoint=function(t){et.asn1.x509.DistributionPoint.superclass.constructor.call(this);var e=et.asn1;this.getEncodedHex=function(){var t=new e.DERSequence;if(null!=this.asn1DP){var n=new e.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});t.appendASN1Object(n)}return this.hTLV=t.getEncodedHex(),this.hTLV},void 0!==t&&void 0!==t.dpobj&&(this.asn1DP=t.dpobj)},i.lang.extend(et.asn1.x509.DistributionPoint,et.asn1.ASN1Object),et.asn1.x509.OID=new function(t){this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",ecPublicKey:"1.2.840.10045.2.1",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",extensionRequest:"1.2.840.113549.1.9.14"},this.objCache={},this.name2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];if(void 0===this.name2oidList[t])throw"Name of ObjectIdentifier not defined: "+t;var e=this.name2oidList[t],n=new et.asn1.DERObjectIdentifier({oid:e});return this.objCache[t]=n,n},this.atype2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];if(void 0===this.atype2oidList[t])throw"AttributeType name undefined: "+t;var e=this.atype2oidList[t],n=new et.asn1.DERObjectIdentifier({oid:e});return this.objCache[t]=n,n}},et.asn1.x509.OID.oid2name=function(t){var e=et.asn1.x509.OID.name2oidList;for(var n in e)if(e[n]==t)return n;return""},et.asn1.x509.OID.oid2atype=function(t){var e=et.asn1.x509.OID.atype2oidList;for(var n in e)if(e[n]==t)return n;return t},et.asn1.x509.OID.name2oid=function(t){var e=et.asn1.x509.OID.name2oidList;return void 0===e[t]?"":e[t]},et.asn1.x509.X509Util={},et.asn1.x509.X509Util.newCertPEM=function(t){var e=et.asn1.x509,n=e.TBSCertificate,r=e.Certificate,i=new n;if(void 0===t.serial)throw"serial number undefined.";if(i.setSerialNumberByParam(t.serial),"string"!=typeof t.sigalg.name)throw"unproper signature algorithm name";if(i.setSignatureAlgByParam(t.sigalg),void 0===t.issuer)throw"issuer name undefined.";if(i.setIssuerByParam(t.issuer),void 0===t.notbefore)throw"notbefore undefined.";if(i.setNotBeforeByParam(t.notbefore),void 0===t.notafter)throw"notafter undefined.";if(i.setNotAfterByParam(t.notafter),void 0===t.subject)throw"subject name undefined.";if(i.setSubjectByParam(t.subject),void 0===t.sbjpubkey)throw"subject public key undefined.";if(i.setSubjectPublicKeyByGetKey(t.sbjpubkey),void 0!==t.ext&&void 0!==t.ext.length)for(var s=0;s<t.ext.length;s++)for(key in t.ext[s])i.appendExtensionByName(key,t.ext[s][key]);if(void 0===t.cakey&&void 0===t.sighex)throw"param cakey and sighex undefined.";var o=null;return t.cakey&&(o=new r({tbscertobj:i,prvkeyobj:!0===t.cakey.isPrivate?t.cakey:It.getKey.apply(null,t.cakey)})).sign(),t.sighex&&(o=new r({tbscertobj:i})).setSignatureHex(t.sighex),o.getPEMString()},void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),void 0!==et.asn1.cms&&et.asn1.cms||(et.asn1.cms={}),et.asn1.cms.Attribute=function(t){var e=et.asn1;e.cms.Attribute.superclass.constructor.call(this),this.getEncodedHex=function(){var t,n,r;t=new e.DERObjectIdentifier({oid:this.attrTypeOid}),n=new e.DERSet({array:this.valueList});try{n.getEncodedHex()}catch(t){throw"fail valueSet.getEncodedHex in Attribute(1)/"+t}r=new e.DERSequence({array:[t,n]});try{this.hTLV=r.getEncodedHex()}catch(t){throw"failed seq.getEncodedHex in Attribute(2)/"+t}return this.hTLV}},i.lang.extend(et.asn1.cms.Attribute,et.asn1.ASN1Object),et.asn1.cms.ContentType=function(t){var e=et.asn1;e.cms.ContentType.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.3";var n=null;if(void 0!==t){n=new e.DERObjectIdentifier(t);this.valueList=[n]}},i.lang.extend(et.asn1.cms.ContentType,et.asn1.cms.Attribute),et.asn1.cms.MessageDigest=function(t){var e=et,n=e.asn1,r=n.DEROctetString,i=n.cms;if(i.MessageDigest.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.4",void 0!==t)if(t.eciObj instanceof i.EncapsulatedContentInfo&&"string"==typeof t.hashAlg){var s=t.eciObj.eContentValueHex,o=t.hashAlg;(a=new r({hex:e.crypto.Util.hashHex(s,o)})).getEncodedHex(),this.valueList=[a]}else{var a;(a=new r(t)).getEncodedHex(),this.valueList=[a]}},i.lang.extend(et.asn1.cms.MessageDigest,et.asn1.cms.Attribute),et.asn1.cms.SigningTime=function(t){var e=et.asn1;if(e.cms.SigningTime.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.5",void 0!==t){var n=new e.x509.Time(t);try{n.getEncodedHex()}catch(t){throw"SigningTime.getEncodedHex() failed/"+t}this.valueList=[n]}},i.lang.extend(et.asn1.cms.SigningTime,et.asn1.cms.Attribute),et.asn1.cms.SigningCertificate=function(t){var e=et,n=e.asn1,r=n.DERSequence,i=n.cms;e.crypto;i.SigningCertificate.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.16.2.12",this.setCerts=function(t){for(var s=[],o=0;o<t.length;o++){var a=wt(t[o]),c=e.crypto.Util.hashHex(a,"sha1"),u=new n.DEROctetString({hex:c});u.getEncodedHex();var l=new i.IssuerAndSerialNumber({cert:t[o]});l.getEncodedHex();var h=new r({array:[u,l]});h.getEncodedHex(),s.push(h)}var d=new r({array:s});d.getEncodedHex(),this.valueList=[d]},void 0!==t&&"object"==typeof t.array&&this.setCerts(t.array)},i.lang.extend(et.asn1.cms.SigningCertificate,et.asn1.cms.Attribute),et.asn1.cms.SigningCertificateV2=function(t){var e=et,n=e.asn1,r=n.DERSequence,i=n.x509,s=n.cms,o=e.crypto;if(s.SigningCertificateV2.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.16.2.47",this.setCerts=function(t,e){for(var a=[],c=0;c<t.length;c++){var u=wt(t[c]),l=[];"sha256"!==e&&l.push(new i.AlgorithmIdentifier({name:e}));var h=o.Util.hashHex(u,e),d=new n.DEROctetString({hex:h});d.getEncodedHex(),l.push(d);var f=new s.IssuerAndSerialNumber({cert:t[c]});f.getEncodedHex(),l.push(f);var p=new r({array:l});p.getEncodedHex(),a.push(p)}var g=new r({array:a});g.getEncodedHex(),this.valueList=[g]},void 0!==t&&"object"==typeof t.array){var a="sha256";"string"==typeof t.hashAlg&&(a=t.hashAlg),this.setCerts(t.array,a)}},i.lang.extend(et.asn1.cms.SigningCertificateV2,et.asn1.cms.Attribute),et.asn1.cms.IssuerAndSerialNumber=function(t){var e=et.asn1,n=e.DERInteger,r=e.cms,i=e.x509.X500Name,s=Mt;r.IssuerAndSerialNumber.superclass.constructor.call(this);this.setByCertPEM=function(t){var e=wt(t),r=new s;r.hex=e;var o=r.getIssuerHex();this.dIssuer=new i,this.dIssuer.hTLV=o;var a=r.getSerialNumberHex();this.dSerial=new n({hex:a})},this.getEncodedHex=function(){var t=new e.DERSequence({array:[this.dIssuer,this.dSerial]});return this.hTLV=t.getEncodedHex(),this.hTLV},void 0!==t&&("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&this.setByCertPEM(t),t.issuer&&t.serial&&(t.issuer instanceof i?this.dIssuer=t.issuer:this.dIssuer=new i(t.issuer),t.serial instanceof n?this.dSerial=t.serial:this.dSerial=new n(t.serial)),"string"==typeof t.cert&&this.setByCertPEM(t.cert))},i.lang.extend(et.asn1.cms.IssuerAndSerialNumber,et.asn1.ASN1Object),et.asn1.cms.AttributeList=function(t){var e=et.asn1,n=e.cms;n.AttributeList.superclass.constructor.call(this),this.list=new Array,this.sortFlag=!0,this.add=function(t){t instanceof n.Attribute&&this.list.push(t)},this.length=function(){return this.list.length},this.clear=function(){this.list=new Array,this.hTLV=null,this.hV=null},this.getEncodedHex=function(){if("string"==typeof this.hTLV)return this.hTLV;var t=new e.DERSet({array:this.list,sortflag:this.sortFlag});return this.hTLV=t.getEncodedHex(),this.hTLV},void 0!==t&&void 0!==t.sortflag&&0==t.sortflag&&(this.sortFlag=!1)},i.lang.extend(et.asn1.cms.AttributeList,et.asn1.ASN1Object),et.asn1.cms.SignerInfo=function(t){var e=et,n=e.asn1,r=n.DERTaggedObject,i=n.cms,s=i.AttributeList,o=i.ContentType,a=i.EncapsulatedContentInfo,c=i.MessageDigest,u=i.SignedData,l=n.x509.AlgorithmIdentifier,h=e.crypto,d=It;i.SignerInfo.superclass.constructor.call(this),this.dCMSVersion=new n.DERInteger({int:1}),this.dSignerIdentifier=null,this.dDigestAlgorithm=null,this.dSignedAttrs=new s,this.dSigAlg=null,this.dSig=null,this.dUnsignedAttrs=new s,this.setSignerIdentifier=function(t){if("string"==typeof t&&-1!=t.indexOf("CERTIFICATE")&&-1!=t.indexOf("BEGIN")&&-1!=t.indexOf("END")){this.dSignerIdentifier=new i.IssuerAndSerialNumber({cert:t})}},this.setForContentAndHash=function(t){void 0!==t&&(t.eciObj instanceof a&&(this.dSignedAttrs.add(new o({oid:"1.2.840.113549.1.7.1"})),this.dSignedAttrs.add(new c({eciObj:t.eciObj,hashAlg:t.hashAlg}))),void 0!==t.sdObj&&t.sdObj instanceof u&&-1==t.sdObj.digestAlgNameList.join(":").indexOf(t.hashAlg)&&t.sdObj.digestAlgNameList.push(t.hashAlg),"string"==typeof t.hashAlg&&(this.dDigestAlgorithm=new l({name:t.hashAlg})))},this.sign=function(t,e){this.dSigAlg=new l({name:e});var r=this.dSignedAttrs.getEncodedHex(),i=d.getKey(t),s=new h.Signature({alg:e});s.init(i),s.updateHex(r);var o=s.sign();this.dSig=new n.DEROctetString({hex:o})},this.addUnsigned=function(t){this.hTLV=null,this.dUnsignedAttrs.hTLV=null,this.dUnsignedAttrs.add(t)},this.getEncodedHex=function(){if(this.dSignedAttrs instanceof s&&0==this.dSignedAttrs.length())throw"SignedAttrs length = 0 (empty)";var t=new r({obj:this.dSignedAttrs,tag:"a0",explicit:!1}),e=null;this.dUnsignedAttrs.length()>0&&(e=new r({obj:this.dUnsignedAttrs,tag:"a1",explicit:!1}));var i=[this.dCMSVersion,this.dSignerIdentifier,this.dDigestAlgorithm,t,this.dSigAlg,this.dSig];null!=e&&i.push(e);var o=new n.DERSequence({array:i});return this.hTLV=o.getEncodedHex(),this.hTLV}},i.lang.extend(et.asn1.cms.SignerInfo,et.asn1.ASN1Object),et.asn1.cms.EncapsulatedContentInfo=function(t){var e=et.asn1,n=e.DERTaggedObject,r=e.DERSequence,i=e.DERObjectIdentifier,s=e.DEROctetString;e.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.dEContentType=new i({name:"data"}),this.dEContent=null,this.isDetached=!1,this.eContentValueHex=null,this.setContentType=function(t){t.match(/^[0-2][.][0-9.]+$/)?this.dEContentType=new i({oid:t}):this.dEContentType=new i({name:t})},this.setContentValue=function(t){void 0!==t&&("string"==typeof t.hex?this.eContentValueHex=t.hex:"string"==typeof t.str&&(this.eContentValueHex=ft(t.str)))},this.setContentValueHex=function(t){this.eContentValueHex=t},this.setContentValueStr=function(t){this.eContentValueHex=ft(t)},this.getEncodedHex=function(){if("string"!=typeof this.eContentValueHex)throw"eContentValue not yet set";var t=new s({hex:this.eContentValueHex});this.dEContent=new n({obj:t,tag:"a0",explicit:!0});var e=[this.dEContentType];this.isDetached||e.push(this.dEContent);var i=new r({array:e});return this.hTLV=i.getEncodedHex(),this.hTLV}},i.lang.extend(et.asn1.cms.EncapsulatedContentInfo,et.asn1.ASN1Object),et.asn1.cms.ContentInfo=function(t){var e=et.asn1,n=e.DERTaggedObject,r=e.DERSequence,i=e.x509;et.asn1.cms.ContentInfo.superclass.constructor.call(this),this.dContentType=null,this.dContent=null,this.setContentType=function(t){"string"==typeof t&&(this.dContentType=i.OID.name2obj(t))},this.getEncodedHex=function(){var t=new n({obj:this.dContent,tag:"a0",explicit:!0}),e=new r({array:[this.dContentType,t]});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t&&(t.type&&this.setContentType(t.type),t.obj&&t.obj instanceof e.ASN1Object&&(this.dContent=t.obj))},i.lang.extend(et.asn1.cms.ContentInfo,et.asn1.ASN1Object),et.asn1.cms.SignedData=function(t){var e=et.asn1,n=e.ASN1Object,r=e.DERInteger,i=e.DERSet,s=e.DERSequence,o=e.DERTaggedObject,a=e.cms,c=a.EncapsulatedContentInfo,u=a.SignerInfo,l=a.ContentInfo,h=e.x509.AlgorithmIdentifier;et.asn1.cms.SignedData.superclass.constructor.call(this),this.dCMSVersion=new r({int:1}),this.dDigestAlgs=null,this.digestAlgNameList=[],this.dEncapContentInfo=new c,this.dCerts=null,this.certificateList=[],this.crlList=[],this.signerInfoList=[new u],this.addCertificatesByPEM=function(t){var e=wt(t),r=new n;r.hTLV=e,this.certificateList.push(r)},this.getEncodedHex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(null==this.dDigestAlgs){for(var t=[],e=0;e<this.digestAlgNameList.length;e++){var n=this.digestAlgNameList[e],r=new h({name:n});t.push(r)}this.dDigestAlgs=new i({array:t})}var a=[this.dCMSVersion,this.dDigestAlgs,this.dEncapContentInfo];if(null==this.dCerts&&this.certificateList.length>0){var c=new i({array:this.certificateList});this.dCerts=new o({obj:c,tag:"a0",explicit:!1})}null!=this.dCerts&&a.push(this.dCerts);var u=new i({array:this.signerInfoList});a.push(u);var l=new s({array:a});return this.hTLV=l.getEncodedHex(),this.hTLV},this.getContentInfo=function(){return this.getEncodedHex(),new l({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().getEncodedHex()},this.getPEM=function(){return bt(this.getContentInfoEncodedHex(),"CMS")}},i.lang.extend(et.asn1.cms.SignedData,et.asn1.ASN1Object),et.asn1.cms.CMSUtil=new function(){},et.asn1.cms.CMSUtil.newSignedData=function(t){var e=et.asn1,n=e.cms,r=n.SignerInfo,i=n.SignedData,s=n.SigningTime,o=n.SigningCertificate,a=n.SigningCertificateV2,c=e.cades.SignaturePolicyIdentifier,u=new i;if(u.dEncapContentInfo.setContentValue(t.content),"object"==typeof t.certs)for(var l=0;l<t.certs.length;l++)u.addCertificatesByPEM(t.certs[l]);u.signerInfoList=[];for(l=0;l<t.signerInfos.length;l++){var h=t.signerInfos[l],d=new r;for(attrName in d.setSignerIdentifier(h.signerCert),d.setForContentAndHash({sdObj:u,eciObj:u.dEncapContentInfo,hashAlg:h.hashAlg}),h.sAttr){var f=h.sAttr[attrName];if("SigningTime"==attrName){var p=new s(f);d.dSignedAttrs.add(p)}if("SigningCertificate"==attrName){p=new o(f);d.dSignedAttrs.add(p)}if("SigningCertificateV2"==attrName){p=new a(f);d.dSignedAttrs.add(p)}if("SignaturePolicyIdentifier"==attrName){p=new c(f);d.dSignedAttrs.add(p)}}d.sign(h.signerPrvKey,h.sigAlg),u.signerInfoList.push(d)}return u},et.asn1.cms.CMSUtil.verifySignedData=function(t){var e=et,n=e.asn1,r=n.cms,i=(r.SignerInfo,r.SignedData,r.SigningTime,r.SigningCertificate,r.SigningCertificateV2,n.cades.SignaturePolicyIdentifier,e.lang.String.isHex),s=it,o=s.getVbyList,a=s.getTLVbyList,c=s.getIdxbyList,u=s.getChildIdx,l=s.getTLV,h=s.oidname,d=e.crypto.Util.hashHex;void 0===t.cms&&i(t.cms);var f=t.cms,p=function(t,e){var n=e.idx;e.signerid_issuer1=a(t,n,[1,0],"30"),e.signerid_serial1=o(t,n,[1,1],"02"),e.hashalg=h(o(t,n,[2,0],"06"));var r=c(t,n,[3],"a0");e.idxSignedAttrs=r,g(t,e,r);var i=u(t,n).length;if(i<6)throw"malformed SignerInfo";e.sigalg=h(o(t,n,[i-2,0],"06")),e.sigval=o(t,n,[i-1],"04")},g=function(t,e,n){var r=u(t,n);e.signedAttrIdxList=r;for(var i=0;i<r.length;i++){var s,a=r[i],c=o(t,a,[0],"06");"2a864886f70d010905"===c?(s=pt(o(t,a,[1,0])),e.saSigningTime=s):"2a864886f70d010904"===c&&(s=o(t,a,[1,0],"04"),e.saMessageDigest=s)}},y=function(t,e,n,r){n.verifyDetail={};var i=n.verifyDetail,s=e.parse.econtent,o=n.hashalg,a=n.saMessageDigest;i.validMessageDigest=!1,d(s,o)===a&&(i.validMessageDigest=!0),function(t,e,n,r){var i,s=e.parse.certsIdx;if(void 0===e.certs){i=[],e.certkeys=[];for(var o=u(t,s),a=0;a<o.length;a++){var c=l(t,o[a]),h=new Mt;h.readCertHex(c),i[a]=h,e.certkeys[a]=h.getPublicKey()}e.certs=i}else i=e.certs;e.cccc=i.length,e.cccci=o.length;for(a=0;a<i.length;a++){var d=h.getIssuerHex(),f=h.getSerialNumberHex();n.signerid_issuer1===d&&n.signerid_serial1===f&&(n.certkey_idx=a)}}(t,e,n),i.validSignatureValue=!1;var c=n.sigalg,h="31"+l(t,n.idxSignedAttrs).substr(2);n.signedattrshex=h;var f=e.certs[n.certkey_idx].getPublicKey(),p=new et.crypto.Signature({alg:c});p.init(f),p.updateHex(h);var g=p.verify(n.sigval);i.validSignatureValue_isValid=g,!0===g&&(i.validSignatureValue=!0),n.isValid=!1,i.validMessageDigest&&i.validSignatureValue&&(n.isValid=!0)},v={isValid:!1,parse:{}};return function(t,e){if("2a864886f70d010702"!==o(t,0,[0],"06"))return e;e.cmsType="signedData",e.econtent=o(t,0,[1,0,2,1,0]),function(t,e){for(var n,r=3;r<6;r++)if(void 0!==(n=c(t,0,[1,0,r]))){var i=t.substr(n,2);"a0"===i&&(e.certsIdx=n),"a1"===i&&(e.revinfosIdx=n),"31"===i&&(e.signerinfosIdx=n)}}(t,e),e.signerInfos=[],function(t,e){var n=e.signerinfosIdx;if(void 0!==n){var r=u(t,n);e.signerInfoIdxList=r;for(var i=0;i<r.length;i++){var s={idx:r[i]};p(t,s),e.signerInfos.push(s)}}}(t,e)}(f,v.parse),function(t,e){for(var n=e.parse.signerInfos,r=n.length,i=!0,s=0;s<r;s++){var o=n[s];y(t,e,o,s),o.isValid||(i=!1)}e.isValid=i}(f,v),v},void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),void 0!==et.asn1.tsp&&et.asn1.tsp||(et.asn1.tsp={}),et.asn1.tsp.Accuracy=function(t){var e=et.asn1,n=e.DERInteger,r=e.DERSequence,i=e.DERTaggedObject;e.tsp.Accuracy.superclass.constructor.call(this),this.seconds=null,this.millis=null,this.micros=null,this.getEncodedHex=function(){var t=null,e=null,s=null,o=[];if(null!=this.seconds&&(t=new n({int:this.seconds}),o.push(t)),null!=this.millis){var a=new n({int:this.millis});e=new i({obj:a,tag:"80",explicit:!1}),o.push(e)}if(null!=this.micros){var c=new n({int:this.micros});s=new i({obj:c,tag:"81",explicit:!1}),o.push(s)}var u=new r({array:o});return this.hTLV=u.getEncodedHex(),this.hTLV},void 0!==t&&("number"==typeof t.seconds&&(this.seconds=t.seconds),"number"==typeof t.millis&&(this.millis=t.millis),"number"==typeof t.micros&&(this.micros=t.micros))},i.lang.extend(et.asn1.tsp.Accuracy,et.asn1.ASN1Object),et.asn1.tsp.MessageImprint=function(t){var e=et.asn1,n=e.DERSequence,r=e.DEROctetString,i=e.x509.AlgorithmIdentifier;e.tsp.MessageImprint.superclass.constructor.call(this),this.dHashAlg=null,this.dHashValue=null,this.getEncodedHex=function(){return"string"==typeof this.hTLV?this.hTLV:new n({array:[this.dHashAlg,this.dHashValue]}).getEncodedHex()},void 0!==t&&("string"==typeof t.hashAlg&&(this.dHashAlg=new i({name:t.hashAlg})),"string"==typeof t.hashValue&&(this.dHashValue=new r({hex:t.hashValue})))},i.lang.extend(et.asn1.tsp.MessageImprint,et.asn1.ASN1Object),et.asn1.tsp.TimeStampReq=function(t){var e=et.asn1,n=e.DERSequence,r=e.DERInteger,i=e.DERBoolean,s=e.DERObjectIdentifier,o=e.tsp,a=o.MessageImprint;o.TimeStampReq.superclass.constructor.call(this),this.dVersion=new r({int:1}),this.dMessageImprint=null,this.dPolicy=null,this.dNonce=null,this.certReq=!0,this.setMessageImprint=function(t){t instanceof a?this.dMessageImprint=t:"object"==typeof t&&(this.dMessageImprint=new a(t))},this.getEncodedHex=function(){if(null==this.dMessageImprint)throw"messageImprint shall be specified";var t=[this.dVersion,this.dMessageImprint];null!=this.dPolicy&&t.push(this.dPolicy),null!=this.dNonce&&t.push(this.dNonce),this.certReq&&t.push(new i);var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t&&("object"==typeof t.mi&&this.setMessageImprint(t.mi),"object"==typeof t.policy&&(this.dPolicy=new s(t.policy)),"object"==typeof t.nonce&&(this.dNonce=new r(t.nonce)),"boolean"==typeof t.certreq&&(this.certReq=t.certreq))},i.lang.extend(et.asn1.tsp.TimeStampReq,et.asn1.ASN1Object),et.asn1.tsp.TSTInfo=function(t){var e=et.asn1,n=e.DERSequence,r=e.DERInteger,i=e.DERBoolean,s=e.DERGeneralizedTime,o=e.DERObjectIdentifier,a=e.tsp,c=a.MessageImprint,u=a.Accuracy,l=e.x509.X500Name;if(a.TSTInfo.superclass.constructor.call(this),this.dVersion=new r({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerialNumber=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.getEncodedHex=function(){var t=[this.dVersion];if(null==this.dPolicy)throw"policy shall be specified.";if(t.push(this.dPolicy),null==this.dMessageImprint)throw"messageImprint shall be specified.";if(t.push(this.dMessageImprint),null==this.dSerialNumber)throw"serialNumber shall be specified.";if(t.push(this.dSerialNumber),null==this.dGenTime)throw"genTime shall be specified.";t.push(this.dGenTime),null!=this.dAccuracy&&t.push(this.dAccuracy),null!=this.dOrdering&&t.push(this.dOrdering),null!=this.dNonce&&t.push(this.dNonce),null!=this.dTsa&&t.push(this.dTsa);var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t){if("string"==typeof t.policy){if(!t.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new o({oid:t.policy})}void 0!==t.messageImprint&&(this.dMessageImprint=new c(t.messageImprint)),void 0!==t.serialNumber&&(this.dSerialNumber=new r(t.serialNumber)),void 0!==t.genTime&&(this.dGenTime=new s(t.genTime)),void 0!==t.accuracy&&(this.dAccuracy=new u(t.accuracy)),void 0!==t.ordering&&1==t.ordering&&(this.dOrdering=new i),void 0!==t.nonce&&(this.dNonce=new r(t.nonce)),void 0!==t.tsa&&(this.dTsa=new l(t.tsa))}},i.lang.extend(et.asn1.tsp.TSTInfo,et.asn1.ASN1Object),et.asn1.tsp.TimeStampResp=function(t){var e=et.asn1,n=e.DERSequence,r=e.ASN1Object,i=e.tsp,s=i.PKIStatusInfo;i.TimeStampResp.superclass.constructor.call(this),this.dStatus=null,this.dTST=null,this.getEncodedHex=function(){if(null==this.dStatus)throw"status shall be specified";var t=[this.dStatus];null!=this.dTST&&t.push(this.dTST);var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t&&("object"==typeof t.status&&(this.dStatus=new s(t.status)),void 0!==t.tst&&t.tst instanceof r&&(this.dTST=t.tst.getContentInfo()))},i.lang.extend(et.asn1.tsp.TimeStampResp,et.asn1.ASN1Object),et.asn1.tsp.PKIStatusInfo=function(t){var e=et.asn1,n=e.DERSequence,r=e.tsp,i=r.PKIStatus,s=r.PKIFreeText,o=r.PKIFailureInfo;r.PKIStatusInfo.superclass.constructor.call(this),this.dStatus=null,this.dStatusString=null,this.dFailureInfo=null,this.getEncodedHex=function(){if(null==this.dStatus)throw"status shall be specified";var t=[this.dStatus];null!=this.dStatusString&&t.push(this.dStatusString),null!=this.dFailureInfo&&t.push(this.dFailureInfo);var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t&&("object"==typeof t.status&&(this.dStatus=new i(t.status)),"object"==typeof t.statstr&&(this.dStatusString=new s({array:t.statstr})),"object"==typeof t.failinfo&&(this.dFailureInfo=new o(t.failinfo)))},i.lang.extend(et.asn1.tsp.PKIStatusInfo,et.asn1.ASN1Object),et.asn1.tsp.PKIStatus=function(t){var e=et.asn1,n=e.DERInteger,r=e.tsp,i=r.PKIStatus;r.PKIStatus.superclass.constructor.call(this);if(this.getEncodedHex=function(){return this.hTLV=this.dStatus.getEncodedHex(),this.hTLV},void 0!==t)if(void 0!==t.name){var s=i.valueList;if(void 0===s[t.name])throw"name undefined: "+t.name;this.dStatus=new n({int:s[t.name]})}else this.dStatus=new n(t)},i.lang.extend(et.asn1.tsp.PKIStatus,et.asn1.ASN1Object),et.asn1.tsp.PKIStatus.valueList={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5},et.asn1.tsp.PKIFreeText=function(t){var e=et.asn1,n=e.DERSequence,r=e.DERUTF8String;e.tsp.PKIFreeText.superclass.constructor.call(this),this.textList=[],this.getEncodedHex=function(){for(var t=[],e=0;e<this.textList.length;e++)t.push(new r({str:this.textList[e]}));var i=new n({array:t});return this.hTLV=i.getEncodedHex(),this.hTLV},void 0!==t&&"object"==typeof t.array&&(this.textList=t.array)},i.lang.extend(et.asn1.tsp.PKIFreeText,et.asn1.ASN1Object),et.asn1.tsp.PKIFailureInfo=function(t){var e=et.asn1,n=e.DERBitString,r=e.tsp.PKIFailureInfo;if(r.superclass.constructor.call(this),this.value=null,this.getEncodedHex=function(){if(null==this.value)throw"value shall be specified";var t=new Number(this.value).toString(2),e=new n;return e.setByBinaryString(t),this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t)if("string"==typeof t.name){var i=r.valueList;if(void 0===i[t.name])throw"name undefined: "+t.name;this.value=i[t.name]}else"number"==typeof t.int&&(this.value=t.int)},i.lang.extend(et.asn1.tsp.PKIFailureInfo,et.asn1.ASN1Object),et.asn1.tsp.PKIFailureInfo.valueList={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25},et.asn1.tsp.AbstractTSAAdapter=function(t){this.getTSTHex=function(t,e){throw"not implemented yet"}},et.asn1.tsp.SimpleTSAAdapter=function(t){var e=et,n=e.asn1.tsp,r=e.crypto.Util.hashHex;n.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(t,e){var i=r(t,e);this.params.tstInfo.messageImprint={hashAlg:e,hashValue:i},this.params.tstInfo.serialNumber={int:this.serial++};var s=Math.floor(1e9*Math.random());return this.params.tstInfo.nonce={int:s},n.TSPUtil.newTimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==t&&(this.params=t)},i.lang.extend(et.asn1.tsp.SimpleTSAAdapter,et.asn1.tsp.AbstractTSAAdapter),et.asn1.tsp.FixedTSAAdapter=function(t){var e=et,n=e.asn1.tsp,r=e.crypto.Util.hashHex;n.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(t,e){var i=r(t,e);return this.params.tstInfo.messageImprint={hashAlg:e,hashValue:i},n.TSPUtil.newTimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==t&&(this.params=t)},i.lang.extend(et.asn1.tsp.FixedTSAAdapter,et.asn1.tsp.AbstractTSAAdapter),et.asn1.tsp.TSPUtil=new function(){},et.asn1.tsp.TSPUtil.newTimeStampToken=function(t){var e=et.asn1,n=e.cms,r=(e.tsp,e.tsp.TSTInfo),i=new n.SignedData,s=new r(t.tstInfo).getEncodedHex();if(i.dEncapContentInfo.setContentValue({hex:s}),i.dEncapContentInfo.setContentType("tstinfo"),"object"==typeof t.certs)for(var o=0;o<t.certs.length;o++)i.addCertificatesByPEM(t.certs[o]);var a=i.signerInfoList[0];a.setSignerIdentifier(t.signerCert),a.setForContentAndHash({sdObj:i,eciObj:i.dEncapContentInfo,hashAlg:t.hashAlg});var c=new n.SigningCertificate({array:[t.signerCert]});return a.dSignedAttrs.add(c),a.sign(t.signerPrvKey,t.sigAlg),i},et.asn1.tsp.TSPUtil.parseTimeStampReq=function(t){var e=it,n=e.getChildIdx,r=e.getV,i=e.getTLV,s={certreq:!1},o=n(t,0);if(o.length<2)throw"TimeStampReq must have at least 2 items";var a=i(t,o[1]);s.mi=et.asn1.tsp.TSPUtil.parseMessageImprint(a);for(var c=2;c<o.length;c++){var u=o[c],l=t.substr(u,2);if("06"==l){var h=r(t,u);s.policy=e.hextooidstr(h)}"02"==l&&(s.nonce=r(t,u)),"01"==l&&(s.certreq=!0)}return s},et.asn1.tsp.TSPUtil.parseMessageImprint=function(t){var e=it,n=e.getChildIdx,r=e.getV,i=e.getIdxbyList,s={};if("30"!=t.substr(0,2))throw"head of messageImprint hex shall be '30'";n(t,0);var o=r(t,i(t,0,[0,0])),a=e.hextooidstr(o),c=et.asn1.x509.OID.oid2name(a);if(""==c)throw"hashAlg name undefined: "+a;var u=c,l=i(t,0,[1]);return s.hashAlg=u,s.hashValue=r(t,l),s},void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),void 0!==et.asn1.cades&&et.asn1.cades||(et.asn1.cades={}),et.asn1.cades.SignaturePolicyIdentifier=function(t){var e=et.asn1,n=e.DERObjectIdentifier,r=e.DERSequence,i=e.cades,s=i.OtherHashAlgAndValue;if(i.SignaturePolicyIdentifier.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.16.2.15",void 0!==t&&"string"==typeof t.oid&&"object"==typeof t.hash){var o=new r({array:[new n({oid:t.oid}),new s(t.hash)]});this.valueList=[o]}},i.lang.extend(et.asn1.cades.SignaturePolicyIdentifier,et.asn1.cms.Attribute),et.asn1.cades.OtherHashAlgAndValue=function(t){var e=et.asn1,n=e.DERSequence,r=e.DEROctetString,i=e.x509.AlgorithmIdentifier;e.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.dAlg=null,this.dHash=null,this.getEncodedHex=function(){var t=new n({array:[this.dAlg,this.dHash]});return this.hTLV=t.getEncodedHex(),this.hTLV},void 0!==t&&"string"==typeof t.alg&&"string"==typeof t.hash&&(this.dAlg=new i({name:t.alg}),this.dHash=new r({hex:t.hash}))},i.lang.extend(et.asn1.cades.OtherHashAlgAndValue,et.asn1.ASN1Object),et.asn1.cades.SignatureTimeStamp=function(t){var e=et.asn1,n=e.ASN1Object;e.x509;if(e.cades.SignatureTimeStamp.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.16.2.14",this.tstHex=null,void 0!==t){if(void 0!==t.res)if("string"==typeof t.res&&t.res.match(/^[0-9A-Fa-f]+$/));else if(!(t.res instanceof n))throw"res param shall be ASN1Object or hex string";if(void 0!==t.tst)if("string"==typeof t.tst&&t.tst.match(/^[0-9A-Fa-f]+$/)){var r=new n;this.tstHex=t.tst,r.hTLV=this.tstHex,r.getEncodedHex(),this.valueList=[r]}else if(!(t.tst instanceof n))throw"tst param shall be ASN1Object or hex string"}},i.lang.extend(et.asn1.cades.SignatureTimeStamp,et.asn1.cms.Attribute),et.asn1.cades.CompleteCertificateRefs=function(t){var e=et.asn1.cades;e.CompleteCertificateRefs.superclass.constructor.call(this),this.attrTypeOid="1.2.840.113549.1.9.16.2.21",this.setByArray=function(t){this.valueList=[];for(var n=0;n<t.length;n++){var r=new e.OtherCertID(t[n]);this.valueList.push(r)}},void 0!==t&&"object"==typeof t&&"number"==typeof t.length&&this.setByArray(t)},i.lang.extend(et.asn1.cades.CompleteCertificateRefs,et.asn1.cms.Attribute),et.asn1.cades.OtherCertID=function(t){var e=et.asn1,n=e.cms,r=e.cades;r.OtherCertID.superclass.constructor.call(this),this.hasIssuerSerial=!0,this.dOtherCertHash=null,this.dIssuerSerial=null,this.setByCertPEM=function(t){this.dOtherCertHash=new r.OtherHash(t),this.hasIssuerSerial&&(this.dIssuerSerial=new n.IssuerAndSerialNumber(t))},this.getEncodedHex=function(){if(null!=this.hTLV)return this.hTLV;if(null==this.dOtherCertHash)throw"otherCertHash not set";var t=[this.dOtherCertHash];null!=this.dIssuerSerial&&t.push(this.dIssuerSerial);var n=new e.DERSequence({array:t});return this.hTLV=n.getEncodedHex(),this.hTLV},void 0!==t&&("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&this.setByCertPEM(t),"object"==typeof t&&(!1===t.hasis&&(this.hasIssuerSerial=!1),"string"==typeof t.cert&&this.setByCertPEM(t.cert)))},i.lang.extend(et.asn1.cades.OtherCertID,et.asn1.ASN1Object),et.asn1.cades.OtherHash=function(t){var e=et,n=e.asn1,r=(n.cms,n.cades),i=r.OtherHashAlgAndValue,s=e.crypto.Util.hashHex;if(r.OtherHash.superclass.constructor.call(this),this.alg="sha256",this.dOtherHash=null,this.setByCertPEM=function(t){if(-1==t.indexOf("-----BEGIN "))throw"certPEM not to seem PEM format";var e=wt(t),n=s(e,this.alg);this.dOtherHash=new i({alg:this.alg,hash:n})},this.getEncodedHex=function(){if(null==this.dOtherHash)throw"OtherHash not set";return this.dOtherHash.getEncodedHex()},void 0!==t)if("string"==typeof t)if(-1!=t.indexOf("-----BEGIN "))this.setByCertPEM(t);else{if(!t.match(/^[0-9A-Fa-f]+$/))throw"unsupported string value for params";this.dOtherHash=new n.DEROctetString({hex:t})}else"object"==typeof t&&("string"==typeof t.cert?("string"==typeof t.alg&&(this.alg=t.alg),this.setByCertPEM(t.cert)):this.dOtherHash=new i(t))},i.lang.extend(et.asn1.cades.OtherHash,et.asn1.ASN1Object),et.asn1.cades.CAdESUtil=new function(){},et.asn1.cades.CAdESUtil.addSigTS=function(t,e,n){},et.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(t){var e=it,n=e.getChildIdx,r=e.getTLV,i=e.getTLVbyList,s=e.getIdxbyList,o=et.asn1,a=o.ASN1Object,c=o.cms.SignedData,u=o.cades.CAdESUtil,l={};if("06092a864886f70d010702"!=i(t,0,[0]))throw"hex is not CMS SignedData";var h=n(t,s(t,0,[1,0]));if(h.length<4)throw"num of SignedData elem shall be 4 at least";var d=h.shift();l.version=r(t,d);var f=h.shift();l.algs=r(t,f);var p=h.shift();l.encapcontent=r(t,p),l.certs=null,l.revs=null,l.si=[];var g=h.shift();"a0"==t.substr(g,2)&&(l.certs=r(t,g),g=h.shift()),"a1"==t.substr(g,2)&&(l.revs=r(t,g),g=h.shift());var y=g;if("31"!=t.substr(y,2))throw"Can't find signerInfos";for(var v=n(t,y),m=0;m<v.length;m++){var _=v[m],b=u.parseSignerInfoForAddingUnsigned(t,_,m);l.si[m]=b}var w=null;l.obj=new c,(w=new a).hTLV=l.version,l.obj.dCMSVersion=w,(w=new a).hTLV=l.algs,l.obj.dDigestAlgs=w,(w=new a).hTLV=l.encapcontent,l.obj.dEncapContentInfo=w,(w=new a).hTLV=l.certs,l.obj.dCerts=w,l.obj.signerInfoList=[];for(m=0;m<l.si.length;m++)l.obj.signerInfoList.push(l.si[m].obj);return l},et.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(t,e,n){var r=it,i=r.getChildIdx,s=r.getTLV,o=r.getV,a=et.asn1,c=a.ASN1Object,u=a.cms,l=u.AttributeList,h=u.SignerInfo,d={},f=i(t,e);if(6!=f.length)throw"not supported items for SignerInfo (!=6)";var p=f.shift();d.version=s(t,p);var g=f.shift();d.si=s(t,g);var y=f.shift();d.digalg=s(t,y);var v=f.shift();d.sattrs=s(t,v);var m=f.shift();d.sigalg=s(t,m);var _=f.shift();d.sig=s(t,_),d.sigval=o(t,_);var b=null;return d.obj=new h,(b=new c).hTLV=d.version,d.obj.dCMSVersion=b,(b=new c).hTLV=d.si,d.obj.dSignerIdentifier=b,(b=new c).hTLV=d.digalg,d.obj.dDigestAlgorithm=b,(b=new c).hTLV=d.sattrs,d.obj.dSignedAttrs=b,(b=new c).hTLV=d.sigalg,d.obj.dSigAlg=b,(b=new c).hTLV=d.sig,d.obj.dSig=b,d.obj.dUnsignedAttrs=new l,d},void 0!==et.asn1.csr&&et.asn1.csr||(et.asn1.csr={}),et.asn1.csr.CertificationRequest=function(t){var e=et,n=e.asn1,r=n.DERBitString,i=n.DERSequence,s=n.csr,o=n.x509;s.CertificationRequest.superclass.constructor.call(this);this.sign=function(t,n){null==this.prvKey&&(this.prvKey=n),this.asn1SignatureAlg=new o.AlgorithmIdentifier({name:t}),sig=new e.crypto.Signature({alg:t}),sig.init(this.prvKey),sig.updateHex(this.asn1CSRInfo.getEncodedHex()),this.hexSig=sig.sign(),this.asn1Sig=new r({hex:"00"+this.hexSig});var s=new i({array:[this.asn1CSRInfo,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=s.getEncodedHex(),this.isModified=!1},this.getPEMString=function(){return bt(this.getEncodedHex(),"CERTIFICATE REQUEST")},this.getEncodedHex=function(){if(0==this.isModified&&null!=this.hTLV)return this.hTLV;throw"not signed yet"},void 0!==t&&void 0!==t.csrinfo&&(this.asn1CSRInfo=t.csrinfo)},i.lang.extend(et.asn1.csr.CertificationRequest,et.asn1.ASN1Object),et.asn1.csr.CertificationRequestInfo=function(t){var e=et.asn1,n=e.DERInteger,r=e.DERSequence,i=e.DERSet,s=e.DERNull,o=e.DERTaggedObject,a=e.DERObjectIdentifier,c=e.csr,u=e.x509,l=u.X500Name,h=u.Extension,d=It;c.CertificationRequestInfo.superclass.constructor.call(this),this._initialize=function(){this.asn1Array=new Array,this.asn1Version=new n({int:0}),this.asn1Subject=null,this.asn1SubjPKey=null,this.extensionsArray=new Array},this.setSubjectByParam=function(t){this.asn1Subject=new l(t)},this.setSubjectPublicKeyByGetKey=function(t){var e=d.getKey(t);this.asn1SubjPKey=new u.SubjectPublicKeyInfo(e)},this.appendExtensionByName=function(t,e){h.appendByNameToArray(t,e,this.extensionsArray)},this.getEncodedHex=function(){if(this.asn1Array=new Array,this.asn1Array.push(this.asn1Version),this.asn1Array.push(this.asn1Subject),this.asn1Array.push(this.asn1SubjPKey),this.extensionsArray.length>0){var t=new r({array:this.extensionsArray}),e=new i({array:[t]}),n=new r({array:[new a({oid:"1.2.840.113549.1.9.14"}),e]}),c=new o({explicit:!0,tag:"a0",obj:n});this.asn1Array.push(c)}else{c=new o({explicit:!1,tag:"a0",obj:new s});this.asn1Array.push(c)}var u=new r({array:this.asn1Array});return this.hTLV=u.getEncodedHex(),this.isModified=!1,this.hTLV},this._initialize()},i.lang.extend(et.asn1.csr.CertificationRequestInfo,et.asn1.ASN1Object),et.asn1.csr.CSRUtil=new function(){},et.asn1.csr.CSRUtil.newCSRPEM=function(t){var e=It,n=et.asn1.csr;if(void 0===t.subject)throw"parameter subject undefined";if(void 0===t.sbjpubkey)throw"parameter sbjpubkey undefined";if(void 0===t.sigalg)throw"parameter sigalg undefined";if(void 0===t.sbjprvkey)throw"parameter sbjpubkey undefined";var r=new n.CertificationRequestInfo;if(r.setSubjectByParam(t.subject),r.setSubjectPublicKeyByGetKey(t.sbjpubkey),void 0!==t.ext&&void 0!==t.ext.length)for(var i=0;i<t.ext.length;i++)for(key in t.ext[i])r.appendExtensionByName(key,t.ext[i][key]);var s=new n.CertificationRequest({csrinfo:r}),o=e.getKey(t.sbjprvkey);return s.sign(t.sigalg,o),s.getPEMString()},et.asn1.csr.CSRUtil.getInfo=function(t){var e=it.getTLVbyList,n={subject:{},pubkey:{}};if(-1==t.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw"argument is not PEM file";var r=wt(t,"CERTIFICATE REQUEST");return n.subject.hex=e(r,0,[0,1]),n.subject.name=Mt.hex2dn(n.subject.hex),n.pubkey.hex=e(r,0,[0,2]),n.pubkey.obj=It.getKey(n.pubkey.hex,null,"pkcs8pub"),n},void 0!==et&&et||(et={}),void 0!==et.asn1&&et.asn1||(et.asn1={}),void 0!==et.asn1.ocsp&&et.asn1.ocsp||(et.asn1.ocsp={}),et.asn1.ocsp.DEFAULT_HASH="sha1",et.asn1.ocsp.CertID=function(t){var e=et,n=e.asn1,r=n.DEROctetString,i=n.DERInteger,s=n.DERSequence,o=n.x509.AlgorithmIdentifier,a=n.ocsp,c=a.DEFAULT_HASH,u=e.crypto.Util.hashHex,l=Mt,h=it;if(a.CertID.superclass.constructor.call(this),this.dHashAlg=null,this.dIssuerNameHash=null,this.dIssuerKeyHash=null,this.dSerialNumber=null,this.setByValue=function(t,e,n,s){void 0===s&&(s=c),this.dHashAlg=new o({name:s}),this.dIssuerNameHash=new r({hex:t}),this.dIssuerKeyHash=new r({hex:e}),this.dSerialNumber=new i({hex:n})},this.setByCert=function(t,e,n){void 0===n&&(n=c);var r=new l;r.readCertPEM(e);var i=new l;i.readCertPEM(t);var s=i.getPublicKeyHex(),o=h.getTLVbyList(s,0,[1,0],"30"),a=r.getSerialNumberHex(),d=u(i.getSubjectHex(),n),f=u(o,n);this.setByValue(d,f,a,n),this.hoge=r.getSerialNumberHex()},this.getEncodedHex=function(){if(null===this.dHashAlg&&null===this.dIssuerNameHash&&null===this.dIssuerKeyHash&&null===this.dSerialNumber)throw"not yet set values";var t=[this.dHashAlg,this.dIssuerNameHash,this.dIssuerKeyHash,this.dSerialNumber],e=new s({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t){var d=t;if(void 0!==d.issuerCert&&void 0!==d.subjectCert){var f=c;void 0===d.alg&&(f=void 0),this.setByCert(d.issuerCert,d.subjectCert,f)}else{if(void 0===d.namehash||void 0===d.keyhash||void 0===d.serial)throw"invalid constructor arguments";f=c;void 0===d.alg&&(f=void 0),this.setByValue(d.namehash,d.keyhash,d.serial,f)}}},i.lang.extend(et.asn1.ocsp.CertID,et.asn1.ASN1Object),et.asn1.ocsp.Request=function(t){var e=et.asn1,n=e.DERSequence,r=e.ocsp;if(r.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.getEncodedHex=function(){var t=[];if(null===this.dReqCert)throw"reqCert not set";t.push(this.dReqCert);var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t){var i=new r.CertID(t);this.dReqCert=i}},i.lang.extend(et.asn1.ocsp.Request,et.asn1.ASN1Object),et.asn1.ocsp.TBSRequest=function(t){var e=et.asn1,n=e.DERSequence,r=e.ocsp;r.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(t){for(var e=[],n=0;n<t.length;n++){var i=new r.Request(t[0]);e.push(i)}this.dRequestList=e},this.getEncodedHex=function(){var t=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var e=new n({array:this.dRequestList});if(t.push(e),null!==this.dRequestExt)throw"requestExtensions not supported";var r=new n({array:t});return this.hTLV=r.getEncodedHex(),this.hTLV},void 0!==t&&void 0!==t.reqList&&this.setRequestListByParam(t.reqList)},i.lang.extend(et.asn1.ocsp.TBSRequest,et.asn1.ASN1Object),et.asn1.ocsp.OCSPRequest=function(t){var e=et.asn1,n=e.DERSequence,r=e.ocsp;if(r.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.getEncodedHex=function(){var t=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(t.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var e=new n({array:t});return this.hTLV=e.getEncodedHex(),this.hTLV},void 0!==t&&void 0!==t.reqList){var i=new r.TBSRequest(t);this.dTbsRequest=i}},i.lang.extend(et.asn1.ocsp.OCSPRequest,et.asn1.ASN1Object),et.asn1.ocsp.OCSPUtil={},et.asn1.ocsp.OCSPUtil.getRequestHex=function(t,e,n){var r=et.asn1.ocsp;void 0===n&&(n=r.DEFAULT_HASH);var i={alg:n,issuerCert:t,subjectCert:e};return new r.OCSPRequest({reqList:[i]}).getEncodedHex()},et.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(t){var e=it,n=e.getVbyList,r=e.getIdxbyList,i=(n=e.getVbyList,e.getV),s={};try{var o=n(t,0,[0],"0a");s.responseStatus=parseInt(o,16)}catch(t){}if(0!==s.responseStatus)return s;try{var a=r(t,0,[1,0,1,0,0,2,0,1]);"80"===t.substr(a,2)?s.certStatus="good":"a1"===t.substr(a,2)?(s.certStatus="revoked",s.revocationTime=pt(n(t,a,[0]))):"82"===t.substr(a,2)&&(s.certStatus="unknown")}catch(t){}try{var c=r(t,0,[1,0,1,0,0,2,0,2]);s.thisUpdate=pt(i(t,c))}catch(t){}try{var u=r(t,0,[1,0,1,0,0,2,0,3]);"a0"===t.substr(u,2)&&(s.nextUpdate=pt(n(t,u,[0])))}catch(t){}return s},void 0!==et&&et||(et={}),void 0!==et.lang&&et.lang||(et.lang={}),et.lang.String=function(){},"function"==typeof t?(nt=function(e){return ut(new t(e,"utf8").toString("base64"))},rt=function(e){return new t(lt(e),"base64").toString("utf8")}):(nt=function(t){return ht(Et(Ot(t)))},rt=function(t){return decodeURIComponent(xt(dt(t)))}),et.lang.String.isInteger=function(t){return!!t.match(/^[0-9]+$/)||!!t.match(/^-[0-9]+$/)},et.lang.String.isHex=function(t){return!(t.length%2!=0||!t.match(/^[0-9a-f]+$/)&&!t.match(/^[0-9A-F]+$/))},et.lang.String.isBase64=function(t){return!(!(t=t.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||t.length%4!=0)},et.lang.String.isBase64URL=function(t){return!t.match(/[+/=]/)&&(t=lt(t),et.lang.String.isBase64(t))},et.lang.String.isIntegerArray=function(t){return!!(t=t.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)};void 0!==et&&et||(et={}),void 0!==et.crypto&&et.crypto||(et.crypto={}),et.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:s.algo.MD5,sha1:s.algo.SHA1,sha224:s.algo.SHA224,sha256:s.algo.SHA256,sha384:s.algo.SHA384,sha512:s.algo.SHA512,ripemd160:s.algo.RIPEMD160},this.getDigestInfoHex=function(t,e){if(void 0===this.DIGESTINFOHEAD[e])throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,n){var r=this.getDigestInfoHex(t,e),i=n/4;if(r.length+22>i)throw"key is too short for SigAlg: keylen="+n+","+e;for(var s="0001",o="00"+r,a="",c=i-s.length-o.length,u=0;u<c;u+=2)a+="ff";return s+a+o},this.hashString=function(t,e){return new et.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new et.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return new et.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"}).digestString(t)},this.sha256=function(t){return new et.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestString(t)},this.sha256Hex=function(t){return new et.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestHex(t)},this.sha512=function(t){return new et.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestString(t)},this.sha512Hex=function(t){return new et.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestHex(t)}},et.crypto.Util.md5=function(t){return new et.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},et.crypto.Util.ripemd160=function(t){return new et.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},et.crypto.Util.SECURERANDOMGEN=new W,et.crypto.Util.getRandomHexOfNbytes=function(t){var e=new Array(t);return et.crypto.Util.SECURERANDOMGEN.nextBytes(e),at(e)},et.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new d(et.crypto.Util.getRandomHexOfNbytes(t),16)},et.crypto.Util.getRandomHexOfNbits=function(t){var e=t%8,n=new Array((t-e)/8+1);return et.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<e&255^255)&n[0],at(n)},et.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new d(et.crypto.Util.getRandomHexOfNbits(t),16)},et.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var e=t.bitLength();;){var n=et.crypto.Util.getRandomBigIntegerOfNbits(e);if(-1!=t.compareTo(n))return n}},et.crypto.Util.getRandomBigIntegerMinToMax=function(t,e){var n=t.compareTo(e);if(1==n)throw"biMin is greater than biMax";if(0==n)return t;var r=e.subtract(t);return et.crypto.Util.getRandomBigIntegerZeroToMax(r).add(t)},et.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(t,e){if(null!==(t=et.crypto.MessageDigest.getCanonicalAlgName(t))&&void 0===e&&(e=et.crypto.Util.DEFAULTPROVIDER[t]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(t)&&"cryptojs"==e){try{this.md=et.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[t].create()}catch(e){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+e}this.updateString=function(t){this.md.update(t)},this.updateHex=function(t){var e=s.enc.Hex.parse(t);this.md.update(e)},this.digest=function(){return this.md.finalize().toString(s.enc.Hex)},this.digestString=function(t){return this.updateString(t),this.digest()},this.digestHex=function(t){return this.updateHex(t),this.digest()}}if(-1!=":sha256:".indexOf(t)&&"sjcl"==e){try{this.md=new sjcl.hash.sha256}catch(e){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+e}this.updateString=function(t){this.md.update(t)},this.updateHex=function(t){var e=sjcl.codec.hex.toBits(t);this.md.update(e)},this.digest=function(){var t=this.md.finalize();return sjcl.codec.hex.fromBits(t)},this.digestString=function(t){return this.updateString(t),this.digest()},this.digestHex=function(t){return this.updateHex(t),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==t&&void 0!==t.alg&&(this.algName=t.alg,void 0===t.prov&&(this.provName=et.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},et.crypto.MessageDigest.getCanonicalAlgName=function(t){return"string"==typeof t&&(t=(t=t.toLowerCase()).replace(/-/,"")),t},et.crypto.MessageDigest.getHashLength=function(t){var e=et.crypto.MessageDigest,n=e.getCanonicalAlgName(t);if(void 0===e.HASHLENGTH[n])throw"not supported algorithm: "+t;return e.HASHLENGTH[n]},et.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},et.crypto.Mac=function(t){this.setAlgAndProvider=function(t,e){if(null==(t=t.toLowerCase())&&(t="hmacsha1"),"hmac"!=(t=t.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+t;void 0===e&&(e=et.crypto.Util.DEFAULTPROVIDER[t]),this.algProv=t+"/"+e;var n=t.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)&&"cryptojs"==e){try{var r=et.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=s.algo.HMAC.create(r,this.pass)}catch(t){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+t}this.updateString=function(t){this.mac.update(t)},this.updateHex=function(t){var e=s.enc.Hex.parse(t);this.mac.update(e)},this.doFinal=function(){return this.mac.finalize().toString(s.enc.Hex)},this.doFinalString=function(t){return this.updateString(t),this.doFinal()},this.doFinalHex=function(t){return this.updateHex(t),this.doFinal()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(t){if("string"==typeof t){var e=t;return t.length%2!=1&&t.match(/^[0-9A-Fa-f]+$/)||(e=yt(t)),void(this.pass=s.enc.Hex.parse(e))}if("object"!=typeof t)throw"KJUR.crypto.Mac unsupported password type: "+t;e=null;if(void 0!==t.hex){if(t.hex.length%2!=0||!t.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+t.hex;e=t.hex}if(void 0!==t.utf8&&(e=ft(t.utf8)),void 0!==t.rstr&&(e=yt(t.rstr)),void 0!==t.b64&&(e=l(t.b64)),void 0!==t.b64u&&(e=dt(t.b64u)),null==e)throw"KJUR.crypto.Mac unsupported password type: "+t;this.pass=s.enc.Hex.parse(e)},void 0!==t&&(void 0!==t.pass&&this.setPassword(t.pass),void 0!==t.alg&&(this.algName=t.alg,void 0===t.prov&&(this.provName=et.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},et.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){var t=this.algName.match(/^(.+)with(.+)$/);t&&(this.mdAlgName=t[1].toLowerCase(),this.pubkeyAlgName=t[2].toLowerCase())},this._zeroPaddingOfSignature=function(t,e){for(var n="",r=e/4-t.length,i=0;i<r;i++)n+="0";return n+t},this.setAlgAndProvider=function(t,e){if(this._setAlgNames(),"cryptojs/jsrsa"!=e)throw"provider not supported: "+e;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new et.crypto.MessageDigest({alg:this.mdAlgName})}catch(t){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+t}this.init=function(t,e){var n=null;try{n=void 0===e?It.getKey(t):It.getKey(t,e)}catch(t){throw"init failed:"+t}if(!0===n.isPrivate)this.prvKey=n,this.state="SIGN";else{if(!0!==n.isPublic)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.updateString=function(t){this.md.updateString(t)},this.updateHex=function(t){this.md.updateHex(t)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0!==this.ecprvhex&&void 0!==this.eccurvename){var t=new et.crypto.ECDSA({curve:this.eccurvename});this.hSign=t.signHex(this.sHashHex,this.ecprvhex)}else if(this.prvKey instanceof Q&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Q&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof et.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof et.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(t){return this.updateString(t),this.sign()},this.signHex=function(t){return this.updateHex(t),this.sign()},this.verify=function(t){if(this.sHashHex=this.md.digest(),void 0!==this.ecpubhex&&void 0!==this.eccurvename)return new et.crypto.ECDSA({curve:this.eccurvename}).verifyHex(this.sHashHex,t,this.ecpubhex);if(this.pubKey instanceof Q&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,t,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Q&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);if(void 0!==et.crypto.ECDSA&&this.pubKey instanceof et.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);if(void 0!==et.crypto.DSA&&this.pubKey instanceof et.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(t,e){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(t){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(t){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(t){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(t){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,void 0!==t&&(void 0!==t.alg&&(this.algName=t.alg,void 0===t.prov?this.provName=et.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==t.psssaltlen&&(this.pssSaltLen=t.psssaltlen),void 0!==t.prvkeypem)){if(void 0!==t.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{e=It.getKey(t.prvkeypem);this.init(e)}catch(t){throw"fatal error to load pem private key: "+t}}},et.crypto.Cipher=function(t){},et.crypto.Cipher.encrypt=function(t,e,n){if(e instanceof Q&&e.isPublic){var r=et.crypto.Cipher.getAlgByKeyAndName(e,n);if("RSA"===r)return e.encrypt(t);if("RSAOAEP"===r)return e.encryptOAEP(t,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return e.encryptOAEP(t,"sha"+i[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.encrypt: unsupported key or algorithm"},et.crypto.Cipher.decrypt=function(t,e,n){if(e instanceof Q&&e.isPrivate){var r=et.crypto.Cipher.getAlgByKeyAndName(e,n);if("RSA"===r)return e.decrypt(t);if("RSAOAEP"===r)return e.decryptOAEP(t,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return e.decryptOAEP(t,"sha"+i[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.decrypt: unsupported key or algorithm"},et.crypto.Cipher.getAlgByKeyAndName=function(t,e){if(t instanceof Q){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(e))return e;if(null===e||void 0===e)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+e}throw"getAlgByKeyAndName: not supported algorithm name: "+e},et.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==et&&et||(et={}),void 0!==et.crypto&&et.crypto||(et.crypto={}),et.crypto.ECDSA=function(t){var e=new W;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(t){return new d(t.bitLength(),e).mod(t.subtract(d.ONE)).add(d.ONE)},this.setNamedCurve=function(t){this.ecparams=et.crypto.ECParameterDB.getByName(t),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=t},this.setPrivateKeyHex=function(t){this.isPrivate=!0,this.prvKeyHex=t},this.setPublicKeyHex=function(t){this.isPublic=!0,this.pubKeyHex=t},this.getPublicKeyXYHex=function(){var t=this.pubKeyHex;if("04"!==t.substr(0,2))throw"this method supports uncompressed format(04) only";var e=this.ecparams.keylen/4;if(t.length!==2+2*e)throw"malformed public key hex length";var n={};return n.x=t.substr(2,e),n.y=t.substr(2+e),n},this.getShortNISTPCurveName=function(){var t=this.curveName;return"secp256r1"===t||"NIST P-256"===t||"P-256"===t||"prime256v1"===t?"P-256":"secp384r1"===t||"NIST P-384"===t||"P-384"===t?"P-384":null},this.generateKeyPairHex=function(){var t=this.ecparams.n,e=this.getBigRandom(t),n=this.ecparams.G.multiply(e),r=n.getX().toBigInteger(),i=n.getY().toBigInteger(),s=this.ecparams.keylen/4,o=("0000000000"+e.toString(16)).slice(-s),a="04"+("0000000000"+r.toString(16)).slice(-s)+("0000000000"+i.toString(16)).slice(-s);return this.setPrivateKeyHex(o),this.setPublicKeyHex(a),{ecprvhex:o,ecpubhex:a}},this.signWithMessageHash=function(t){return this.signHex(t,this.prvKeyHex)},this.signHex=function(t,e){var n=new d(e,16),r=this.ecparams.n,i=new d(t,16);do{var s=this.getBigRandom(r),o=this.ecparams.G.multiply(s).getX().toBigInteger().mod(r)}while(o.compareTo(d.ZERO)<=0);var a=s.modInverse(r).multiply(i.add(n.multiply(o))).mod(r);return et.crypto.ECDSA.biRSSigToASN1Sig(o,a)},this.sign=function(t,e){var n=e,r=this.ecparams.n,i=d.fromByteArrayUnsigned(t);do{var s=this.getBigRandom(r),o=this.ecparams.G.multiply(s).getX().toBigInteger().mod(r)}while(o.compareTo(d.ZERO)<=0);var a=s.modInverse(r).multiply(i.add(n.multiply(o))).mod(r);return this.serializeSig(o,a)},this.verifyWithMessageHash=function(t,e){return this.verifyHex(t,e,this.pubKeyHex)},this.verifyHex=function(t,e,n){var r,i,s,o=et.crypto.ECDSA.parseSigHex(e);r=o.r,i=o.s,s=X.decodeFromHex(this.ecparams.curve,n);var a=new d(t,16);return this.verifyRaw(a,r,i,s)},this.verify=function(t,e,n){var r,i,s;if(Bitcoin.Util.isArray(e)){var o=this.parseSig(e);r=o.r,i=o.s}else{if("object"!=typeof e||!e.r||!e.s)throw"Invalid value for signature";r=e.r,i=e.s}if(n instanceof X)s=n;else{if(!Bitcoin.Util.isArray(n))throw"Invalid format for pubkey value, must be byte array or ECPointFp";s=X.decodeFrom(this.ecparams.curve,n)}var a=d.fromByteArrayUnsigned(t);return this.verifyRaw(a,r,i,s)},this.verifyRaw=function(t,e,n,r){var i=this.ecparams.n,s=this.ecparams.G;if(e.compareTo(d.ONE)<0||e.compareTo(i)>=0)return!1;if(n.compareTo(d.ONE)<0||n.compareTo(i)>=0)return!1;var o=n.modInverse(i),a=t.multiply(o).mod(i),c=e.multiply(o).mod(i);return s.multiply(a).add(r.multiply(c)).getX().toBigInteger().mod(i).equals(e)},this.serializeSig=function(t,e){var n=t.toByteArraySigned(),r=e.toByteArraySigned(),i=[];return i.push(2),i.push(n.length),(i=i.concat(n)).push(2),i.push(r.length),(i=i.concat(r)).unshift(i.length),i.unshift(48),i},this.parseSig=function(t){var e;if(48!=t[0])throw new Error("Signature not a valid DERSequence");if(2!=t[e=2])throw new Error("First element in signature must be a DERInteger");var n=t.slice(e+2,e+2+t[e+1]);if(2!=t[e+=2+t[e+1]])throw new Error("Second element in signature must be a DERInteger");var r=t.slice(e+2,e+2+t[e+1]);return e+=2+t[e+1],{r:d.fromByteArrayUnsigned(n),s:d.fromByteArrayUnsigned(r)}},this.parseSigCompact=function(t){if(65!==t.length)throw"Signature has the wrong length";var e=t[0]-27;if(e<0||e>7)throw"Invalid signature type";var n=this.ecparams.n;return{r:d.fromByteArrayUnsigned(t.slice(1,33)).mod(n),s:d.fromByteArrayUnsigned(t.slice(33,65)).mod(n),i:e}},this.readPKCS5PrvKeyHex=function(t){var e,n,r,i=it,s=et.crypto.ECDSA.getName,o=i.getVbyList;if(!1===i.isASN1HEX(t))throw"not ASN.1 hex string";try{e=o(t,0,[2,0],"06"),n=o(t,0,[1],"04");try{r=o(t,0,[3,0],"03").substr(2)}catch(t){}}catch(t){throw"malformed PKCS#1/5 plain ECC private key"}if(this.curveName=s(e),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(t){var e,n,r,i=it,s=et.crypto.ECDSA.getName,o=i.getVbyList;if(!1===i.isASN1HEX(t))throw"not ASN.1 hex string";try{o(t,0,[1,0],"06"),e=o(t,0,[1,1],"06"),n=o(t,0,[2,0,1],"04");try{r=o(t,0,[2,0,2,0],"03").substr(2)}catch(t){}}catch(t){throw"malformed PKCS#8 plain ECC private key"}if(this.curveName=s(e),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PubKeyHex=function(t){var e,n,r=it,i=et.crypto.ECDSA.getName,s=r.getVbyList;if(!1===r.isASN1HEX(t))throw"not ASN.1 hex string";try{s(t,0,[0,0],"06"),e=s(t,0,[0,1],"06"),n=s(t,0,[1],"03").substr(2)}catch(t){throw"malformed PKCS#8 ECC public key"}if(this.curveName=i(e),null===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(n)},this.readCertPubKeyHex=function(t,e){5!==e&&(e=6);var n,r,i=it,s=et.crypto.ECDSA.getName,o=i.getVbyList;if(!1===i.isASN1HEX(t))throw"not ASN.1 hex string";try{n=o(t,0,[0,e,0,1],"06"),r=o(t,0,[0,e,1],"03").substr(2)}catch(t){throw"malformed X.509 certificate ECC public key"}if(this.curveName=s(n),null===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r)},void 0!==t&&void 0!==t.curve&&(this.curveName=t.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==t&&(void 0!==t.prv&&this.setPrivateKeyHex(t.prv),void 0!==t.pub&&this.setPublicKeyHex(t.pub))},et.crypto.ECDSA.parseSigHex=function(t){var e=et.crypto.ECDSA.parseSigHexInHexRS(t);return{r:new d(e.r,16),s:new d(e.s,16)}},et.crypto.ECDSA.parseSigHexInHexRS=function(t){var e=it,n=e.getChildIdx,r=e.getV;if("30"!=t.substr(0,2))throw"signature is not a ASN.1 sequence";var i=n(t,0);if(2!=i.length)throw"number of signature ASN.1 sequence elements seem wrong";var s=i[0],o=i[1];if("02"!=t.substr(s,2))throw"1st item of sequene of signature is not ASN.1 integer";if("02"!=t.substr(o,2))throw"2nd item of sequene of signature is not ASN.1 integer";return{r:r(t,s),s:r(t,o)}},et.crypto.ECDSA.asn1SigToConcatSig=function(t){var e=et.crypto.ECDSA.parseSigHexInHexRS(t),n=e.r,r=e.s;if("00"==n.substr(0,2)&&n.length%32==2&&(n=n.substr(2)),"00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),n.length%32==30&&(n="00"+n),r.length%32==30&&(r="00"+r),n.length%32!=0)throw"unknown ECDSA sig r length error";if(r.length%32!=0)throw"unknown ECDSA sig s length error";return n+r},et.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var e=t.substr(0,t.length/2),n=t.substr(t.length/2);return et.crypto.ECDSA.hexRSSigToASN1Sig(e,n)},et.crypto.ECDSA.hexRSSigToASN1Sig=function(t,e){var n=new d(t,16),r=new d(e,16);return et.crypto.ECDSA.biRSSigToASN1Sig(n,r)},et.crypto.ECDSA.biRSSigToASN1Sig=function(t,e){var n=et.asn1,r=new n.DERInteger({bigint:t}),i=new n.DERInteger({bigint:e});return new n.DERSequence({array:[r,i]}).getEncodedHex()},et.crypto.ECDSA.getName=function(t){return"2a8648ce3d030107"===t?"secp256r1":"2b8104000a"===t?"secp256k1":"2b81040022"===t?"secp384r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)?"secp256r1":-1!=="|secp256k1|".indexOf(t)?"secp256k1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(t)?"secp384r1":null},void 0!==et&&et||(et={}),void 0!==et.crypto&&et.crypto||(et.crypto={}),et.crypto.ECParameterDB=new function(){var t={},e={};function n(t){return new d(t,16)}this.getByName=function(n){var r=n;if(void 0!==e[r]&&(r=e[n]),void 0!==t[r])return t[r];throw"unregistered EC curve name: "+r},this.regist=function(r,i,s,o,a,c,u,l,h,d,f,p){t[r]={};var g=n(s),y=n(o),v=n(a),m=n(c),_=n(u),b=new Z(g,y,v),w=b.decodePointHex("04"+l+h);t[r].name=r,t[r].keylen=i,t[r].curve=b,t[r].G=w,t[r].n=m,t[r].h=_,t[r].oid=f,t[r].info=p;for(var S=0;S<d.length;S++)e[d[S]]=r}},et.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),et.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),et.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),et.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),et.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),et.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),et.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),et.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),et.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),et.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),void 0!==et&&et||(et={}),void 0!==et.crypto&&et.crypto||(et.crypto={}),et.crypto.DSA=function(){this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(t,e,n,r,i){this.isPrivate=!0,this.p=t,this.q=e,this.g=n,this.y=r,this.x=i},this.setPrivateHex=function(t,e,n,r,i){var s,o,a,c,u;s=new d(t,16),o=new d(e,16),a=new d(n,16),c="string"==typeof r&&r.length>1?new d(r,16):null,u=new d(i,16),this.setPrivate(s,o,a,c,u)},this.setPublic=function(t,e,n,r){this.isPublic=!0,this.p=t,this.q=e,this.g=n,this.y=r,this.x=null},this.setPublicHex=function(t,e,n,r){var i,s,o,a;i=new d(t,16),s=new d(e,16),o=new d(n,16),a=new d(r,16),this.setPublic(i,s,o,a)},this.signWithMessageHash=function(t){var e=this.p,n=this.q,r=this.g,i=(this.y,this.x),s=et.crypto.Util.getRandomBigIntegerMinToMax(d.ONE.add(d.ONE),n.subtract(d.ONE)),o=new d(t.substr(0,n.bitLength()/4),16),a=r.modPow(s,e).mod(n),c=s.modInverse(n).multiply(o.add(i.multiply(a))).mod(n);return et.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:a}},{int:{bigint:c}}]})},this.verifyWithMessageHash=function(t,e){var n=this.p,r=this.q,i=this.g,s=this.y,o=this.parseASN1Signature(e),a=o[0],c=o[1],u=new d(t.substr(0,r.bitLength()/4),16);if(d.ZERO.compareTo(a)>0||a.compareTo(r)>0)throw"invalid DSA signature";if(d.ZERO.compareTo(c)>=0||c.compareTo(r)>0)throw"invalid DSA signature";var l=c.modInverse(r),h=u.multiply(l).mod(r),f=a.multiply(l).mod(r);return 0==i.modPow(h,n).multiply(s.modPow(f,n)).mod(n).mod(r).compareTo(a)},this.parseASN1Signature=function(t){try{return[new d(it.getVbyList(t,0,[0],"02"),16),new d(it.getVbyList(t,0,[1],"02"),16)]}catch(t){throw"malformed ASN.1 DSA signature"}},this.readPKCS5PrvKeyHex=function(t){var e,n,r,i,s,o=it,a=o.getVbyList;if(!1===o.isASN1HEX(t))throw"not ASN.1 hex string";try{e=a(t,0,[1],"02"),n=a(t,0,[2],"02"),r=a(t,0,[3],"02"),i=a(t,0,[4],"02"),s=a(t,0,[5],"02")}catch(t){throw console.log("EXCEPTION:"+t),"malformed PKCS#1/5 plain DSA private key"}this.setPrivateHex(e,n,r,i,s)},this.readPKCS8PrvKeyHex=function(t){var e,n,r,i,s=it,o=s.getVbyList;if(!1===s.isASN1HEX(t))throw"not ASN.1 hex string";try{e=o(t,0,[1,1,0],"02"),n=o(t,0,[1,1,1],"02"),r=o(t,0,[1,1,2],"02"),i=o(t,0,[2,0],"02")}catch(t){throw console.log("EXCEPTION:"+t),"malformed PKCS#8 plain DSA private key"}this.setPrivateHex(e,n,r,null,i)},this.readPKCS8PubKeyHex=function(t){var e,n,r,i,s=it,o=s.getVbyList;if(!1===s.isASN1HEX(t))throw"not ASN.1 hex string";try{e=o(t,0,[0,1,0],"02"),n=o(t,0,[0,1,1],"02"),r=o(t,0,[0,1,2],"02"),i=o(t,0,[1,0],"02")}catch(t){throw console.log("EXCEPTION:"+t),"malformed PKCS#8 DSA public key"}this.setPublicHex(e,n,r,i)},this.readCertPubKeyHex=function(t,e){var n,r,i,s;5!==e&&(e=6);var o=it,a=o.getVbyList;if(!1===o.isASN1HEX(t))throw"not ASN.1 hex string";try{n=a(t,0,[0,e,0,1,0],"02"),r=a(t,0,[0,e,0,1,1],"02"),i=a(t,0,[0,e,0,1,2],"02"),s=a(t,0,[0,e,1,0],"02")}catch(t){throw console.log("EXCEPTION:"+t),"malformed X.509 certificate DSA public key"}this.setPublicHex(n,r,i,s)}};var It=function(){var t=function(t,n,r){return e(s.AES,t,n,r)},e=function(t,e,n,r){var i=s.enc.Hex.parse(e),o=s.enc.Hex.parse(n),a=s.enc.Hex.parse(r),c={};c.key=o,c.iv=a,c.ciphertext=i;var u=t.decrypt(c,o,{iv:a});return s.enc.Hex.stringify(u)},n=function(t,e,n){return r(s.AES,t,e,n)},r=function(t,e,n,r){var i=s.enc.Hex.parse(e),o=s.enc.Hex.parse(n),a=s.enc.Hex.parse(r),c=t.encrypt(i,o,{iv:a}),u=s.enc.Hex.parse(c.toString());return s.enc.Base64.stringify(u)},i={"AES-256-CBC":{proc:t,eproc:n,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:n,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:n,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(t,n,r){return e(s.TripleDES,t,n,r)},eproc:function(t,e,n){return r(s.TripleDES,t,e,n)},keylen:24,ivlen:8},"DES-CBC":{proc:function(t,n,r){return e(s.DES,t,n,r)},eproc:function(t,e,n){return r(s.DES,t,e,n)},keylen:8,ivlen:8}},o=function(t){var e={},n=t.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));n&&(e.cipher=n[1],e.ivsalt=n[2]);var r=t.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));r&&(e.type=r[1]);var i=-1,s=0;-1!=t.indexOf("\r\n\r\n")&&(i=t.indexOf("\r\n\r\n"),s=2),-1!=t.indexOf("\n\n")&&(i=t.indexOf("\n\n"),s=1);var o=t.indexOf("-----END");if(-1!=i&&-1!=o){var a=t.substring(i+2*s,o-s);a=a.replace(/\s+/g,""),e.data=a}return e},a=function(t,e,n){for(var r=n.substring(0,16),o=s.enc.Hex.parse(r),a=s.enc.Utf8.parse(e),c=i[t].keylen+i[t].ivlen,u="",l=null;;){var h=s.algo.MD5.create();if(null!=l&&h.update(l),h.update(a),h.update(o),l=h.finalize(),(u+=s.enc.Hex.stringify(l)).length>=2*c)break}var d={};return d.keyhex=u.substr(0,2*i[t].keylen),d.ivhex=u.substr(2*i[t].keylen,2*i[t].ivlen),d},c=function(t,e,n,r){var o=s.enc.Base64.parse(t),a=s.enc.Hex.stringify(o);return(0,i[e].proc)(a,n,r)};return{version:"1.0.0",parsePKCS5PEM:function(t){return o(t)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(t,e,n){return a(t,e,n)},decryptKeyB64:function(t,e,n,r){return c(t,e,n,r)},getDecryptedKeyHex:function(t,e){var n=o(t),r=(n.type,n.cipher),i=n.ivsalt,s=n.data,u=a(r,e,i).keyhex;return c(s,r,u,i)},getEncryptedPKCS5PEMFromPrvKeyHex:function(t,e,n,r,o){var c="";if(void 0!==r&&null!=r||(r="AES-256-CBC"),void 0===i[r])throw"KEYUTIL unsupported algorithm: "+r;void 0!==o&&null!=o||(o=function(t){var e=s.lib.WordArray.random(t);return s.enc.Hex.stringify(e)}(i[r].ivlen).toUpperCase());var u=function(t,e,n,r){return(0,i[e].eproc)(t,n,r)}(e,r,a(r,n,o).keyhex,o);c="-----BEGIN "+t+" PRIVATE KEY-----\r\n";return c+="Proc-Type: 4,ENCRYPTED\r\n",c+="DEK-Info: "+r+","+o+"\r\n",c+="\r\n",c+=u.replace(/(.{64})/g,"$1\r\n"),c+="\r\n-----END "+t+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(t){var e=it,n=e.getChildIdx,r=e.getV,i={},s=n(t,0);if(2!=s.length)throw"malformed format: SEQUENCE(0).items != 2: "+s.length;i.ciphertext=r(t,s[1]);var o=n(t,s[0]);if(2!=o.length)throw"malformed format: SEQUENCE(0.0).items != 2: "+o.length;if("2a864886f70d01050d"!=r(t,o[0]))throw"this only supports pkcs5PBES2";var a=n(t,o[1]);if(2!=o.length)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+a.length;var c=n(t,a[1]);if(2!=c.length)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+c.length;if("2a864886f70d0307"!=r(t,c[0]))throw"this only supports TripleDES";i.encryptionSchemeAlg="TripleDES",i.encryptionSchemeIV=r(t,c[1]);var u=n(t,a[0]);if(2!=u.length)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+u.length;if("2a864886f70d01050c"!=r(t,u[0]))throw"this only supports pkcs5PBKDF2";var l=n(t,u[1]);if(l.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+l.length;i.pbkdf2Salt=r(t,l[0]);var h=r(t,l[1]);try{i.pbkdf2Iter=parseInt(h,16)}catch(t){throw"malformed format pbkdf2Iter: "+h}return i},getPBKDF2KeyHexFromParam:function(t,e){var n=s.enc.Hex.parse(t.pbkdf2Salt),r=t.pbkdf2Iter,i=s.PBKDF2(e,n,{keySize:6,iterations:r});return s.enc.Hex.stringify(i)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(t,e){var n=wt(t,"ENCRYPTED PRIVATE KEY"),r=this.parseHexOfEncryptedPKCS8(n),i=It.getPBKDF2KeyHexFromParam(r,e),o={};o.ciphertext=s.enc.Hex.parse(r.ciphertext);var a=s.enc.Hex.parse(i),c=s.enc.Hex.parse(r.encryptionSchemeIV),u=s.TripleDES.decrypt(o,a,{iv:c});return s.enc.Hex.stringify(u)},getKeyFromEncryptedPKCS8PEM:function(t,e){var n=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(t,e);return this.getKeyFromPlainPrivatePKCS8Hex(n)},parsePlainPrivatePKCS8Hex:function(t){var e=it,n=e.getChildIdx,r=e.getV,i={algparam:null};if("30"!=t.substr(0,2))throw"malformed plain PKCS8 private key(code:001)";var s=n(t,0);if(3!=s.length)throw"malformed plain PKCS8 private key(code:002)";if("30"!=t.substr(s[1],2))throw"malformed PKCS8 private key(code:003)";var o=n(t,s[1]);if(2!=o.length)throw"malformed PKCS8 private key(code:004)";if("06"!=t.substr(o[0],2))throw"malformed PKCS8 private key(code:005)";if(i.algoid=r(t,o[0]),"06"==t.substr(o[1],2)&&(i.algparam=r(t,o[1])),"04"!=t.substr(s[2],2))throw"malformed PKCS8 private key(code:006)";return i.keyidx=e.getVidx(t,s[2]),i},getKeyFromPlainPrivatePKCS8PEM:function(t){var e=wt(t,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(e)},getKeyFromPlainPrivatePKCS8Hex:function(t){var e,n=this.parsePlainPrivatePKCS8Hex(t);if("2a864886f70d010101"==n.algoid)e=new Q;else if("2a8648ce380401"==n.algoid)e=new et.crypto.DSA;else{if("2a8648ce3d0201"!=n.algoid)throw"unsupported private key algorithm";e=new et.crypto.ECDSA}return e.readPKCS8PrvKeyHex(t),e},_getKeyFromPublicPKCS8Hex:function(t){var e,n=it.getVbyList(t,0,[0,0],"06");if("2a864886f70d010101"===n)e=new Q;else if("2a8648ce380401"===n)e=new et.crypto.DSA;else{if("2a8648ce3d0201"!==n)throw"unsupported PKCS#8 public key hex";e=new et.crypto.ECDSA}return e.readPKCS8PubKeyHex(t),e},parsePublicRawRSAKeyHex:function(t){var e=it,n=e.getChildIdx,r=e.getV,i={};if("30"!=t.substr(0,2))throw"malformed RSA key(code:001)";var s=n(t,0);if(2!=s.length)throw"malformed RSA key(code:002)";if("02"!=t.substr(s[0],2))throw"malformed RSA key(code:003)";if(i.n=r(t,s[0]),"02"!=t.substr(s[1],2))throw"malformed RSA key(code:004)";return i.e=r(t,s[1]),i},parsePublicPKCS8Hex:function(t){var e=it,n=e.getChildIdx,r=e.getV,i={algparam:null},s=n(t,0);if(2!=s.length)throw"outer DERSequence shall have 2 elements: "+s.length;var o=s[0];if("30"!=t.substr(o,2))throw"malformed PKCS8 public key(code:001)";var a=n(t,o);if(2!=a.length)throw"malformed PKCS8 public key(code:002)";if("06"!=t.substr(a[0],2))throw"malformed PKCS8 public key(code:003)";if(i.algoid=r(t,a[0]),"06"==t.substr(a[1],2)?i.algparam=r(t,a[1]):"30"==t.substr(a[1],2)&&(i.algparam={},i.algparam.p=e.getVbyList(t,a[1],[0],"02"),i.algparam.q=e.getVbyList(t,a[1],[1],"02"),i.algparam.g=e.getVbyList(t,a[1],[2],"02")),"03"!=t.substr(s[1],2))throw"malformed PKCS8 public key(code:004)";return i.key=r(t,s[1]).substr(2),i}}}();It.getKey=function(t,e,n){var r=(v=it).getChildIdx,i=(v.getV,v.getVbyList),s=et.crypto,o=s.ECDSA,a=s.DSA,c=Q,u=wt,l=It;if(void 0!==c&&t instanceof c)return t;if(void 0!==o&&t instanceof o)return t;if(void 0!==a&&t instanceof a)return t;if(void 0!==t.curve&&void 0!==t.xy&&void 0===t.d)return new o({pub:t.xy,curve:t.curve});if(void 0!==t.curve&&void 0!==t.d)return new o({prv:t.d,curve:t.curve});if(void 0===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0===t.d)return(k=new c).setPublic(t.n,t.e),k;if(void 0===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0!==t.d&&void 0!==t.p&&void 0!==t.q&&void 0!==t.dp&&void 0!==t.dq&&void 0!==t.co&&void 0===t.qi)return(k=new c).setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),k;if(void 0===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0!==t.d&&void 0===t.p)return(k=new c).setPrivate(t.n,t.e,t.d),k;if(void 0!==t.p&&void 0!==t.q&&void 0!==t.g&&void 0!==t.y&&void 0===t.x)return(k=new a).setPublic(t.p,t.q,t.g,t.y),k;if(void 0!==t.p&&void 0!==t.q&&void 0!==t.g&&void 0!==t.y&&void 0!==t.x)return(k=new a).setPrivate(t.p,t.q,t.g,t.y,t.x),k;if("RSA"===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0===t.d)return(k=new c).setPublic(dt(t.n),dt(t.e)),k;if("RSA"===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0!==t.d&&void 0!==t.p&&void 0!==t.q&&void 0!==t.dp&&void 0!==t.dq&&void 0!==t.qi)return(k=new c).setPrivateEx(dt(t.n),dt(t.e),dt(t.d),dt(t.p),dt(t.q),dt(t.dp),dt(t.dq),dt(t.qi)),k;if("RSA"===t.kty&&void 0!==t.n&&void 0!==t.e&&void 0!==t.d)return(k=new c).setPrivate(dt(t.n),dt(t.e),dt(t.d)),k;if("EC"===t.kty&&void 0!==t.crv&&void 0!==t.x&&void 0!==t.y&&void 0===t.d){var h=(A=new o({curve:t.crv})).ecparams.keylen/4,f="04"+("0000000000"+dt(t.x)).slice(-h)+("0000000000"+dt(t.y)).slice(-h);return A.setPublicKeyHex(f),A}if("EC"===t.kty&&void 0!==t.crv&&void 0!==t.x&&void 0!==t.y&&void 0!==t.d){h=(A=new o({curve:t.crv})).ecparams.keylen/4,f="04"+("0000000000"+dt(t.x)).slice(-h)+("0000000000"+dt(t.y)).slice(-h);var p=("0000000000"+dt(t.d)).slice(-h);return A.setPublicKeyHex(f),A.setPrivateKeyHex(p),A}if("pkcs5prv"===n){var g,y=t,v=it;if(9===(g=r(y,0)).length)(k=new c).readPKCS5PrvKeyHex(y);else if(6===g.length)(k=new a).readPKCS5PrvKeyHex(y);else{if(!(g.length>2&&"04"===y.substr(g[1],2)))throw"unsupported PKCS#1/5 hexadecimal key";(k=new o).readPKCS5PrvKeyHex(y)}return k}if("pkcs8prv"===n)return k=l.getKeyFromPlainPrivatePKCS8Hex(t);if("pkcs8pub"===n)return l._getKeyFromPublicPKCS8Hex(t);if("x509pub"===n)return Mt.getPublicKeyFromCertHex(t);if(-1!=t.indexOf("-END CERTIFICATE-",0)||-1!=t.indexOf("-END X509 CERTIFICATE-",0)||-1!=t.indexOf("-END TRUSTED CERTIFICATE-",0))return Mt.getPublicKeyFromCertPEM(t);if(-1!=t.indexOf("-END PUBLIC KEY-")){var m=wt(t,"PUBLIC KEY");return l._getKeyFromPublicPKCS8Hex(m)}if(-1!=t.indexOf("-END RSA PRIVATE KEY-")&&-1==t.indexOf("4,ENCRYPTED")){var _=u(t,"RSA PRIVATE KEY");return l.getKey(_,null,"pkcs5prv")}if(-1!=t.indexOf("-END DSA PRIVATE KEY-")&&-1==t.indexOf("4,ENCRYPTED")){var b=i(R=u(t,"DSA PRIVATE KEY"),0,[1],"02"),w=i(R,0,[2],"02"),S=i(R,0,[3],"02"),C=i(R,0,[4],"02"),E=i(R,0,[5],"02");return(k=new a).setPrivate(new d(b,16),new d(w,16),new d(S,16),new d(C,16),new d(E,16)),k}if(-1!=t.indexOf("-END PRIVATE KEY-"))return l.getKeyFromPlainPrivatePKCS8PEM(t);if(-1!=t.indexOf("-END RSA PRIVATE KEY-")&&-1!=t.indexOf("4,ENCRYPTED")){var x=l.getDecryptedKeyHex(t,e),T=new Q;return T.readPKCS5PrvKeyHex(x),T}if(-1!=t.indexOf("-END EC PRIVATE KEY-")&&-1!=t.indexOf("4,ENCRYPTED")){var A,k=i(R=l.getDecryptedKeyHex(t,e),0,[1],"04"),O=i(R,0,[2,0],"06"),P=i(R,0,[3,0],"03").substr(2);if(void 0===et.crypto.OID.oidhex2name[O])throw"undefined OID(hex) in KJUR.crypto.OID: "+O;return(A=new o({curve:et.crypto.OID.oidhex2name[O]})).setPublicKeyHex(P),A.setPrivateKeyHex(k),A.isPublic=!1,A}if(-1!=t.indexOf("-END DSA PRIVATE KEY-")&&-1!=t.indexOf("4,ENCRYPTED")){var R;b=i(R=l.getDecryptedKeyHex(t,e),0,[1],"02"),w=i(R,0,[2],"02"),S=i(R,0,[3],"02"),C=i(R,0,[4],"02"),E=i(R,0,[5],"02");return(k=new a).setPrivate(new d(b,16),new d(w,16),new d(S,16),new d(C,16),new d(E,16)),k}if(-1!=t.indexOf("-END ENCRYPTED PRIVATE KEY-"))return l.getKeyFromEncryptedPKCS8PEM(t,e);throw"not supported argument"},It.generateKeypair=function(t,e){if("RSA"==t){var n=e;(o=new Q).generate(n,"10001"),o.isPrivate=!0,o.isPublic=!0;var r=new Q,i=o.n.toString(16),s=o.e.toString(16);return r.setPublic(i,s),r.isPrivate=!1,r.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=r,a}if("EC"==t){var o,a,c=e,u=new et.crypto.ECDSA({curve:c}).generateKeyPairHex();return(o=new et.crypto.ECDSA({curve:c})).setPublicKeyHex(u.ecpubhex),o.setPrivateKeyHex(u.ecprvhex),o.isPrivate=!0,o.isPublic=!1,(r=new et.crypto.ECDSA({curve:c})).setPublicKeyHex(u.ecpubhex),r.isPrivate=!1,r.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=r,a}throw"unknown algorithm: "+t},It.getPEM=function(t,e,n,r,i,o){var a=et,c=a.asn1,u=c.DERObjectIdentifier,l=c.DERInteger,h=c.ASN1Util.newObject,d=c.x509.SubjectPublicKeyInfo,f=a.crypto,p=f.DSA,g=f.ECDSA,y=Q;function v(t){return h({seq:[{int:0},{int:{bigint:t.n}},{int:t.e},{int:{bigint:t.d}},{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.dmp1}},{int:{bigint:t.dmq1}},{int:{bigint:t.coeff}}]})}function m(t){return h({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a0",!0,{oid:{name:t.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]})}function _(t){return h({seq:[{int:0},{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}},{int:{bigint:t.y}},{int:{bigint:t.x}}]})}if((void 0!==y&&t instanceof y||void 0!==p&&t instanceof p||void 0!==g&&t instanceof g)&&1==t.isPublic&&(void 0===e||"PKCS8PUB"==e))return bt(C=new d(t).getEncodedHex(),"PUBLIC KEY");if("PKCS1PRV"==e&&void 0!==y&&t instanceof y&&(void 0===n||null==n)&&1==t.isPrivate)return bt(C=v(t).getEncodedHex(),"RSA PRIVATE KEY");if("PKCS1PRV"==e&&void 0!==g&&t instanceof g&&(void 0===n||null==n)&&1==t.isPrivate){var b=new u({name:t.curveName}).getEncodedHex(),w=m(t).getEncodedHex(),S="";return S+=bt(b,"EC PARAMETERS"),S+=bt(w,"EC PRIVATE KEY")}if("PKCS1PRV"==e&&void 0!==p&&t instanceof p&&(void 0===n||null==n)&&1==t.isPrivate)return bt(C=_(t).getEncodedHex(),"DSA PRIVATE KEY");if("PKCS5PRV"==e&&void 0!==y&&t instanceof y&&void 0!==n&&null!=n&&1==t.isPrivate){var C=v(t).getEncodedHex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",C,n,r,o)}if("PKCS5PRV"==e&&void 0!==g&&t instanceof g&&void 0!==n&&null!=n&&1==t.isPrivate){C=m(t).getEncodedHex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",C,n,r,o)}if("PKCS5PRV"==e&&void 0!==p&&t instanceof p&&void 0!==n&&null!=n&&1==t.isPrivate){C=_(t).getEncodedHex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",C,n,r,o)}var E=function(t,e){var n=x(t,e);return new h({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:n.pbkdf2Salt}},{int:n.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:n.encryptionSchemeIV}}]}]}]},{octstr:{hex:n.ciphertext}}]}).getEncodedHex()},x=function(t,e){var n=s.lib.WordArray.random(8),r=s.lib.WordArray.random(8),i=s.PBKDF2(e,n,{keySize:6,iterations:100}),o=s.enc.Hex.parse(t),a=s.TripleDES.encrypt(o,i,{iv:r})+"",c={};return c.ciphertext=a,c.pbkdf2Salt=s.enc.Hex.stringify(n),c.pbkdf2Iter=100,c.encryptionSchemeAlg="DES-EDE3-CBC",c.encryptionSchemeIV=s.enc.Hex.stringify(r),c};if("PKCS8PRV"==e&&void 0!=y&&t instanceof y&&1==t.isPrivate){var T=v(t).getEncodedHex();C=h({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:T}}]}).getEncodedHex();return void 0===n||null==n?bt(C,"PRIVATE KEY"):bt(w=E(C,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==e&&void 0!==g&&t instanceof g&&1==t.isPrivate){T=new h({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]}).getEncodedHex(),C=h({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:T}}]}).getEncodedHex();return void 0===n||null==n?bt(C,"PRIVATE KEY"):bt(w=E(C,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==e&&void 0!==p&&t instanceof p&&1==t.isPrivate){T=new l({bigint:t.x}).getEncodedHex(),C=h({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:T}}]}).getEncodedHex();return void 0===n||null==n?bt(C,"PRIVATE KEY"):bt(w=E(C,n),"ENCRYPTED PRIVATE KEY")}throw"unsupported object nor format"},It.getKeyFromCSRPEM=function(t){var e=wt(t,"CERTIFICATE REQUEST");return It.getKeyFromCSRHex(e)},It.getKeyFromCSRHex=function(t){var e=It.parseCSRHex(t);return It.getKey(e.p8pubkeyhex,null,"pkcs8pub")},It.parseCSRHex=function(t){var e=it,n=e.getChildIdx,r=e.getTLV,i={},s=t;if("30"!=s.substr(0,2))throw"malformed CSR(code:001)";var o=n(s,0);if(o.length<1)throw"malformed CSR(code:002)";if("30"!=s.substr(o[0],2))throw"malformed CSR(code:003)";var a=n(s,o[0]);if(a.length<3)throw"malformed CSR(code:004)";return i.p8pubkeyhex=r(s,a[2]),i},It.getJWKFromKey=function(t){var e={};if(t instanceof Q&&t.isPrivate)return e.kty="RSA",e.n=ht(t.n.toString(16)),e.e=ht(t.e.toString(16)),e.d=ht(t.d.toString(16)),e.p=ht(t.p.toString(16)),e.q=ht(t.q.toString(16)),e.dp=ht(t.dmp1.toString(16)),e.dq=ht(t.dmq1.toString(16)),e.qi=ht(t.coeff.toString(16)),e;if(t instanceof Q&&t.isPublic)return e.kty="RSA",e.n=ht(t.n.toString(16)),e.e=ht(t.e.toString(16)),e;if(t instanceof et.crypto.ECDSA&&t.isPrivate){if("P-256"!==(r=t.getShortNISTPCurveName())&&"P-384"!==r)throw"unsupported curve name for JWT: "+r;var n=t.getPublicKeyXYHex();return e.kty="EC",e.crv=r,e.x=ht(n.x),e.y=ht(n.y),e.d=ht(t.prvKeyHex),e}if(t instanceof et.crypto.ECDSA&&t.isPublic){var r;if("P-256"!==(r=t.getShortNISTPCurveName())&&"P-384"!==r)throw"unsupported curve name for JWT: "+r;n=t.getPublicKeyXYHex();return e.kty="EC",e.crv=r,e.x=ht(n.x),e.y=ht(n.y),e}throw"not supported key object"},Q.getPosArrayOfChildrenFromHex=function(t){return it.getChildIdx(t,0)},Q.getHexValueArrayOfChildrenFromHex=function(t){var e,n=it.getV,r=n(t,(e=Q.getPosArrayOfChildrenFromHex(t))[0]),i=n(t,e[1]),s=n(t,e[2]),o=n(t,e[3]),a=n(t,e[4]),c=n(t,e[5]),u=n(t,e[6]),l=n(t,e[7]),h=n(t,e[8]);return(e=new Array).push(r,i,s,o,a,c,u,l,h),e},Q.prototype.readPrivateKeyFromPEMString=function(t){var e=wt(t),n=Q.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},Q.prototype.readPKCS5PrvKeyHex=function(t){var e=Q.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Q.prototype.readPKCS8PrvKeyHex=function(t){var e,n,r,i,s,o,a,c,u=it,l=u.getVbyList;if(!1===u.isASN1HEX(t))throw"not ASN.1 hex string";try{e=l(t,0,[2,0,1],"02"),n=l(t,0,[2,0,2],"02"),r=l(t,0,[2,0,3],"02"),i=l(t,0,[2,0,4],"02"),s=l(t,0,[2,0,5],"02"),o=l(t,0,[2,0,6],"02"),a=l(t,0,[2,0,7],"02"),c=l(t,0,[2,0,8],"02")}catch(t){throw"malformed PKCS#8 plain RSA private key"}this.setPrivateEx(e,n,r,i,s,o,a,c)},Q.prototype.readPKCS5PubKeyHex=function(t){var e=it,n=e.getV;if(!1===e.isASN1HEX(t))throw"keyHex is not ASN.1 hex string";var r=e.getChildIdx(t,0);if(2!==r.length||"02"!==t.substr(r[0],2)||"02"!==t.substr(r[1],2))throw"wrong hex for PKCS#5 public key";var i=n(t,r[0]),s=n(t,r[1]);this.setPublic(i,s)},Q.prototype.readPKCS8PubKeyHex=function(t){var e=it;if(!1===e.isASN1HEX(t))throw"not ASN.1 hex string";if("06092a864886f70d010101"!==e.getTLVbyList(t,0,[0,0]))throw"not PKCS8 RSA public key";var n=e.getTLVbyList(t,0,[1,0]);this.readPKCS5PubKeyHex(n)},Q.prototype.readCertPubKeyHex=function(t,e){var n,r;(n=new Mt).readCertHex(t),r=n.getPublicKeyHex(),this.readPKCS8PubKeyHex(r)};var Ft=new RegExp("");function Dt(t,e){for(var n="",r=e/4-t.length,i=0;i<r;i++)n+="0";return n+t}function Nt(t,e,n){for(var r="",i=0;r.length<e;)r+=gt(n(yt(t+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return r}function jt(t){for(var e in et.crypto.Util.DIGESTINFOHEAD){var n=et.crypto.Util.DIGESTINFOHEAD[e],r=n.length;if(t.substring(0,r)==n)return[e,t.substring(r)]}return[]}function Mt(){var t=it,e=t.getChildIdx,n=t.getV,r=t.getTLV,i=t.getVbyList,s=t.getTLVbyList,o=t.getIdxbyList,a=t.getVidx,c=t.oidname,u=Mt,l=wt;this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){return null===this.hex||0!==this.version?this.version:"a003020102"!==s(this.hex,0,[0,0])?(this.version=1,this.foffset=-1,1):(this.version=3,3)},this.getSerialNumberHex=function(){return i(this.hex,0,[0,1+this.foffset],"02")},this.getSignatureAlgorithmField=function(){return c(i(this.hex,0,[0,2+this.foffset,0],"06"))},this.getIssuerHex=function(){return s(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return u.hex2dn(this.getIssuerHex())},this.getSubjectHex=function(){return s(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return u.hex2dn(this.getSubjectHex())},this.getNotBefore=function(){var t=i(this.hex,0,[0,4+this.foffset,0]);return t=t.replace(/(..)/g,"%$1"),t=decodeURIComponent(t)},this.getNotAfter=function(){var t=i(this.hex,0,[0,4+this.foffset,1]);return t=t.replace(/(..)/g,"%$1"),t=decodeURIComponent(t)},this.getPublicKeyHex=function(){return t.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return o(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var t=this.getPublicKeyIdx();return o(this.hex,t,[1,0],"30")},this.getPublicKey=function(){return It.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){return c(i(this.hex,0,[1,0],"06"))},this.getSignatureValueHex=function(){return i(this.hex,0,[2],"03",!0)},this.verifySignature=function(t){var e=this.getSignatureAlgorithmName(),n=this.getSignatureValueHex(),r=s(this.hex,0,[0],"30"),i=new et.crypto.Signature({alg:e});return i.init(t),i.updateHex(r),i.verify(n)},this.parseExt=function(){if(3!==this.version)return-1;var n=o(this.hex,0,[0,7,0],"30"),r=e(this.hex,n);this.aExtInfo=new Array;for(var s=0;s<r.length;s++){var c={critical:!1},u=0;3===e(this.hex,r[s]).length&&(c.critical=!0,u=1),c.oid=t.hextooidstr(i(this.hex,r[s],[0],"06"));var l=o(this.hex,r[s],[1+u]);c.vidx=a(this.hex,l),this.aExtInfo.push(c)}},this.getExtInfo=function(t){var e=this.aExtInfo,n=t;if(t.match(/^[0-9.]+$/)||(n=et.asn1.x509.OID.name2oid(t)),""!==n)for(var r=0;r<e.length;r++)if(e[r].oid===n)return e[r]},this.getExtBasicConstraints=function(){var t=this.getExtInfo("basicConstraints");if(void 0===t)return t;var e=n(this.hex,t.vidx);if(""===e)return{};if("0101ff"===e)return{cA:!0};if("0101ff02"===e.substr(0,8)){var r=n(e,6);return{cA:!0,pathLen:parseInt(r,16)}}throw"basicConstraints parse error"},this.getExtKeyUsageBin=function(){var t=this.getExtInfo("keyUsage");if(void 0===t)return"";var e=n(this.hex,t.vidx);if(e.length%2!=0||e.length<=2)throw"malformed key usage value";var r=parseInt(e.substr(0,2)),i=parseInt(e.substr(2),16).toString(2);return i.substr(0,i.length-r)},this.getExtKeyUsageString=function(){for(var t=this.getExtKeyUsageBin(),e=new Array,n=0;n<t.length;n++)"1"==t.substr(n,1)&&e.push(Mt.KEYUSAGE_NAME[n]);return e.join(",")},this.getExtSubjectKeyIdentifier=function(){var t=this.getExtInfo("subjectKeyIdentifier");return void 0===t?t:n(this.hex,t.vidx)},this.getExtAuthorityKeyIdentifier=function(){var t=this.getExtInfo("authorityKeyIdentifier");if(void 0===t)return t;for(var i={},s=r(this.hex,t.vidx),o=e(s,0),a=0;a<o.length;a++)"80"===s.substr(o[a],2)&&(i.kid=n(s,o[a]));return i},this.getExtExtKeyUsageName=function(){var t=this.getExtInfo("extKeyUsage");if(void 0===t)return t;var i=new Array,s=r(this.hex,t.vidx);if(""===s)return i;for(var o=e(s,0),a=0;a<o.length;a++)i.push(c(n(s,o[a])));return i},this.getExtSubjectAltName=function(){for(var t=this.getExtSubjectAltName2(),e=new Array,n=0;n<t.length;n++)"DNS"===t[n][0]&&e.push(t[n][1]);return e},this.getExtSubjectAltName2=function(){var t,i,s,o=this.getExtInfo("subjectAltName");if(void 0===o)return o;for(var a=new Array,c=r(this.hex,o.vidx),u=e(c,0),l=0;l<u.length;l++)s=c.substr(u[l],2),t=n(c,u[l]),"81"===s&&(i=pt(t),a.push(["MAIL",i])),"82"===s&&(i=pt(t),a.push(["DNS",i])),"84"===s&&(i=Mt.hex2dn(t,0),a.push(["DN",i])),"86"===s&&(i=pt(t),a.push(["URI",i])),"87"===s&&(i=kt(t),a.push(["IP",i]));return a},this.getExtCRLDistributionPointsURI=function(){var t=this.getExtInfo("cRLDistributionPoints");if(void 0===t)return t;for(var n=new Array,r=e(this.hex,t.vidx),s=0;s<r.length;s++)try{var o=pt(i(this.hex,r[s],[0,0,0],"86"));n.push(o)}catch(t){}return n},this.getExtAIAInfo=function(){var t=this.getExtInfo("authorityInfoAccess");if(void 0===t)return t;for(var n={ocsp:[],caissuer:[]},r=e(this.hex,t.vidx),s=0;s<r.length;s++){var o=i(this.hex,r[s],[0],"06"),a=i(this.hex,r[s],[1],"86");"2b06010505073001"===o&&n.ocsp.push(pt(a)),"2b06010505073002"===o&&n.caissuer.push(pt(a))}return n},this.getExtCertificatePolicies=function(){var t=this.getExtInfo("certificatePolicies");if(void 0===t)return t;for(var s=r(this.hex,t.vidx),o=[],a=e(s,0),u=0;u<a.length;u++){var l={},h=e(s,a[u]);if(l.id=c(n(s,h[0])),2===h.length)for(var d=e(s,h[1]),f=0;f<d.length;f++){var p=i(s,d[f],[0],"06");"2b06010505070201"===p?l.cps=pt(i(s,d[f],[1])):"2b06010505070202"===p&&(l.unotice=pt(i(s,d[f],[1,0])))}o.push(l)}return o},this.readCertPEM=function(t){this.readCertHex(l(t))},this.readCertHex=function(t){this.hex=t,this.getVersion();try{o(this.hex,0,[0,7],"a3"),this.parseExt()}catch(t){}},this.getInfo=function(){var t,e,n;if(t="Basic Fields\n",t+="  serial number: "+this.getSerialNumberHex()+"\n",t+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",t+="  issuer: "+this.getIssuerString()+"\n",t+="  notBefore: "+this.getNotBefore()+"\n",t+="  notAfter: "+this.getNotAfter()+"\n",t+="  subject: "+this.getSubjectString()+"\n",t+="  subject public key info: \n",t+="    key algorithm: "+(e=this.getPublicKey()).type+"\n","RSA"===e.type&&(t+="    n="+Pt(e.n.toString(16)).substr(0,16)+"...\n",t+="    e="+Pt(e.e.toString(16))+"\n"),void 0!==(n=this.aExtInfo)&&null!==n){t+="X509v3 Extensions:\n";for(var r=0;r<n.length;r++){var i=n[r],s=et.asn1.x509.OID.oid2name(i.oid);""===s&&(s=i.oid);var o="";if(!0===i.critical&&(o="CRITICAL"),t+="  "+s+" "+o+":\n","basicConstraints"===s){var a=this.getExtBasicConstraints();void 0===a.cA?t+="    {}\n":(t+="    cA=true",void 0!==a.pathLen&&(t+=", pathLen="+a.pathLen),t+="\n")}else if("keyUsage"===s)t+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"===s)t+="    "+this.getExtSubjectKeyIdentifier()+"\n";else if("authorityKeyIdentifier"===s){var c=this.getExtAuthorityKeyIdentifier();void 0!==c.kid&&(t+="    kid="+c.kid+"\n")}else{if("extKeyUsage"===s)t+="    "+this.getExtExtKeyUsageName().join(", ")+"\n";else if("subjectAltName"===s)t+="    "+this.getExtSubjectAltName2()+"\n";else if("cRLDistributionPoints"===s)t+="    "+this.getExtCRLDistributionPointsURI()+"\n";else if("authorityInfoAccess"===s){var u=this.getExtAIAInfo();void 0!==u.ocsp&&(t+="    ocsp: "+u.ocsp.join(",")+"\n"),void 0!==u.caissuer&&(t+="    caissuer: "+u.caissuer.join(",")+"\n")}else if("certificatePolicies"===s)for(var l=this.getExtCertificatePolicies(),h=0;h<l.length;h++)void 0!==l[h].id&&(t+="    policy oid: "+l[h].id+"\n"),void 0!==l[h].cps&&(t+="    cps: "+l[h].cps+"\n")}}}return t+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n",t+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"}}Ft.compile("[^0-9a-f]","gi"),Q.prototype.sign=function(t,e){var n=function(t){return et.crypto.Util.hashString(t,e)}(t);return this.signWithMessageHash(n,e)},Q.prototype.signWithMessageHash=function(t,e){var n=z(et.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return Dt(this.doPrivate(n).toString(16),this.n.bitLength())},Q.prototype.signPSS=function(t,e,n){var r=function(t){return et.crypto.Util.hashHex(t,e)}(yt(t));return void 0===n&&(n=-1),this.signWithMessageHashPSS(r,e,n)},Q.prototype.signWithMessageHashPSS=function(t,e,n){var r,i=gt(t),s=i.length,o=this.n.bitLength()-1,a=Math.ceil(o/8),c=function(t){return et.crypto.Util.hashHex(t,e)};if(-1===n||void 0===n)n=s;else if(-2===n)n=a-s-2;else if(n<-2)throw"invalid salt length";if(a<s+n+2)throw"data too long";var u="";n>0&&(u=new Array(n),(new W).nextBytes(u),u=String.fromCharCode.apply(String,u));var l=gt(c(yt("\0\0\0\0\0\0\0\0"+i+u))),h=[];for(r=0;r<a-n-s-2;r+=1)h[r]=0;var f=String.fromCharCode.apply(String,h)+""+u,p=Nt(l,f.length,c),g=[];for(r=0;r<f.length;r+=1)g[r]=f.charCodeAt(r)^p.charCodeAt(r);var y=65280>>8*a-o&255;for(g[0]&=~y,r=0;r<s;r++)g.push(l.charCodeAt(r));return g.push(188),Dt(this.doPrivate(new d(g)).toString(16),this.n.bitLength())},Q.prototype.verify=function(t,e){var n=z(e=(e=e.replace(Ft,"")).replace(/[ \n]+/g,""),16);if(n.bitLength()>this.n.bitLength())return 0;var r=jt(this.doPublic(n).toString(16).replace(/^1f+00/,""));if(0==r.length)return!1;var i=r[0];return r[1]==function(t){return et.crypto.Util.hashString(t,i)}(t)},Q.prototype.verifyWithMessageHash=function(t,e){var n=z(e=(e=e.replace(Ft,"")).replace(/[ \n]+/g,""),16);if(n.bitLength()>this.n.bitLength())return 0;var r=jt(this.doPublic(n).toString(16).replace(/^1f+00/,""));if(0==r.length)return!1;r[0];return r[1]==t},Q.prototype.verifyPSS=function(t,e,n,r){var i=function(t){return et.crypto.Util.hashHex(t,n)}(yt(t));return void 0===r&&(r=-1),this.verifyWithMessageHashPSS(i,e,n,r)},Q.prototype.verifyWithMessageHashPSS=function(t,e,n,r){var i=new d(e,16);if(i.bitLength()>this.n.bitLength())return!1;var s,o=function(t){return et.crypto.Util.hashHex(t,n)},a=gt(t),c=a.length,u=this.n.bitLength()-1,l=Math.ceil(u/8);if(-1===r||void 0===r)r=c;else if(-2===r)r=l-c-2;else if(r<-2)throw"invalid salt length";if(l<c+r+2)throw"data too long";var h=this.doPublic(i).toByteArray();for(s=0;s<h.length;s+=1)h[s]&=255;for(;h.length<l;)h.unshift(0);if(188!==h[l-1])throw"encoded message does not end in 0xbc";var f=(h=String.fromCharCode.apply(String,h)).substr(0,l-c-1),p=h.substr(f.length,c),g=65280>>8*l-u&255;if(0!=(f.charCodeAt(0)&g))throw"bits beyond keysize not zero";var y=Nt(p,f.length,o),v=[];for(s=0;s<f.length;s+=1)v[s]=f.charCodeAt(s)^y.charCodeAt(s);v[0]&=~g;var m=l-c-r-2;for(s=0;s<m;s+=1)if(0!==v[s])throw"leftmost octets not zero";if(1!==v[m])throw"0x01 marker not found";return p===gt(o(yt("\0\0\0\0\0\0\0\0"+a+String.fromCharCode.apply(String,v.slice(-r)))))},Q.SALT_LEN_HLEN=-1,Q.SALT_LEN_MAX=-2,Q.SALT_LEN_RECOVER=-2,Mt.hex2dn=function(t,e){if(void 0===e&&(e=0),"30"!==t.substr(e,2))throw"malformed DN";for(var n=new Array,r=it.getChildIdx(t,e),i=0;i<r.length;i++)n.push(Mt.hex2rdn(t,r[i]));return"/"+(n=n.map(function(t){return t.replace("/","\\/")})).join("/")},Mt.hex2rdn=function(t,e){if(void 0===e&&(e=0),"31"!==t.substr(e,2))throw"malformed RDN";for(var n=new Array,r=it.getChildIdx(t,e),i=0;i<r.length;i++)n.push(Mt.hex2attrTypeValue(t,r[i]));return(n=n.map(function(t){return t.replace("+","\\+")})).join("+")},Mt.hex2attrTypeValue=function(t,e){var n=it,r=n.getV;if(void 0===e&&(e=0),"30"!==t.substr(e,2))throw"malformed attribute type and value";var i=n.getChildIdx(t,e);2!==i.length||t.substr(i[0],2);var s=r(t,i[0]),o=et.asn1.ASN1Util.oidHexToInt(s);return et.asn1.x509.OID.oid2atype(o)+"="+gt(r(t,i[1]))},Mt.getPublicKeyFromCertHex=function(t){var e=new Mt;return e.readCertHex(t),e.getPublicKey()},Mt.getPublicKeyFromCertPEM=function(t){var e=new Mt;return e.readCertPEM(t),e.getPublicKey()},Mt.getPublicKeyInfoPropOfCertPEM=function(t){var e,n,r=it.getVbyList,i={};return i.algparam=null,(e=new Mt).readCertPEM(t),n=e.getPublicKeyHex(),i.keyhex=r(n,0,[1],"03").substr(2),i.algoid=r(n,0,[0,0],"06"),"2a8648ce3d0201"===i.algoid&&(i.algparam=r(n,0,[0,1],"06")),i},Mt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==et&&et||(et={}),void 0!==et.jws&&et.jws||(et.jws={}),et.jws.JWS=function(){var t=et.jws.JWS.isSafeJSONString;this.parseJWS=function(e,n){if(void 0===this.parsedJWS||!n&&void 0===this.parsedJWS.sigvalH){var r=e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==r)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=r[1],s=r[2],o=r[3],a=i+"."+s;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=s,this.parsedJWS.sigvalB64U=o,this.parsedJWS.si=a,!n){var c=dt(o),u=z(c,16);this.parsedJWS.sigvalH=c,this.parsedJWS.sigvalBI=u}var l=rt(i),h=rt(s);if(this.parsedJWS.headS=l,this.parsedJWS.payloadS=h,!t(l,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+l}}},et.jws.JWS.sign=function(t,e,n,r,i){var s,o,a,c=et,u=c.jws.JWS,l=u.readSafeJSONString,h=u.isSafeJSONString,d=c.crypto,f=(d.ECDSA,d.Mac),p=d.Signature,g=JSON;if("string"!=typeof e&&"object"!=typeof e)throw"spHeader must be JSON string or object: "+e;if("object"==typeof e&&(o=e,s=g.stringify(o)),"string"==typeof e){if(!h(s=e))throw"JWS Head is not safe JSON string: "+s;o=l(s)}if(a=n,"object"==typeof n&&(a=g.stringify(n)),""!=t&&null!=t||void 0===o.alg||(t=o.alg),""!=t&&null!=t&&void 0===o.alg&&(o.alg=t,s=g.stringify(o)),t!==o.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+o.alg;var y=null;if(void 0===u.jwsalg2sigalg[t])throw"unsupported alg name: "+t;y=u.jwsalg2sigalg[t];var v=nt(s)+"."+nt(a),m="";if("Hmac"==y.substr(0,4)){if(void 0===r)throw"mac key shall be specified for HS* alg";var _=new f({alg:y,prov:"cryptojs",pass:r});_.updateString(v),m=_.doFinal()}else{var b;if(-1!=y.indexOf("withECDSA"))(b=new p({alg:y})).init(r,i),b.updateString(v),hASN1Sig=b.sign(),m=et.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig);else if("none"!=y)(b=new p({alg:y})).init(r,i),b.updateString(v),m=b.sign()}return v+"."+ht(m)},et.jws.JWS.verify=function(t,e,n){var r,i=et,s=i.jws.JWS,o=s.readSafeJSONString,a=i.crypto,c=a.ECDSA,u=a.Mac,l=a.Signature;r=Q;var h=t.split(".");if(3!==h.length)return!1;var d=h[0]+"."+h[1],f=dt(h[2]),p=o(rt(h[0])),g=null,y=null;if(void 0===p.alg)throw"algorithm not specified in header";if((y=(g=p.alg).substr(0,2),null!=n&&"[object Array]"===Object.prototype.toString.call(n)&&n.length>0)&&-1==(":"+n.join(":")+":").indexOf(":"+g+":"))throw"algorithm '"+g+"' not accepted in the list";if("none"!=g&&null===e)throw"key shall be specified to verify.";if("string"==typeof e&&-1!=e.indexOf("-----BEGIN ")&&(e=It.getKey(e)),!("RS"!=y&&"PS"!=y||e instanceof r))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==y&&!(e instanceof c))throw"key shall be a ECDSA obj for ES* algs";var v=null;if(void 0===s.jwsalg2sigalg[p.alg])throw"unsupported alg name: "+g;if("none"==(v=s.jwsalg2sigalg[g]))throw"not supported";if("Hmac"==v.substr(0,4)){if(void 0===e)throw"hexadecimal key shall be specified for HMAC";var m=new u({alg:v,pass:e});return m.updateString(d),f==m.doFinal()}if(-1!=v.indexOf("withECDSA")){var _,b=null;try{b=c.concatSigToASN1Sig(f)}catch(t){return!1}return(_=new l({alg:v})).init(e),_.updateString(d),_.verify(b)}return(_=new l({alg:v})).init(e),_.updateString(d),_.verify(f)},et.jws.JWS.parse=function(t){var e,n,r,i=t.split("."),s={};if(2!=i.length&&3!=i.length)throw"malformed sJWS: wrong number of '.' splitted elements";return e=i[0],n=i[1],3==i.length&&(r=i[2]),s.headerObj=et.jws.JWS.readSafeJSONString(rt(e)),s.payloadObj=et.jws.JWS.readSafeJSONString(rt(n)),s.headerPP=JSON.stringify(s.headerObj,null,"  "),null==s.payloadObj?s.payloadPP=rt(n):s.payloadPP=JSON.stringify(s.payloadObj,null,"  "),void 0!==r&&(s.sigHex=dt(r)),s},et.jws.JWS.verifyJWT=function(t,e,n){var r=et.jws,i=r.JWS,s=i.readSafeJSONString,o=i.inArray,a=i.includedArray,c=t.split("."),u=c[0],l=c[1],h=(dt(c[2]),s(rt(u))),d=s(rt(l));if(void 0===h.alg)return!1;if(void 0===n.alg)throw"acceptField.alg shall be specified";if(!o(h.alg,n.alg))return!1;if(void 0!==d.iss&&"object"==typeof n.iss&&!o(d.iss,n.iss))return!1;if(void 0!==d.sub&&"object"==typeof n.sub&&!o(d.sub,n.sub))return!1;if(void 0!==d.aud&&"object"==typeof n.aud)if("string"==typeof d.aud){if(!o(d.aud,n.aud))return!1}else if("object"==typeof d.aud&&!a(d.aud,n.aud))return!1;var f=r.IntDate.getNow();return void 0!==n.verifyAt&&"number"==typeof n.verifyAt&&(f=n.verifyAt),void 0!==n.gracePeriod&&"number"==typeof n.gracePeriod||(n.gracePeriod=0),!(void 0!==d.exp&&"number"==typeof d.exp&&d.exp+n.gracePeriod<f)&&(!(void 0!==d.nbf&&"number"==typeof d.nbf&&f<d.nbf-n.gracePeriod)&&(!(void 0!==d.iat&&"number"==typeof d.iat&&f<d.iat-n.gracePeriod)&&((void 0===d.jti||void 0===n.jti||d.jti===n.jti)&&!!i.verify(t,e,n.alg))))},et.jws.JWS.includedArray=function(t,e){var n=et.jws.JWS.inArray;if(null===t)return!1;if("object"!=typeof t)return!1;if("number"!=typeof t.length)return!1;for(var r=0;r<t.length;r++)if(!n(t[r],e))return!1;return!0},et.jws.JWS.inArray=function(t,e){if(null===e)return!1;if("object"!=typeof e)return!1;if("number"!=typeof e.length)return!1;for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1},et.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},et.jws.JWS.isSafeJSONString=function(t,e,n){var r=null;try{return"object"!=typeof(r=tt(t))?0:r.constructor===Array?0:(e&&(e[n]=r),1)}catch(t){return 0}},et.jws.JWS.readSafeJSONString=function(t){var e=null;try{return"object"!=typeof(e=tt(t))?null:e.constructor===Array?null:e}catch(t){return null}},et.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var e=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==e)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]},et.jws.JWS.getJWKthumbprint=function(t){if("RSA"!==t.kty&&"EC"!==t.kty&&"oct"!==t.kty)throw"unsupported algorithm for JWK Thumprint";var e="{";if("RSA"===t.kty){if("string"!=typeof t.n||"string"!=typeof t.e)throw"wrong n and e value for RSA key";e+='"e":"'+t.e+'",',e+='"kty":"'+t.kty+'",',e+='"n":"'+t.n+'"}'}else if("EC"===t.kty){if("string"!=typeof t.crv||"string"!=typeof t.x||"string"!=typeof t.y)throw"wrong crv, x and y value for EC key";e+='"crv":"'+t.crv+'",',e+='"kty":"'+t.kty+'",',e+='"x":"'+t.x+'",',e+='"y":"'+t.y+'"}'}else if("oct"===t.kty){if("string"!=typeof t.k)throw"wrong k value for oct(symmetric) key";e+='"kty":"'+t.kty+'",',e+='"k":"'+t.k+'"}'}var n=yt(e);return ht(et.crypto.Util.hashHex(n,"sha256"))},et.jws.IntDate={},et.jws.IntDate.get=function(t){var e=et.jws.IntDate,n=e.getNow,r=e.getZulu;if("now"==t)return n();if("now + 1hour"==t)return n()+3600;if("now + 1day"==t)return n()+86400;if("now + 1month"==t)return n()+2592e3;if("now + 1year"==t)return n()+31536e3;if(t.match(/Z$/))return r(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},et.jws.IntDate.getZulu=function(t){return Ct(t)},et.jws.IntDate.getNow=function(){return~~(new Date/1e3)},et.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},et.jws.IntDate.intDate2Zulu=function(t){var e=new Date(1e3*t);return("0000"+e.getUTCFullYear()).slice(-4)+("00"+(e.getUTCMonth()+1)).slice(-2)+("00"+e.getUTCDate()).slice(-2)+("00"+e.getUTCHours()).slice(-2)+("00"+e.getUTCMinutes()).slice(-2)+("00"+e.getUTCSeconds()).slice(-2)+"Z"},void 0!==et&&et||(et={}),void 0!==et.jws&&et.jws||(et.jws={}),et.jws.JWSJS=function(){var t=et.jws.JWS,e=t.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(t){this.init();var e=t.split(".");if(3!=e.length)throw"malformed input JWS";this.aHeader.push(e[0]),this.sPayload=e[1],this.aSignature.push(e[2])},this.addSignature=function(t,e,n,r){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var i=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var s=et.jws.JWS.sign(t,e,this.sPayload,n,r).split(".");s[0],s[2];this.aHeader.push(s[0]),this.aSignature.push(s[2])}catch(t){throw this.aHeader.length>i&&this.aHeader.pop(),this.aSignature.length>i&&this.aSignature.pop(),"addSignature failed: "+t}},this.verifyAll=function(t){if(this.aHeader.length!==t.length||this.aSignature.length!==t.length)return!1;for(var e=0;e<t.length;e++){var n=t[e];if(2!==n.length)return!1;if(!1===this.verifyNth(e,n[0],n[1]))return!1}return!0},this.verifyNth=function(e,n,r){if(this.aHeader.length<=e||this.aSignature.length<=e)return!1;var i=this.aHeader[e],s=this.aSignature[e],o=i+"."+this.sPayload+"."+s,a=!1;try{a=t.verify(o,n,r)}catch(t){return!1}return a},this.readJWSJS=function(t){if("string"==typeof t){var n=e(t);if(null==n)throw"argument is not safe JSON object string";this.aHeader=n.headers,this.sPayload=n.payload,this.aSignature=n.signatures}else try{if(!(t.headers.length>0))throw"malformed header";if(this.aHeader=t.headers,"string"!=typeof t.payload)throw"malformed signatures";if(this.sPayload=t.payload,!(t.signatures.length>0))throw"malformed signatures";this.aSignatures=t.signatures}catch(t){throw"malformed JWS-JS JSON object: "+t}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},e.SecureRandom=W,e.rng_seed_time=H,e.BigInteger=d,e.RSAKey=Q,e.ECDSA=et.crypto.ECDSA,e.DSA=et.crypto.DSA,e.Signature=et.crypto.Signature,e.MessageDigest=et.crypto.MessageDigest,e.Mac=et.crypto.Mac,e.Cipher=et.crypto.Cipher,e.KEYUTIL=It,e.ASN1HEX=it,e.X509=Mt,e.CryptoJS=s,e.b64tohex=l,e.b64toBA=h,e.stoBA=st,e.BAtos=ot,e.BAtohex=at,e.stohex=ct,e.stob64=function(t){return u(ct(t))},e.stob64u=function(t){return ut(u(ct(t)))},e.b64utos=function(t){return ot(h(lt(t)))},e.b64tob64u=ut,e.b64utob64=lt,e.hex2b64=u,e.hextob64u=ht,e.b64utohex=dt,e.utf8tob64u=nt,e.b64utoutf8=rt,e.utf8tob64=function(t){return u(Et(Ot(t)))},e.b64toutf8=function(t){return decodeURIComponent(xt(l(t)))},e.utf8tohex=ft,e.hextoutf8=pt,e.hextorstr=gt,e.rstrtohex=yt,e.hextob64=vt,e.hextob64nl=mt,e.b64nltohex=_t,e.hextopem=bt,e.pemtohex=wt,e.hextoArrayBuffer=function(t){if(t.length%2!=0)throw"input is not even length";if(null==t.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var e=new ArrayBuffer(t.length/2),n=new DataView(e),r=0;r<t.length/2;r++)n.setUint8(r,parseInt(t.substr(2*r,2),16));return e},e.ArrayBuffertohex=function(t){for(var e="",n=new DataView(t),r=0;r<t.byteLength;r++)e+=("00"+n.getUint8(r).toString(16)).slice(-2);return e},e.zulutomsec=St,e.zulutosec=Ct,e.zulutodate=function(t){return new Date(St(t))},e.datetozulu=function(t,e,n){var r,i=t.getUTCFullYear();if(e){if(i<1950||2049<i)throw"not proper year for UTCTime: "+i;r=(""+i).slice(-2)}else r=("000"+i).slice(-4);if(r+=("0"+(t.getUTCMonth()+1)).slice(-2),r+=("0"+t.getUTCDate()).slice(-2),r+=("0"+t.getUTCHours()).slice(-2),r+=("0"+t.getUTCMinutes()).slice(-2),r+=("0"+t.getUTCSeconds()).slice(-2),n){var s=t.getUTCMilliseconds();0!==s&&(r+="."+(s=(s=("00"+s).slice(-3)).replace(/0+$/g,"")))}return r+="Z"},e.uricmptohex=Et,e.hextouricmp=xt,e.ipv6tohex=Tt,e.hextoipv6=At,e.hextoip=kt,e.iptohex=function(t){var e="malformed IP address";if(!(t=t.toLowerCase(t)).match(/^[0-9.]+$/)){if(t.match(/^[0-9a-f:]+$/)&&-1!==t.indexOf(":"))return Tt(t);throw e}var n=t.split(".");if(4!==n.length)throw e;var r="";try{for(var i=0;i<4;i++)r+=("0"+parseInt(n[i]).toString(16)).slice(-2);return r}catch(t){throw e}},e.encodeURIComponentAll=Ot,e.newline_toUnix=function(t){return t=t.replace(/\r\n/gm,"\n")},e.newline_toDos=function(t){return t=(t=t.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},e.hextoposhex=Pt,e.intarystrtohex=Rt,e.strdiffidx=function(t,e){var n=t.length;t.length>e.length&&(n=e.length);for(var r=0;r<n;r++)if(t.charCodeAt(r)!=e.charCodeAt(r))return r;return t.length!=e.length?n:-1},e.KJUR=et,e.crypto=et.crypto,e.asn1=et.asn1,e.jws=et.jws,e.lang=et.lang}).call(this,n(100).Buffer)},function(t,e,n){"use strict";n.r(e),n.d(e,"WebCryptoMemoryKeyStorage",function(){return r});class r{constructor(){this.storageMap=new Map}find(t){return Promise.resolve(this.storageMap.get(t))}async write(t,e){return this.storageMap.set(t,e),Promise.resolve(t)}static getInstance(){return new r}}},function(t,e,n){"use strict";n.r(e);var r=n(52),i=n.n(r);n.d(e,"firebase",function(){return i.a});n(60),n(63)},function(t,e,n){"use strict";n.r(e),n.d(e,"BrowserLoader",function(){return h});var r=n(185),i=n(189),s=n(190),o=n(193),a=n(194);
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const c=(t,e,n="log")=>console[n].bind(console,`%c${t} [Particle]`,`background: ${e}; color: white; padding: 1px 6px 2px 7px; border-radius: 4px;`),u=(t,...e)=>(t[0]+e.map((e,n)=>e+t[n+1]).join("")).trim(),l={};class h extends r.Loader{constructor(t){super(),this._urlMap=t}_loadURL(t){const e=this._resolve(t),n=new URL(e,document.URL).href;return l[n]||(l[n]=super._loadURL(e))}loadResource(t){return this._loadURL(t)}_resolve(t){let e=this._urlMap[t];if(!e&&t){const n=Object.keys(this._urlMap).sort((t,e)=>e.length-t.length).find(e=>t.slice(0,e.length)==e);n&&(e=this._urlMap[n]+t.slice(n.length))}return e=e||t}requireParticle(t){const e=this._resolve(t);this.mapParticleUrl(e);const n=[];self.defineParticle=function(t){n.push(t)},importScripts(e),delete self.defineParticle;const r=c(t.split("/").pop(),"#1faa00");return this.unwrapParticle(n[0],r)}mapParticleUrl(t){const e=t.split("/"),n=e.pop(),r=e.join("/"),i=n.split(".").shift();this._urlMap[i]=r}unwrapParticle(t,e){const n=this._resolve.bind(this),r=h.fetch||fetch;return t({Particle:i.Particle,DomParticle:s.DomParticle,MultiplexerDomParticle:o.MultiplexerDomParticle,SimpleParticle:s.DomParticle,TransformationDomParticle:a.TransformationDomParticle,resolver:n,log:e,html:u,_fetch:r})}}}]);
//# sourceMappingURL=arcs.js.map