!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=254)}({254:function(e,t){!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./shell/source/worker-entry.js")}({"./devtools/shared/devtools-broker.js":
/*!********************************************!*\
  !*** ./devtools/shared/devtools-broker.js ***!
  \********************************************/
/*! exports provided: DevtoolsBroker */function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"DevtoolsBroker",function(){return n});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s="object"==typeof window?window:e;s._arcDebugPromise||(s._arcDebugPromise=new Promise(e=>{s._arcDebugPromiseResolve=e}));class n{static get onceConnected(){return s._arcDebugPromise}static markConnected(){return s._arcDebugPromiseResolve(),{preExistingArcs:!!s.arc}}}}.call(this,r(/*! ./../../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/array-set.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/array-set.js ***!
  \***************************************************************************************/
/*! no static exports found */function(e,t,r){var s=r(/*! ./util */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/util.js"),n=Object.prototype.hasOwnProperty;function i(){this._array=[],this._set=Object.create(null)}i.fromArray=function(e,t){for(var r=new i,s=0,n=e.length;s<n;s++)r.add(e[s],t);return r},i.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(e,t){var r=s.toSetString(e),i=n.call(this._set,r),a=this._array.length;i&&!t||this._array.push(e),i||(this._set[r]=a)},i.prototype.has=function(e){var t=s.toSetString(e);return n.call(this._set,t)},i.prototype.indexOf=function(e){var t=s.toSetString(e);if(n.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},i.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},i.prototype.toArray=function(){return this._array.slice()},t.ArraySet=i},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64-vlq.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64-vlq.js ***!
  \****************************************************************************************/
/*! no static exports found */function(e,t,r){var s=r(/*! ./base64 */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64.js");t.encode=function(e){var t,r="",n=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&n,(n>>>=5)>0&&(t|=32),r+=s.encode(t)}while(n>0);return r},t.decode=function(e,t,r){var n,i,a=e.length,o=0,c=0;do{if(t>=a)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(i=s.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));n=!!(32&i),o+=(i&=31)<<c,c+=5}while(n);r.value=function(e){var t=e>>1;return 1==(1&e)?-t:t}(o),r.rest=t}},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64.js":
/*!************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64.js ***!
  \************************************************************************************/
/*! no static exports found */function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<r.length)return r[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/binary-search.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/binary-search.js ***!
  \*******************************************************************************************/
/*! no static exports found */function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,r,s,n){if(0===r.length)return-1;var i=function e(r,s,n,i,a,o){var c=Math.floor((s-r)/2)+r,l=a(n,i[c],!0);return 0===l?c:l>0?s-c>1?e(c,s,n,i,a,o):o==t.LEAST_UPPER_BOUND?s<i.length?s:-1:c:c-r>1?e(r,c,n,i,a,o):o==t.LEAST_UPPER_BOUND?c:r<0?-1:r}(-1,r.length,e,r,s,n||t.GREATEST_LOWER_BOUND);if(i<0)return-1;for(;i-1>=0&&0===s(r[i],r[i-1],!0);)--i;return i}},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/quick-sort.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/quick-sort.js ***!
  \****************************************************************************************/
/*! no static exports found */function(e,t){function r(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function s(e,t,n,i){if(n<i){var a=n-1;r(e,function(e,t){return Math.round(e+Math.random()*(t-e))}(n,i),i);for(var o=e[i],c=n;c<i;c++)t(e[c],o)<=0&&r(e,a+=1,c);r(e,a+1,c);var l=a+1;s(e,t,n,l-1),s(e,t,l+1,i)}}t.quickSort=function(e,t){s(e,t,0,e.length-1)}},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/source-map-consumer.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/source-map-consumer.js ***!
  \*************************************************************************************************/
/*! no static exports found */function(e,t,r){var s=r(/*! ./util */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/util.js"),n=r(/*! ./binary-search */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/binary-search.js"),i=r(/*! ./array-set */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/array-set.js").ArraySet,a=r(/*! ./base64-vlq */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/base64-vlq.js"),o=r(/*! ./quick-sort */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/quick-sort.js").quickSort;function c(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new h(t):new l(t)}function l(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=s.getArg(t,"version"),n=s.getArg(t,"sources"),a=s.getArg(t,"names",[]),o=s.getArg(t,"sourceRoot",null),c=s.getArg(t,"sourcesContent",null),l=s.getArg(t,"mappings"),u=s.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);n=n.map(String).map(s.normalize).map(function(e){return o&&s.isAbsolute(o)&&s.isAbsolute(e)?s.relative(o,e):e}),this._names=i.fromArray(a.map(String),!0),this._sources=i.fromArray(n,!0),this.sourceRoot=o,this.sourcesContent=c,this._mappings=l,this.file=u}function u(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=s.getArg(t,"version"),n=s.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);this._sources=new i,this._names=new i;var a={line:-1,column:0};this._sections=n.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=s.getArg(e,"offset"),r=s.getArg(t,"line"),n=s.getArg(t,"column");if(r<a.line||r===a.line&&n<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=t,{generatedOffset:{generatedLine:r+1,generatedColumn:n+1},consumer:new c(s.getArg(e,"map"))}})}c.fromSourceMap=function(e){return l.fromSourceMap(e)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,r){var n,i=t||null;switch(r||c.GENERATED_ORDER){case c.GENERATED_ORDER:n=this._generatedMappings;break;case c.ORIGINAL_ORDER:n=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;n.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=a&&(t=s.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,i)},c.prototype.allGeneratedPositionsFor=function(e){var t=s.getArg(e,"line"),r={source:s.getArg(e,"source"),originalLine:t,originalColumn:s.getArg(e,"column",0)};if(null!=this.sourceRoot&&(r.source=s.relative(this.sourceRoot,r.source)),!this._sources.has(r.source))return[];r.source=this._sources.indexOf(r.source);var i=[],a=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,n.LEAST_UPPER_BOUND);if(a>=0){var o=this._originalMappings[a];if(void 0===e.column)for(var c=o.originalLine;o&&o.originalLine===c;)i.push({line:s.getArg(o,"generatedLine",null),column:s.getArg(o,"generatedColumn",null),lastColumn:s.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a];else for(var l=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==l;)i.push({line:s.getArg(o,"generatedLine",null),column:s.getArg(o,"generatedColumn",null),lastColumn:s.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a]}return i},t.SourceMapConsumer=c,l.prototype=Object.create(c.prototype),l.prototype.consumer=c,l.fromSourceMap=function(e){var t=Object.create(l.prototype),r=t._names=i.fromArray(e._names.toArray(),!0),n=t._sources=i.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var a=e._mappings.toArray().slice(),c=t.__generatedMappings=[],h=t.__originalMappings=[],d=0,p=a.length;d<p;d++){var m=a[d],f=new u;f.generatedLine=m.generatedLine,f.generatedColumn=m.generatedColumn,m.source&&(f.source=n.indexOf(m.source),f.originalLine=m.originalLine,f.originalColumn=m.originalColumn,m.name&&(f.name=r.indexOf(m.name)),h.push(f)),c.push(f)}return o(t.__originalMappings,s.compareByOriginalPositions),t},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?s.join(this.sourceRoot,e):e},this)}}),l.prototype._parseMappings=function(e,t){for(var r,n,i,c,l,h=1,d=0,p=0,m=0,f=0,g=0,y=e.length,b=0,_={},S={},v=[],w=[];b<y;)if(";"===e.charAt(b))h++,b++,d=0;else if(","===e.charAt(b))b++;else{for((r=new u).generatedLine=h,c=b;c<y&&!this._charIsMappingSeparator(e,c);c++);if(i=_[n=e.slice(b,c)])b+=n.length;else{for(i=[];b<c;)a.decode(e,b,S),l=S.value,b=S.rest,i.push(l);if(2===i.length)throw new Error("Found a source, but no line and column");if(3===i.length)throw new Error("Found a source and line, but no column");_[n]=i}r.generatedColumn=d+i[0],d=r.generatedColumn,i.length>1&&(r.source=f+i[1],f+=i[1],r.originalLine=p+i[2],p=r.originalLine,r.originalLine+=1,r.originalColumn=m+i[3],m=r.originalColumn,i.length>4&&(r.name=g+i[4],g+=i[4])),w.push(r),"number"==typeof r.originalLine&&v.push(r)}o(w,s.compareByGeneratedPositionsDeflated),this.__generatedMappings=w,o(v,s.compareByOriginalPositions),this.__originalMappings=v},l.prototype._findMapping=function(e,t,r,s,i,a){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[s]);return n.search(e,t,i,a)},l.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(e){var t={generatedLine:s.getArg(e,"line"),generatedColumn:s.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",s.compareByGeneratedPositionsDeflated,s.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(r>=0){var n=this._generatedMappings[r];if(n.generatedLine===t.generatedLine){var i=s.getArg(n,"source",null);null!==i&&(i=this._sources.at(i),null!=this.sourceRoot&&(i=s.join(this.sourceRoot,i)));var a=s.getArg(n,"name",null);return null!==a&&(a=this._names.at(a)),{source:i,line:s.getArg(n,"originalLine",null),column:s.getArg(n,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}))},l.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=s.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=s.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(e){var t=s.getArg(e,"source");if(null!=this.sourceRoot&&(t=s.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};var r={source:t=this._sources.indexOf(t),originalLine:s.getArg(e,"line"),originalColumn:s.getArg(e,"column")},n=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,s.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(n>=0){var i=this._originalMappings[n];if(i.source===r.source)return{line:s.getArg(i,"generatedLine",null),column:s.getArg(i,"generatedColumn",null),lastColumn:s.getArg(i,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=l,h.prototype=Object.create(c.prototype),h.prototype.constructor=c,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),h.prototype.originalPositionFor=function(e){var t={generatedLine:s.getArg(e,"line"),generatedColumn:s.getArg(e,"column")},r=n.search(t,this._sections,function(e,t){var r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:t.generatedLine-(i.generatedOffset.generatedLine-1),column:t.generatedColumn-(i.generatedOffset.generatedLine===t.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},h.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(s.getArg(e,"source"))){var n=r.consumer.generatedPositionFor(e);if(n)return{line:n.line+(r.generatedOffset.generatedLine-1),column:n.column+(r.generatedOffset.generatedLine===n.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var n=this._sections[r],i=n.consumer._generatedMappings,a=0;a<i.length;a++){var c=i[a],l=n.consumer._sources.at(c.source);null!==n.consumer.sourceRoot&&(l=s.join(n.consumer.sourceRoot,l)),this._sources.add(l),l=this._sources.indexOf(l);var u=n.consumer._names.at(c.name);this._names.add(u),u=this._names.indexOf(u);var h={source:l,generatedLine:c.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(n.generatedOffset.generatedLine===c.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:u};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}o(this.__generatedMappings,s.compareByGeneratedPositionsDeflated),o(this.__originalMappings,s.compareByOriginalPositions)},t.IndexedSourceMapConsumer=h},"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/util.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/util.js ***!
  \**********************************************************************************/
/*! no static exports found */function(e,t){t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,s=/^data:.+\,.+$/;function n(e){var t=e.match(r);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(e){var r=e,s=n(e);if(s){if(!s.path)return e;r=s.path}for(var a,o=t.isAbsolute(r),c=r.split(/\/+/),l=0,u=c.length-1;u>=0;u--)"."===(a=c[u])?c.splice(u,1):".."===a?l++:l>0&&(""===a?(c.splice(u+1,l),l=0):(c.splice(u,2),l--));return""===(r=c.join("/"))&&(r=o?"/":"."),s?(s.path=r,i(s)):r}t.urlParse=n,t.urlGenerate=i,t.normalize=a,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=n(t),o=n(e);if(o&&(e=o.path||"/"),r&&!r.scheme)return o&&(r.scheme=o.scheme),i(r);if(r||t.match(s))return t;if(o&&!o.host&&!o.path)return o.host=t,i(o);var c="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=c,i(o)):c},t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(r)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var s=e.lastIndexOf("/");if(s<0)return t;if((e=e.slice(0,s)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var o=!("__proto__"in Object.create(null));function c(e){return e}function l(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function u(e,t){return e===t?0:e>t?1:-1}t.toSetString=o?c:function(e){return l(e)?"$"+e:e},t.fromSetString=o?c:function(e){return l(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,r){var s=e.source-t.source;return 0!==s?s:0!=(s=e.originalLine-t.originalLine)?s:0!=(s=e.originalColumn-t.originalColumn)||r?s:0!=(s=e.generatedColumn-t.generatedColumn)?s:0!=(s=e.generatedLine-t.generatedLine)?s:e.name-t.name},t.compareByGeneratedPositionsDeflated=function(e,t,r){var s=e.generatedLine-t.generatedLine;return 0!==s?s:0!=(s=e.generatedColumn-t.generatedColumn)||r?s:0!=(s=e.source-t.source)?s:0!=(s=e.originalLine-t.originalLine)?s:0!=(s=e.originalColumn-t.originalColumn)?s:e.name-t.name},t.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!==(r=u(e.source,t.source))?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:u(e.name,t.name)}},"./node_modules/sourcemapped-stacktrace/sourcemapped-stacktrace.js":
/*!*************************************************************************!*\
  !*** ./node_modules/sourcemapped-stacktrace/sourcemapped-stacktrace.js ***!
  \*************************************************************************/
/*! no static exports found */function(e,t,r){var s,n;s=[r(/*! source-map/lib/source-map-consumer */"./node_modules/sourcemapped-stacktrace/node_modules/source-map/lib/source-map-consumer.js")],void 0===(n=function(e){var t={},r=function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1},s=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},n=function(){return navigator.userAgent.toLowerCase().indexOf("safari")>-1},i=function(){return document.documentMode&&document.documentMode>=11},a=function(){this.count=0,this.pending=[]};a.prototype.incr=function(){this.count++},a.prototype.decr=function(){this.count--,this.flush()},a.prototype.whenReady=function(e){this.pending.push(e),this.flush()},a.prototype.flush=function(){0===this.count&&(this.pending.forEach(function(e){e()}),this.pending=[])};var o=function(e){this.sem=new a,this.sync=e&&e.sync,this.mapForUri=e&&e.cacheGlobally?t:{}};o.prototype.ajax=function(e,t){var r=function(){for(var e=!1,t=0;t<d.length;t++){try{e=d[t]()}catch(e){continue}break}return e}(),s=this;r.onreadystatechange=function(){4==r.readyState&&t.call(s,r,e)},r.open("GET",e,!this.sync),r.send()},o.prototype.fetchScript=function(e){e in this.mapForUri||(this.sem.incr(),this.mapForUri[e]=null,this.ajax(e,this.onScriptLoad))};var c=new RegExp("^(?:[a-z]+:)?//","i");o.prototype.onScriptLoad=function(t,r){if(200===t.status||"file://"===r.slice(0,7)&&0===t.status){var s=t.responseText.match("//# [s]ourceMappingURL=(.*)[\\s]*$","m");if(s&&2===s.length){var n=s[1],i=n.match("data:application/json;(charset=[^;]+;)?base64,(.*)");if(i&&i[2])this.mapForUri[r]=new e.SourceMapConsumer(atob(i[2])),this.sem.decr();else{if(!c.test(n)){var a,o=r.lastIndexOf("/");-1!==o&&(a=r.slice(0,o+1),n=a+n)}this.ajax(n,function(t){(200===t.status||"file://"===n.slice(0,7)&&0===t.status)&&(this.mapForUri[r]=new e.SourceMapConsumer(t.responseText)),this.sem.decr()})}}else this.sem.decr()}else this.sem.decr()};var l=function(e,t,r){for(var s,n=[],i=0;i<e.length;i++){var a=t[i];if(a){var o=a[1],c=parseInt(a[2],10),l=parseInt(a[3],10);if(s=r[o]){var d=s.originalPositionFor({line:c,column:l});n.push(h(d.source,d.line,d.column,d.name||u(e[i])))}else n.push(h(o,c,l,u(e[i])))}else n.push(e[i])}return n};function u(e){var t=String(e).match(r()||i()?/ +at +([^ ]*).*/:/([^@]*)@.*/);return t&&t[1]}var h=function(e,t,r,s){return"    at "+(s||"(unknown)")+" ("+e+":"+t+":"+r+")"},d=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return{mapStackTrace:function(e,t,a){var c,u,h,d,p,m,f,g={},y=new o(a);if(r()||i())m=/^ +at.+\((.*):([0-9]+):([0-9]+)/,p=4,f=1;else{if(!s()&&!n())throw new Error("unknown browser :(");m=/@(.*):([0-9]+):([0-9]+)/,p=4,f=0}c=e.split("\n").slice(f);for(var b=0;b<c.length;b++)u=c[b],a&&a.filter&&!a.filter(u)||(h=u.match(m))&&h.length===p&&(g[b]=h,(d=h[1]).match(/<anonymous>/)||y.fetchScript(d));y.sem.whenReady(function(){var e=l(c,g,y.mapForUri);t(e)})}}}.apply(t,s))||(e.exports=n)},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},"./platform/assert-web.js":
/*!********************************!*\
  !*** ./platform/assert-web.js ***!
  \********************************/
/*! exports provided: assert */function(e,t,r){"use strict";function s(e,t){if(!e)throw new Error(t)}r.r(t),r.d(t,"assert",function(){return s})},"./platform/devtools-channel-web.js":
/*!******************************************!*\
  !*** ./platform/devtools-channel-web.js ***!
  \******************************************/
/*! exports provided: DevtoolsChannel */function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsChannel",function(){return n});var s=r(/*! ../runtime/debug/abstract-devtools-channel.js */"./runtime/debug/abstract-devtools-channel.js");
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class n extends s.AbstractDevtoolsChannel{constructor(){super(),document.addEventListener("arcs-debug-in",e=>this._handleMessage(e.detail))}_flush(e){document.dispatchEvent(new CustomEvent("arcs-debug-out",{detail:e}))}}},"./platform/fs-web.js":
/*!****************************!*\
  !*** ./platform/fs-web.js ***!
  \****************************/
/*! exports provided: fs */function(e,t,r){"use strict";r.r(t),r.d(t,"fs",function(){return s});const s={}},"./platform/sourcemapped-stacktrace-web.js":
/*!*************************************************!*\
  !*** ./platform/sourcemapped-stacktrace-web.js ***!
  \*************************************************/
/*! exports provided: mapStackTrace */function(e,t,r){"use strict";r.r(t),r.d(t,"mapStackTrace",function(){return s});const s=r(/*! sourcemapped-stacktrace/sourcemapped-stacktrace.js */"./node_modules/sourcemapped-stacktrace/sourcemapped-stacktrace.js").mapStackTrace},"./platform/vm-web.js":
/*!****************************!*\
  !*** ./platform/vm-web.js ***!
  \****************************/
/*! exports provided: vm */function(e,t,r){"use strict";r.r(t),r.d(t,"vm",function(){return s});const s={}},"./runtime/api-channel.js":
/*!********************************!*\
  !*** ./runtime/api-channel.js ***!
  \********************************/
/*! exports provided: APIPort, PECOuterPort, PECInnerPort */function(e,t,r){"use strict";r.r(t),r.d(t,"APIPort",function(){return l}),r.d(t,"PECOuterPort",function(){return u}),r.d(t,"PECInnerPort",function(){return h});var s=r(/*! ../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./ts-build/particle-spec.js */"./runtime/ts-build/particle-spec.js"),i=r(/*! ./ts-build/type.js */"./runtime/ts-build/type.js"),a=r(/*! ./debug/outer-port-attachment.js */"./runtime/debug/outer-port-attachment.js"),o=r(/*! ./debug/devtools-connection.js */"./runtime/debug/devtools-connection.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e){this._prefix=e,this._nextIdentifier=0,this._idMap=new Map,this._reverseIdMap=new Map}_newIdentifier(){return this._prefix+this._nextIdentifier++}createMappingForThing(e,t){let r;return Object(s.assert)(!this._reverseIdMap.has(e)),r=t||(e.apiChannelMappingId?e.apiChannelMappingId:this._newIdentifier()),Object(s.assert)(!this._idMap.has(r),`${t?"requestedId":e.apiChannelMappingId?"apiChannelMappingId":"newIdentifier()"} ${r} already in use`),this.establishThingMapping(r,e),r}maybeCreateMappingForThing(e){return this.hasMappingForThing(e)?this.identifierForThing(e):this.createMappingForThing(e)}async establishThingMapping(e,t){let r;Array.isArray(t)&&([t,r]=t),this._idMap.set(e,t),t instanceof Promise?(Object(s.assert)(null==r),await this.establishThingMapping(e,await t)):(this._reverseIdMap.set(t,e),r&&await r())}hasMappingForThing(e){return this._reverseIdMap.has(e)}identifierForThing(e){return Object(s.assert)(this._reverseIdMap.has(e),`Missing thing [${e}]`),this._reverseIdMap.get(e)}thingForIdentifier(e){return Object(s.assert)(this._idMap.has(e),`Missing id: ${e}`),this._idMap.get(e)}}class l{constructor(e,t){this._port=e,this._mapper=new c(t),this._messageMap=new Map,this._port.onmessage=(async e=>this._processMessage(e)),this._debugAttachment=null,this._attachStack=!1,this.messageCount=0,this.Direct={convert:e=>e,unconvert:e=>e},this.LocalMapped={convert:e=>this._mapper.maybeCreateMappingForThing(e),unconvert:e=>this._mapper.thingForIdentifier(e)},this.Mapped={convert:e=>this._mapper.identifierForThing(e),unconvert:e=>this._mapper.thingForIdentifier(e)},this.Map=function(e,t){return{convert:r=>{const s={};return r.forEach((r,n)=>s[e.convert(n)]=t.convert(r)),s},unconvert:r=>{const s=new Map;for(const n in r)s.set(e.unconvert(n),t.unconvert(r[n]));return s}}},this.List=function(e){return{convert:t=>t.map(t=>e.convert(t)),unconvert:t=>t.map(t=>e.unconvert(t))}},this.ByLiteral=function(e){return{convert:e=>e.toLiteral(),unconvert:t=>e.fromLiteral(t)}},this._testingHook()}_testingHook(){}close(){this._port.close()}async _processMessage(e){Object(s.assert)(this._messageMap.has(e.data.messageType));const t=this.messageCount++,r=this._messageMap.get(e.data.messageType);let n;try{n=this._unprocessArguments(r.args,e.data.messageBody)}catch(t){throw console.error(`Exception during unmarshaling for ${e.data.messageType}`),t}for(const t of Object.values(n))if(t instanceof Promise)return void t.then(()=>this._processMessage(e));const i="on"+e.data.messageType;Object(s.assert)(this[i],`no handler named ${i}`),this._debugAttachment&&this._debugAttachment.handlePecMessage(i,e.data.messageBody,t,e.data.stack);const a=this[i](n);r.isInitializer&&(Object(s.assert)(n.identifier),await this._mapper.establishThingMapping(n.identifier,a))}_processArguments(e,t){const r={};for(const s in e)r[s]=e[s].convert(t[s]);return r}_unprocessArguments(e,t){const r={};for(const s in e)r[s]=e[s].unconvert(t[s]);return r}registerCall(e,t){this[e]=(r=>{const s={messageType:e,messageBody:this._processArguments(t,r)};this._attachStack&&(s.stack=(new Error).stack);const n=this.messageCount++;this._port.postMessage(s),this._debugAttachment&&this._debugAttachment.handlePecMessage(e,s.messageBody,n,(new Error).stack)})}registerHandler(e,t){this._messageMap.set(e,{args:t})}registerInitializerHandler(e,t){t.identifier=this.Direct,this._messageMap.set(e,{isInitializer:!0,args:t})}registerRedundantInitializer(e,t,r){this.registerInitializer(e,t,r,!0)}registerInitializer(e,t,r=null,s=!1){this[e]=((n,i)=>{if(s&&this._mapper.hasMappingForThing(n))return;const a={messageType:e,messageBody:this._processArguments(t,i)};this._attachStack&&(a.stack=(new Error).stack);const o=r&&i[r];a.messageBody.identifier=this._mapper.createMappingForThing(n,o);const c=this.messageCount++;this._port.postMessage(a),this._debugAttachment&&this._debugAttachment.handlePecMessage(e,a.messageBody,c,(new Error).stack)})}}class u extends l{constructor(e,t){super(e,"o"),this.registerCall("Stop",{}),this.registerRedundantInitializer("DefineHandle",{type:this.ByLiteral(i.Type),name:this.Direct}),this.registerInitializer("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(n.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)},"id"),this.registerCall("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerCall("SimpleCallback",{callback:this.Direct,data:this.Direct}),this.registerCall("AwaitIdle",{version:this.Direct}),this.registerCall("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerCall("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerHandler("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerHandler("InitializeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("SynchronizeProxy",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleGet",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleToList",{handle:this.Mapped,callback:this.Direct}),this.registerHandler("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerHandler("HandleStore",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemove",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleRemoveMultiple",{handle:this.Mapped,callback:this.Direct,data:this.Direct,particleId:this.Direct}),this.registerHandler("HandleStream",{handle:this.Mapped,callback:this.Direct,pageSize:this.Direct,forward:this.Direct}),this.registerHandler("StreamCursorNext",{handle:this.Mapped,callback:this.Direct,cursorId:this.Direct}),this.registerHandler("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerHandler("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerHandler("GetBackingStore",{callback:this.Direct,storageKey:this.Direct,type:this.ByLiteral(i.Type)}),this.registerInitializer("GetBackingStoreCallback",{callback:this.Direct,type:this.ByLiteral(i.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerHandler("ConstructInnerArc",{callback:this.Direct,particle:this.Mapped}),this.registerCall("ConstructArcCallback",{callback:this.Direct,arc:this.LocalMapped}),this.registerHandler("ArcCreateHandle",{callback:this.Direct,arc:this.LocalMapped,type:this.ByLiteral(i.Type),name:this.Direct}),this.registerInitializer("CreateHandleCallback",{callback:this.Direct,type:this.ByLiteral(i.Type),name:this.Direct,id:this.Direct}),this.registerHandler("ArcMapHandle",{callback:this.Direct,arc:this.LocalMapped,handle:this.Mapped}),this.registerInitializer("MapHandleCallback",{callback:this.Direct,id:this.Direct}),this.registerHandler("ArcCreateSlot",{callback:this.Direct,arc:this.LocalMapped,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializer("CreateSlotCallback",{callback:this.Direct,hostedSlotId:this.Direct}),this.registerCall("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerHandler("ArcLoadRecipe",{arc:this.LocalMapped,recipe:this.Direct,callback:this.Direct}),this.registerHandler("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerCall("DevToolsConnected",{}),o.DevtoolsConnection.onceConnected.then(e=>{this.DevToolsConnected(),this._debugAttachment=new a.OuterPortAttachment(t,e)})}}class h extends l{constructor(e){super(e,"i"),this.registerHandler("Stop",{}),this.registerInitializerHandler("DefineHandle",{type:this.ByLiteral(i.Type),name:this.Direct}),this.registerInitializerHandler("InstantiateParticle",{id:this.Direct,spec:this.ByLiteral(n.ParticleSpec),handles:this.Map(this.Direct,this.Mapped)}),this.registerHandler("UIEvent",{particle:this.Mapped,slotName:this.Direct,event:this.Direct}),this.registerHandler("SimpleCallback",{callback:this.LocalMapped,data:this.Direct}),this.registerHandler("AwaitIdle",{version:this.Direct}),this.registerHandler("StartRender",{particle:this.Mapped,slotName:this.Direct,providedSlots:this.Map(this.Direct,this.Direct),contentTypes:this.List(this.Direct)}),this.registerHandler("StopRender",{particle:this.Mapped,slotName:this.Direct}),this.registerCall("Render",{particle:this.Mapped,slotName:this.Direct,content:this.Direct}),this.registerCall("InitializeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("SynchronizeProxy",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleGet",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleToList",{handle:this.Mapped,callback:this.LocalMapped}),this.registerCall("HandleSet",{handle:this.Mapped,data:this.Direct,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleClear",{handle:this.Mapped,particleId:this.Direct,barrier:this.Direct}),this.registerCall("HandleStore",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemove",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleRemoveMultiple",{handle:this.Mapped,callback:this.LocalMapped,data:this.Direct,particleId:this.Direct}),this.registerCall("HandleStream",{handle:this.Mapped,callback:this.LocalMapped,pageSize:this.Direct,forward:this.Direct}),this.registerCall("StreamCursorNext",{handle:this.Mapped,callback:this.LocalMapped,cursorId:this.Direct}),this.registerCall("StreamCursorClose",{handle:this.Mapped,cursorId:this.Direct}),this.registerCall("Idle",{version:this.Direct,relevance:this.Map(this.Mapped,this.Direct)}),this.registerCall("GetBackingStore",{callback:this.LocalMapped,storageKey:this.Direct,type:this.ByLiteral(i.Type)}),this.registerInitializerHandler("GetBackingStoreCallback",{callback:this.LocalMapped,type:this.ByLiteral(i.Type),name:this.Direct,id:this.Direct,storageKey:this.Direct}),this.registerCall("ConstructInnerArc",{callback:this.LocalMapped,particle:this.Mapped}),this.registerHandler("ConstructArcCallback",{callback:this.LocalMapped,arc:this.Direct}),this.registerCall("ArcCreateHandle",{callback:this.LocalMapped,arc:this.Direct,type:this.ByLiteral(i.Type),name:this.Direct}),this.registerInitializerHandler("CreateHandleCallback",{callback:this.LocalMapped,type:this.ByLiteral(i.Type),name:this.Direct,id:this.Direct}),this.registerCall("ArcMapHandle",{callback:this.LocalMapped,arc:this.Direct,handle:this.Mapped}),this.registerInitializerHandler("MapHandleCallback",{callback:this.LocalMapped,id:this.Direct}),this.registerCall("ArcCreateSlot",{callback:this.LocalMapped,arc:this.Direct,transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedParticleName:this.Direct,hostedSlotName:this.Direct,handleId:this.Direct}),this.registerInitializerHandler("CreateSlotCallback",{callback:this.LocalMapped,hostedSlotId:this.Direct}),this.registerHandler("InnerArcRender",{transformationParticle:this.Mapped,transformationSlotName:this.Direct,hostedSlotId:this.Direct,content:this.Direct}),this.registerCall("ArcLoadRecipe",{arc:this.Direct,recipe:this.Direct,callback:this.LocalMapped}),this.registerCall("RaiseSystemException",{exception:this.Direct,methodName:this.Direct,particleId:this.Direct}),this.registerHandler("DevToolsConnected",{}),this.onDevToolsConnected=(()=>this._attachStack=!0)}}},"./runtime/debug/abstract-devtools-channel.js":
/*!****************************************************!*\
  !*** ./runtime/debug/abstract-devtools-channel.js ***!
  \****************************************************/
/*! exports provided: AbstractDevtoolsChannel */function(e,t,r){"use strict";r.r(t),r.d(t,"AbstractDevtoolsChannel",function(){return n});var s=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js");
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class n{constructor(){this.debouncedMessages=[],this.debouncing=!1,this.messageListeners=new Map}send(e){this.debouncedMessages.push(e),this.debouncing||(this.debouncing=!0,setTimeout(()=>{this._flush(this.debouncedMessages),this.debouncedMessages=[],this.debouncing=!1},100))}listen(e,t,r){Object(s.assert)(t),Object(s.assert)(e);const n=`${"string"==typeof e?e:e.id.toString()}/${t}`;let i=this.messageListeners.get(n);i||this.messageListeners.set(n,i=[]),i.push(r)}_handleMessage(e){const t=this.messageListeners.get(`${e.arcId}/${e.messageType}`);if(t)for(const r of t)r(e);else console.warn(`No one is listening to ${e.messageType} message`)}_flush(e){throw"Not implemented in an abstract class"}}},"./runtime/debug/devtools-connection.js":
/*!**********************************************!*\
  !*** ./runtime/debug/devtools-connection.js ***!
  \**********************************************/
/*! exports provided: DevtoolsConnection, DevtoolsForTests */function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsConnection",function(){return h}),r.d(t,"DevtoolsForTests",function(){return d});var s=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ../../platform/devtools-channel-web.js */"./platform/devtools-channel-web.js"),i=r(/*! ./testing/devtools-channel-stub.js */"./runtime/debug/testing/devtools-channel-stub.js"),a=r(/*! ../../devtools/shared/devtools-broker.js */"./devtools/shared/devtools-broker.js");
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
let o=null,c=!1,l=null,u=new Promise(e=>l=e);a.DevtoolsBroker.onceConnected.then(()=>{h.ensure(),l(o),c=!0});class h{static get isConnected(){return c}static get onceConnected(){return u}static get(){return o}static ensure(){o||(o=new n.DevtoolsChannel)}}class d{static get channel(){return o}static ensureStub(){Object(s.assert)(!o),o=new i.DevtoolsChannelStub,l(o),c=!0}static reset(){Object(s.assert)(o),c=!1,l=null,u=new Promise(e=>l=e),o=null}}},"./runtime/debug/outer-port-attachment.js":
/*!************************************************!*\
  !*** ./runtime/debug/outer-port-attachment.js ***!
  \************************************************/
/*! exports provided: OuterPortAttachment */function(e,t,r){"use strict";r.r(t),r.d(t,"OuterPortAttachment",function(){return n});var s=r(/*! ../../platform/sourcemapped-stacktrace-web.js */"./platform/sourcemapped-stacktrace-web.js");
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class n{constructor(e,t){this._devtoolsChannel=t,this._arcIdString=e.id.toString(),this._speculative=e.isSpeculative}handlePecMessage(e,t,r,s){if(this._arcIdString.endsWith("-pipes")||this._speculative)return;const n=this._extractStackFrames(s);this._devtoolsChannel.send({messageType:"PecLog",messageBody:{name:e,pecMsgBody:t,pecMsgCount:r,timestamp:Date.now(),stack:n}})}_extractStackFrames(e){const t=[];if(!e)return t;if(e.includes("(file:///")){for(const r of e.split("\n    at ").slice(2)){let e=r.match(/^(.*) \((.*)\)$/);null===e&&(e={1:"<unknown>",2:r});let s=e[2].replace(/:[0-9]+$/,"");s.startsWith("file")&&(s=s.replace(/^.*\/arcs[^/]*\//,"")),t.push({method:e[1],location:s,target:null,targetClass:"noLink"})}return t}return Object(s.mapStackTrace)(e,e=>e.slice(1).map(e=>{let r=e.match(/^ {4}at (.*) \((.*)\)$/);null===r&&(r={1:"<unknown>",2:e.replace(/^ *at */,"")});const s={method:r[1]},n=r[2].replace(/:[0-9]+$/,"");n.startsWith("http")?(s.location=n.replace(/^.*\/arcs[^/]*\//,""),s.target=n,s.targetClass="link"):n.startsWith("webpack")?(s.location=n.slice(11),s.target=`webpack:///./${s.location}`,s.targetClass="link"):(s.location=n,s.target=null,s.targetClass="noLink"),t.push(s)}),{sync:!0,cacheGlobally:!0}),t}}},"./runtime/debug/testing/devtools-channel-stub.js":
/*!********************************************************!*\
  !*** ./runtime/debug/testing/devtools-channel-stub.js ***!
  \********************************************************/
/*! exports provided: DevtoolsChannelStub */function(e,t,r){"use strict";r.r(t),r.d(t,"DevtoolsChannelStub",function(){return s});
/**
 * @license
 * Copyright (c) 2018 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(){this._messages=[]}get messages(){return this._messages}send(e){this._messages.push(JSON.parse(JSON.stringify(e)))}listen(e,t,r){}clear(){this._messages.length=0}}},"./runtime/dom-particle-base.js":
/*!**************************************!*\
  !*** ./runtime/dom-particle-base.js ***!
  \**************************************/
/*! exports provided: DomParticleBase */function(e,t,r){"use strict";r.r(t),r.d(t,"DomParticleBase",function(){return i});var s=r(/*! ../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./ts-build/particle.js */"./runtime/ts-build/particle.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class i extends n.Particle{constructor(){super()}get template(){return""}getTemplate(e){return this.template}getTemplateName(e){return"default"}shouldRender(){return!0}render(){return{}}renderSlot(e,t){const r=this._getStateArgs(),s=this.getSlot(e);if(s){if(this.currentSlotName=e,t.forEach(e=>s.requestedContentTypes.add(e)),this.shouldRender(...r)){const e={};s.requestedContentTypes.has("template")&&(e.template=this.getTemplate(s.slotName)),s.requestedContentTypes.has("model")&&(e.model=this.render(...r)),e.templateName=this.getTemplateName(s.slotName),s.render(e)}else s.isRendered&&s.render({});this.currentSlotName=void 0}}_getStateArgs(){return[]}forceRenderTemplate(e){this._slotByName.forEach((t,r)=>{e&&r!=e||t.requestedContentTypes.add("template")})}fireEvent(e,{handler:t,data:r}){this[t]&&this[t]({data:r})}setParticleDescription(e){if("string"==typeof e)return super.setParticleDescription(e);Object(s.assert)(!!e.template&&!!e.model,"Description pattern must either be string or have template and model"),super.setDescriptionPattern("_template_",e.template),super.setDescriptionPattern("_model_",JSON.stringify(e.model))}async clearHandle(e){await this.handles.get(e).clear()}async mergeEntitiesToHandle(e,t){const r={},s=this.handles.get(e);(await s.toList()).forEach(e=>r[e.id]=e);for(const e of t)r[e.id]||s.store(e)}async appendEntitiesToHandle(e,t){const r=this.handles.get(e);r&&Promise.all(t.map(e=>r.store(e)))}async appendRawDataToHandle(e,t){const r=this.handles.get(e);r&&Promise.all(t.map(e=>r.store(new r.entityClass(e))))}updateVariable(e,t){const r=this.handles.get(e);if(r){const e=new r.entityClass(t);return r.set(e),e}}async updateSet(e,t){const r=this.handles.get(e);r&&(r.remove(t),r.store(t))}boxQuery(e,t){return e.filter(e=>t===e.getUserID().split("|")[0])}}},"./runtime/dom-particle.js":
/*!*********************************!*\
  !*** ./runtime/dom-particle.js ***!
  \*********************************/
/*! exports provided: DomParticle */function(e,t,r){"use strict";r.r(t),r.d(t,"DomParticle",function(){return i});var s=r(/*! ../shell/components/xen/xen-state.js */"./shell/components/xen/xen-state.js"),n=r(/*! ./dom-particle-base.js */"./runtime/dom-particle-base.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class i extends(Object(s.XenStateMixin)(n.DomParticleBase)){constructor(){super(),this.state=this._state,this.props=this._props}willReceiveProps(){}update(){}shouldRender(){return!0}render(){return{}}setState(e){return this._setState(e)}setIfDirty(e){return console.warn("DomParticle: `setIfDirty` is deprecated, please use `setState` instead"),this._setState(e)}configureHandles(e){}get config(){return{handleNames:this.spec.inputs.map(e=>e.name),slotNames:[...this.spec.slots.values()].map(e=>e.name)}}_willReceiveProps(...e){this.willReceiveProps(...e)}_update(...e){this.update(...e),this.shouldRender(...e)&&(this.relevance=1),this.config.slotNames.forEach(e=>this.renderSlot(e,["model"]))}get _views(){return console.warn(`Particle ${this.spec.name} uses deprecated _views getter.`),this.handles}async setViews(e){return console.warn(`Particle ${this.spec.name} uses deprecated setViews method.`),this.setHandles(e)}async setHandles(e){this.configureHandles(e),this.handles=e,this._handlesToSync=new Set;for(const t of this.config.handleNames){const r=e.get(t);r&&r.options.keepSynced&&r.options.notifySync&&this._handlesToSync.add(t)}setTimeout(()=>!this._hasProps&&this._invalidate(),200)}async onHandleSync(e,t){this._handlesToSync.delete(e.name),0==this._handlesToSync.size&&await this._handlesToProps()}async onHandleUpdate(e,t){this._debounce("handleUpdateDebounce",()=>{this._handlesToProps()},100)}async _handlesToProps(){const e=this.config,t=await Promise.all(e.handleNames.map(e=>this.handles.get(e)).map(e=>e.toList?e.toList():e.get?e.get():e)),r=Object.create(null);e.handleNames.forEach((e,s)=>{r[e]=t[s]}),this._hasProps=!0,this._setProps(r)}fireEvent(e,{handler:t,data:r}){this[t]&&this[t]({data:r},this._state)}_debounce(e,t,r){const s=`_debounce_${e}`;this._state[s]||this.startBusy();super._debounce(e,()=>{this.doneBusy(),t(),this._state[s]=null},r)}}},"./runtime/fetch-web.js":
/*!******************************!*\
  !*** ./runtime/fetch-web.js ***!
  \******************************/
/*! exports provided: fetch */function(e,t,r){"use strict";r.r(t),r.d(t,"fetch",function(){return s});const s=fetch},"./runtime/multiplexer-dom-particle.js":
/*!*********************************************!*\
  !*** ./runtime/multiplexer-dom-particle.js ***!
  \*********************************************/
/*! exports provided: MultiplexerDomParticle */function(e,t,r){"use strict";r.r(t),r.d(t,"MultiplexerDomParticle",function(){return a});var s=r(/*! ../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./ts-build/particle-spec.js */"./runtime/ts-build/particle-spec.js"),i=r(/*! ./transformation-dom-particle.js */"./runtime/transformation-dom-particle.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class a extends i.TransformationDomParticle{constructor(){super(),this._itemSubIdByHostedSlotId=new Map,this._connByHostedConn=new Map}async _mapParticleConnections(e,t,r,s,n){const i=[],a=[];let o=2;const c=[e,t];for(const[e,t]of s){if(c.includes(e))continue;i.push(`use '${await n.mapHandle(t._proxy)}' as v${o}`);const s=r.connections.find(e=>e.isCompatibleType(t.type));s&&(a.push(`${s.name} = v${o++}`),this._connByHostedConn.set(s.name,e))}return[i,a]}async setHandles(e){this.handleIds={};const t=await this.constructInnerArc(),r=e.get("hostedParticle");let s=null,n=[],i=[];r&&(s=await r.get())&&([n,i]=await this._mapParticleConnections("list","hostedParticle",s,e,t)),this.setState({arc:t,type:e.get("list").type,hostedParticle:s,otherMappedHandles:n,otherConnections:i}),super.setHandles(e)}async willReceiveProps({list:e},{arc:t,type:r,hostedParticle:s,otherMappedHandles:i,otherConnections:a}){e.length>0&&(this.relevance=.1);for(const[o,c]of this.getListEntries(e)){let e=s;if(this.handleIds[c.id]){(await this.handleIds[c.id]).set(c);continue}const l=t.createHandle(r.primitiveType(),"item"+o);this.handleIds[c.id]=l;const u=await l;if(!e){if(!c.renderParticleSpec)continue;e=n.ParticleSpec.fromLiteral(JSON.parse(c.renderParticleSpec));const r="list",s="renderParticle";[i,a]=await this._mapParticleConnections(r,s,e,this.handles,t)}const h=[...e.slots.keys()][0],d=[...this.spec.slots.values()][0].name,p=await t.createSlot(this,d,e.name,h,u._id);if(p){this._itemSubIdByHostedSlotId.set(p,c.id);try{const r=this.constructInnerRecipe(e,c,u,{name:h,id:p},{connections:a,handles:i});await t.loadRecipe(r,this),u.set(c)}catch(e){console.log(e)}}}}combineHostedModel(e,t,r){const s=this._itemSubIdByHostedSlotId.get(t);if(!s)return;const n=this._state.renderModel?this._state.renderModel.items:[],i=n.findIndex(e=>e.subId==s),a=Object.assign({},r.model,{subId:s});i>=0&&i<n.length?n[i]=a:n.push(a),this._setState({renderModel:{items:n}})}combineHostedTemplate(e,t,r){const n=this._itemSubIdByHostedSlotId.get(t);if(n&&(Object(s.assert)(r.templateName,`Template name is missing for slot '${e}' (hosted slot ID: '${t}')`),this._setState({templateName:Object.assign(this._state.templateName||{},{[n]:`${r.templateName}`})}),r.template)){let e=r.template;e=e.replace(new RegExp('slotid="[a-z]+"',"gi"),'$& subid$="{{subId}}"'),this._connByHostedConn.forEach((t,r)=>{e=e.replace(new RegExp(`{{${r}.description}}`,"g"),`{{${t}.description}}`)}),this._setState({template:Object.assign(this._state.template||{},{[r.templateName]:e})}),this.forceRenderTemplate()}}constructInnerRecipe(e,t,r,s,n){}getListEntries(e){return e.entries()}}},"./runtime/transformation-dom-particle.js":
/*!************************************************!*\
  !*** ./runtime/transformation-dom-particle.js ***!
  \************************************************/
/*! exports provided: TransformationDomParticle */function(e,t,r){"use strict";r.r(t),r.d(t,"TransformationDomParticle",function(){return n});var s=r(/*! ./dom-particle.js */"./runtime/dom-particle.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class n extends s.DomParticle{getTemplate(e){return this._state.template}getTemplateName(e){return this._state.templateName}render(e,t){return t.renderModel}shouldRender(e,t){return Boolean((t.template||t.templateName)&&t.renderModel)}renderHostedSlot(e,t,r){this.combineHostedTemplate(e,t,r),this.combineHostedModel(e,t,r)}combineHostedTemplate(e,t,r){}combineHostedModel(e,t,r){}static propsToItems(e){return e?e.map(({rawData:e,id:t})=>Object.assign({},e,{subId:t})):[]}}},"./runtime/ts-build/converters/jsonldToManifest.js":
/*!*********************************************************!*\
  !*** ./runtime/ts-build/converters/jsonldToManifest.js ***!
  \*********************************************************/
/*! exports provided: JsonldToManifest */function(e,t,r){"use strict";r.r(t),r.d(t,"JsonldToManifest",function(){return n});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=["Text","URL","Number","Boolean"];class n{static convert(e,t){const r=JSON.parse(e),n={},i={};r["@graph"]||(r["@graph"]=[r]);for(const e of r["@graph"])"rdf:Property"===e["@type"]?i[e["@id"]]=e:"rdfs:Class"===e["@type"]&&(n[e["@id"]]=e,e.subclasses=[],e.superclass=null);for(const e of Object.values(n))if(void 0!==e["rdfs:subClassOf"]){void 0==e["rdfs:subClassOf"].length&&(e["rdfs:subClassOf"]=[e["rdfs:subClassOf"]]);for(const t of e["rdfs:subClassOf"]){const r=t["@id"];void 0==e.superclass&&(e.superclass=[]),n[r]?(n[r].subclasses.push(e),e.superclass.push(n[r])):e.superclass.push({"@id":r})}}for(const e of Object.values(n))0===e.subclasses.length&&void 0==t&&(t=e);const a=[];for(const e of Object.values(i)){let r=e["schema:domainIncludes"];if(r||(r={"@id":t["@id"]}),r.length||(r=[r]),(r=r.map(e=>e["@id"])).includes(t["@id"])){const t=e["@id"].split(":")[1];let r=e["schema:rangeIncludes"];r||console.log(e),r.length||(r=[r]),(r=(r=r.map(e=>e["@id"].split(":")[1])).filter(e=>s.includes(e))).length>0&&a.push({name:t,type:r})}}const o=t["@id"].split(":")[1],c=t&&t.superclass?t.superclass.map(e=>e["@id"].split(":")[1]):[];let l="";for(const e of c)l+=`import 'https://schema.org/${e}'\n\n`;if(l+=`schema ${o}`,c.length>0&&(l+=` extends ${c.join(", ")}`),a.length>0)for(const e of a){let t;l+=`\n  ${t=e.type.length>1?"("+e.type.join(" or ")+")":e.type[0]} ${e.name}`}return l+="\n"}}},"./runtime/ts-build/entity.js":
/*!************************************!*\
  !*** ./runtime/ts-build/entity.js ***!
  \************************************/
/*! exports provided: Entity */function(e,t,r){"use strict";r.r(t),r.d(t,"Entity",function(){return i});var s=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./symbols.js */"./runtime/ts-build/symbols.js");
// @license
class i{constructor(e){Object(s.assert)(!e||-1===e.indexOf(":"),"user IDs must not contain the ':' character"),this[n.Symbols.identifier]=void 0,this.userIDComponent=e}get data(){}getUserID(){return this.userIDComponent}isIdentified(){return void 0!==this[n.Symbols.identifier]}get id(){return Object(s.assert)(!!this.isIdentified()),this[n.Symbols.identifier]}identify(e){Object(s.assert)(!this.isIdentified()),this[n.Symbols.identifier]=e;const t=e.split(":");"uid"===t[t.length-2]&&(this.userIDComponent=t[t.length-1])}createIdentity(e){let t;Object(s.assert)(!this.isIdentified()),t=this.userIDComponent?`${e.base}:uid:${this.userIDComponent}`:`${e.base}:${e.component()}`,this[n.Symbols.identifier]=t}toLiteral(){return this.rawData}}},"./runtime/ts-build/handle.js":
/*!************************************!*\
  !*** ./runtime/ts-build/handle.js ***!
  \************************************/
/*! exports provided: Handle, handleFor */function(e,t,r){"use strict";r.r(t),r.d(t,"Handle",function(){return l}),r.d(t,"handleFor",function(){return m});var s=r(/*! ./reference.js */"./runtime/ts-build/reference.js"),n=r(/*! ./symbols.js */"./runtime/ts-build/symbols.js"),i=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),a=r(/*! ./particle-spec.js */"./runtime/ts-build/particle-spec.js"),o=r(/*! ./type.js */"./runtime/ts-build/type.js");function c(e,t){Object(i.assert)(t,"Handles need entity classes for deserialization");const{id:r,rawData:s}=e,n=new t(
/** @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function(e){return e}(s));return e.id&&n.identify(e.id),n}class l{constructor(e,t,r,s,n){Object(i.assert)(!(e instanceof l)),this._proxy=e,this.name=t||this._proxy.name,this.canRead=s,this.canWrite=n,this._particleId=r,this.options={keepSynced:!0,notifySync:!0,notifyUpdate:!0,notifyDesync:!1}}raiseSystemException(e,t){this._proxy.raiseSystemException(e,t,this._particleId)}configure(e){Object(i.assert)(this.canRead,"configure can only be called on readable Handles");try{const t=Object.keys(this.options),r=Object.keys(e).filter(e=>!t.includes(e));if(r.length>0)throw new Error(`Invalid option in Handle.configure(): ${r}`);Object.assign(this.options,e)}catch(e){throw this.raiseSystemException(e,"Handle::configure"),e}}_serialize(e){return Object(i.assert)(e,"can't serialize a null entity"),e.isIdentified()||e.createIdentity(this._proxy.generateIDComponents()),{id:e[n.Symbols.identifier],rawData:e.dataClone()}}get type(){return this._proxy.type}get _id(){return this._proxy.id}async store(e){throw new Error("unimplemented")}toManifestString(){return`'${this._id}'`}}class u extends l{_notify(e,t,r){switch(Object(i.assert)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":return void t.onHandleSync(this,this._restore(r));case"update":{const e={};return"add"in r&&(e.added=this._restore(r.add)),"remove"in r&&(e.removed=this._restore(r.remove)),e.originator=r.originatorId===this._particleId,void t.onHandleUpdate(this,e)}case"desync":return void t.onHandleDesync(this);default:throw new Error("unsupported")}}async get(e){if(!this.canRead)throw new Error("Handle not readable");return this._restore([await this._proxy.get(e,this._particleId)])[0]}async toList(){if(!this.canRead)throw new Error("Handle not readable");return this._restore(await this._proxy.toList())}_restore(e){return null!==e?e.map(e=>c(e,this.entityClass)):null}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),r=[this._proxy.generateID()+"key"];return this._proxy.store(t,r,this._particleId)}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this._proxy.remove(t.id,[],this._particleId)}}class h extends l{async _notify(e,t,r){switch(Object(i.assert)(this.canRead,"_notify should not be called for non-readable handles"),e){case"sync":try{await t.onHandleSync(this,this._restore(r))}catch(e){this.raiseSystemException(e,`${t.name}::onHandleSync`)}return;case"update":try{await t.onHandleUpdate(this,{data:this._restore(r.data)})}catch(e){this.raiseSystemException(e,`${t.name}::onHandleUpdate`)}return;case"desync":try{await t.onHandleDesync(this)}catch(e){this.raiseSystemException(e,`${t.name}::onHandleDesync`)}return;default:throw new Error("unsupported")}}async get(){if(!this.canRead)throw new Error("Handle not readable");const e=await this._proxy.get();return this._restore(e)}_restore(e){return null===e?null:this.type instanceof o.EntityType?c(e,this.entityClass):this.type instanceof o.InterfaceType?a.ParticleSpec.fromLiteral(e):this.type instanceof o.ReferenceType?new s.Reference(e,this.type,this._proxy.pec):void Object(i.assert)(!1,`Don't know how to deliver handle data of type ${this.type}`)}async set(e){try{if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.set(this._serialize(e),this._particleId)}catch(e){throw this.raiseSystemException(e,"Handle::set"),e}}async clear(){if(!this.canWrite)throw new Error("Handle not writeable");return this._proxy.clear(this._particleId)}}class d{constructor(e,t){this._parent=e,this._cursorId=t}async next(){const e=await this._parent._proxy.cursorNext(this._cursorId);return e.done||(e.value=e.value.map(e=>c(e,this._parent.entityClass))),e}close(){this._parent._proxy.cursorClose(this._cursorId)}}class p extends l{configure(e){throw new Error("BigCollections do not support sync/update configuration")}async _notify(e,t,r){Object(i.assert)(this.canRead,"_notify should not be called for non-readable handles"),Object(i.assert)("sync"===e,"BigCollection._notify only supports sync events"),await t.onHandleSync(this,[])}async store(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e),r=[this._proxy.generateID()+"key"];return this._proxy.store(t,r,this._particleId)}async remove(e){if(!this.canWrite)throw new Error("Handle not writeable");const t=this._serialize(e);return this._proxy.remove(t.id,this._particleId)}async stream({pageSize:e,forward:t=!0}){if(!this.canRead)throw new Error("Handle not readable");if(isNaN(e)||e<1)throw new Error("Streamed reads require a positive pageSize");const r=await this._proxy.stream(e,t);return new d(this,r)}}function m(e,t=null,r=0,s=!0,n=!0){let i;i=e.type instanceof o.CollectionType?new u(e,t,r,s,n):e.type instanceof o.BigCollectionType?new p(e,t,r,s,n):new h(e,t,r,s,n);const a=e.type.getContainedType()||e.type;return a instanceof o.EntityType&&(i.entityClass=a.entitySchema.entityClass(e.pec)),i}},"./runtime/ts-build/loader.js":
/*!************************************!*\
  !*** ./runtime/ts-build/loader.js ***!
  \************************************/
/*! exports provided: Loader */function(e,t,r){"use strict";r.r(t),r.d(t,"Loader",function(){return m});var s=r(/*! ../../platform/fs-web.js */"./platform/fs-web.js"),n=r(/*! ../../platform/vm-web.js */"./platform/vm-web.js"),i=r(/*! ../fetch-web.js */"./runtime/fetch-web.js"),a=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),o=r(/*! ./particle.js */"./runtime/ts-build/particle.js"),c=r(/*! ../dom-particle.js */"./runtime/dom-particle.js"),l=r(/*! ../multiplexer-dom-particle.js */"./runtime/multiplexer-dom-particle.js"),u=r(/*! ./reference.js */"./runtime/ts-build/reference.js"),h=r(/*! ../transformation-dom-particle.js */"./runtime/transformation-dom-particle.js"),d=r(/*! ./converters/jsonldToManifest.js */"./runtime/ts-build/converters/jsonldToManifest.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const p=(e,...t)=>(e[0]+t.map((t,r)=>t+e[r+1]).join("")).trim();class m{path(e){return e.replace(/[/][^/]+$/,"/")}join(e,t){return/^https?:\/\//.test(t)?t:"/"===t[0]||":"===t[1]?t:(e=this.path(e),t=this.normalizeDots(`${e}${t}`))}normalizeDots(e){const t=e=>e.replace(/(?:^|\/)[^./]*\/\.\./g,"");for(let r=t(e=(e=e.replace(/\\/g,"/")).replace(/\/\.\//g,"/"));r!==e;r=t(e=r));return e}loadResource(e){return/^https?:\/\//.test(e)?this._loadURL(e):this._loadFile(e)}_loadFile(e){return new Promise((t,r)=>{s.fs.readFile(e,(e,s)=>{e?r(e):t(s.toString("utf-8"))})})}_loadURL(e){return/\/\/schema.org\//.test(e)?e.endsWith("/Thing")?Object(i.fetch)("https://schema.org/Product.jsonld").then(e=>e.text()).then(e=>d.JsonldToManifest.convert(e,{"@id":"schema:Thing"})):Object(i.fetch)(e+".jsonld").then(e=>e.text()).then(e=>d.JsonldToManifest.convert(e)):Object(i.fetch)(e).then(e=>e.text())}async loadParticleClass(e){const t=await this.requireParticle(e.implFile);return t.spec=e,t}async requireParticle(e){null===e&&(e="");const t=await this.loadResource(e),r=new n.vm.Script(t,{filename:e,displayErrors:!0}),s=[],o={defineParticle(e){s.push(e)},console:console,fetch:i.fetch,setTimeout:setTimeout,importScripts:e=>null};return r.runInNewContext(o,{filename:e,displayErrors:!0}),Object(a.assert)(s.length>0&&"function"==typeof s[0],`Error while instantiating particle implementation from ${e}`),this.unwrapParticle(s[0])}setParticleExecutionContext(e){this.pec=e}unwrapParticle(e){return Object(a.assert)(this.pec),e({Particle:o.Particle,DomParticle:c.DomParticle,TransformationDomParticle:h.TransformationDomParticle,MultiplexerDomParticle:l.MultiplexerDomParticle,Reference:u.Reference.newClientReference(this.pec),html:p})}}},"./runtime/ts-build/particle-execution-context.js":
/*!********************************************************!*\
  !*** ./runtime/ts-build/particle-execution-context.js ***!
  \********************************************************/
/*! exports provided: ParticleExecutionContext */function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"ParticleExecutionContext",function(){return o});var s=r(/*! ./handle.js */"./runtime/ts-build/handle.js"),n=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),i=r(/*! ../api-channel.js */"./runtime/api-channel.js"),a=r(/*! ./storage-proxy.js */"./runtime/ts-build/storage-proxy.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(t,r,s){this.particles=[],this._nextLocalID=0,this.pendingLoads=[],this.scheduler=new a.StorageProxyScheduler,this.keyedProxies={},this.apiPort=new i.PECInnerPort(t),this.idBase=r,this.loader=s,s.setParticleExecutionContext(this),this.apiPort.onDefineHandle=(({type:e,identifier:t,name:r})=>a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r)),this.apiPort.onGetBackingStoreCallback=(({type:e,id:t,name:r,callback:s,storageKey:n})=>{const i=a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r);return i.storageKey=n,[i,()=>s(i,n)]}),this.apiPort.onCreateHandleCallback=(({type:e,id:t,name:r,callback:s})=>{const n=a.StorageProxy.newProxy(t,e,this.apiPort,this,this.scheduler,r);return[n,()=>s(n)]}),this.apiPort.onMapHandleCallback=(({id:e,callback:t})=>[e,()=>t(e)]),this.apiPort.onCreateSlotCallback=(({hostedSlotId:e,callback:t})=>[e,()=>t(e)]),this.apiPort.onInnerArcRender=(({transformationParticle:e,transformationSlotName:t,hostedSlotId:r,content:s})=>{e.renderHostedSlot(t,r,s)}),this.apiPort.onStop=(()=>{e.close&&e.close()}),this.apiPort.onInstantiateParticle=(({id:e,spec:t,handles:r})=>this._instantiateParticle(e,t,r)),this.apiPort.onSimpleCallback=(({callback:e,data:t})=>e(t)),this.apiPort.onConstructArcCallback=(({callback:e,arc:t})=>e(t)),this.apiPort.onAwaitIdle=(({version:e})=>this.idle.then(t=>{setTimeout(()=>{this.apiPort.Idle({version:e,relevance:this.relevance})},0)})),this.apiPort.onUIEvent=(({particle:e,slotName:t,event:r})=>e.fireEvent(t,r)),this.apiPort.onStartRender=(({particle:e,slotName:t,providedSlots:r,contentTypes:s})=>{e._slotByName.set(t,new class{constructor(e,t,r,s){this.handlers=new Map,this.requestedContentTypes=new Set,this._isRendered=!1,this.slotName=r,this.particle=t,this.pec=e,this.providedSlots=s}get isRendered(){return this._isRendered}render(r){r.template&&this.providedSlots.size>0&&("string"==typeof(r=Object.assign({},r)).template?r.template=this.substituteSlotNamesForIds(r.template):r.template=Object.entries(r.template).reduce((e,[t,r])=>(e[t]=this.substituteSlotNamesForIds(r),e),{})),this.pec.apiPort.Render({particle:e,slotName:t,content:r}),Object.keys(r).forEach(e=>{this.requestedContentTypes.delete(e)}),this._isRendered=0===this.requestedContentTypes.size&&Object.keys(r).length>0}substituteSlotNamesForIds(e){return this.providedSlots.forEach((t,r)=>{e=e.replace(new RegExp(`slotid="${r}"`,"gi"),`slotid="${t}"`)}),e}registerEventHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}clearEventHandlers(e){this.handlers.set(e,[])}fireEvent(e){for(const t of this.handlers.get(e.handler)||[])t(e)}}(this,e,t,r)),e.renderSlot(t,s)}),this.apiPort.onStopRender=(({particle:e,slotName:t})=>{Object(n.assert)(e._slotByName.has(t),`Stop render called for particle ${e.name} slot ${t} without start render being called.`),e._slotByName.delete(t)})}generateIDComponents(){return{base:this.idBase,component:()=>this._nextLocalID++}}generateID(){return`${this.idBase}:${this._nextLocalID++}`}innerArcHandle(e,t){const r=this;return{createHandle:(n,i,a)=>new Promise((o,c)=>r.apiPort.ArcCreateHandle({arc:e,type:n,name:i,callback:e=>{const r=Object(s.handleFor)(e,i,t);o(r),a&&e.register(a,r)}})),mapHandle:t=>new Promise((s,n)=>r.apiPort.ArcMapHandle({arc:e,handle:t,callback:e=>{s(e)}})),createSlot:(t,s,n,i,a)=>new Promise((o,c)=>r.apiPort.ArcCreateSlot({arc:e,transformationParticle:t,transformationSlotName:s,hostedParticleName:n,hostedSlotName:i,handleId:a,callback:e=>{o(e)}})),loadRecipe:t=>new Promise((s,n)=>r.apiPort.ArcLoadRecipe({arc:e,recipe:t,callback:e=>{void 0==e?s():n(e)}}))}}getStorageProxy(e,t){return this.keyedProxies[e]||(this.keyedProxies[e]=new Promise((r,s)=>{this.apiPort.GetBackingStore({storageKey:e,type:t,callback:(e,t)=>{this.keyedProxies[t]=e,r(e)}})})),this.keyedProxies[e]}defaultCapabilitySet(){return{constructInnerArc:e=>new Promise((t,r)=>this.apiPort.ConstructInnerArc({callback:r=>{t(this.innerArcHandle(r,e.id))},particle:e}))}}async _instantiateParticle(e,t,r){t.name;let n=null;const i=new Promise(e=>n=e);this.pendingLoads.push(i);const a=await this.loader.loadParticleClass(t),o=this.defaultCapabilitySet(),c=new a;c.id=e,c.capabilities=o,this.particles.push(c);const l=new Map,u=[];return r.forEach((r,n)=>{const i=t.connectionMap.get(n),a=Object(s.handleFor)(r,n,e,i.isInput,i.isOutput);l.set(n,a),u.push({proxy:r,particle:c,handle:a})}),[c,async()=>{await c.setHandles(l),u.forEach(({proxy:e,particle:t,handle:r})=>e.register(t,r));const e=this.pendingLoads.indexOf(i);this.pendingLoads.splice(e,1),n()}]}get relevance(){const e=new Map;return this.particles.forEach(t=>{0!==t.relevances.length&&(e.set(t,t.relevances),t.relevances=[])}),e}get busy(){return!!(this.pendingLoads.length>0||this.scheduler.busy)||this.particles.filter(e=>e.busy).length>0}get idle(){if(!this.busy)return Promise.resolve();const e=this.particles.filter(e=>e.busy).map(e=>e.idle);return Promise.all([this.scheduler.idle,...this.pendingLoads,...e]).then(()=>this.idle)}}}.call(this,r(/*! ./../../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./runtime/ts-build/particle-spec.js":
/*!*******************************************!*\
  !*** ./runtime/ts-build/particle-spec.js ***!
  \*******************************************/
/*! exports provided: ConnectionSpec, SlotSpec, ProvidedSlotSpec, ParticleSpec */function(e,t,r){"use strict";r.r(t),r.d(t,"ConnectionSpec",function(){return o}),r.d(t,"SlotSpec",function(){return c}),r.d(t,"ProvidedSlotSpec",function(){return l}),r.d(t,"ParticleSpec",function(){return u});var s=r(/*! ./type.js */"./runtime/ts-build/type.js"),n=r(/*! ./recipe/type-checker.js */"./runtime/ts-build/recipe/type-checker.js"),i=r(/*! ./shape.js */"./runtime/ts-build/shape.js"),a=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class o{constructor(e,t){this.parentConnection=null,this.rawData=e,this.direction=e.direction,this.name=e.name,this.type=e.type.mergeTypeVariablesByName(t),this.isOptional=e.isOptional,this.tags=e.tags||[],this.dependentConnections=[]}instantiateDependentConnections(e,t){for(const r of this.rawData.dependentConnections){const s=e.createConnection(r,t);s.parentConnection=this,this.dependentConnections.push(s)}}get isInput(){return"in"===this.direction||"inout"===this.direction||"host"===this.direction}get isOutput(){return"out"===this.direction||"inout"===this.direction}isCompatibleType(e){return n.TypeChecker.compareTypes({type:e},{type:this.type,direction:this.direction})}}class c{constructor(e){this.name=e.name,this.isRequired=e.isRequired,this.isSet=e.isSet,this.tags=e.tags||[],this.formFactor=e.formFactor,this.providedSlots=[],e.providedSlots&&e.providedSlots.forEach(e=>{this.providedSlots.push(new l(e))})}getProvidedSlotSpec(e){return this.providedSlots.find(t=>t.name===e)}}class l{constructor(e){this.name=e.name,this.isRequired=e.isRequired||!1,this.isSet=e.isSet||!1,this.tags=e.tags||[],this.formFactor=e.formFactor,this.handles=e.handles||[]}}class u{constructor(e){this.model=e,this.name=e.name,this.verbs=e.verbs;const t=new Map;this.connections=[],e.args.forEach(e=>this.createConnection(e,t)),this.connectionMap=new Map,this.connections.forEach(e=>this.connectionMap.set(e.name,e)),this.inputs=this.connections.filter(e=>e.isInput),this.outputs=this.connections.filter(e=>e.isOutput),e.description=e.description||{},this.validateDescription(e.description),this.pattern=e.description.pattern,this.connections.forEach(t=>{t.pattern=e.description[t.name]}),this.implFile=e.implFile,this.modality=e.modality,this.slots=new Map,e.slots&&e.slots.forEach(e=>this.slots.set(e.name,new c(e))),this.slots.forEach(e=>{e.providedSlots.forEach(e=>{e.handles.forEach(e=>Object(a.assert)(this.connectionMap.has(e),"Cannot provide slot for nonexistent handle constraint ",e))})})}createConnection(e,t){const r=new o(e,t);return this.connections.push(r),r.instantiateDependentConnections(this,t),r}isInput(e){for(const t of this.inputs)if(t.name===e)return!0;return!1}isOutput(e){for(const t of this.outputs)if(t.name===e)return!0;return!1}getSlotSpec(e){return this.slots.get(e)}get primaryVerb(){return this.verbs.length>0?this.verbs[0]:void 0}matchModality(e){return this.slots.size<=0||this.modality.includes(e)}toLiteral(){const{args:e,name:t,verbs:r,description:s,implFile:n,modality:i,slots:a}=this.model,o=({type:e,direction:t,name:r,isOptional:s,dependentConnections:n})=>({type:e.toLiteral(),direction:t,name:r,isOptional:s,dependentConnections:n.map(o)});return{args:e.map(e=>o(e)),name:t,verbs:r,description:s,implFile:n,modality:i,slots:a}}static fromLiteral(e){let{args:t,name:r,verbs:n,description:i,implFile:a,modality:o,slots:c}=e;const l=({type:e,direction:t,name:r,isOptional:n,dependentConnections:i})=>({type:s.Type.fromLiteral(e),direction:t,name:r,isOptional:n,dependentConnections:i?i.map(l):[]});return t=t.map(l),new u({args:t,name:r,verbs:n||[],description:i,implFile:a,modality:o,slots:c})}clone(){return u.fromLiteral(this.toLiteral())}equals(e){return JSON.stringify(this.toLiteral())===JSON.stringify(e.toLiteral())}validateDescription(e){Object.keys(e||[]).forEach(e=>{Object(a.assert)(["kind","location","pattern"].includes(e)||this.connectionMap.has(e),`Unexpected description for ${e}`)})}toInterface(){return s.Type.newInterface(this._toShape())}_toShape(){const e=this.model.args;Object(a.assert)(!this.slots.size,"please implement slots toShape");return new i.Shape(this.name,e,[])}toString(){const e=[];let t="";this.verbs.length>0&&(t=" "+this.verbs.map(e=>`&${e}`).join(" ")),e.push(`particle ${this.name}${t} in '${this.implFile}'`.trim());const r=(t,s)=>{const n=t.tags.map(e=>` #${e}`).join("");e.push(`${s}${t.direction}${t.isOptional?"?":""} ${t.type.toString()} ${t.name}${n}`);for(const e of t.dependentConnections)r(e,s+"  ")};for(const e of this.connections)e.parentConnection||r(e,"  ");return this.modality.filter(e=>"mock"!==e).forEach(t=>e.push(`  modality ${t}`)),this.slots.forEach(t=>{const r=[];t.isRequired&&r.push("must"),r.push("consume"),t.isSet&&r.push("set of"),r.push(t.name),t.tags.length>0&&r.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`  ${r.join(" ")}`),t.formFactor&&e.push(`    formFactor ${t.formFactor}`),t.providedSlots.forEach(t=>{const r=[];t.isRequired&&r.push("must"),r.push("provide"),t.isSet&&r.push("set of"),r.push(t.name),t.tags.length>0&&r.push(t.tags.map(e=>`#${e}`).join(" ")),e.push(`    ${r.join(" ")}`),t.formFactor&&e.push(`      formFactor ${t.formFactor}`),t.handles.forEach(t=>e.push(`      handle ${t}`))})}),this.pattern&&(e.push(`  description \`${this.pattern}\``),this.connections.forEach(t=>{t.pattern&&e.push(`    ${t.name} \`${t.pattern}\``)})),e.join("\n")}toManifestString(){return this.toString()}}},"./runtime/ts-build/particle.js":
/*!**************************************!*\
  !*** ./runtime/ts-build/particle.js ***!
  \**************************************/
/*! exports provided: Particle */function(e,t,r){"use strict";r.r(t),r.d(t,"Particle",function(){return s});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class s{constructor(e){this.relevances=[],this._idle=Promise.resolve(),this._busy=0,this._slotByName=new Map,this.spec=this.constructor.spec,0===this.spec.inputs.length&&(this.extraData=!0),this.capabilities=e||{}}setHandles(e){}setViews(e){}onHandleSync(e,t){}onHandleUpdate(e,t){}onHandleDesync(e){}constructInnerArc(){if(!this.capabilities.constructInnerArc)throw new Error("This particle is not allowed to construct inner arcs");return this.capabilities.constructInnerArc(this)}get busy(){return this._busy>0}get idle(){return this._idle}set relevance(e){this.relevances.push(e)}startBusy(){0===this._busy&&(this._idle=new Promise(e=>this._idleResolver=e)),this._busy++}doneBusy(){this._busy--,0===this._busy&&this._idleResolver()}inputs(){return this.spec.inputs}outputs(){return this.spec.outputs}getSlot(e){return this._slotByName.get(e)}static buildManifest(e,...t){const r=[];for(let s=0;s<t.length;s++){const n=e[s],i=/ *$/.exec(n)[0];let a;a=(a="string"==typeof t[s]?t[s]:t[s].toManifestString()).replace(/(\n)/g,"$1"+i),r.push(n),r.push(a)}return e.length>t.length&&r.push(e[e.length-1]),r.join("")}setParticleDescription(e){return this.setDescriptionPattern("pattern",e)}setDescriptionPattern(e,t){const r=this.handles.get("descriptions");if(r){const s=r.entityClass;return r.store(new s({key:e,value:t},this.spec.name+"-"+e)),!0}throw new Error("A particle needs a description handle to set a decription pattern")}}},"./runtime/ts-build/recipe/type-checker.js":
/*!*************************************************!*\
  !*** ./runtime/ts-build/recipe/type-checker.js ***!
  \*************************************************/
/*! exports provided: TypeChecker */function(e,t,r){"use strict";r.r(t),r.d(t,"TypeChecker",function(){return i});var s=r(/*! ../type.js */"./runtime/ts-build/type.js"),n=r(/*! ../type-variable.js */"./runtime/ts-build/type-variable.js");class i{static processTypeList(e,t){const r=new n.TypeVariable("",null,null);e&&(r.resolution=e),e=s.Type.newVariable(r);const a=[];for(const r of t)if(r.type.resolvedType().hasVariable){if(null==(e=i._tryMergeTypeVariable(e,r.type)))return null}else a.push(r);for(const t of a)if(!i._tryMergeConstraints(e,t))return null;const o=e=>e instanceof s.VariableType?null==e.canReadSubset||null==e.canWriteSuperset?e:e.canReadSubset.isMoreSpecificThan(e.canWriteSuperset)?(e.canWriteSuperset.isMoreSpecificThan(e.canReadSubset)&&(e.variable.resolution=e.canReadSubset),e):null:e,c=e.resolvedType();if(c instanceof s.CollectionType){const e=o(c.collectionType);return null!==e?e.collectionOf():null}if(c instanceof s.BigCollectionType){const e=o(c.bigCollectionType);return null!==e?e.bigCollectionOf():null}return o(c)}static _tryMergeTypeVariable(e,t){const[r,n]=s.Type.unwrapPair(e.resolvedType(),t.resolvedType());if(r instanceof s.VariableType){if(n instanceof s.VariableType){if(!1===r.variable.maybeMergeConstraints(n.variable))return null;n.variable.resolution=r}else r.variable.resolution=n;return e}if(n instanceof s.VariableType)return n.variable.resolution=r,t;if(r instanceof s.InterfaceType&&n instanceof s.InterfaceType){const e=r.interfaceShape.tryMergeTypeVariablesWith(n.interfaceShape);return null==e?null:s.Type.newInterface(e)}if(r.isTypeContainer()&&r.hasVariable||n.isTypeContainer()&&n.hasVariable)return null;throw new Error("tryMergeTypeVariable shouldn't be called on two types without any type variables")}static _tryMergeConstraints(e,{type:t,direction:r}){let[a,o]=s.Type.unwrapPair(e.resolvedType(),t.resolvedType());if(a instanceof s.VariableType){for(;o.isTypeContainer();){if(null!=a.variable.resolution||null!=a.variable.canReadSubset||null!=a.variable.canWriteSuperset)return!1;const e=s.Type.newVariable(new n.TypeVariable("a",null,null));o instanceof s.CollectionType?a.variable.resolution=s.Type.newCollection(e):o instanceof s.BigCollectionType?a.variable.resolution=s.Type.newBigCollection(e):a.variable.resolution=s.Type.newReference(e);const t=s.Type.unwrapPair(a.resolvedType(),o);[a,o]=t}if(("out"===r||"inout"===r||"`provide"===r)&&!a.variable.maybeMergeCanReadSubset(o.canWriteSuperset))return!1;if(("in"===r||"inout"===r||"`consume"===r)&&!a.variable.maybeMergeCanWriteSuperset(o.canReadSubset))return!1}else{if(o.tag!==a.tag)return!1;if(("out"===r||"inout"===r)&&!i._writeConstraintsApply(a,o))return!1;if(("in"===r||"inout"===r)&&!i._readConstraintsApply(a,o))return!1}return!0}static _writeConstraintsApply(e,t){const r=t.canWriteSuperset;return null==r||null==e.canReadSubset||!!r.isMoreSpecificThan(e.canReadSubset)}static _readConstraintsApply(e,t){const r=t.canReadSubset;return null==r||null==e.canWriteSuperset||!!e.canWriteSuperset.isMoreSpecificThan(r)}static compareTypes(e,t){const r=e.type.resolvedType(),n=t.type.resolvedType(),[i,a]=s.Type.unwrapPair(r,n);if(i instanceof s.VariableType&&a.isTypeContainer())return!(i.variable.canReadSubset||i.variable.canWriteSuperset);if(a instanceof s.VariableType&&i.isTypeContainer())return!(a.variable.canReadSubset||a.variable.canWriteSuperset);if(i instanceof s.VariableType||a instanceof s.VariableType)return s.Type.canMergeConstraints(i,a);if(void 0===i!=(void 0===a))return!1;if(i===a)return!0;if(i.tag!==a.tag)return!1;if(i instanceof s.SlotType)return!0;if(i instanceof s.InterfaceType&&a instanceof s.InterfaceType&&i.interfaceShape.equals(a.interfaceShape))return!0;if(!(i instanceof s.EntityType&&a instanceof s.EntityType))return!1;const o=i.entitySchema.isMoreSpecificThan(a.entitySchema),c=a.entitySchema.isMoreSpecificThan(i.entitySchema);if(c&&o)return!0;if(!c&&!o)return!1;const[l,u]=c?[e,t]:[t,e],h=l.direction||(l.connection?l.connection.direction:"inout"),d=u.direction||(u.connection?u.connection.direction:"inout");return"in"===h||"out"===d}}},"./runtime/ts-build/reference.js":
/*!***************************************!*\
  !*** ./runtime/ts-build/reference.js ***!
  \***************************************/
/*! exports provided: Reference */function(e,t,r){"use strict";r.r(t),r.d(t,"Reference",function(){return o});var s,n=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),i=r(/*! ./type.js */"./runtime/ts-build/type.js"),a=r(/*! ./handle.js */"./runtime/ts-build/handle.js");!function(e){e[e.Unstored=0]="Unstored",e[e.Stored=1]="Stored"}(s||(s={}));class o{constructor(e,t,r){this.entity=null,this.storageProxy=null,this.handle=null,this.id=e.id,this.storageKey=e.storageKey,this.context=r,this.type=t}async ensureStorageProxy(){null==this.storageProxy&&(this.storageProxy=await this.context.getStorageProxy(this.storageKey,this.type.referredType),this.handle=Object(a.handleFor)(this.storageProxy),this.storageKey?Object(n.assert)(this.storageKey===this.storageProxy.storageKey):this.storageKey=this.storageProxy.storageKey)}async dereference(){return Object(n.assert)(this.context,"Must have context to dereference"),this.entity?this.entity:(await this.ensureStorageProxy(),this.entity=await this.handle.get(this.id),this.entity)}dataClone(){return{storageKey:this.storageKey,id:this.id}}static newClientReference(e){return class extends o{constructor(t){super({id:t.id,storageKey:null},new i.ReferenceType(t.constructor.type),e),this.mode=s.Unstored,this.entity=t,this.stored=new Promise(async(e,r)=>{await this.storeReference(t),e()})}async storeReference(e){await this.ensureStorageProxy(),await this.handle.store(e),this.mode=s.Stored}async dereference(){return this.mode===s.Unstored?null:super.dereference()}isIdentified(){return this.entity.isIdentified()}}}}},"./runtime/ts-build/schema.js":
/*!************************************!*\
  !*** ./runtime/ts-build/schema.js ***!
  \************************************/
/*! exports provided: Schema */function(e,t,r){"use strict";r.r(t),r.d(t,"Schema",function(){return c});var s=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./type.js */"./runtime/ts-build/type.js"),i=r(/*! ./recipe/type-checker.js */"./runtime/ts-build/recipe/type-checker.js"),a=r(/*! ./entity.js */"./runtime/ts-build/entity.js"),o=r(/*! ./reference.js */"./runtime/ts-build/reference.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class c{constructor(e){Object(s.assert)(e.fields),this._model=e,this.description={},e.description&&e.description.description.forEach(e=>this.description[e.name]=e.pattern||e.patterns[0])}toLiteral(){const e={},t=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:t.model.toLiteral()}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:t(e.schema)}:e};for(const r of Object.keys(this._model.fields))e[r]=t(this._model.fields[r]);return{names:this._model.names,fields:e,description:this.description}}static fromLiteral(e={fields:{},names:[],description:{}}){const t={},r=e=>{if("schema-reference"===e.kind){const t=e.schema;return{kind:"schema-reference",schema:{kind:t.kind,model:n.Type.fromLiteral(t.model)}}}return"schema-collection"===e.kind?{kind:"schema-collection",schema:r(e.schema)}:e};for(const s of Object.keys(e.fields))t[s]=r(e.fields[s]);const s=new c({names:e.names,fields:t});return s.description=e.description||{},s}get fields(){return this._model.fields}get names(){return this._model.names}get name(){return this.names[0]}static typesEqual(e,t){return c._typeString(e)===c._typeString(t)}static _typeString(e){if("object"!=typeof e)return Object(s.assert)("string"==typeof e),e;switch(e.kind){case"schema-union":return`(${e.types.join(" or ")})`;case"schema-tuple":return`(${e.types.join(", ")})`;case"schema-reference":return`Reference<${c._typeString(e.schema)}>`;case"type-name":case"schema-inline":return e.model.entitySchema.toInlineSchemaString();case"schema-collection":return`[${c._typeString(e.schema)}]`;default:throw new Error(`Unknown type kind ${e.kind} in schema ${this.name}`)}}static union(e,t){const r=[...new Set([...e.names,...t.names])],s={};for(const[r,n]of[...Object.entries(e.fields),...Object.entries(t.fields)])if(s[r]){if(!c.typesEqual(s[r],n))return null}else s[r]=n;return new c({names:r,fields:s})}static intersect(e,t){const r=[...e.names].filter(e=>t.names.includes(e)),s={};for(const[r,n]of Object.entries(e.fields)){const e=t.fields[r];e&&c.typesEqual(n,e)&&(s[r]=n)}return new c({names:r,fields:s})}equals(e){return this===e||this.name===e.name&&this.isMoreSpecificThan(e)&&e.isMoreSpecificThan(this)}isMoreSpecificThan(e){const t=new Set(this.names);for(const r of e.names)if(!t.has(r))return!1;const r={};for(const[e,t]of Object.entries(this.fields))r[e]=t;for(const[t,s]of Object.entries(e.fields)){if(void 0==r[t])return!1;if(!c.typesEqual(r[t],s))return!1}return!0}get type(){return n.Type.newEntity(this)}entityClass(e=null){const t=this,r=this.name,c=["toJSON","prototype","toString","inspect"],l=e=>{switch(e){case"Text":case"URL":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Object":return"object";default:throw new Error(`Unknown field type ${e} in schema ${r}`)}},u=this.fields,h=(e,t,r)=>d(e,t,u[t],r),d=(e,t,s,a)=>{if(void 0===s)throw new Error(`Can't ${e} field ${t}; not in schema ${r}`);if(void 0!==a&&null!==a)if("object"==typeof s)switch(s.kind){case"schema-union":for(const e of s.types)if(typeof a===l(e))return;throw new TypeError(`Type mismatch ${e}ting field ${t} (union [${s.types}]); `+`value '${a}' is type ${typeof a}`);case"schema-tuple":if(!Array.isArray(a))throw new TypeError(`Cannot ${e} tuple ${t} with non-array value '${a}'`);if(a.length!==s.types.length)throw new TypeError(`Length mismatch ${e}ting tuple ${t} `+`[${s.types}] with value '${a}'`);s.types.map((r,n)=>{if(void 0!==a[n]&&null!==a[n]&&typeof a[n]!==l(r))throw new TypeError(`Type mismatch ${e}ting field ${t} (tuple [${s.types}]); `+`value '${a}' has type ${typeof a[n]} at index ${n}`)});break;case"schema-reference":if(!(a instanceof o.Reference))throw new TypeError(`Cannot ${e} reference ${t} with non-reference '${a}'`);if(!i.TypeChecker.compareTypes({type:a.type},{type:n.Type.newReference(s.schema.model)}))throw new TypeError(`Cannot ${e} reference ${t} with value '${a}' of mismatched type`);break;case"schema-collection":if("Set"!==a.constructor.name)throw new TypeError(`Cannot ${e} collection ${t} with non-Set '${a}'`);for(const r of a)d(e,t,s.schema,r);break;default:throw new Error(`Unknown kind ${s.kind} in schema ${r}`)}else if(typeof a!==l(s))throw new TypeError(`Type mismatch ${e}ting field ${t} (type ${s}); `+`value '${a}' is type ${typeof a}`)},p=class extends a.Entity{constructor(e,t){super(t),this.rawData=new Proxy({},{get:(e,t)=>{if(c.includes(t)||t.constructor===Symbol)return;const r=e[t];return h("get",t,r),r},set:(e,t,r)=>(h("set",t,r),e[t]=r,!0)}),Object(s.assert)(e,"can't construct entity with null data");const r=this.sanitizeData(e);for(const[e,t]of Object.entries(r))this.rawData[e]=t}sanitizeData(e){const t={};for(const[r,s]of Object.entries(e))t[r]=this.sanitizeEntry(u[r],s,r);return t}sanitizeEntry(t,r,s){if(!t)return r;if("schema-reference"===t.kind&&r){if(r instanceof o.Reference)return r;if(r.id&&r.storageKey)return new o.Reference(r,n.Type.newReference(t.schema.model),e);throw new TypeError(`Cannot set reference ${s} with non-reference '${r}'`)}if("schema-collection"===t.kind&&r){if("Set"===r.constructor.name)return r;if(r.length&&r instanceof Object)return new Set(r.map(e=>this.sanitizeEntry(t.schema,e,s)));throw new TypeError(`Cannot set collection ${s} with non-collection '${r}'`)}return r}dataClone(){const e={};for(const r of Object.keys(t.fields))void 0!==this.rawData[r]&&(u[r]&&"schema-reference"===u[r].kind?e[r]=this.rawData[r].dataClone():u[r]&&"schema-collection"===u[r].kind?e[r]=[...this.rawData[r]].map(e=>e.dataClone()):e[r]=this.rawData[r]);return e}static get type(){return n.Type.newEntity(this.key.schema)}static get key(){return{tag:"entity",schema:t}}};Object.defineProperty(p,"type",{value:this.type}),Object.defineProperty(p,"name",{value:this.name});for(const e of Object.keys(this.fields))Object.defineProperty(p.prototype,e,{get(){return this.rawData[e]},set(t){this.rawData[e]=t}});return p}toInlineSchemaString(e){const t=this.names.join(" ")||"*",r=Object.entries(this.fields).map(([e,t])=>`${c._typeString(t)} ${e}`).join(", ");return`${t} {${r.length>0&&e&&e.hideFields?"...":r}}`}toManifestString(){const e=[];if(e.push(`schema ${this.names.join(" ")}`),e.push(...Object.entries(this.fields).map(([e,t])=>`  ${c._typeString(t)} ${e}`)),Object.keys(this.description).length>0){e.push(`  description \`${this.description.pattern}\``);for(const t of Object.keys(this.description))"pattern"!==t&&e.push(`    ${t} \`${this.description[t]}\``)}return e.join("\n")}}},"./runtime/ts-build/shape.js":
/*!***********************************!*\
  !*** ./runtime/ts-build/shape.js ***!
  \***********************************/
/*! exports provided: Shape */function(e,t,r){"use strict";r.r(t),r.d(t,"Shape",function(){return u});var s=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),n=r(/*! ./type.js */"./runtime/ts-build/type.js"),i=r(/*! ./recipe/type-checker.js */"./runtime/ts-build/recipe/type-checker.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function a(e){return e&&"object"==typeof e?n.Type.fromLiteral(e):e}function o(e){return e&&e.toLiteral?e.toLiteral():e}const c=["type","name","direction"],l=["name","direction","isRequired","isSet"];class u{constructor(e,t,r){Object(s.assert)(e),Object(s.assert)(void 0!==t),Object(s.assert)(void 0!==r),this.name=e,this.handles=t,this.slots=r,this.typeVars=[];for(const e of t)for(const t of c)u.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t});for(const e of r)for(const t of l)u.isTypeVar(e[t])&&this.typeVars.push({object:e,field:t})}toPrettyString(){return"SHAAAAPE"}mergeTypeVariablesByName(e){this.typeVars.map(({object:t,field:r})=>t[r]=t[r].mergeTypeVariablesByName(e))}get canReadSubset(){return this._cloneAndUpdate(e=>e.canReadSubset)}get canWriteSuperset(){return this._cloneAndUpdate(e=>e.canWriteSuperset)}isMoreSpecificThan(e){if(this.handles.length!==e.handles.length||this.slots.length!==e.slots.length)return!1;for(let t=0;t<this.typeVars.length;t++){const r=this.typeVars[t],s=e.typeVars[t];if(!r.object[r.field].isMoreSpecificThan(s.object[s.field]))return!1}return!0}_applyExistenceTypeTest(e){for(const t of this.typeVars)if(e(t.object[t.field]))return!0;return!1}_handlesToManifestString(){return this.handles.map(e=>{const t=e.type.resolvedType();return`  ${e.direction?e.direction+" ":""}${t.toString()} ${e.name?e.name:"*"}`}).join("\n")}_slotsToManifestString(){return this.slots.map(e=>`  ${e.direction} ${e.isSet?"set of ":""}${e.name?e.name+" ":""}`).join("\n")}toString(){return`shape ${this.name}\n${this._handlesToManifestString()}\n${this._slotsToManifestString()}\n`}static fromLiteral(e){const t=e.handles.map(e=>({type:a(e.type),name:a(e.name),direction:a(e.direction)})),r=e.slots.map(e=>({name:a(e.name),direction:a(e.direction),isRequired:a(e.isRequired),isSet:a(e.isSet)}));return new u(e.name,t,r)}toLiteral(){const e=this.handles.map(e=>({type:o(e.type),name:o(e.name),direction:o(e.direction)})),t=this.slots.map(e=>({name:o(e.name),direction:o(e.direction),isRequired:o(e.isRequired),isSet:o(e.isSet)}));return{name:this.name,handles:e,slots:t}}clone(e){const t=this.handles.map(({name:t,direction:r,type:s})=>({name:t,direction:r,type:s?s.clone(e):void 0})),r=this.slots.map(({name:e,direction:t,isRequired:r,isSet:s})=>({name:e,direction:t,isRequired:r,isSet:s}));return new u(this.name,t,r)}cloneWithResolutions(e){return this._cloneWithResolutions(e)}_cloneWithResolutions(e){const t=this.handles.map(({name:t,direction:r,type:s})=>({name:t,direction:r,type:s?s._cloneWithResolutions(e):void 0})),r=this.slots.map(({name:e,direction:t,isRequired:r,isSet:s})=>({name:e,direction:t,isRequired:r,isSet:s}));return new u(this.name,t,r)}canEnsureResolved(){for(const e of this.typeVars)if(!e.object[e.field].canEnsureResolved())return!1;return!0}maybeEnsureResolved(){for(const e of this.typeVars){let t=e.object[e.field];if(!(t=t.clone(new Map)).maybeEnsureResolved())return!1}for(const e of this.typeVars)e.object[e.field].maybeEnsureResolved();return!0}tryMergeTypeVariablesWith(e){if(!this._equalItems(e.slots,this.slots,this._equalSlot))return null;if(e.handles.length!==this.handles.length)return null;const t=new Set(this.handles),r=new Set(e.handles),s=new Map;let n=t.size;for(;t.size>0;){const e=[...t.values()].map(e=>({handle:e,match:[...r.values()].filter(t=>this._equalHandle(e,t))}));for(const n of e){if(0===n.match.length)return null;1===n.match.length&&(s.set(n.handle,n.match[0]),r.delete(n.match[0]),t.delete(n.handle))}if(t.size===n)return null;n=t.size}const a=[];for(const e of this.handles){const t=s.get(e);let r;if(e.type.hasVariable||t.type.hasVariable){if(!(r=i.TypeChecker._tryMergeTypeVariable(e.type,t.type)))return null}else r=e.type||t.type;a.push({name:e.name||t.name,direction:e.direction||t.direction,type:r})}const o=this.slots.map(({name:e,direction:t,isRequired:r,isSet:s})=>({name:e,direction:t,isRequired:r,isSet:s}));return new u(this.name,a,o)}resolvedType(){return this._cloneAndUpdate(e=>e.resolvedType())}equals(e){return this.handles.length===e.handles.length&&(!!this._equalItems(e.handles,this.handles,this._equalHandle)&&!!this._equalItems(e.slots,this.slots,this._equalSlot))}_equalHandle(e,t){return e.name===t.name&&e.direction===t.direction&&e.type.equals(t.type)}_equalSlot(e,t){return e.name===t.name&&e.direction===t.direction&&e.isRequired===t.isRequired&&e.isSet===t.isSet}_equalItems(e,t,r){for(const s of e){let e=!1;for(const n of t)if(r(n,s)){e=!0;break}if(!e)return!1}return!0}_cloneAndUpdate(e){const t=this.clone(new Map);return t.typeVars.forEach(t=>u._updateTypeVar(t,e)),t}static _updateTypeVar(e,t){e.object[e.field]=t(e.object[e.field])}static isTypeVar(e){return e instanceof n.Type&&e.hasProperty(e=>e instanceof n.VariableType)}static mustMatch(e){return!(void 0==e||u.isTypeVar(e))}static handlesMatch(e,t){if(u.mustMatch(e.name)&&e.name!==t.name)return!1;if(u.mustMatch(e.direction)&&e.direction!==t.direction)return!1;if(void 0==e.type)return!0;const[r,s]=n.Type.unwrapPair(e.type,t.type);return r instanceof n.VariableType?[{var:r,value:s,direction:e.direction}]:r.equals(s)}static slotsMatch(e,t){return(!u.mustMatch(e.name)||e.name===t.name)&&((!u.mustMatch(e.direction)||e.direction===t.direction)&&((!u.mustMatch(e.isRequired)||e.isRequired===t.isRequired)&&(!u.mustMatch(e.isSet)||e.isSet===t.isSet)))}particleMatches(e){return!1!==this.cloneWithResolutions(new Map).restrictType(e)}restrictType(e){return this._restrictThis(e)}_restrictThis(e){const t=this.handles.map(t=>e.connections.map(e=>({match:e,result:u.handlesMatch(t,e)})).filter(e=>!1!==e.result)),r=[];e.slots.forEach(e=>{r.push({name:e.name,direction:"consume",isRequired:e.isRequired,isSet:e.isSet}),e.providedSlots.forEach(e=>{r.push({name:e.name,direction:"provide",isRequired:!1,isSet:e.isSet})})});let s=this.slots.map(e=>r.filter(t=>u.slotsMatch(e,t)));s=s.map(e=>e.map(e=>({match:e,result:!0})));function a(e,t){if(0===e.length)return[];const r=e.pop();for(const s of r){if(t.includes(s.match))continue;const r=t.slice();r.push(s.match);const n=a(e,r);if(!1!==n)return s.result.length?n.concat(s.result):n}return!1}const o=a(t,[]),c=a(s,[]);if(!1===o||!1===c)return!1;for(const e of o)if(e.var.variable.resolution){if(e.var.variable.resolution instanceof n.VariableType){if(!i.TypeChecker.processTypeList(e.var,[{type:e.value,direction:e.direction}]))return!1}else if(!e.var.variable.resolution.equals(e.value))return!1}else e.var.variable.resolution=e.value;return this}}},"./runtime/ts-build/storage-proxy.js":
/*!*******************************************!*\
  !*** ./runtime/ts-build/storage-proxy.js ***!
  \*******************************************/
/*! exports provided: StorageProxy, CollectionProxy, VariableProxy, BigCollectionProxy, StorageProxyScheduler */function(e,t,r){"use strict";r.r(t),r.d(t,"StorageProxy",function(){return o}),r.d(t,"CollectionProxy",function(){return c}),r.d(t,"VariableProxy",function(){return l}),r.d(t,"BigCollectionProxy",function(){return u}),r.d(t,"StorageProxyScheduler",function(){return h});var s,n=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),i=r(/*! ./storage/crdt-collection-model.js */"./runtime/ts-build/storage/crdt-collection-model.js"),a=r(/*! ./type.js */"./runtime/ts-build/type.js");!function(e){e[e.none=0]="none",e[e.pending=1]="pending",e[e.full=2]="full"}(s||(s={}));class o{constructor(e,t,r,n,i,a){this.localIDComponent=0,this.version=void 0,this.listenerAttached=!1,this.keepSynced=!1,this.synchronized=s.none,this.observers=[],this.updates=[],this.barrier=null,this.id=e,this.type=t,this.port=r,this.scheduler=i,this.name=a,this.baseForNewID=n.generateID(),this.updates=[],this.pec=n}static newProxy(e,t,r,s,n,i){return t instanceof a.CollectionType?new c(e,t,r,s,n,i):t instanceof a.BigCollectionType?new u(e,t,r,s,n,i):new l(e,t,r,s,n,i)}raiseSystemException(e,t,r){this.port.RaiseSystemException({exception:{message:e.message,stack:e.stack,name:e.name},methodName:t,particleId:r})}register(e,t){if(t.canRead&&(this.observers.push({particle:e,handle:t}),this.listenerAttached||(this.port.InitializeProxy({handle:this,callback:e=>this._onUpdate(e)}),this.listenerAttached=!0),t.options.keepSynced&&(this.keepSynced||(this.port.SynchronizeProxy({handle:this,callback:e=>this._onSynchronize(e)}),this.keepSynced=!0),t.options.notifySync&&this.synchronized===s.full))){const r=this._getModelForSync();this.scheduler.enqueue(e,t,["sync",e,r])}}_onSynchronize({version:e,model:t}){if(void 0!==this.version&&e<=this.version)return void console.warn(`StorageProxy '${this.id}' received stale model version ${e}; `+`current is ${this.version}`);if(!this._synchronizeModel(e,t))return;for(this.synchronized=s.full;this.updates.length>0&&this.updates[0].version<=e;)this.updates.shift();const r=this._getModelForSync();this._notify("sync",r,e=>e.keepSynced&&e.notifySync),this._processUpdates()}_onUpdate(e){if(this.observers.find(({handle:e})=>!e.options.keepSynced&&e.options.notifyUpdate)){const t=this._processUpdate(e,!1);this._notify("update",t,e=>!e.keepSynced&&e.notifyUpdate)}this.keepSynced&&(e.version<=this.version?console.warn(`StorageProxy '${this.id}' received stale update version ${e.version}; `+`current is ${this.version}`):(this.updates.push(e),this.updates.sort((e,t)=>e.version-t.version),this._processUpdates()))}_notify(e,t,r=(e=>!0)){for(const{handle:s,particle:n}of this.observers)r(s.options)&&this.scheduler.enqueue(n,s,[e,n,t])}_processUpdates(){const e=e=>e.version===this.version+1||!(!this.barrier||e.barrier!==this.barrier);for(;this.updates.length>0&&e(this.updates[0]);){const e=this.updates.shift(),t=this._processUpdate(e);this.version=e.version,t&&this._notify("update",t,e=>e.keepSynced&&e.notifyUpdate)}if(this.updates.length>0){if(this.synchronized!==s.none){this.synchronized=s.none,this.port.SynchronizeProxy({handle:this,callback:e=>this._onSynchronize(e)});for(const{handle:e,particle:t}of this.observers)e.options.notifyDesync&&this.scheduler.enqueue(t,e,["desync",t])}}else this.synchronized!==s.full&&(this.synchronized=s.full)}generateID(){return`${this.baseForNewID}:${this.localIDComponent++}`}generateIDComponents(){return{base:this.baseForNewID,component:()=>this.localIDComponent++}}}class c extends o{constructor(){super(...arguments),this.model=new i.CrdtCollectionModel}_getModelForSync(){return this.model.toList()}_synchronizeModel(e,t){return this.version=e,this.model=new i.CrdtCollectionModel(t),!0}_processUpdate(e,t=!0){if(this.synchronized===s.full)for(const{handle:t}of this.observers)if(e.originatorId===t._particleId)return null;const r=[],n=[];if("add"in e)for(const{value:s,keys:n,effective:i}of e.add)(t&&this.model.add(s.id,s,n)||!t&&i)&&r.push(s);else{if(!("remove"in e))throw new Error(`StorageProxy received invalid update event: ${JSON.stringify(e)}`);for(const{value:r,keys:s,effective:i}of e.remove){const e=this.model.getValue(r.id);(t&&this.model.remove(r.id,s)||!t&&i)&&n.push(e)}}if(r.length||n.length){const t={originatorId:e.originatorId};return r.length&&(t.add=r),n.length&&(t.remove=n),t}return null}toList(){return this.synchronized===s.full?Promise.resolve(this.model.toList()):new Promise(e=>this.port.HandleToList({callback:e,handle:this}))}get(e,t){return this.synchronized===s.full?Promise.resolve(this.model.getValue(e)):new Promise((r,s)=>this.port.HandleToList({callback:t=>r(t.find(t=>t.id===e)),handle:this,particleId:t}))}store(e,t,r){const n=e.id,i={value:e,keys:t};if(this.port.HandleStore({handle:this,callback:()=>{},data:i,particleId:r}),this.synchronized!==s.full)return;if(!this.model.add(n,e,t))return;const a={originatorId:r,add:[e]};this._notify("update",a,e=>e.notifyUpdate)}clear(e){this.synchronized!==s.full&&this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:[],particleId:e});let t=this.model.toList().map(e=>({id:e.id,keys:this.model.getKeys(e.id)}));this.port.HandleRemoveMultiple({handle:this,callback:()=>{},data:t,particleId:e}),(t=(t=t.map(({id:e,keys:t})=>({rawData:this.model.getValue(e).rawData,id:e,keys:t}))).filter(e=>this.model.remove(e.id,e.keys))).length>0&&this._notify("update",{originatorId:e,remove:t},e=>e.notifyUpdate)}remove(e,t,r){if(this.synchronized!==s.full){const t={id:e,keys:[]};return void this.port.HandleRemove({handle:this,callback:()=>{},data:t,particleId:r})}const n=this.model.getValue(e);if(!n)return;0===t.length&&(t=this.model.getKeys(e));const i={id:e,keys:t};if(this.port.HandleRemove({handle:this,callback:()=>{},data:i,particleId:r}),!this.model.remove(e,t))return;const a={originatorId:r,remove:[n]};this._notify("update",a,e=>e.notifyUpdate)}}class l extends o{constructor(){super(...arguments),this.model=null}_getModelForSync(){return this.model}_synchronizeModel(e,t){return null==this.barrier&&(this.version=e,this.model=0===t.length?null:t[0].value,Object(n.assert)(void 0!==this.model),!0)}_processUpdate(e,t=!0){if(Object(n.assert)("data"in e),!t)return e;if(null!=this.barrier){if(e.barrier===this.barrier&&(this.barrier=null,this.synchronized!==s.full)){this.synchronized=s.full;const e=this._getModelForSync();this._notify("sync",e,e=>e.keepSynced&&e.notifySync)}return null}return this.model=e.data,e}get(){return this.synchronized===s.full?Promise.resolve(this.model):new Promise(e=>this.port.HandleGet({callback:e,handle:this}))}set(e,t){if(Object(n.assert)(void 0!==e),JSON.stringify(this.model)===JSON.stringify(e))return;let r;r=this.listenerAttached?this.generateID():null,this.model=JSON.parse(JSON.stringify(e)),this.barrier=r,this.port.HandleSet({data:e,handle:this,particleId:t,barrier:r});const s={originatorId:t,data:e};this._notify("update",s,e=>e.notifyUpdate)}clear(e){if(null==this.model)return;const t=this.generateID();this.model=null,this.barrier=t,this.port.HandleClear({handle:this,particleId:e,barrier:t});const r={originatorId:e,data:null};this._notify("update",r,e=>e.notifyUpdate)}}class u extends o{register(e,t){t.canRead&&this.scheduler.enqueue(e,t,["sync",e,{}])}_getModelForSync(){throw new Error("_getModelForSync not implemented for BigCollectionProxy")}_processUpdate(){throw new Error("_processUpdate not implemented for BigCollectionProxy")}_synchronizeModel(){throw new Error("_synchronizeModel not implemented for BigCollectionProxy")}async store(e,t,r){return new Promise(s=>this.port.HandleStore({handle:this,callback:s,data:{value:e,keys:t},particleId:r}))}async remove(e,t){return new Promise(r=>this.port.HandleRemove({handle:this,callback:r,data:{id:e,keys:[]},particleId:t}))}async stream(e,t){return new Promise(r=>this.port.HandleStream({handle:this,callback:r,pageSize:e,forward:t}))}async cursorNext(e){return new Promise(t=>this.port.StreamCursorNext({handle:this,callback:t,cursorId:e}))}cursorClose(e){this.port.StreamCursorClose({handle:this,cursorId:e})}}class h{constructor(){this._scheduled=!1,this._queues=new Map,this._idleResolver=null,this._idle=null,this._scheduled=!1,this._queues=new Map}enqueue(e,t,r){this._queues.has(e)||this._queues.set(e,new Map);const s=this._queues.get(e);s.has(t)||s.set(t,[]),s.get(t).push(r),this._schedule()}get busy(){return this._queues.size>0}_updateIdle(){this._idleResolver&&!this.busy&&(this._idleResolver(),this._idle=null,this._idleResolver=null)}get idle(){return this.busy?(this._idle||(this._idle=new Promise(e=>this._idleResolver=e)),this._idle):Promise.resolve()}_schedule(){this._scheduled||(this._scheduled=!0,setTimeout(()=>{this._scheduled=!1,this._dispatch()},0))}_dispatch(){for(;this._queues.size>0;){const e=[...this._queues.keys()][0],t=this._queues.get(e);this._queues.delete(e);for(const[e,r]of t.entries())for(const t of r)try{e._notify(...t)}catch(t){console.error("Error dispatching to particle",t),e._proxy.raiseSystemException(t,"StorageProxyScheduler::_dispatch",e._particleId)}}this._updateIdle()}}},"./runtime/ts-build/storage/crdt-collection-model.js":
/*!***********************************************************!*\
  !*** ./runtime/ts-build/storage/crdt-collection-model.js ***!
  \***********************************************************/
/*! exports provided: CrdtCollectionModel */function(e,t,r){"use strict";r.r(t),r.d(t,"CrdtCollectionModel",function(){return n});var s=r(/*! ../../../platform/assert-web.js */"./platform/assert-web.js");
// @license
class n{constructor(e){if(this.items=new Map,e)for(let{id:t,value:r,keys:s}of e)s||(s=[]),this.items.set(t,{value:r,keys:new Set(s)})}add(e,t,r){Object(s.assert)(r.length>0&&"object"==typeof r,"add requires a list of keys");let n=this.items.get(e),i=!1;if(n){let e=!1;for(const t of r)n.keys.has(t)||(e=!0),n.keys.add(t);this._equals(n.value,t)||(Object(s.assert)(e,"cannot add without new keys. incoming="+r.join(",")+" existing="+[...n.keys].join(",")),n.value=t,i=!0)}else n={value:t,keys:new Set(r)},this.items.set(e,n),i=!0;return i}_equals(e,t){if(Boolean(e)!==Boolean(t))return!1;if(!e)return!0;const r=typeof e;if(r!==typeof t)return!1;if("object"===r){const r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>this._equals(e[r],t[r]))}return JSON.stringify(e)===JSON.stringify(t)}remove(e,t){const r=this.items.get(e);if(!r)return!1;for(const e of t)r.keys.delete(e);const s=0===r.keys.size;return s&&this.items.delete(e),s}toLiteral(){const e=[];for(const[t,{value:r,keys:s}]of this.items.entries())e.push({id:t,value:r,keys:[...s]});return e}toList(){return[...this.items.values()].map(e=>e.value)}has(e){return this.items.has(e)}getKeys(e){const t=this.items.get(e);return t?[...t.keys]:[]}getValue(e){const t=this.items.get(e);return t?t.value:null}get size(){return this.items.size}}},"./runtime/ts-build/symbols.js":
/*!*************************************!*\
  !*** ./runtime/ts-build/symbols.js ***!
  \*************************************/
/*! exports provided: Symbols */function(e,t,r){"use strict";r.r(t),r.d(t,"Symbols",function(){return s});
// @license
const s={identifier:Symbol("id")}},"./runtime/ts-build/type-variable.js":
/*!*******************************************!*\
  !*** ./runtime/ts-build/type-variable.js ***!
  \*******************************************/
/*! exports provided: TypeVariable */function(e,t,r){"use strict";r.r(t),r.d(t,"TypeVariable",function(){return a});var s=r(/*! ./type.js */"./runtime/ts-build/type.js"),n=r(/*! ../../platform/assert-web.js */"./platform/assert-web.js"),i=r(/*! ./schema.js */"./runtime/ts-build/schema.js");
// @license
class a{constructor(e,t,r){this.name=e,this._canWriteSuperset=t,this._canReadSubset=r,this._resolution=null}maybeMergeConstraints(e){return!!this.maybeMergeCanReadSubset(e.canReadSubset)&&this.maybeMergeCanWriteSuperset(e.canWriteSuperset)}maybeMergeCanReadSubset(e){if(null==e)return!0;if(null==this.canReadSubset)return this.canReadSubset=e,!0;if(this.canReadSubset instanceof s.SlotType&&e instanceof s.SlotType)return!0;const t=i.Schema.intersect(this.canReadSubset.entitySchema,e.entitySchema);return!!t&&(this.canReadSubset=s.Type.newEntity(t),!0)}maybeMergeCanWriteSuperset(e){if(null==e)return!0;if(null==this.canWriteSuperset)return this.canWriteSuperset=e,!0;if(this.canWriteSuperset instanceof s.SlotType&&e instanceof s.SlotType)return!0;const t=i.Schema.union(this.canWriteSuperset.entitySchema,e.entitySchema);return!!t&&(this.canWriteSuperset=s.Type.newEntity(t),!0)}isSatisfiedBy(e){const t=this._canWriteSuperset;if(!t)return!0;if(!(t instanceof s.EntityType&&e instanceof s.EntityType))throw new Error(`constraint checking not implemented for ${this} and ${e}`);return e.getEntitySchema().isMoreSpecificThan(t.getEntitySchema())}get resolution(){return this._resolution?this._resolution.resolvedType():null}set resolution(e){Object(n.assert)(!this._resolution);const t=e.resolvedType().getContainedType();t instanceof s.VariableType&&Object(n.assert)(t.variable!==this,"variable cannot resolve to collection of itself");let r=e;for(;r&&r instanceof s.VariableType;){if(r.variable===this)return;r=r.variable.resolution}this._resolution=e,this._canWriteSuperset=null,this._canReadSubset=null}get canWriteSuperset(){return this._resolution?(Object(n.assert)(!this._canWriteSuperset),this._resolution instanceof s.VariableType?this._resolution.variable.canWriteSuperset:null):this._canWriteSuperset}set canWriteSuperset(e){Object(n.assert)(!this._resolution),this._canWriteSuperset=e}get canReadSubset(){return this._resolution?(Object(n.assert)(!this._canReadSubset),this._resolution instanceof s.VariableType?this._resolution.variable.canReadSubset:null):this._canReadSubset}set canReadSubset(e){Object(n.assert)(!this._resolution),this._canReadSubset=e}get hasConstraint(){return null!==this._canReadSubset||null!==this._canWriteSuperset}canEnsureResolved(){return this._resolution?this._resolution.canEnsureResolved():!(!this._canWriteSuperset&&!this._canReadSubset)}maybeEnsureResolved(){return this._resolution?this._resolution.maybeEnsureResolved():this._canWriteSuperset?(this.resolution=this._canWriteSuperset,!0):!!this._canReadSubset&&(this.resolution=this._canReadSubset,!0)}toLiteral(){return Object(n.assert)(null==this.resolution),this.toLiteralIgnoringResolutions()}toLiteralIgnoringResolutions(){return{name:this.name,canWriteSuperset:this._canWriteSuperset&&this._canWriteSuperset.toLiteral(),canReadSubset:this._canReadSubset&&this._canReadSubset.toLiteral()}}static fromLiteral(e){return new a(e.name,e.canWriteSuperset?s.Type.fromLiteral(e.canWriteSuperset):null,e.canReadSubset?s.Type.fromLiteral(e.canReadSubset):null)}isResolved(){return this._resolution&&this._resolution.isResolved()}}},"./runtime/ts-build/type.js":
/*!**********************************!*\
  !*** ./runtime/ts-build/type.js ***!
  \**********************************/
/*! exports provided: Type, EntityType, VariableType, CollectionType, BigCollectionType, RelationType, InterfaceType, SlotType, ReferenceType, ArcInfoType, HandleInfoType */function(e,t,r){"use strict";r.r(t),r.d(t,"Type",function(){return o}),r.d(t,"EntityType",function(){return c}),r.d(t,"VariableType",function(){return l}),r.d(t,"CollectionType",function(){return u}),r.d(t,"BigCollectionType",function(){return h}),r.d(t,"RelationType",function(){return d}),r.d(t,"InterfaceType",function(){return p}),r.d(t,"SlotType",function(){return m}),r.d(t,"ReferenceType",function(){return f}),r.d(t,"ArcInfoType",function(){return g}),r.d(t,"HandleInfoType",function(){return y});var s=r(/*! ./schema.js */"./runtime/ts-build/schema.js"),n=r(/*! ./type-variable.js */"./runtime/ts-build/type-variable.js"),i=r(/*! ./shape.js */"./runtime/ts-build/shape.js"),a=r(/*! ./recipe/type-checker.js */"./runtime/ts-build/recipe/type-checker.js");
// @license
class o{constructor(e,t){this.tag=e,this.data=t}static newEntity(e){return new c(e)}static newVariable(e){return new l(e)}static newCollection(e){return new u(e)}static newBigCollection(e){return new h(e)}static newRelation(e){return new d(e)}static newInterface(e){return new p(e)}static newSlot(e){return new m(e)}static newReference(e){return new f(e)}static newArcInfo(){return new g}static newHandleInfo(){return new y}static fromLiteral(e){switch(e.tag){case"Entity":return new c(s.Schema.fromLiteral(e.data));case"Variable":return new l(n.TypeVariable.fromLiteral(e.data));case"Collection":return new u(o.fromLiteral(e.data));case"BigCollection":return new h(o.fromLiteral(e.data));case"Relation":return new d(e.data);case"Interface":return new p(i.Shape.fromLiteral(e.data));case"Slot":return new m(e.data);case"Reference":return new f(o.fromLiteral(e.data));case"ArcInfo":return new g;case"HandleInfo":return new y;default:throw new Error(`fromLiteral: unknown type ${e}`)}}static unwrapPair(e,t){if(e.tag===t.tag){const r=e.getContainedType();if(null!==r)return o.unwrapPair(r,t.getContainedType())}return[e,t]}static canMergeConstraints(e,t){return o._canMergeCanReadSubset(e,t)&&o._canMergeCanWriteSuperset(e,t)}static _canMergeCanReadSubset(e,t){if(e.canReadSubset&&t.canReadSubset){if(e.canReadSubset.tag!==t.canReadSubset.tag)return!1;if(e.canReadSubset instanceof c)return null!==s.Schema.intersect(e.canReadSubset.entitySchema,t.canReadSubset.entitySchema);throw new Error(`_canMergeCanReadSubset not implemented for types tagged with ${e.canReadSubset.tag}`)}return!0}static _canMergeCanWriteSuperset(e,t){if(e.canWriteSuperset&&t.canWriteSuperset){if(e.canWriteSuperset.tag!==t.canWriteSuperset.tag)return!1;if(e.canWriteSuperset instanceof c)return null!==s.Schema.union(e.canWriteSuperset.entitySchema,t.canWriteSuperset.entitySchema)}return!0}equals(e){return a.TypeChecker.compareTypes({type:this},{type:e})}isResolved(){return!this.hasUnresolvedVariable}mergeTypeVariablesByName(e){return this}_applyExistenceTypeTest(e){return e(this)}get hasVariable(){return this._applyExistenceTypeTest(e=>e instanceof l)}get hasUnresolvedVariable(){return this._applyExistenceTypeTest(e=>e instanceof l&&!e.variable.isResolved())}primitiveType(){return null}getContainedType(){return null}isTypeContainer(){return!1}collectionOf(){return new u(this)}bigCollectionOf(){return new h(this)}resolvedType(){return this}canEnsureResolved(){return this.isResolved()||this._canEnsureResolved()}_canEnsureResolved(){return!0}maybeEnsureResolved(){return!0}get canWriteSuperset(){throw new Error(`canWriteSuperset not implemented for ${this}`)}get canReadSubset(){throw new Error(`canReadSubset not implemented for ${this}`)}isMoreSpecificThan(e){return this.tag===e.tag&&this._isMoreSpecificThan(e)}_isMoreSpecificThan(e){throw new Error(`isMoreSpecificThan not implemented for ${this}`)}clone(e){const t=this.resolvedType();if(t instanceof l){if(e.has(t.variable))return new l(e.get(t.variable));{const r=n.TypeVariable.fromLiteral(t.variable.toLiteral());return e.set(t.variable,r),new l(r)}}return t.data.clone?o.fromLiteral({tag:t.tag,data:t.data.clone(e)}):o.fromLiteral(t.toLiteral())}_cloneWithResolutions(e){return o.fromLiteral(this.toLiteral())}toLiteral(){return this}hasProperty(e){return e(this)||this._hasProperty(e)}_hasProperty(e){return!1}toString(e){return this.tag}getEntitySchema(){return null}toPrettyString(){return null}}class c extends o{get entitySchema(){return this.data}constructor(e){super("Entity",e)}get isEntity(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return this.entitySchema.isMoreSpecificThan(e.entitySchema)}toLiteral(){return{tag:this.tag,data:this.entitySchema.toLiteral()}}toString(e){return this.entitySchema.toInlineSchemaString(e)}getEntitySchema(){return this.entitySchema}toPrettyString(){return this.entitySchema.description.pattern?this.entitySchema.description.pattern:this.entitySchema.name?this.entitySchema.name.replace(/([^A-Z])([A-Z])/g,"$1 $2").replace(/([A-Z][^A-Z])/g," $1").replace(/[\s]+/g," ").trim():JSON.stringify(this.entitySchema.toLiteral())}}class l extends o{get variable(){return this.data}constructor(e){super("Variable",e)}get isVariable(){return!0}mergeTypeVariablesByName(e){const t=this.variable.name;let r=e.get(t);if(r){if(r instanceof l&&(r.variable.hasConstraint||this.variable.hasConstraint)){if(!r.variable.maybeMergeConstraints(this.variable))throw new Error("could not merge type variables")}}else r=this,e.set(t,this);return r}resolvedType(){return this.variable.resolution||this}_canEnsureResolved(){return this.variable.canEnsureResolved()}maybeEnsureResolved(){return this.variable.maybeEnsureResolved()}get canWriteSuperset(){return this.variable.canWriteSuperset}get canReadSubset(){return this.variable.canReadSubset}_cloneWithResolutions(e){if(e.has(this.variable))return new l(e.get(this.variable));{const t=n.TypeVariable.fromLiteral(this.variable.toLiteralIgnoringResolutions());return this.variable.resolution&&(t.resolution=this.variable.resolution._cloneWithResolutions(e)),this.variable._canReadSubset&&(t.canReadSubset=this.variable.canReadSubset._cloneWithResolutions(e)),this.variable._canWriteSuperset&&(t.canWriteSuperset=this.variable.canWriteSuperset._cloneWithResolutions(e)),e.set(this.variable,t),new l(t)}}toLiteral(){return this.variable.resolution?this.variable.resolution.toLiteral():{tag:this.tag,data:this.variable.toLiteral()}}toString(e){return`~${this.variable.name}`}getEntitySchema(){return this.variable.isResolved()?this.resolvedType().getEntitySchema():null}toPrettyString(){return this.variable.isResolved()?this.resolvedType().toPrettyString():`[~${this.variable.name}]`}}class u extends o{get collectionType(){return this.data}constructor(e){super("Collection",e)}get isCollection(){return!0}mergeTypeVariablesByName(e){const t=this.collectionType,r=t.mergeTypeVariablesByName(e);return r===t?this:r.collectionOf()}_applyExistenceTypeTest(e){return this.collectionType._applyExistenceTypeTest(e)}primitiveType(){return this.collectionType}getContainedType(){return this.collectionType}isTypeContainer(){return!0}resolvedType(){const e=this.collectionType,t=e.resolvedType();return e!==t?t.collectionOf():this}_canEnsureResolved(){return this.collectionType.canEnsureResolved()}maybeEnsureResolved(){return this.collectionType.maybeEnsureResolved()}_cloneWithResolutions(e){return new u(this.collectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.collectionType.toLiteral()}}_hasProperty(e){return this.collectionType.hasProperty(e)}toString(e){return`[${this.collectionType.toString(e)}]`}getEntitySchema(){return this.collectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`${this.collectionType.toPrettyString()} List`}}class h extends o{get bigCollectionType(){return this.data}constructor(e){super("BigCollection",e)}get isBigCollection(){return!0}mergeTypeVariablesByName(e){const t=this.bigCollectionType,r=t.mergeTypeVariablesByName(e);return r===t?this:r.bigCollectionOf()}_applyExistenceTypeTest(e){return this.bigCollectionType._applyExistenceTypeTest(e)}getContainedType(){return this.bigCollectionType}isTypeContainer(){return!0}resolvedType(){const e=this.bigCollectionType,t=e.resolvedType();return e!==t?t.bigCollectionOf():this}_canEnsureResolved(){return this.bigCollectionType.canEnsureResolved()}maybeEnsureResolved(){return this.bigCollectionType.maybeEnsureResolved()}_cloneWithResolutions(e){return new h(this.bigCollectionType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.bigCollectionType.toLiteral()}}_hasProperty(e){return this.bigCollectionType.hasProperty(e)}toString(e){return`BigCollection<${this.bigCollectionType.toString(e)}>`}getEntitySchema(){return this.bigCollectionType.getEntitySchema()}toPrettyString(){const e=this.getEntitySchema();return e&&e.description.plural?e.description.plural:`Collection of ${this.bigCollectionType.toPrettyString()}`}}class d extends o{get relationEntities(){return this.data}constructor(e){super("Relation",e)}get isRelation(){return!0}toPrettyString(){return JSON.stringify(this.relationEntities)}}class p extends o{get interfaceShape(){return this.data}constructor(e){super("Interface",e)}get isInterface(){return!0}mergeTypeVariablesByName(e){const t=this.interfaceShape.clone(new Map);return t.mergeTypeVariablesByName(e),new p(t)}_applyExistenceTypeTest(e){return this.interfaceShape._applyExistenceTypeTest(e)}resolvedType(){return new p(this.interfaceShape.resolvedType())}_canEnsureResolved(){return this.interfaceShape.canEnsureResolved()}maybeEnsureResolved(){return this.interfaceShape.maybeEnsureResolved()}get canWriteSuperset(){return new p(this.interfaceShape.canWriteSuperset)}get canReadSubset(){return new p(this.interfaceShape.canReadSubset)}_isMoreSpecificThan(e){return this.interfaceShape.isMoreSpecificThan(e.interfaceShape)}_cloneWithResolutions(e){return new p(this.interfaceShape._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.interfaceShape.toLiteral()}}toString(e){return this.interfaceShape.name}toPrettyString(){return this.interfaceShape.toPrettyString()}}class m extends o{get slot(){return this.data}constructor(e){super("Slot",e)}get isSlot(){return!0}get canWriteSuperset(){return this}get canReadSubset(){return this}_isMoreSpecificThan(e){return!0}toString(e){const t=[];for(const e of Object.keys(this.slot))void 0!==this.slot[e]&&t.push(`${e}:${this.slot[e]}`);let r="";return 0!==t.length&&(r=` {${t.join(", ")}}`),`Slot${r}`}toPrettyString(){const e=[];for(const t of Object.keys(this.slot))void 0!==this.slot[t]&&e.push(`${t}:${this.slot[t]}`);let t="";return 0!==e.length&&(t=` {${e.join(", ")}}`),`Slot${t}`}}class f extends o{get referredType(){return this.data}constructor(e){super("Reference",e)}get isReference(){return!0}getContainedType(){return this.referredType}isTypeContainer(){return!0}resolvedType(){const e=this.referredType,t=e.resolvedType();return e!==t?new f(t):this}_canEnsureResolved(){return this.referredType.canEnsureResolved()}maybeEnsureResolved(){return this.referredType.maybeEnsureResolved()}get canReadSubset(){return this.referredType.canReadSubset}_cloneWithResolutions(e){return new f(this.referredType._cloneWithResolutions(e))}toLiteral(){return{tag:this.tag,data:this.referredType.toLiteral()}}toString(e){return"Reference<"+this.referredType.toString()+">"}}class g extends o{constructor(){super("ArcInfo",null)}get isArcInfo(){return!0}}class y extends o{constructor(){super("HandleInfo",null)}get isHandleInfo(){return!0}}},"./shell/components/xen/xen-state.js":
/*!*******************************************!*\
  !*** ./shell/components/xen/xen-state.js ***!
  \*******************************************/
/*! exports provided: XenStateMixin, nob, debounce */function(e,t,r){"use strict";r.r(t),r.d(t,"XenStateMixin",function(){return i}),r.d(t,"nob",function(){return s}),r.d(t,"debounce",function(){return n});
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=()=>Object.create(null),n=(e,t,r)=>{if(e&&clearTimeout(e),t&&r)return setTimeout(t,r)},i=e=>(class extends e{constructor(){super(),this._pendingProps=s(),this._props=this._getInitialProps()||s(),this._lastProps=s(),this._state=this._getInitialState()||s(),this._lastState=s()}_getInitialProps(){}_getInitialState(){}_getProperty(e){return this._pendingProps[e]||this._props[e]}_setProperty(e,t){(this._validator||this._wouldChangeProp(e,t))&&(this._pendingProps[e]=t,this._invalidateProps())}_wouldChangeValue(e,t,r){return e[t]!==r}_wouldChangeProp(e,t){return this._wouldChangeValue(this._props,e,t)}_wouldChangeState(e,t){return this._wouldChangeValue(this._state,e,t)}_setProps(e){Object.assign(this._pendingProps,e),this._invalidateProps()}_invalidateProps(){this._propsInvalid=!0,this._invalidate()}_setImmutableState(e,t){"object"==typeof e&&(console.warn("Xen:: _setImmutableState takes name and value args for a single property, dictionaries not supported."),t=Object.values(e)[0],e=Object.names(e)[0]),"object"==typeof t&&(t=Object.assign(Object.create(null),t)),this._state[e]=t,this._invalidate()}_setState(e){let t=!1;const r=this._state;for(const s in e){const n=e[s];this._wouldChangeState(s,n)&&(t=!0,r[s]=n)}if(t)return this._invalidate(),!0}_setIfDirty(e){return this._setState(e)}_async(e){return Promise.resolve().then(e.bind(this))}_invalidate(){this._validator||(this._validator=this._async(this._validate))}_getStateArgs(){return[this._props,this._state,this._lastProps,this._lastState]}_validate(){const e=this._getStateArgs();try{Object.assign(this._props,this._pendingProps),this._propsInvalid&&(this._willReceiveProps(...e),this._propsInvalid=!1),this._shouldUpdate(...e)&&(this._ensureMount(),this._doUpdate(...e))}catch(e){console.error(e)}this._validator=null,this._lastProps=Object.assign(s(),this._props),this._lastState=Object.assign(s(),this._state)}_doUpdate(...e){this._update(...e),this._didUpdate(...e)}_ensureMount(){}_willReceiveProps(){}_shouldUpdate(){return!0}_update(){}_didUpdate(){}_debounce(e,t,r){e=`_debounce_${e}`,this._state[e]=n(this._state[e],t,null!=r?r:16)}})},"./shell/source/browser-loader.js":
/*!****************************************!*\
  !*** ./shell/source/browser-loader.js ***!
  \****************************************/
/*! exports provided: BrowserLoader */function(e,t,r){"use strict";r.r(t),r.d(t,"BrowserLoader",function(){return h});var s=r(/*! ../../runtime/ts-build/loader.js */"./runtime/ts-build/loader.js"),n=r(/*! ../../runtime/ts-build/particle.js */"./runtime/ts-build/particle.js"),i=r(/*! ../../runtime/dom-particle.js */"./runtime/dom-particle.js"),a=r(/*! ../../runtime/multiplexer-dom-particle.js */"./runtime/multiplexer-dom-particle.js"),o=r(/*! ../../runtime/transformation-dom-particle.js */"./runtime/transformation-dom-particle.js");
/**
 * @license
 * Copyright (c) 2017 Google Inc. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * Code distributed by Google as part of this project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const c=(e,t,r="log")=>console[r].bind(console,`%c${e} [Particle]`,`background: ${t}; color: white; padding: 1px 6px 2px 7px; border-radius: 4px;`),l=(e,...t)=>(e[0]+t.map((t,r)=>t+e[r+1]).join("")).trim(),u={};class h extends s.Loader{constructor(e){super(),this._urlMap=e}_loadURL(e){const t=this._resolve(e),r=new URL(t,document.URL).href;return u[r]||(u[r]=super._loadURL(t))}loadResource(e){return this._loadURL(e)}_resolve(e){let t=this._urlMap[e];if(!t&&e){const r=Object.keys(this._urlMap).sort((e,t)=>t.length-e.length).find(t=>e.slice(0,t.length)==t);r&&(t=this._urlMap[r]+e.slice(r.length))}return t=t||e}requireParticle(e){const t=this._resolve(e);this.mapParticleUrl(t);const r=[];self.defineParticle=function(e){r.push(e)},importScripts(t),delete self.defineParticle;const s=c(e.split("/").pop(),"#1faa00");return this.unwrapParticle(r[0],s)}mapParticleUrl(e){const t=e.split("/"),r=t.pop(),s=t.join("/"),n=r.split(".").shift();this._urlMap[n]=s}unwrapParticle(e,t){const r=this._resolve.bind(this),s=h.fetch||fetch;return e({Particle:n.Particle,DomParticle:i.DomParticle,MultiplexerDomParticle:a.MultiplexerDomParticle,SimpleParticle:i.DomParticle,TransformationDomParticle:o.TransformationDomParticle,resolver:r,log:t,html:l,_fetch:s})}}},"./shell/source/worker-entry.js":
/*!**************************************!*\
  !*** ./shell/source/worker-entry.js ***!
  \**************************************/
/*! no exports provided */function(e,t,r){"use strict";r.r(t);var s=r(/*! ../../runtime/ts-build/particle-execution-context.js */"./runtime/ts-build/particle-execution-context.js"),n=r(/*! ./browser-loader.js */"./shell/source/browser-loader.js");
// @license
console.log.bind(console,"%cworker-entry","background: #12005e; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;");self.onmessage=function(e){self.onmessage=null;const{id:t,base:r}=e.data;new s.ParticleExecutionContext(e.ports[0],t,new n.BrowserLoader(r))}}})}});
//# sourceMappingURL=worker.js.map