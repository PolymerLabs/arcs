meta
  namespace: arcs.core.data.testdata.gen

import './Schemas.arcs'
import './Ingest.arcs'

particle AnalyzeSentiment
  events: reads [Event {type, value}]
  processed: writes [AnalyzedEvent {sentiment, cohortIndex}]

particle SummarizeSentiment
  pieces: reads [AnalyzedEvent {sentiment, cohortIndex}]
  result: writes OverallSentiment {
    overallSentiment: Number,
    sentimentCohortBreakdown: [Number],
    summary: Text
  }

// Example: Long running arc mapping data from another long running arc
//          and providing data derived from the mapped data.
@trigger
  launch startup
  arcId sentimentAnalysis
recipe SentimentAnalyzer
  // Example: Mapping by id and type; mapping a collection.
  events: map 'raw-events'
  // Example: Handle created without capabilities in a long running arc.
  processed: create
  summary: create persistent 'events-summary' @ttl(15d)
  AnalyzeSentiment
    events: reads events
    processed: writes processed
  SummarizeSentiment
    pieces: reads processed
    result: writes summary
