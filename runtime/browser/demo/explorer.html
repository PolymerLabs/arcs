<!--
Copyright (c) 2017 Google Inc. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt
Code distributed by Google as part of this project is also
subject to an additional IP rights grant found at
http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../../strategy-explorer/strategy-explorer.html"></link>

<style>
  strategy-explorer {
    display: none;
    background-color: white;
    width: 100%;
  }
</style>

<script>
  (function() {
    const hotKey = 'e'; // + CTRL
    let explorer = document.body.appendChild(document.createElement('strategy-explorer'));
    let explorerVisible = false;
    window.addEventListener('keydown', e => {
      if (e.ctrlKey && (e.key == hotKey)) {
        e.stopPropagation();
        e.preventDefault();
        explorerVisible = !explorerVisible;
        explorer.style.display = explorerVisible ? 'block' : '';
        let selectedHash = document.body.querySelector('demo-flow').shadowRoot.querySelector('suggestions-element')._selectedHash;
        if (selectedHash) {
          let seRecipes = [].concat.apply([], Array.from(
            explorer.shadowRoot.querySelector('se-explorer').shadowRoot.querySelectorAll('se-population')).map(se => Array.from(se.shadowRoot.querySelectorAll('se-recipe'))))
          let seRecipe = seRecipes.find(r => r.shadowRoot.querySelector('#hash').textContent == selectedHash);
          if (seRecipe) {
            seRecipe.shadowRoot.querySelector('#recipe-box').click();
          }
        }
      }
    });
    document.addEventListener('generations', e => {
      explorer.reset();
      setTimeout(() => explorer.results = e.detail.map(pop => explorer.preparePopulation(pop)), 0);
    });
  })();
</script>
