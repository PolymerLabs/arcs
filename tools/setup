#!/bin/sh

ROOT=$(dirname $0)/..

NVM_VERSION="v0.34.0"

echo "\n\n1. Install nvm\n\n"
curl -o- "https://raw.githubusercontent.com/creationix/nvm/$NVM_VERSION/install.sh" | sh || \
  (echo "Failed to download nvm version $NVM_VERSION." && exit 1)

echo "\n\n1.1 ensure nvm is in your current process\n\n"
. ~/.nvm/nvm.sh || source ~/.nvm/nvm.sh || \
  (echo 'Failed to ensure nvm is in this process.' && exit 1)

echo "\n\n2. Install node\n"
nvm install 10 || \
  (echo 'Failed to install node version 10.' && exit 1)

echo "\n\n3. Update npm to latest version\n\n"
nvm install-latest-npm  || \
  (echo 'Failed to update npm to latest version.' && exit 1)

echo "\n\n4. Install node_modules\n\n"
(cd $ROOT && npm install) || \
  (echo 'Failed to install node_modules.' && exit 1)

echo "\n\n5. Build the project\n\n"
$ROOT/tools/sigh || \
  (echo 'Failed to build project with `sigh`.' && exit 1)

