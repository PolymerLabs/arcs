#!/bin/sh

ROOT=$(dirname $0)/..

NVM_VERSION="v0.34.0"

fail() {
    echo $1
    exit 1
}

echo "\n\n1. Install nvm\n\n"
curl -o- "https://raw.githubusercontent.com/creationix/nvm/$NVM_VERSION/install.sh" | sh || \
    fail "Failed to download nvm version $NVM_VERSION." 

echo "\n\n1.1 ensure nvm is in your current process\n\n"
. ~/.nvm/nvm.sh || source ~/.nvm/nvm.sh

echo "\n\n2. Install node\n"
(cd $ROOT && nvm install && nvm use) || fail 'Failed to install target node version.' 

echo "\n\n3. Update npm to latest version\n\n"
nvm install-latest-npm  || fail 'Failed to update npm to latest version.'

echo "\n\n4. Install node_modules\n\n"
(cd $ROOT && npm install) || fail 'Failed to install node_modules.' 

