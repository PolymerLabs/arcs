version: '0.0.{build}'

environment:
  nodejs_version: '10'

init:
  - cmd: set NODE_OPTIONS=--max-old-space-size=1024

install:
  - ps: Install-Product node $env:nodejs_version
  - choco install -y python2 gtk-runtime microsoft-build-tools libjpeg-turbo
  - Invoke-WebRequest "http://ftp.gnome.org/pub/GNOME/binaries/win32/gtk+/2.24/gtk+-bundle_2.24.10-20120208_win32.zip" -OutFile "C:\gtk.zip"
  - 7z e "C:\gtk.zip" -o "C:\GTK" -r
  - npm install -g npm@6.9.0
  - appveyor-retry npm install

build: off

# Instead of specific targets, this should use `npm test`.
# But, that needs some work, and the tests themselves aren't stable so I'm
# going to wait to add more sources of possible failure.
test_script:
  - node --version
  - npm --version
  - npm run test-no-web
